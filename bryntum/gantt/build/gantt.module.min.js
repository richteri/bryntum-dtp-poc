/*!
 *
 * Bryntum Gantt 2.1.9
 *
 * Copyright(c) 2020 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
var e="URLSearchParams"in self,t="Symbol"in self&&"iterator"in Symbol,r="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),n="FormData"in self,s="ArrayBuffer"in self;if(s)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=ArrayBuffer.isView||function(e){return e&&i.indexOf(Object.prototype.toString.call(e))>-1};function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function c(e){var r={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t&&(r[Symbol.iterator]=function(){return r}),r}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function u(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function g(e){var t=new FileReader,r=h(t);return t.readAsArrayBuffer(e),r}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function p(){return this.bodyUsed=!1,this._initBody=function(t){var i;this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:r&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:n&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:e&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():s&&r&&((i=t)&&DataView.prototype.isPrototypeOf(i))?(this._bodyArrayBuffer=m(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(t)||o(t))?this._bodyArrayBuffer=m(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var e=u(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?u(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var e,t,r,n=u(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=h(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n&&(this.formData=function(){return this.text().then(y)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=a(e),t=l(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},d.prototype.delete=function(e){delete this.map[a(e)]},d.prototype.get=function(e){return e=a(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},d.prototype.set=function(e,t){this.map[a(e)]=l(t)},d.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},d.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),c(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),c(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),c(e)},t&&(d.prototype[Symbol.iterator]=d.prototype.entries);var f=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function v(e,t){var r,n,s=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,s||null==e._bodyInit||(s=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),f.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&s)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(s)}function y(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(s))}})),t}function b(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},p.call(v.prototype),p.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},b.error=function(){var e=new b(null,{status:0,statusText:""});return e.type="error",e};var C=[301,302,303,307,308];b.redirect=function(e,t){if(-1===C.indexOf(t))throw new RangeError("Invalid status code");return new b(null,{status:t,headers:{location:e}})};var w,S=self.DOMException;try{new S}catch(e){(S=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),S.prototype.constructor=S}function D(e,t){return new Promise((function(n,i){var o=new v(e,t);if(o.signal&&o.signal.aborted)return i(new S("Aborted","AbortError"));var a=new XMLHttpRequest;function l(){a.abort()}a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new d,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var s=r.join(":").trim();t.append(n,s)}})),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var s="response"in a?a.response:a.responseText;setTimeout((function(){n(new b(s,r))}),0)},a.onerror=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},a.ontimeout=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},a.onabort=function(){setTimeout((function(){i(new S("Aborted","AbortError"))}),0)},a.open(o.method,function(e){try{return""===e&&self.location.href?self.location.href:e}catch(t){return e}}(o.url),!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&(r?a.responseType="blob":s&&o.headers.get("Content-Type")&&-1!==o.headers.get("Content-Type").indexOf("application/octet-stream")&&(a.responseType="arraybuffer")),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),o.signal&&(o.signal.addEventListener("abort",l),a.onreadystatechange=function(){4===a.readyState&&o.signal.removeEventListener("abort",l)}),a.send(void 0===o._bodyInit?null:o._bodyInit)}))}D.polyfill=!0,self.fetch||(self.fetch=D,self.Headers=d,self.Request=v,self.Response=b),w=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,t,r){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var s=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}(e,t);if(s){var i=Object.getOwnPropertyDescriptor(s,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}var a=function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return r(t,[{key:"addEventListener",value:function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var r=this.listeners[e],n=0,s=r.length;n<s;n++)if(r[n]===t)return void r.splice(n,1)}},{key:"dispatchEvent",value:function(e){var t=this;if(e.type in this.listeners){for(var r=function(r){setTimeout((function(){return r.call(t,e)}))},n=this.listeners[e.type],s=0,i=n.length;s<i;s++)r(n[s]);return!e.defaultPrevented}}}]),t}(),l=function(t){function l(){var t;return e(this,l),(t=function(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?i(e):t}(this,n(l).call(this))).listeners||a.call(i(t)),Object.defineProperty(i(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(i(t),"onabort",{value:null,writable:!0,configurable:!0}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(l,t),r(l,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),o(n(l.prototype),"dispatchEvent",this).call(this,e)}}]),l}(a),c=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new l,writable:!0,configurable:!0})}return r(t,[{key:"abort",value:function(){var e;try{e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();function d(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}"undefined"!=typeof Symbol&&Symbol.toStringTag&&(c.prototype[Symbol.toStringTag]="AbortController",l.prototype[Symbol.toStringTag]="AbortSignal"),function(e){if(d(e))if(e.fetch){var t=function(e){"function"==typeof e&&(e={fetch:e});var t=e,r=t.fetch,n=t.Request,s=void 0===n?r.Request:n,i=t.AbortController,o=t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,a=void 0!==o&&o;if(!d({fetch:r,Request:s,AbortController:i,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a}))return{fetch:r,Request:l};var l=s;(l&&!l.prototype.hasOwnProperty("signal")||a)&&((l=function(e,t){var r;t&&t.signal&&(r=t.signal,delete t.signal);var n=new s(e,t);return r&&Object.defineProperty(n,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),n}).prototype=s.prototype);var c=r;return{fetch:function(e,t){var r=l&&l.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(r){var n;try{n=new DOMException("Aborted","AbortError")}catch(e){(n=new Error("Aborted")).name="AbortError"}if(r.aborted)return Promise.reject(n);var s=new Promise((function(e,t){r.addEventListener("abort",(function(){return t(n)}),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([s,c(e,t)])}return c(e,t)},Request:l}}(e),r=t.fetch,n=t.Request;e.fetch=r,e.Request=n,Object.defineProperty(e,"AbortController",{writable:!0,enumerable:!1,configurable:!0,value:c}),Object.defineProperty(e,"AbortSignal",{writable:!0,enumerable:!1,configurable:!0,value:l})}else console.warn("fetch() is not available, cannot install abortcontroller-polyfill")}("undefined"!=typeof self?self:global)},"function"==typeof define&&define.amd?define(w):w();const E=/([a-z])([A-Z])/g,x=/[.*+?^${}()|[\]\\]/g,T=/(^[^a-z]+|[^\w]+)/gi,R=(e,t,r)=>t+"-"+r.toLowerCase(),M=e=>e?"_x"+e.charCodeAt(0).toString(16):"__blank__",k={};class I{static capitalizeFirstLetter(e){return e?e[0].toUpperCase()+e.substr(1):null}static lowercaseFirstLetter(e){return e?e[0].toLowerCase()+e.substr(1):null}static hyphenate(e){const t=k[e];return t||(k[e]=e.replace(E,R))}static safeJsonParse(e){let t=null;try{t=JSON.parse(e)}catch(e){console.error(e)}return t}static safeJsonStringify(e){let t=null;try{t=JSON.stringify(e)}catch(e){console.error(e)}return t}static createId(e){return String(e).replace(T,M)}static escapeRegExp(e){return e.replace(x,"\\$&")}static joinPaths(e,t="/"){return e.join(t).replace(new RegExp("\\"+t+"+","g"),t)}}I._$name="StringHelper";let F=!1;try{F=Boolean(window!==window.parent&&window.parent.Siesta)}catch(e){}class A{static setVersion(e,t){this[e=e.toLowerCase()]={version:t,isNewerThan:e=>e<t,isOlderThan:e=>e>t};let r="";r="gantt";const n=`${r}.${e}${t.replace(/\./g,"-")}`;if(!0===window.bryntum[n]){if(!F)throw new Error("Bundle included twice, check cache-busters and file types (.js)");window.BUNDLE_EXCEPTION=!0}else window.bryntum[n]=!0}static getVersion(e){if(!this[e=e.toLowerCase()])throw new Error("No version specified");return this[e].version}static checkVersion(e,t,r,n){const s=this.getVersion(e);let i;switch(r){case"<":i=s<t;break;case"<=":i=s<=t;break;case"=":i=s===t;break;case">=":i=s>=t;break;case">":i=s>t}return i}static deprecate(e,t,r){if(!this.checkVersion(e,t,"<",r))throw new Error("Deprecated API use. "+r);console.warn(`Deprecation warning: You are using a deprecated API which will change in v${t}. ${r}`)}static get isTestEnv(){return F}}(window.bryntum||(window.bryntum={})).getVersion=A.getVersion.bind(A),window.bryntum.checkVersion=A.checkVersion.bind(A),window.bryntum.deprecate=A.deprecate.bind(A),A._$name="VersionHelper";class P{static cacheFlags(e=navigator.platform,t=navigator.userAgent){const r=this;r._isLinux=Boolean(e.match(/Linux/)),r._isMac=Boolean(e.match(/Mac/)),r._isWindows=Boolean(e.match(/Win32/)),r._isIE11=Boolean(t.match(/rv:11/)),r._edgeVersion=r.getVersion(t,/Edge?\/(\d+)\./),r._isEdge=r._edgeVersion>0&&r._edgeVersion<80,r._isEdge||(r._edgeVersion=0),r._isWebkit=Boolean(t.match(/WebKit/))&&!r._isEdge,r._firefoxVersion=r.getVersion(t,/Firefox\/(\d+)\./),r._isFirefox=r._firefoxVersion>0,r._chromeVersion=r._isEdge?0:r.getVersion(t,/Chrom(?:e|ium)\/(\d+)\./),r._isChrome=r._chromeVersion>0,r._isSafari=Boolean(t.match(/Safari/))&&!r._isChrome&&!r._isEdge,r._isMobileSafari=Boolean(t.match(/Mobile.*Safari/)),r._isAndroid=Boolean(t.match(/Android/g));try{document.querySelector(":scope"),r.supportsQueryScope=!r._isFirefox}catch(e){r.supportsQueryScope=!1}r._supportsPassive=!1;try{document.addEventListener("__notvalid__",null,{get passive(){r._supportsPassive=!0}})}catch(e){}}static getVersion(e,t){const r=e.match(t);return r?parseInt(r[1]):0}static get isTouchDevice(){return"_isTouchDevice"in this?this._isTouchDevice:"ontouchstart"in window||!this.isEdge&&navigator.maxTouchPoints>0||this.isEdge&&window.TouchEvent||navigator.msMaxTouchPoints>0}static get supportsPointerEvents(){return Boolean(window.PointerEvent||window.MSPointerEvent)}static set isTouchDevice(e){this._isTouchDevice=e}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isIE11(){return this._isIE11}static get isEdge(){return this._isEdge}static get edgeVersion(){return this._edgeVersion}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get isMobileSafari(){return this._isMobileSafari}static get isAndroid(){return this._isAndroid}static get supportsPassive(){return this._supportsPassive}static get storageAvailable(){let e,t;try{return e=localStorage,t="__storage_test__",e.setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}static setLocalStorageItem(e,t){this.storageAvailable&&localStorage.setItem(e,t)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}static searchParam(e,t=null,r=document.location.search){const n=new RegExp(`[?&]${e}=([^&]*)`),s=r.match(n);return s&&s[1]||t}static getCookie(e){const t=encodeURIComponent(e)+"=",r=document.cookie.split(";");for(let e=0;e<r.length;e++){let n=r[e];for(;" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return decodeURIComponent(n.substring(t.length,n.length))}return""}static get queryString(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries())}static get isBrowserEnv(){return"undefined"!=typeof window}}P.isBrowserEnv&&P.cacheFlags(),P._$name="BrowserHelper";const L=Symbol("defaultConfig"),O=Symbol("propertyInitializers"),_=Symbol("classHierarchy"),$=Symbol("configuration"),j=Symbol("originalConfig"),H=Symbol("instanceProperties"),{hasOwnProperty:N}=Object.prototype;class B{constructor(...e){this.construct(...e),this.afterConstruct()}construct(...e){null!==e[0]&&this.configure(...e),this.afterConfigure()}static destroy(...e){e.forEach(e=>{e&&e.destroy&&!e.isDestroyed&&e.destroy()})}destroy(){const e=this;e.isDestroying=!0,e.doDestroy(),Object.setPrototypeOf(this,null);for(const t in e)delete e[t];delete e[j],e.isDestroyed=!0}_thisIsAUsedExpression(e){}static get $name(){return N.call(this,"_$name")&&this._$name||this.name}get $name(){return this.constructor.$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,t,r){"this"===t&&(t=this);const{handler:n,thisObj:s}=this.resolveCallback(e,t);return r?n.apply(s,r):n.call(s)}resolveCallback(e,t=this){if(e.substr){if(e.startsWith("up."))for(e=e.substr(3),t=this.owner;t&&!t[e];t=t.owner);else e.startsWith("this.")&&(t=this);e=t[e]}return{handler:e,thisObj:t}}bindCallback(e,t=this){if(e){const{handler:r,thisObj:n}=this.resolveCallback(e,t);if(r)return r.bind(n)}}delay(e,t){e=this.setTimeout?e:e.bind(this),("number"==typeof t?this.setTimeout||setTimeout:this.requestAnimationFrame||requestAnimationFrame)(e,t)}doDestroy(){}destroyProperties(...e){const t=this;let r,n;for(r of e)!(r in t)||t[$]&&t[$][r]||(n=t[r],n&&n.destroy&&n.destroy(),delete t[r])}configure(e={}){const t=this;t.initialConfig=e,t.isConfiguring=!0,Object.assign(t,t.getProperties()),t.setConfig(t[j]=B.assign(t.getDefaultConfiguration(),e),!0),t.isConfiguring=!1}setConfig(e,t){const r=this,n=r[$],s=n?r.configDone:r.configDone={},i=r[H]={};let o,a;for(o in r[$]=n?Object.setPrototypeOf(Object.assign({},e),n):e,e)null!=e[o]||N.call(e,o)?(i[o]||!(a=Reflect.getOwnPropertyDescriptor(r,o))||"value"in a||(i[o]=a),Reflect.defineProperty(r,o,B.createPropInitializer(o)),t||(s[o]=!1)):s[o]=!0;for(o in t&&r.startConfigure(e),e)s[o]||(r[o]=e[o]);n?r[$]=n:delete r[$],t&&r.finishConfigure(e)}get config(){let e,t={},r=this[j];for(e in r)t[e]=r[e];return t}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.getConfigDescriptor(),t=e.needsFork?this.fork(e.defaultConfig):Object.setPrototypeOf({},e.defaultConfig);if(A.isTestEnv&&t.testConfig&&window.__applyTestConfigs)for(const e in t.testConfig)t[e]=t.testConfig[e];return t}static getConfigDescriptor(e){const t=this;let r,n,s,i,o,a=!e&&N.call(t,L)?t[L]:null;if(!a){for(n in a={defaultConfig:r=N.call(t,"defaultConfig")?t.defaultConfig:{},needsFork:0},e||(t[L]=a),r)if(i=r[n],i&&(i.constructor===Object||Array.isArray(i))&&!Object.isFrozen(i)){a.needsFork=1;break}if(!e)for(s=t.superclass;s&&s!==B;s=s.superclass)o=s.getConfigDescriptor(!0),Object.keys(o.defaultConfig).length&&(a.needsFork|=o.needsFork,Object.setPrototypeOf(r,r=o.defaultConfig))}return a}static fork(e){var t,r,n;if(e&&e.constructor===Object&&!Object.isFrozen(e))for(r in t=Object.setPrototypeOf({},e),e)(n=e[r])&&(n.constructor===Object?t[r]=this.fork(n):n instanceof Array&&(t[r]=n.slice()));else t=e;return t}static assign(e,...t){for(var r,n,s=0,i=t.length;s<i;s++)for(n in r=t[s])e[n]=r[n];return e}getProperties(){const e=this.classHierarchy(),t=e.length;let r,n,s={};for(r=0;r<t;r++)n=e[r],N.call(n,"properties")&&Object.assign(s,n.properties);return s}static get superclass(){return Object.getPrototypeOf(this)}static createPropInitializer(e){var t=(this[O]||(this[O]={}))[e];if(!t){const r="initializing"+I.capitalizeFirstLetter(e);t=this[O][e]={configurable:!0,get(){const t=this,n=t[H][e];return n?Reflect.defineProperty(t,e,n):delete t[e],t[r]=!0,t[e]=t[$][e],t[r]=!1,t.configDone[e]=!0,t[e]},set(t){const r=this,n=r[H][e];n?Reflect.defineProperty(r,e,n):delete r[e],r.configDone[e]=!0,r[e]=t}}}return t}classHierarchy(e){let t,r=this.constructor,n=N.call(r,_)?r[_]:null;if(!n){for(n=r[_]=[];r!==B;r=Object.getPrototypeOf(r))n.unshift(r);Object.freeze(n)}if(e)for(let r=0;!t&&r<n.length;r++)n[r]===e&&(t=n.slice(r));else t=n;return t}classNameHierarchy(e){return this.classHierarchy(e).map(e=>e.$name)}static isOfTypeName(e){return this.classNameHierarchy().includes(e)}detachListeners(e){let t=this.$detachers;if(t=t&&t[e],t)for(;t.length;)t.pop()()}trackDetacher(e,t){const r=this.$detachers||(this.$detachers={});(r[e]||(r[e]=[])).push(t)}untrackDetachers(e){const t=this.$detachers;if(t)for(const r in t){const n=t[r];for(let t=n.length;t-- >0;)n[t].eventer===e&&n.splice(t,1)}}}Object.assign(B.prototype,{$detachers:null}),A.setVersion("core","0.0.0"),B._$name="Base";class z{static clean(e){return e.reduce((e,t)=>(null==t||Array.isArray(t)&&0===t.length||""===t||e.push(t),e),[])}static remove(e,...t){let r,n,s=!1;for(let i=0;i<t.length;i++)n=t[i],-1!==(r=e.indexOf(n))&&(e.splice(r,1),s=!0);return s}static findInsertionIndex(e,t,r=this.lexicalCompare,n){const s=t.length;let i,o;return n<s&&(i=n>0?r(t[n-1],e):0,o=n<s-1?r(e,t[n]):0,i<1&&o<1)?n:this.binarySearch(t,e,r)}static binarySearch(e,t,r=0,n=e.length,s=this.lexicalCompare){const i=e.length;let o,a;for(r instanceof Function?(s=r,r=0):n instanceof Function&&(s=n,n=i),--n;r<=n;)o=r+n>>1,a=s(t,e[o]),a>=0?r=o+1:a<0&&(n=o-1);return r}magnitudeCompare(e,t){return e<t?-1:e>t?1:0}lexicalCompare(e,t){return(e=String(e))<(t=String(t))?-1:e>t?1:0}static fill(e,t={},r=null){const n=[],s=Array.isArray(t)?t:[t];for(let t=0;t<e;t++)for(let e of s){const s=Object.assign({},e);r&&r(s,t),n.push(s)}return n}static populate(e,t){const r=[];for(let n=0;n<e;n++)r.push(t(n));return r}static include(e,t){e.includes(t)||e.push(t)}static allowNegative(e){return new Proxy(e,{get(e,t,r){if("string"!=typeof t)return Reflect.get(e,t,r);const n=Number(t);return Number.isNaN(n)?Reflect.get(e,t,r):e[n<0?e.length+n:n]},set(e,t,r,n){if("string"!=typeof t)return Reflect.set(e,t,r,n);const s=Number(t);return Number.isNaN(s)?Reflect.set(e,t,r,n):(e[s<0?e.length+s:s]=r,!0)}})}static delta(e,t){if(!t)return{onlyInA:e,onlyInB:[],inBoth:[]};const r=[],n=[],s=[];for(let n=0;n<e.length;n++){const i=e[n];t.includes(i)?s.push(i):r.push(i)}for(let e=0;e<t.length;e++){const r=t[e];s.includes(r)||n.push(r)}return{onlyInA:r,onlyInB:n,inBoth:s}}}z._$name="ArrayHelper";const V={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,name:1,_oldDestructor:1},W=(e,t)=>t.prio-e.prio;var G=e=>class extends(e||B){static get defaultConfig(){return{listeners:null}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(...e){super.construct(...e),this.processConfiguredListeners()}processConfiguredListeners(e=this.listeners&&this.initialEventListeners){const t=this;if(e&&!t.defaultListenersInitialized){const r=t.addListener(e,t);!1!==t.listeners.detachable&&(t.listenerDetacher=r),t.defaultListenersInitialized=!0}}doDestroy(){const e=this;e.trigger("destroy"),e.listenerDetacher&&e.listenerDetacher(),e.removeAllListeners(),super.doDestroy()}addListener(e,t,r){const n=this,s=n.eventListeners||(n.eventListeners={});if("string"==typeof e)return n.addListener({[e]:t,detachable:!1!==t.detachable,thisObj:r});{t=void 0!==e.thisObj?e.thisObj:e.thisObj=t;for(const r in e)if(!V[r]){const i=e[r],o={fn:"object"==typeof i?i.fn:i,thisObj:void 0!==i.thisObj?i.thisObj:t,args:i.args||e.args,prio:void 0!==i.prio?i.prio:void 0!==e.prio?e.prio:0,once:void 0!==i.once?i.once:void 0!==e.once&&e.once,catchAll:"catchAll"===r},a=r.toLowerCase(),l=s[a]||(s[a]=[]);i.expires&&n.delay(()=>n.un(a,o),e.expires),l.splice(z.findInsertionIndex(o,l,W,l.length),0,o)}e.relayAll&&n.relayAll(e.relayAll),t&&n.attachAutoDetacher(e);const r=!1!==e.detachable,i=e.name,o=e.expires||r||i?()=>{n.isDestroyed||n.removeListener(e)}:null;if(o&&(o.eventer=n,o.listenerName=i,i&&t&&t.trackDetacher&&t.trackDetacher(i,o),e.expires&&n.delay(o,e.expires),r))return o}}on(){return this.addListener(...arguments)}un(){this.removeListener(...arguments)}set listeners(e){this.isConfiguring?this.initialEventListeners=e:(this.removeAllListeners(),e&&this.on(e))}get listeners(){return this.eventListeners||this.initialEventListeners}removeListener(e,t=e.thisObj,...r){const n=this;"string"!=typeof e?(Object.entries(e).forEach(([e,r])=>{if(V[e])return;const s=e.toLowerCase(),i=n.eventListeners&&n.eventListeners[s];if(i){const e=i.findIndex(e=>!(e.fn!==r&&e.fn!==r.fn||e.thisObj!==t&&e.thisObj!==r.thisObj&&t));e>=0&&(i.splice(e,1),i.length||delete n.eventListeners[s])}}),e.thisObj&&!e.thisObj.isDestroyed&&n.detachAutoDetacher(e)):n.removeListener({[e]:t},!(r.length>0)||r[0])}hasListener(e){return Boolean(this.eventListeners&&this.eventListeners[e])}relayAll(e,t,r=!0){(this.relayAllTargets||(this.relayAllTargets=[])).push({through:e,prefix:t,transformCase:r})}removeAllListeners(){const e=this.eventListeners;let t,r;for(const n in e){const s=e[n];for(t=s.length;t-- >0;){const e=s[t];this.removeListener(n,e),r=e.thisObj,r&&r.untrackDetachers&&r.untrackDetachers(this)}}}relayEvents(e,t,r){const n={detachable:!0},s=(e,...t)=>this.trigger((r||"")+e,...t);return t.forEach(e=>{n[e]=(...t)=>s(e,...t)}),e.on(n)}attachAutoDetacher(e){const t=e.thisObj,r="doDestroy"in t?"doDestroy":"destroy";r in t?(e._oldDestructor=t[r],t[r]=()=>{this.isDestroyed||this.removeListener(e),e._oldDestructor.call(t)}):t[r]=()=>{this.removeListener(e)}}detachAutoDetacher(e){const t=e.thisObj,r="doDestroy"in t?"doDestroy":"destroy";e._oldDestructor&&(t[r]=e._oldDestructor)}await(e,t={checkLog:!0,resetLog:!0}){const r=this;return!1===t&&(t={checkLog:!1}),new Promise(n=>{t.checkLog&&r._triggered&&r._triggered[e]&&(n(),t.resetLog&&r.clearLog(e)),r.on({[e]:(...s)=>{n(...s),t.resetLog&&r.clearLog(e)},prio:-1e4,once:!0})})}clearLog(e){this._triggered&&(e?delete this._triggered[e]:this._triggered={})}callPreventable(e,t,r,n=[],s=!1){const i=this;if(!s&&!1===i.trigger("before"+I.capitalizeFirstLetter(e),t))return!1;const o=r(t,...n);return s||i.trigger(e,t),o}trigger(e,t){const r=this,n=e.toLowerCase(),{eventsSuspended:s,relayAllTargets:i,callOnFunctions:o,owner:a}=r;let l=r.eventListeners&&r.eventListeners[n],c=!0;if(r._triggered||(r._triggered={}),r._triggered[e]=!0,s)return s.shouldQueue&&s.queue.push(arguments),!0;if(r.eventListeners&&r.eventListeners.catchall&&((l=l?l.slice():[]).push(...r.eventListeners.catchall),l.sort(W),c=!1),!l&&!i&&!o)return!0;if(t?"source"in t||(Object.isExtensible(t)?t.source=r:t=Object.setPrototypeOf({source:r},t)):t={source:r},t.type!==n&&(t.constructor!==Object?Reflect.defineProperty(t,"type",{get:()=>n}):t.type=n),o){const n="on"+I.capitalizeFirstLetter(e);if(n in r&&(r.callback(r[n],r,[t]),!r.isDestroyed&&Object.prototype.hasOwnProperty.call(r,n)&&(!r.pluginFunctionChain||!r.pluginFunctionChain[n]))){const e=Object.getPrototypeOf(r);if(n in e&&(e[n].call(r,t),r.isDestroyed))return}}if(l){let e,s,i=0;for(c&&(l=l.slice());i<l.length&&!r.isDestroyed;i++){e=l[i];let o=e.thisObj;if(!o||!o.isDestroyed){if(e.once&&r.removeListener(n,e),"string"==typeof e.fn){if(o&&(s=o[e.fn]),!s){const t=r.resolveCallback(e.fn);s=t.handler,o=t.thisObj}}else s=e.fn;if(e.args){if(!1===s.call(o||r,...e.args,t))return!1}else if(!1===s.call(o||r,t))return!1}}}return i&&i.forEach(r=>{let n=e;if(r.transformCase&&(n=I.capitalizeFirstLetter(n)),r.prefix&&(n=r.prefix+n),!1===r.through.trigger(n,t))return!1}),!(t.bubbles&&a&&!a.isDestroyed)||a.trigger(e,t)}suspendEvents(e=!1){(this.eventsSuspended||(this.eventsSuspended={shouldQueue:e,queue:[],count:0})).count++}resumeEvents(){const e=this.eventsSuspended;if(e&&0==--e.count&&(this.eventsSuspended=null,e.shouldQueue))for(const t of e.queue)this.trigger(...t);return!Boolean(this.eventsSuspended)}};class U{static register(e,t){const r=q.get(t);e=e.toLowerCase(),Y[e]=t,r?r[e]=1:q.set(t,{[e]:1})}static getClass(e){return Y[e.toLowerCase()]}static isType(e,t,r){t=t.toLowerCase();for(let n=e.constructor;n;n=r&&Object.getPrototypeOf(n)){const e=Object.prototype.hasOwnProperty.call(n,"$name")?n.$name:n.name;let r=q.get(n);if(!r&&e&&(r={[e.toLowerCase()]:1},q.set(n,r)),r&&r[t])return!0}}static createWidget(e,t){const r=this.getClass(e||"widget");return r?new r(t):null}}const Y=U.widgetRegister={},q=U.widgetClassRegister=new Map;function X(e,t){const r=e.classHierarchy();for(let e=0;e<r.length;e++)if(r[e].$name.toLowerCase()===t)return!0;return!1}U._$name="BryntumWidgetAdapterRegister";class K{static generateId(e="generatedId"){return e+ ++K.idCounter}static register(e,t=""){let r=e.id;if(null==r&&(r=e.id=K.generateId(t),e.hasGeneratedId=!0),r in K.idMap&&!this.disableThrow)throw new Error("Id "+r+" already in use");K.idMap[r]=e}static unregister(e){K.idMap[e.id]===e&&delete K.idMap[e.id]}static get(e){return K.idMap[e]}static query(e,t=!1){const r=K.idMap;for(let n in r)if(Z(r[n],e,t))return r[n];return null}static queryAll(e,t=!1){const r=K.idMap,n=[];for(let s in r)Z(r[s],e,t)&&n.push(r[s]);return n}static fromElement(e,t,r){const n=typeof t;e&&e instanceof Event&&(e=e.target),("number"===n||t&&1===t.nodeType)&&(r=t,t=null);let s,i,o,a=e,l=K.idMap,c=0;for("number"!=typeof r&&(s=r,r=Number.MAX_VALUE),"string"===n&&(t=t.toLowerCase());a&&1===a.nodeType&&c<r&&a!==s;){if(i=a.dataset&&a.dataset.ownerCmp||a.id,i){if(o=l[i],o){if(!t)return o;if("function"===n){if(t(o))return o}else if(Z(o,t)||X(o,t))return o}c++}a=a.parentNode}return null}}function Z(e,t,r){return"*"===t||("function"==typeof t?t(e):U.isType(e,t,r))}K.idCounter=0,K.idMap={},(window.bryntum||(window.bryntum={})).get=K.get,window.bryntum.IdHelper=K,window.bryntum.query=K.query,window.bryntum.queryAll=K.queryAll,window.bryntum.fromElement=K.fromElement,K._$name="IdHelper";class J{static set adapter(e){this._adapter=new e}static get adapter(){if(!this._adapter)throw new Error("Widget adapter is required. Please import BryntumWidgetAdapter class. See docs here: https://www.bryntum.com/docs/grid/#Core/adapter/widget/BryntumWidgetAdapter");return this._adapter}static get hasAdapter(){return!!this._adapter}static getById(e){return K.get(e)}static fromElement(e,t,r){return K.fromElement(e,t,r)}static createWidget(e={}){return this.adapter.createWidget(e)}static append(e,t){if(e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||"string"==typeof t)&&(t={appendTo:t}),t.insertFirst){const e="string"==typeof t.insertFirst?document.getElementById(t.insertFirst):t.insertFirst;e.firstChild?t.insertBefore=e.firstChild:t.appendTo=e}return this.adapter.appendWidgets(e,t)}static openPopup(e,t){return this.adapter.openPopup(e,t)}static showContextMenu(e,t){return this.adapter.showContextMenu(e,t)}static attachTooltip(e,t){return this.adapter.attachTooltip(e,t)}static hasTooltipAttached(e){return this.adapter.hasTooltipAttached(e)}static destroyTooltipAttached(e){return this.adapter.destroyTooltipAttached(e)}static mask(e,t){return this.adapter.mask(e,t)}static unmask(e,t=!0){this.adapter.unmask(e)}static toast(e){this.adapter.toast(e)}static set defaultStyle(e){this.adapter.defaultStyle=e}static get defaultStyle(){return this.adapter.defaultStyle}}J._$name="WidgetHelper";const Q=/^(\w+)=(.*)$/;class ee{static get(e,t){return this.fetch(e,t)}static post(e,t,r={}){return t instanceof FormData||"string"==typeof t||(t=JSON.stringify(t),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:t},r))}static fetch(e,t={}){const r=new AbortController;if(Object.assign(t,{abortController:r,signal:r.signal}),"credentials"in t||(t.credentials="include"),t.queryParams){const r=Object.entries(t.queryParams);r.length&&(e+="?"+r.map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&"))}const n=new Promise((r,s)=>{fetch(e,t).then(e=>{t.parseJson?e.json().then(t=>{e.parsedJson=t,r(e)}).catch(t=>{e.parsedJson=null,e.error=t,s(e)}):r(e)}).catch(e=>{e.stack=n.stack,s(e)})});return n.stack=(new Error).stack,n.abort=function(){r.abort()},n}static mockUrl(e,t){(this.mockAjaxMap||(this.mockAjaxMap={}))[e]=t,ee.originalFetch||(ee.originalFetch=ee.fetch),ee.fetch=this.mockAjaxFetch.bind(this)}static mockAjaxFetch(e,t){let r=e.split("?"),n=this.mockAjaxMap[r[0]],s=null;if(n){"function"==typeof n&&(n=n(r[0],r[1]&&function(e){const t={},r=e.split("&");for(const e of r){const[r,n,s]=Q.exec(e),i=decodeURIComponent(n),o=decodeURIComponent(s);if(r){let e=t[i];e?(Array.isArray(e)||(e=t[i]=[e]),e.push(o)):t[i]=o}}return t}(r[1]),t));try{s=t.parseJson&&JSON.parse(n.responseText)}catch(e){s=null,n.error=e}return n=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:s,text:()=>new Promise(e=>{e(n.responseText)}),json:()=>new Promise(e=>{e(s)})},n),new Promise((function(e,t){n.synchronous?e(n):setTimeout((function(){e(n)}),"delay"in n?n.delay:100)}))}return ee.originalFetch(e,t)}}ee._$name="AjaxHelper";class te{static mergeLocales(...e){const t={};return e.forEach(e=>{Object.keys(e).forEach(r=>{"object"==typeof e[r]?t[r]={...t[r],...e[r]}:t[r]=e[r]})}),t}static trimLocale(e,t){const r=(t,r)=>{if(!e[t])throw new Error(`Key "${t}" doesn't exist in locale`);if(r){if(!e[t][r])throw new Error(`SubKey "${t}.${r}" doesn't exist in locale`);delete e[t][r]}else delete e[t]};Object.keys(t).forEach(e=>{Array.isArray(t[e])?t[e].forEach(t=>r(e,t)):r(e)})}static publishLocale(e,t){const r=window.bryntum=window.bryntum||{},n=r.locales=r.locales||{};n[e]=n[e]?this.mergeLocales(n[e],t):t}}te._$name="LocaleHelper";class re extends(G(B)){static get defaultConfig(){return{locales:{},throwOnMissingLocale:A.isTestEnv}}construct(...e){const t=this;super.construct(...e);const r=document.querySelector("script[data-default-locale]");r&&(t.defaultLocaleName=r.dataset.defaultLocale),window.bryntum&&window.bryntum.locales&&(Object.keys(window.bryntum.locales).forEach(e=>{if(!e.startsWith("moment")){const r=window.bryntum.locales[e];r.extends?t.extendLocale(r.extends,r):r.localeName&&t.registerLocale(r.localeName,{desc:r.localeDesc,locale:r})}}),t.locale||"En"!==t.defaultLocaleName&&t.applyLocale(t.defaultLocaleName||Object.keys(t.locales)[0]))}set locales(e){this._locales=e}get locales(){return this._locales}set locale(e){"string"==typeof e?this.applyLocale(e):(e.locale||(e={locale:e,localeName:e.localeName||"custom"}),this.registerLocale(e.localeName,e),this.applyLocale(e.localeName))}get locale(){return this._locale}registerLocale(e,t){const r=this,n=r.defaultLocaleName===e,s=r.locale&&r.locale.localeName===e,i=0===Object.keys(r.locales).length;r.locales[e]?r.locales[e].locale=te.mergeLocales(r.locales[e].locale,t.locale):r.locales[e]=t,(n||!r.defaultLocaleName&&(i||s))&&r.internalApplyLocale(r.locales[e])}extendLocale(e,t){var r;const n=this.locales[e];return!!n&&(n.locale=te.mergeLocales(n.locale,t),delete n.locale.extends,(null===(r=this.locale)||void 0===r?void 0:r.localeName)===e&&this.applyLocale(e),!0)}internalApplyLocale(e){this._locale=e.locale,this.trigger("locale",e)}applyLocale(e,t=!1,r=!1){const n=this,s=n.locales[e];if(s&&s.locale&&n._locale===s.locale&&!t)return!0;if(!s){if(r)return!0;throw new Error(`Locale ${e} not registered`)}function i(){n.internalApplyLocale(s)}return s.locale?(i(),!0):new Promise((t,r)=>{n.loadLocale(s.path).then(r=>{r.text().then(r=>{new Function(r)(),s.locale=window.bryntum.locales[e],i(),t(s)})}).catch(e=>r(e))})}loadLocale(e){return ee.get(e)}set throwOnMissingLocale(e){this._throwOnMissingLocale=e}get throwOnMissingLocale(){return this._throwOnMissingLocale}}const ne=new re,se=Object.getPrototypeOf(Object),ie=/L{.*?}/g,oe=e=>e.replace(/\[\[(\d+)]]/gm,"{$1}");var ae=e=>class t extends(e||B){static get defaultConfig(){return{localeClass:null,localizableProperties:[]}}static clsName(e){var t,r;return"string"==typeof e?e:e===se?"Object":e.$name||e.name||(null===(t=e.prototype)||void 0===t?void 0:t.$name)||(null===(r=e.prototype)||void 0===r?void 0:r.name)}static parseLocaleString(e){var t;const r=[];let n;if(null===(t=e)||void 0===t?void 0:t.includes("L{")){const t=/L{(.*?)}/g;for(e=e.replace(/{(\d+)}/gm,"[[$1]]");null!=(n=t.exec(e));){const e=/((.*?)\.)?(.+)/g.exec(n[1]);r.push({match:oe(n[0]),localeKey:oe(e[3]),localeClass:e[2]})}}return r.length>0?r:[{match:e,localeKey:e}]}construct(e={},...t){super.construct(e,...t),ne.on("locale",this.updateLocalization,this),this.updateLocalization()}get localeClass(){return this._localeClass||null}set localeClass(e){this._localeClass=e}localizeProperty(e){const t=this;if("string"==typeof t[e]){t.originalLocales=t.originalLocales||{},t.originalLocales[e]=t.originalLocales[e]||t[e];const r=t.originalLocales[e];r&&(t[e]=t.L(r))}}updateLocalization(){this.localizableProperties&&this.localizableProperties.forEach(this.localizeProperty,this)}static getTranslation(e,r,n){const{locale:s}=ne;let i,o,a=null;if(s)for(const l of this.parseLocaleString(e)){const c=t=>{var n;const i=null===(n=s[t])||void 0===n?void 0:n[l.localeKey];return i&&(a="function"==typeof i?null!=r?i(r):i:"object"==typeof i||e===l.match?i:(a||e).replace(l.match,i)),i};let d=!1;for(o=n;o&&(i=t.clsName(o))&&!(d=c(i))&&"string"!=typeof o;o=Object.getPrototypeOf(o));!d&&l.localeClass&&c(l.localeClass)}return a}buildLocalizableProperties(e){const t=[];e.localizableProperties&&t.push(...e.localizableProperties);for(let e=this.constructor.superclass;e&&e!==B;e=e.superclass){const r=e.getConfigDescriptor(!0).defaultConfig;r&&r.localizableProperties&&t.push(...r.localizableProperties.filter(e=>t.indexOf(e)<0))}return t}startConfigure(e){e.localizableProperties=this.buildLocalizableProperties(e),super.startConfigure(e)}static localize(e,r,...n){var s;0===(null===(s=n)||void 0===s?void 0:s.length)&&(n=[this]);let i=null;return n.some(n=>(i=t.getTranslation(e,r,n),null!=i)),i}static L(e,r,...n){var s;0===(null===(s=n)||void 0===s?void 0:s.length)&&(n=[this]);const i=this.localize(e,r,...n);if(ne.throwOnMissingLocale&&ne.locale&&null==i&&ie.test(e))throw new Error(`Localization is not found for '${e}' in '${n.map(e=>t.clsName(e)).join(", ")}'. ${ne.locale.localeName?"Locale : "+ne.locale.localeName:""}`);return null!=i?i:e}L(e,r){const n=this;return n.localeClass&&t.clsName(n.localeClass)!==t.clsName(n.constructor)?t.L(e,r,n.localeClass,n.constructor):t.L(e,r,n.constructor)}get localeManager(){return ne}};const le=e=>e+({1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"),ce=new RegExp("â€Ž"),de=(e,t)=>isNaN(e)||null==e?t:e,ue=(e,t,r)=>{let n=(ve[e]||(ve[e]=new Intl.DateTimeFormat(me,t))).format(r);return P.isIE11&&(n=n.replace(ce,"")),n},he=(e,t=0)=>new Date(e.getFullYear()+t,0,1),ge=e=>e>=0?e:e+7;let me="en-US",pe=le,fe={},ve={},ye={};const be={M:e=>e.getMonth()+1,Mo:e=>pe(be.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>ue("MMM",{month:"short"},e),MMMM:e=>ue("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/3),Qo:e=>pe(be.Q(e).toString()),D:e=>e.getDate(),Do:e=>pe(be.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/Re.day.millisecond),DDDo:e=>pe(be.DDD(e).toString()),DDDD:e=>be.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>pe(e.getDay().toString()),d1:e=>be.ddd(e).substring(0,1),dd:e=>be.ddd(e).substring(0,2),ddd:e=>ue("ddd",{weekday:"short"},e),dddd:e=>ue("dddd",{weekday:"long"},e),e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>je.getWeekNumber(e)[1],Wo:e=>pe(be.W(e).toString()),WW:e=>be.W(e).toString().padStart(2,"0"),Y:e=>e.getFullYear(),YY:e=>e.getFullYear()%100,YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>be.h(e).toString().padStart(2,"0"),k:e=>e.getHours()+1,kk:e=>be.k(e).toString().padStart(2,"0"),K:e=>ue("K",{hour:"numeric"},e),KK:e=>ue("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>be.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>be.s(e).toString().padStart(2,"0"),S:e=>e.getMilliseconds().toString().substr(0,1),SS:e=>e.getMilliseconds().toString().substr(0,2).padEnd(2,"0"),SSS:e=>e.getMilliseconds().toString().substr(0,3).padEnd(3,"0"),z:e=>ue("z",{timeZoneName:"short"},e),zz:e=>ue("zz",{timeZoneName:"long"},e),LT:e=>ue("LT",{hour:"2-digit",minute:"2-digit"},e),LTS:e=>ue("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>ue("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>ue("l",{year:"numeric",month:"numeric",day:"numeric"},e),LL:e=>ue("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>ue("ll",{year:"numeric",month:"short",day:"numeric"},e),LLL:e=>ue("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>ue("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>ue("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>ue("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},Ce=`^(?:${Object.keys(be).sort((e,t)=>t.length-e.length).join("|")})`,we=()=>({}),Se=e=>(e=>Oe.test(e))(e)&&{milliseconds:parseInt(e.padEnd(3,"0").substring(0,3))},De={YYYY:e=>({year:parseInt(e)}),Y:e=>({year:parseInt(e)}),YY:e=>{const t=parseInt(e);return{year:t+(t>1968?1900:2e3)}},MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),DD:e=>({date:parseInt(e)}),M:e=>({month:parseInt(e)-1}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:we,MMM:we,MMMM:we,DDDo:we,DDDD:we,d:we,do:we,d1:we,dd:we,ddd:we,dddd:we,Q:we,Qo:we,W:we,Wo:we,WW:we,e:we,E:we,HH:e=>({hours:parseInt(e)}),hh:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:Se,SS:Se,SSS:Se,A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",Z:e=>{if(!e||!_e.test(e)&&"Z"!==e)return null;let t=0;if("Z"!==e){const r=_e.exec(e);if(r){t=("+"===r[1]?1:-1)*(60*(parseInt(r[2])||0)+(parseInt(r[3])||0))}else t=-1*(new Date).getTimezoneOffset()}return{timeZone:t}}},Ee=Object.keys(De).sort((e,t)=>t.length-e.length),xe=new RegExp(`(${Ee.join("|")})`),Te=new RegExp("(l|LL|ll|LLL|lll|LLLL|llll)"),Re={year:{year:1,quarter:4,month:12,week:52,day:365,hour:8760,minute:525600,second:31536e3,millisecond:31536e6},quarter:{year:1/4,quarter:1,month:3,week:4,day:91,hour:2184,minute:131040,second:7862400,millisecond:78624e5},month:{year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-720,minute:-43200,second:-2592e3,millisecond:-2592e6},week:{year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{year:-1/8760,quarter:-1/2184,month:-1/720,week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{year:-1/525600,quarter:-1/131040,month:-1/43200,week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{year:-1/31536e3,quarter:-1/7862400,month:-1/2592e3,week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{year:-1/31536e6,quarter:-1/78624e5,month:-1/2592e6,week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:.001}},Me={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year"},ke=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,Ie=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,Fe=["millisecond","second","minute","hour","day","week","month","quarter","year"],Ae=[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"]],Pe=["year","month","week","day","hour","minute","second","millisecond"],Le=["milliseconds","seconds","minutes","hours","date","month","year"],Oe=/^[0-9]+$/,_e=/([+-])(\d\d):*(\d\d)*$/,$e={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8};class je extends(ae()){static set defaultFormat(e){this._defaultFormat=e}static get defaultFormat(){return this._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static buildParser(e){const t=e.split(xe),r=[];return 1===t.length||Te.test(e)?[]:(t.reduce((t,n,s,i)=>{if(0!==s||""!==n)if(xe.test(n)){const o=(this.localize("L{parsers}")||{})[n]||De[n];if("Z"===n&&s<i.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);if("string"==typeof o){const e=je.buildParser(o),n=e.pop();delete n.last,r.push(...e),t=n}else t.pattern=n,t.fn=De[n]}else t.splitter=n,r.push(t),t={};else Object.prototype.hasOwnProperty.call(t,"pattern")&&r.push(t);return t},{}),r[r.length-1].last=!0,r)}static parse(e,t=this.defaultParseFormat){if(e instanceof Date)return e;if("string"!=typeof e||!e)return null;const r={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};t=t.replace(/S+/gm,"SSS");let n,s=ye[t];s||(s=ye[t]=je.buildParser(t)),s.reduce((e,t)=>{if(!t.last){let n,s,i;if(n="T"===t.splitter&&-1===e.indexOf("T")?e.indexOf(" "):""!==t.splitter?e.indexOf(t.splitter):t.pattern&&t.pattern.length||-1,-1===n||"SSS"===t.pattern&&e.match(/^\d+Z$/)){const t=e.split(/([Z\-+])/);1===t.length?(s=e,i=""):(s=t[0],i=`${t[1]}${t[2]}`)}else s=e.substring(0,n)||e,i=e.substring(n+t.splitter.length);if(t.fn){const e=t.fn(s);e?Object.assign(r,e):i=s+i}return i}Object.assign(r,t.fn(e))},e),r.year&&!r.date&&(r.date=1);const i=this.create(r);return n=i||new Date(e),n}static create(e){const t=Object.assign({},e);let r=isNaN(t.year),n=!1;if(!r){let e=!0;Le.forEach(r=>{r in t&&!isNaN(t[r])||(t[r]=0),e=e&&null===t[r]}),r=e}if("pm"===t.amPm&&(t.hours=t.hours%12+12),"timeZone"in t&&(n=!0,t.minutes-=t.timeZone),r)return null;const s=[de(t.year,2020),de(t.month,0),de(t.date,1),t.hours,t.minutes,t.seconds,t.milliseconds];return n?new Date(Date.UTC(...s)):new Date(...s)}static format(e,t=this.defaultFormat){if(!e||isNaN(e))return null;let r=fe[t],n="";if(!r){r=fe[t]=[];for(let e=0;e<t.length;e++){const n=t.substr(e).match(Ce),s=n&&n[0];if(s){const t=(this.localize("L{formats}")||{})[s]||be[s];r.push(t),e+=s.length-1}else if("{"===t[e]){const n=t.indexOf("}",e+1);-1===n?(r.push(t.substr(e+1)),e=t.length):(r.push(t.substring(e+1,n)),e=n)}else r.push(t[e])}}return r.forEach(t=>{n+="string"==typeof t?t:t(e)}),(P.isEdge||P.isIE11)&&(n=n.replace(/\u200E/g,"")),n}static asMilliseconds(e,t=null){return"string"==typeof e&&(t=e,e=1),this.as("millisecond",e,t)}static formatDelta(e,t=!1){const r=[],n=t?this.getShortNameOfUnit:this.getLocalizedNameOfUnit,s=t?"":" ";for(const t of Pe){const i=Math.floor(this.as(t,e));if(i&&(r.push(`${i}${s}${n.call(this,t,i>1)}`),e-=this.as("ms",i,t)),!e)break}return r.join(", ")}static as(e,t,r="ms"){return e===r?t:(e=this.normalizeUnit(e),r=this.normalizeUnit(r),$e[r]>$e[e]?t*Math.abs(Re[r][e]):t/Math.abs(Re[e][r]))}static formatContainsHourInfo(e){return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(/(\\.)/g,""))}static is24HourFormat(e){return this.format(this.getTime(13,0,0),e).includes("13")}static add(e,t,r="ms"){const n=this;let s;if(s="string"==typeof e?n.parse(e):new Date(e.getTime()),!r||0===t)return s;switch(r=je.normalizeUnit(r)){case"millisecond":s=new Date(s.getTime()+t);break;case"second":s=new Date(s.getTime()+1e3*t);break;case"minute":s=new Date(s.getTime()+6e4*t);break;case"hour":s=new Date(s.getTime()+36e5*t);break;case"day":t%1==0?s.setDate(s.getDate()+t):s=new Date(s.getTime()+864e5*t),23===s.getHours()&&0===s.getHours()&&(s=n.add(s,1,"hour"));break;case"week":s.setDate(s.getDate()+7*t);break;case"month":{let e=s.getDate();e>28&&(e=Math.min(e,n.getLastDateOfMonth(n.add(n.getFirstDateOfMonth(s),t,"month")).getDate())),s.setDate(e),s.setMonth(s.getMonth()+t);break}case"quarter":s=n.add(s,3*t,"month");break;case"year":s.setFullYear(s.getFullYear()+t)}return s}static diff(e,t,r="ms",n=!0){if(r=je.normalizeUnit(r),!e||!t)return 0;let s;switch(r){case"year":s=this.diff(e,t,"month")/12;break;case"quarter":s=this.diff(e,t,"month")/3;break;case"month":s=12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth());break;case"week":s=this.diff(e,t,"day")/7;break;case"day":{const r=e.getTimezoneOffset()-t.getTimezoneOffset();s=(t-e+60*r*1e3)/864e5;break}case"hour":s=(t-e)/36e5;break;case"minute":s=(t-e)/6e4;break;case"second":s=(t-e)/1e3;break;case"millisecond":s=t-e}return n?s:Math.round(s)}static startOf(e,t="day",r=!0){if(!e)return null;t=this.normalizeUnit(t),r&&(e=this.clone(e));const n={},s=$e[t];for(let e=0;e<s;e++){const t=Fe[e];"quarter"!==t&&"week"!==t&&(n[t]="day"===t?1:0)}if("quarter"===t)n.month=3*(this.get(e,"quarter")-1);else if("week"===t){const t=e.getDay()-this.weekStartDay;n.day=e.getDate()-t}return this.set(e,n)}static clone(e){return new Date(e.getTime())}static clearTime(e,t=!0){return je.startOf(e,"day",t)}static set(e,t,r){if(!t)return e;if("string"==typeof t)switch(this.normalizeUnit(t)){case"millisecond":(0!==r||e.getMilliseconds()>0)&&e.setMilliseconds(r);break;case"second":(0!==r||e.getSeconds()>0)&&e.setSeconds(r);break;case"minute":(0!==r||e.getMinutes()>0)&&e.setMinutes(r);break;case"hour":e.setHours(r);break;case"day":case"date":e.setDate(r);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(r);break;case"quarter":e.setDate(1),e.setMonth(3*(r-1));break;case"year":e.setFullYear(r)}else Object.entries(t).sort((e,t)=>$e[e[0]]-$e[t[0]]).forEach(([t,r])=>{this.set(e,t,r)});return e}static constrain(e,t,r){return null!=t&&(e=this.max(e,t)),null==r?e:this.min(e,r)}static getTime(e,t=0,r=0,n=0){return e instanceof Date&&(n=e.getMilliseconds(),r=e.getSeconds(),t=e.getMinutes(),e=e.getHours()),new Date(2020,0,1,e,t,r,n)}static copyTimeValues(e,t){return e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),e}static isDST(e){const t=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear(),6,1);return e.getTimezoneOffset()<Math.max(t.getTimezoneOffset(),r.getTimezoneOffset())}static isBefore(e,t){return e<t}static isAfter(e,t){return e>t}static isEqual(e,t,r=null){return null===r?e&&t&&e.getTime()===t.getTime():this.startOf(e,r)-this.startOf(t,r)==0}static compare(e,t,r=null){const n=this;return r&&(e=n.startOf(e,r),t=n.startOf(t,r)),n.isBefore(e,t)?-1:n.isAfter(e,t)?1:0}static isStartOf(e,t){return this.isEqual(e,this.startOf(e,t))}static betweenLesser(e,t,r){return t.getTime()<=e.getTime()&&e.getTime()<r.getTime()}static betweenLesserEqual(e,t,r){return t.getTime()<=e.getTime()&&e.getTime()<=r.getTime()}static intersectSpans(e,t,r,n){return this.betweenLesser(e,r,n)||this.betweenLesser(r,e,t)}static compareUnits(e,t){return Math.sign($e[e]-$e[t])}static timeSpanContains(e,t,r,n){return r-e>=0&&t-n>=0}static get weekStartDay(){return this.localize("L{weekStartDay}")||0}static get(e,t){switch(this.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return be.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInMonth(e){const t=this.clone(e);return t.setDate(1),t.setMonth(e.getMonth()+1),t.setDate(0),t.getDate()}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,t){return e.getTime()<t.getTime()?e:t}static max(e,t){return e.getTime()>t.getTime()?e:t}static getNext(e,t,r=1,n=this.weekStartDay){const s=this;if("week"===t){let t=s.clone(e);const i=t.getDay();return t=s.startOf(t,"day"),t=s.add(t,n-i+7*(r-(n<=i?0:1)),"day"),t.getDay()!==n&&s.add(t,1,"hour"),t}return s.startOf(s.add(e,r,t),t)}static isValidDate(e){return this.isDate(e)&&!isNaN(e)}static isDate(e){return e&&e.constructor&&"Date"===e.constructor.name}static getStartOfNextDay(e,t,r){let n=je.add(r?e:je.clearTime(e,t),1,"day");if(n.getDate()===e.getDate()){const r=je.add(je.clearTime(e,t),"day",2).getTimezoneOffset(),s=e.getTimezoneOffset();n=je.add(n,s-r,"minute")}return n}static getEndOfPreviousDay(e,t){const r=t?e:je.clearTime(e,!0);return r-e?r:this.add(r,-1,"day")}static getWeekNumber(e,t=je.weekStartDay,r=0){let n=he(e,r),s=((e,t)=>Math.floor((e.getTime()-t.getTime()-(e.getTimezoneOffset()-t.getTimezoneOffset())*Re.minute.millisecond)/Re.day.millisecond)+1)(e,n);const i=ge(n.getDay()-je.weekStartDay);let o;return i<4?(o=Math.floor((s+i-1)/7)+1,o>52&&(n=he(e,1),s=ge(n.getDay()-je.weekStartDay),o=s<4?1:53)):(o=Math.floor((s+i-1)/7),r=1),o>0?[n.getFullYear()-1+r,o]:je.getWeekNumber(e,t,-1)}static formatCount(e,t){return t=je.normalizeUnit(t),1!==e&&(t+="s"),e+" "+t}static getUnitToBaseUnitRatio(e,t,r=!1){return(e=je.normalizeUnit(e))===(t=je.normalizeUnit(t))?1:Re[e]&&Re[e][t]&&(r||Re[e][t]>0)?1/je.as(t,1,e):Re[t]&&Re[t][e]&&(r||Re[t][e]>0)?je.as(e,1,t):-1}static getMeasuringUnit(e){return"week"===e?"day":e}static getShortNameOfUnit(e){return e=this.parseTimeUnit(e),this.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,t){return e=this.normalizeUnit(e),e=this.parseTimeUnit(e),this.unitLookup[e][t?"plural":"single"]}static normalizeUnit(e){return e?"date"===e.toLowerCase()||Fe.includes(e.toLowerCase())?e.toLowerCase():Me[e]||Me[e.toLowerCase()]:null}static getUnitByName(e){return je.normalizeUnit(e)||je.normalizeUnit(this.parseTimeUnit(e))}static getDurationInUnit(e,t,r,n){return this.diff(e,t,r,n)}static doesUnitsAlign(e,t){return e===t||"week"!==t}static getSmallerUnit(e){return Fe[$e[this.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return Fe[$e[this.normalizeUnit(e)]+1]||null}static parseDuration(e,t=!0,r){const n=(t?ke:Ie).exec(e);if(null==e||!n)return null;const s=(e=>{const t=parseFloat(e);return isNaN(t)?null:t})(n[1]),i=this.parseTimeUnit(n[2])||r;return i?{magnitude:s,unit:i}:null}static parseTimeUnit(e){const t=null==e?null:this.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(let e=0;e<Fe.length;e++)if(t[e+1])return Fe[e]}static fillDayNames(){const e=this,t=new Date("2000-01-01T12:00:00"),r=e._dayNames||[],n=e._dayShortNames||[];r.length=0,n.length=0;for(let s=2;s<9;s++)t.setDate(s),r.push(e.format(t,"dddd")),n.push(e.format(t,"ddd"));e._dayNames=r,e._dayShortNames=n}static getDayNames(){return this._dayNames}static getDayName(e){return this._dayNames[e]}static getDayShortNames(){return this._dayShortNames}static getDayShortName(e){return this._dayShortNames[e]}static fillMonthNames(){const e=this,t=new Date("2000-01-15T12:00:00"),r=e._monthNames||[],n=e._monthShortNames||[];r.length=0,n.length=0;for(let s=0;s<12;s++)t.setMonth(s),r.push(e.format(t,"MMMM")),n.push(e.format(t,"MMM"));e._monthNames=r,e._monthShortNames=n}static getMonthShortNames(){return this._monthShortNames}static getMonthShortName(e){return this._monthShortNames[e]}static getMonthNames(){return this._monthNames}static getMonthName(e){return this._monthNames[e]}static set locale(e){me=e}static get locale(){return me}static setupDurationRegEx(e=[],t=[]){const r=this,n={};let s="";for(let i=0;i<t.length;i++){const o=t[i],a=e[i];a.canonicalUnitName=Fe[i],n[a.single]=n[a.single.toUpperCase()]=n[a.canonicalUnitName]=n[a.canonicalUnitName.toUpperCase()]=a,s+=(i?"|":"")+"(";for(let e=0;e<o.length;e++)s+=o[e]+"|";if(me=r.localize("L{locale}")||"en-US","en-US"!==me){const e=Ae[i];for(let t=0;t<e.length;t++)s+=e[t]+"|"}s+=`${a.single}|${a.plural}|${a.canonicalUnitName})`}r.unitLookup=n,r.durationRegEx=new RegExp(`^(?:${s})$`)}static applyLocale(){const e=this,t=e.localize("L{unitAbbreviations}")||[],r=e.unitNames=e.localize("L{unitNames}");"unitNames"!==r&&(me=e.localize("L{locale}")||"en-US",pe="en-US"===me?le:e.L("L{ordinalSuffix}")||pe,fe={},ye={},ve={},e.setupDurationRegEx(r,t),e.fillDayNames(),e.fillMonthNames())}}je._$name="DateHelper",ne.on({locale:"applyLocale",prio:1e3,thisObj:je}),ne.locale&&je.applyLocale(),je._$name="DateHelper";const He=/\s+/,Ne=e=>{const t=typeof e;if("object"===t){if(null===e)return"null";if("[object Date]"===Object.prototype.toString.call(e))return"date"}return t},Be="1.01"===1.005.toFixed(2)?null:function(e,t){const r=e.toString().split("."),n=+(r[1]?r.join(".")+"1":r[0]);return e.toFixed.call(n,t)};class ze{static isEqual(e,t,r=!1){if(null===e&&null!==t||void 0===e&&void 0!==t||null===t&&null!==e||void 0===t&&void 0!==e)return!1;if(null==e&&null==t)return!0;if(e===t)return!0;const n=typeof e;if(n===typeof t){switch(n){case"number":case"string":case"boolean":return e===t}switch(!0){case e instanceof Date&&t instanceof Date:return e.getTime()===t.getTime();case Array.isArray(e)&&Array.isArray(t):return e.length===t.length&&e.every((e,n)=>this.isEqual(e,t[n],r));case"object"===n&&e.constructor.prototype===t.constructor.prototype:return r?this.isDeeplyEqual(e,t,r):JSON.stringify(e)===JSON.stringify(t)}}return String(e)===String(t)}static isDeeplyEqual(e,t,r={}){if(e===t)return!0;if(!e||!t)return!1;const n=this.keys(e,r.ignore),s=this.keys(t,r.ignore);if(n.length!==s.length)return!1;for(let i=0;i<n.length;i++){const o=n[i],a=s[i];if(o!==a)return!1;const l=e[o],c=t[a];if(!r.shouldEvaluate||!1!==r.shouldEvaluate(o,{value:l,object:e},{value:c,object:t})){if(r.evaluate){const n=r.evaluate(o,{value:l,object:e},{value:c,object:t});if(!1===n)return!1;if(!0===n)continue}if(!this.isEqual(l,c,r))return!1}}return!0}static isPartial(e,t){return e=String(e).toLowerCase(),t=String(t).toLowerCase(),-1!=e.indexOf(t)}static isLessThan(e,t){return e instanceof Date&&t instanceof Date?je.isBefore(e,t):e<t}static isMoreThan(e,t){return e instanceof Date&&t instanceof Date?je.isAfter(e,t):e>t}static fork(e){var t,r,n;if(e&&e.constructor===Object)for(r in t=Object.setPrototypeOf({},e),e)(n=e[r])&&(n.constructor===Object?t[r]=this.fork(n):n instanceof Array&&(t[r]=n.slice()));else t=e;return t}static assign(e,...t){for(var r,n,s=0,i=t.length;s<i;s++)for(n in r=t[s])e[n]=r[n];return e}static clone(e){if(null==e)return e;var t,r,n=e.constructor.name,s=e;if("Date"===n)return new Date(e.getTime());if("Array"===n)for(t=e.length,s=[];t--;)s[t]=this.clone(e[t]);else if("Object"===n)for(r in s={},e)s[r]=this.clone(e[r]);return s}static merge(e,...t){for(var r,n,s,i,o=0,a=t.length;o<a;o++)for(n in r=t[o])(s=r[n])&&s.constructor===Object?(i=e[n])&&"Object"===i.constructor.name?this.merge(i,s):e[n]=this.clone(s):e[n]=s;return e}static copyProperties(e,t,r){let n,s;for(s=0;s<r.length;s++)n=r[s],n in t&&(e[n]=t[n]);return e}static copyPropertiesIf(e,t,r){for(const n of r)n in e||(e[n]=t[n]);return e}static keys(e,t=null){const r=[];for(const n in e)t&&t[n]||r.push(n);return r}static isEmpty(e){for(const t in e)return!1;return!0}static getTruthyKeys(e){const t=Object.keys(e);for(let r=0;r<t.length;)e[t[r]]?r++:t.splice(r,1);return t}static getTruthyValues(e){const t=Object.keys(e);for(let r=0;r<t.length;)e[t[r]]?t[r]=e[t[r++]]:t.splice(r,1);return t}static createTruthyKeys(e){"string"==typeof e&&(e=e.split(He));const t={};for(const r of e)r.length&&(t[r]=1);return t}static allKeys(e){const t=[];for(;e;e=Object.getPrototypeOf(e))t.push(...Object.keys(e));return t}static pathExists(e,t){return t.split(".").every(t=>t in e&&(e=e[t],!0))}static getPath(e,t){return t.split(".").reduce((e,t)=>(e||{})[t],e)}static setPath(e,t,r){return t.split(".").reduce((e,t,n,s)=>n===s.length-1?e[t]=r:(e[t]instanceof Object||(e[t]={}),e[t]),e),e}static pathifyKeys(e){const t={};for(const r in e)if(Object.hasOwnProperty.call(e,r))if(e[r]instanceof Object){const n=this.pathifyKeys(e[r]);for(const e in n)t[`${r}.${e}`]=n[e]}else t[r]=e[r];return t}static deletePath(e,t){t.split(".").reduce((e,t,r,n)=>{if(null==e)return null;if(Object.hasOwnProperty.call(e,t)){if(r!==n.length-1)return e[t];delete e[t]}},e)}static coerce(e,t){var r=Ne(e),n=Ne(t),s="string"==typeof e;if(r!==n)switch(n){case"string":return String(e);case"number":return Number(e);case"boolean":return!(s&&(!e||"false"===e||"0"===e))&&Boolean(e);case"null":return!(!s||e&&"null"!==e)&&null;case"undefined":return!(!s||e&&"undefined"!==e)&&void 0;case"date":return s&&isNaN(e)?je.parse(e):Date(Number(e))}return e}static wrapProperty(e,t,r,n,s=!0){const i={};let o=Object.getPrototypeOf(e),a=Object.getOwnPropertyDescriptor(o,t);for(;!a&&o&&s;)o=Object.getPrototypeOf(o),o&&(a=Object.getOwnPropertyDescriptor(o,t));a?(a.set?i.set=t=>{a.set.call(e,t),n&&n.call(e,a.get.call(e))}:i.set=n,a.get?i.get=()=>{let t=a.get.call(e);return r&&(t=r.call(e,t)),t}:i.get=r):(i.set=r=>{e["_"+t]=r,n&&n.call(e,r)},i.get=()=>{let n=e["_"+t];return r&&(n=r.call(e,n)),n}),Object.defineProperty(e,t,i)}static getPropertyDescriptor(e,t){let r=null;for(let n=e;!r&&n!==B;n=Object.getPrototypeOf(n))r=Object.getOwnPropertyDescriptor(n,t);return r}static cleanupProperties(e){return Object.entries(e).forEach(([t,r])=>null==r&&delete e[t]),e}static assertType(e,t,r){if(null!=e&&typeof e!==t)throw new Error(`Incorrect type "${typeof e}" for ${r}, expected "${t}"`)}static assertNumber(e,t){const r=Number(e);if("number"!=typeof e||isNaN(r))throw new Error(`Incorrect type for ${t}, got "${e}" (expected a Number)`)}static assertBoolean(e,t){this.assertType(e,"boolean",t)}static toFixed(e,t){return Be?Be(e,t):e.toFixed(t)}static roundTo(e,t=1){return Math.round(e/t)*t}static round(e,t){if(null==t)return e;const r=10**t;return Math.round(e*r)/r}static isPromise(e){return"function"==typeof(null==e?void 0:e.then)}}ze._$name="ObjectHelper";class Ve{constructor(...e){"object"==typeof e[0]?Object.assign(this,e[0]):this.process(1,e),this[Ye]=!0}clone(){return new Ve(this)}contains(e){return!("string"!=typeof e||!e)&&Boolean(this[e])}toString(){return this.length?this.value+" ":""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){if("string"==typeof e&&(qe.value=e,e=qe),this.length===e.length){const t=ze.getTruthyKeys(e);for(let e=0,r=t.length;e<r;e++)if(!this[t[e]])return!1;return!0}return!1}get value(){const e=this;if(e[Ye]){const t=ze.getTruthyKeys(e);e[Ue]=t.length,e[Ge]=t.join(" "),e[Ye]=!1}return e[Ge]}set value(e){const t=this,r=Object.keys(t),n=r.length;for(let e=0;e<n;e++)delete t[r[e]];e?t.process(1,[e]):t[Ye]=!0}get length(){return this.value?this[Ue]:0}process(e,t){const r=t.length;for(let n=0;n<r;n++)if(t[n]){const r=t[n],s=r.values?Array.from(r.values()):r.item?Array.from(r):r.split(We),i=s.length;for(let t=0;t<i;t++)s[t]&&(this[s[t]]=e)}this[Ye]=!0}add(...e){this.process(1,e)}remove(...e){this.process(0,e)}split(){return ze.getTruthyKeys(this)}forEach(e){return ze.getTruthyKeys(this).forEach(e)}get isDomClassList(){return!0}}const We=/\s+/,Ge=Symbol("value"),Ue=Symbol("length"),Ye=Symbol("dirty"),qe=new Ve;Ve._$name="DomClassList";const Xe={align:"t0-t0"};let Ke,Ze=null,Je=0,Qe=null;const et=/(?:matrix\((?:-?\d*\.?[0-9]*),\s?(?:-?\d*\.?[0-9]*),\s?(?:-?\d*\.?[0-9]*),\s?(?:-?\d*\.?[0-9]*),\s?(-?\d*\.?[0-9]*),\s?(-?\d*\.?[0-9]*))|(?:matrix3d\((?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(-?\d*),\s?(-?\d*))/,tt=/translate(3d|X)?\((-?\d*\.?[0-9]*)px(?:,\s?(-?\d*\.?[0-9]*)px)?/,rt=/translate(3d|Y)?\((-?\d*\.?[0-9]*)px(?:,\s?(-?\d*\.?[0-9]*)px)?/,nt=/^[^a-z]+|[^\w:.-]+/gi,st=/\s+/,it={tag:1,html:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,className:1,unmatched:1,_element:1,onlyChildren:1,elementData:1,compareHtml:1,syncOptions:1},ot={length:1,parentRule:1,style:1},at={width:1,height:1,top:1,left:1,minWidth:1,minHeight:1,maxWidth:1,maxHeight:1,fontSize:1},lt={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,HTML:P.isIE11?1:0,BODY:P.isIE11?0:1},ct=window,dt=document,ut={},ht=[],gt=Array.prototype.slice,mt=new Promise(e=>e()),pt=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],ft=e=>e._hidden,vt=e=>{const t=e.ownerDocument.defaultView.getComputedStyle(e);return"none"!==t.getPropertyValue("display")&&"hidden"!==t.getPropertyValue("visibility")},yt=document.documentElement.getRootNode?e=>e.getRootNode():e=>{for(;e.parentNode;)e=e.parentNode;return e},bt=e=>e&&(e===document.body||("offsetParent"in e?e.offsetParent:bt(e.parentNode))),Ct=e=>e&&(document.body.contains(e)||(Ke=yt(e).host)&&Ct(Ke));let wt,St,Dt;class Et{static isFocusable(e,t=!1){if(!t&&(!this.isVisible(e)||K.fromElement(e,ft)))return!1;const r=e.nodeName;return lt[r]||("A"===r||"LINK"===r)&&!!e.href||null!=e.getAttribute("tabIndex")||"true"===e.contentEditable}static isInView(e,t=!0){let r=Xt.from(e),n=!0;const s=r.height,i=r.width;for(;n&&e.parentElement;)e=e.parentElement,r=r.intersect(Xt.from(e)),n=r&&(!t||r.height>=s&&r.width>=i);return n}static isVisible(e){const t=e.ownerDocument;for(;e;e=(r=e).parentNode||r.host){if(e===t)return!0;if(1===e.nodeType&&!vt(e))return!1}var r;return!1}static roundPx(e,t=window.devicePixelRatio||1){const r=1/t;return Math.round(e/r)*r}static isCustomElement(e){return e&&e.shadowRoot}static elementFromPoint(e,t){let r=document.elementFromPoint(e,t);return Et.isCustomElement(r)&&(r=r.shadowRoot.elementFromPoint(e,t)||r),r}static get activeElement(){let e=document.activeElement;for(;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}static getId(e){return e.id||(e.id="b-element-"+ ++Je)}static getElement(e){return e instanceof Element?e:dt.querySelector(e)}static setAttributes(e,t){const r=this.getElement(e);Object.entries(t).forEach(([e,t])=>r.setAttribute(e,t))}static setLength(e,t,r){return 1===arguments.length?"number"==typeof e?e+"px":e:(e=this.getElement(e)).style[t]="number"==typeof r?r+"px":r}static getChild(e,t){if(P.supportsQueryScope)t=":scope>"+t;else{t=`#${e.id||(e.id="b-element-"+ ++Je)} > ${t}`}return e.querySelector(t)}static hasChild(e,t){return null!=Et.getChild(e,t)}static children(e,t){return Array.from(e.querySelectorAll(t))}static down(e,t){if(!e)return null;if(e.matches&&e.matches(t))return e;if(P.supportsQueryScope)t=":scope "+t;else{t=`#${e.id||(e.id="b-element-"+ ++Je)} ${t}`}return e.querySelector(t)}static isDescendant(e,t){return e.contains||(e=e.body),e.contains(t)}static forEachSelector(e,t,r){"string"==typeof e&&(r=t,t=e,e=dt),this.children(e,t).forEach(r)}static forEachChild(e,t){Array.from(e.children).forEach(t)}static removeEachSelector(e,t){this.forEachSelector(e,t,e=>e.remove())}static removeClsGlobally(e,...t){t.forEach(t=>this.forEachSelector(e,"."+t,e=>e.classList.remove(t)))}static up(e,t){return e&&e.closest(t)}static getAncestor(e,t,r=null){let n,s=!1,i=e;for(Array.isArray(t)||(t=[t]);i=i.parentElement;){if(t.includes(i)){s=!0;break}if(r&&i===r)break;n=i}return s?n||e:null}static getParents(e){const t=[];for(;e.parentElement;)t.push(e.parentElement),e=e.parentElement;return t}static makeValidId(e){return null==e?null:String(e).replace(nt,"")}static createElement(e={},t=!1,r=null,n=null){"string"==typeof e.parent&&(e.parent=document.getElementById(e.parent)),e.syncOptions&&e.syncOptions.syncIdField&&(n=e.syncOptions.syncIdField);const s=e.parent||e.nextSibling&&e.nextSibling.parentNode;let i;i=e.ns?dt.createElementNS(e.ns,e.tag||"svg"):dt.createElement(e.tag||"div"),null!=e.html&&(e.html instanceof DocumentFragment?i.appendChild(e.html):i.innerHTML=e.html),e.tooltip&&J.attachTooltip(i,e.tooltip),e.style&&this.applyStyle(i,e.style),e.dataset&&Object.assign(i.dataset,e.dataset),s&&s.insertBefore(i,e.nextSibling),e.reference&&((r||(r={}))[e.reference]=i,i.setAttribute("reference",e.reference)),e.elementData&&(i.elementData=e.elementData);const{className:o}=e;o&&(o.isDomClassList?i.className=o.toString():i.className="object"==typeof o?new Ve(o):o);for(const t of Object.keys(e))it[t]||(e.ns?i.setAttribute(t,e[t]):i[t]=e[t]);return!0===t?t=[i]:Array.isArray(t)&&t.push(i),e.children&&(n&&(i.syncIdMap={}),e.children.forEach(s=>{if(s)if("string"==typeof s)i.appendChild(document.createTextNode(s));else if(isNaN(s.nodeType)){s.parent=i,!s.ns&&e.ns&&(s.ns=e.ns);const o=Et.createElement(s,t,r,n),a=s.dataset&&s.dataset[n];null!=a&&(i.syncIdMap[a]=o),delete s.parent}else i.appendChild(s)})),i.lastConfig=e,e._element=i,r||t||i}static createElementFromTemplate(e,t=ut){const{array:r,raw:n,fragment:s}=t;let i;if(Et.supportsTemplate){if((wt||(wt=dt.createElement("template"))).innerHTML=e,i=wt.content,s)return i.cloneNode(!0)}else{if((St||(St=new DOMParser)).parseFromString(e,"text/html"),i=St.parseFromString(e,"text/html").body,s){const e=i?i.childNodes:ht;for(i=document.createDocumentFragment();e.length;)i.appendChild(e[0]);return i}i||(i={children:[],childNodes:[]})}return i=n?i.childNodes:i.children,1!==i.length||r?gt.call(i):i[0]}static insertFirst(e,t){return t&&t.nodeType!==Node.ELEMENT_NODE&&t.tag&&(t=Et.createElement(t)),e.insertBefore(t,e.firstElementChild)}static insertBefore(e,t,r){return t&&t.nodeType!==Node.ELEMENT_NODE&&t.tag&&(t=Et.createElement(t)),r?e.insertBefore(t,r):Et.insertFirst(e,t)}static append(e,t){return t&&("string"==typeof t?t=Et.createElementFromTemplate(t):t.nodeType!==Node.ELEMENT_NODE&&t.tag&&(t=Et.createElement(t))),Array.isArray(t)?t.map(t=>e.appendChild(t)):e.appendChild(t)}static getTranslateX(e){const t=e.style.transform;let r=tt.exec(t);return r?parseInt(r[2]):(r=et.exec(t)||et.exec(this.getStyleValue(this.getElement(e),"transform")),r?parseInt(r[1]||r[3]):0)}static getTranslateY(e){const t=e.style.transform;let r=rt.exec(t);if(r){const e=parseInt(r["Y"===r[1]?2:3]);return isNaN(e)?0:e}return r=et.exec(t)||et.exec(this.getStyleValue(this.getElement(e),"transform")),r?parseInt(r[2]||r[4]):0}static getTranslateXY(e){return[this.getTranslateX(e),this.getTranslateY(e)]}static getOffsetX(e,t=null){return t?e.getBoundingClientRect().left-t.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,t=null){return t?e.getBoundingClientRect().top-t.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,t=null){return[this.getOffsetX(e,t),this.getOffsetY(e,t)]}static focusWithoutScrolling(e){function t(e){e.forEach(({element:e,scrollLeft:t,scrollTop:r})=>{e.scrollLeft!==t&&(e.scrollLeft=t),e.scrollTop!==r&&(e.scrollTop=r)})}if(P.chromeVersion>=64||P.fireFoxVersion>=68)e.focus({preventScroll:!0});else{const r=Et.getParents(e).map(e=>({element:e,scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}));e.focus(),P.isIE11?t(r):setTimeout(()=>t(r),0)}}static getPageX(e){return e.getBoundingClientRect().left+ct.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+ct.pageYOffset}static getExtremalSizePX(e,t){const r=I.hyphenate(t),n=r.split("-")[1];let s=this.getStyleValue(e,r);return s=/%/.test(s)?e.parentElement?parseInt(this.getStyleValue(e.parentElement,n),10):NaN:parseInt(s,10),s}static setTranslateX(e,t){const r=Et.getStyleValue(e,"transform").split(/,\s*/);t=Et.roundPx(t),r.length>1?(r[r[0].startsWith("matrix3d")?12:4]=t,e.style.transform=r.join(",")):e.style.transform=`translateX(${t}px)`}static setTranslateY(e,t){const r=Et.getStyleValue(e,"transform").split(/,\s*/);t=Et.roundPx(t),r.length>1?(r[r[0].startsWith("matrix3d")?13:5]=t,e.style.transform=r.join(",")+")"):e.style.transform=`translateY(${t}px)`}static setTop(e,t){this.setLength(e,"top",t)}static setLeft(e,t){this.setLength(e,"left",t)}static setTranslateXY(e,t,r){if(null==t)return this.setTranslateY(e,r);if(null==r)return this.setTranslateX(e,t);t=Et.roundPx(t),r=Et.roundPx(r);const n=Et.getStyleValue(e,"transform").split(/,\s*/),s=n[0].startsWith("matrix3d");n.length>1?(n[s?12:4]=t,n[s?13:5]=r,e.style.transform=n.join(",")+")"):e.style.transform=`translateX(${t}px) translateY(${r}px)`}static addTranslateX(e,t){Et.setTranslateX(e,Et.getTranslateX(e)+t)}static addTranslateY(e,t){Et.setTranslateY(e,Et.getTranslateY(e)+t)}static addLeft(e,t){Et.setLeft(e,Et.getOffsetX(e)+t)}static addTop(e,t){Et.setTop(e,Et.getOffsetY(e)+t)}static alignTo(e,t,r=Xe){t=t instanceof Xt?t:Xt.from(t,!0);const n=this.getTranslateXY(e),s=Xt.from(e,!0),i=s.alignTo(Object.assign(r,{target:t}));this.setTranslateXY(e,n[0]+i.x-s.x,n[1]+i.y-s.y)}static getStyleValue(e,t,r,n){const s=r?e.style:e.ownerDocument.defaultView.getComputedStyle(e,n);if(Array.isArray(t)){const e={};for(const r of t)e[r]=s.getPropertyValue(I.hyphenate(r));return e}return s.getPropertyValue(I.hyphenate(t))}static getEdgeSize(e,t,r){const n="border"===t?"-width":"",s={raw:{}};for(const i of["top","right","bottom","left"])r&&!r.includes(i[0])||(s[i]=parseFloat(s.raw[i]=Et.getStyleValue(e,`${t}-${i}${n}`)));return s.width=s.left+s.right,s.height=s.top+s.bottom,s}static applyStyle(e,t,r=!1){if("string"==typeof t)r?(t.length||e.style.cssText.length)&&(e.style.cssText=t):e.style.cssText+=t;else{r&&(e.style.cssText=""),t.style&&("string"==typeof t.style?e.style.cssText=t.style:t=Object.assign({},t.style,t));for(const r in t)ot[r]||(at[r]&&"number"==typeof t[r]?e.style[I.hyphenate(r)]=t[r]+"px":e.style[I.hyphenate(r)]=t[r])}}static getCSSText(e){if("string"==typeof e)return e;let t="";for(const r in e)ot[r]||(t+=`${I.hyphenate(r)}:${e[r]};`);return t}static addClasses(e,t){t.forEach(t=>e.classList.add(t))}static removeClasses(e,t){t.forEach(t=>e.classList.remove(t))}static toggleClasses(e,t,r=null){Array.isArray(t)||(t=[t]),!0===r?this.addClasses(e,t):!1===r?this.removeClasses(e,t):t.forEach(t=>e.classList.toggle(t))}static addTemporaryClass(e,t,r,n=window){r>0&&(e.classList.add(t),n.setTimeout(()=>e.classList.remove(t),r))}static getPropertyTransitionDuration(e,t){const r=window.getComputedStyle(e),n=r.transitionProperty.split(", "),s=r.transitionDuration.split(", "),i=n.indexOf(t);let o;return-1!==i&&(o=1e3*parseFloat(s[i])),o}static highlight(e,t=window){return e instanceof Xt?e.highlight():new Promise(r=>{t.setTimeout(()=>{e.classList.add("b-fx-highlight"),t.setTimeout(()=>{e.classList.remove("b-fx-highlight"),r()},1e3)},0)})}static get scrollBarWidth(){if(null===Ze&&dt.body){const e=Et.createElement({parent:dt.body,style:"position:absolute;top:-999px;width:100px;height:100px;overflow:scroll"});Ze=e.offsetWidth-e.clientWidth,e.remove()}return Ze}static resetScrollBarWidth(){Ze=null}static measureText(e,t,r,n){const s=this.getMeasureElement(t,n);s[r?"innerHTML":"innerText"]=e;const i=s.clientWidth;return s.className="",i}static measureSize(e,t){if(!e)return 0;if("number"==typeof e)return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(t){const r=this.getMeasureElement(t);r.innerHTML="",r.style.width=Et.setLength(e);const n=r.offsetWidth;return r.style.width=r.className="",n}return/^\d+em$/.test(e)?14*parseInt(e):isNaN(e)?0:parseInt(e)}static getMeasureElement(e,t=dt.body){const r=ct.getComputedStyle(e),n=t.offScreenDiv=t.offScreenDiv||Et.createElement({parent:t,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},!0)[1];return pt.forEach(e=>{n.style[e]!==r[e]&&(n.style[e]=r[e])}),n.className=e.className,n.parentElement.parentElement!==t&&t.appendChild(n.parentElement),n}static sync(e,t){if("string"==typeof e){if(""===e)return void(t.innerHTML="");e=this.createElementFromTemplate(e)}return this.performSync(e,t),t}static performSync(e,t){return e.outerHTML!==t.outerHTML&&(this.syncAttributes(e,t),this.syncContent(e,t),this.syncChildren(e,t),!0)}static getSyncAttributes(e){const t={},r=[];for(let n=0;n<e.attributes.length;n++){const s=e.attributes[n];if(s.specified){const e=s.name.toLowerCase();t[e]=s.value,r.push(e)}}return{attributes:t,names:r}}static syncAttributes(e,t){const{attributes:r,names:n}=this.getSyncAttributes(e),{attributes:s,names:i}=this.getSyncAttributes(t),o=n.includes("dataset"),a=n.filter(e=>!i.includes(e)),l=i.filter(e=>!(n.includes(e)||o&&e.startsWith("data-"))),c=n.filter(e=>i.includes(e));if(a.length>0)for(let e=0;e<a.length;e++){const n=a[e];"style"===n?this.applyStyle(t,r.style,!0):"dataset"===n?Object.assign(t.dataset,r.dataset):t.setAttribute(n,r[n])}if(l.length>0)for(let e=0;e<l.length;e++)t.removeAttribute(l[e]);if(c.length>0)for(let e=0;e<c.length;e++){const n=c[e];if("style"===n)this.applyStyle(t,r.style,!0);else if("dataset"===n)Object.assign(t.dataset,r.dataset);else if("class"!==n||!r.class.isDomClassList&&"object"!=typeof r.class)s[n]!==r[n]&&t.setAttribute(n,r[n]);else{let e;e=r.class.isDomClassList?r.class:new Ve(r.class),e.isEqual(s.class)||t.setAttribute("class",e)}}}static syncContent(e,t){0===e.childElementCount&&(t.innerText=e.innerText)}static setInnerText(e,t){const r=e.firstChild;r?r.data=t:e.textContent=t}static syncChildren(e,t){const r=this,n=gt.call(e.childNodes),s=gt.call(t.childNodes);for(;n.length;){const e=n.shift(),i=s.shift();if(e&&e.nodeType!==Node.TEXT_NODE&&e.nodeType!==Node.ELEMENT_NODE)throw new Error(`Source node type ${e.nodeType} not supported by DomHelper.sync()`);if(i&&i.nodeType!==Node.TEXT_NODE&&i.nodeType!==Node.ELEMENT_NODE)throw new Error(`Target node type ${i.nodeType} not supported by DomHelper.sync()`);if(i)if(e.nodeType===i.nodeType)e.nodeType===Node.TEXT_NODE?i.data=e.data:e.tagName===i.tagName?r.performSync(e,i):(t.insertBefore(e,i),i.remove());else{if(e.nodeType!==Node.TEXT_NODE||i.nodeType!==Node.ELEMENT_NODE)throw new Error("Currently no support for transforming nodeType");t.innerText=e.data.trim()}else t.appendChild(e)}s.forEach(e=>{e.remove()})}static syncClassList(e,t){const r=e.classList,n="string"==typeof t,s=n?t.trim().split(st):Array.isArray(t)?t:ze.getTruthyKeys(t),i=s.length;let o,a=r.length!==i;for(o=0;!a&&o<i;o++)a=!r.contains(s[o]);a&&(e.className=n?t:s.join(" "))}static setTheme(e){e=e.toLowerCase();const t=this.themeInfo.name.toLowerCase(),r=document.head.querySelector("#bryntum-theme:not([data-loading])")||document.head.querySelector(`[href$="${t}.css"]:not([data-loading])`);if(Et.removeEachSelector(document.head,"#bryntum-theme[data-loading]"),!r||!r.href.includes(t+".css"))throw new Error(`Theme link for ${t} not found`);return r.href.includes(e)?mt:new Promise((t,n)=>{const s=document.createElement("link"),i=r.nextSibling,o=Et.themeInfo.name.toLowerCase(),a={theme:e,prev:o};s.rel="stylesheet",s.id="bryntum-theme",s.addEventListener("load",()=>{delete s.dataset.loading,Qe=null,r.remove(),window.bryntum.GlobalEvents.trigger("theme",a),t(a)}),s.addEventListener("error",e=>{delete s.dataset.loading,n(e)}),s.dataset.loading="true",s.href=r.href.replace(o,e),i.parentNode.insertBefore(s,i)})}static get themeInfo(){if(!Qe){const e=this.createElement({parent:document.body,className:"b-theme-info"}),t=this.getStyleValue(e,"content",!1,":before");if(t)try{Qe=JSON.parse(t.replace(/^["']|["']$|\\/g,""))}catch(e){Qe=null}e.remove()}return Qe}static isOrphaned(e){return e!==document.body&&e!==document.documentElement&&e.nodeType===Node.ELEMENT_NODE&&null===e.offsetParent}}const xt=()=>Et.isTouchEvent=!1,Tt=()=>{Et.isTouchEvent=!0,clearTimeout(Dt),Dt=setTimeout(xt,400)};if(dt.addEventListener("touchstart",Tt,!0),dt.addEventListener("touchend",Tt,!0),Et.supportsTemplate="content"in dt.createElement("template"),!("children"in Node.prototype)){const e=e=>1===e.nodeType;Object.defineProperty(Node.prototype,"children",{get:function(){return Array.prototype.filter.call(this.childNodes,e)}})}if(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){const t=(this.document||this.ownerDocument).querySelectorAll(e);let r=t.length;for(;--r>=0&&t.item(r)!==this;);return r>-1}),ct.Element&&!Element.prototype.closest?Node.prototype.closest=Element.prototype.closest=function(e){var t=this;if(!dt.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}:Node.prototype.closest=function(e){return this.parentNode.closest(e)},[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(e){Object.prototype.hasOwnProperty.call(e,"remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})})),SVGElement.prototype.contains||(SVGElement.prototype.contains=function(e){do{if(this===e)return!0;e=e.parentNode}while(e);return!1}),"function"!=typeof ct.CustomEvent){let e,t;ct.CustomEvent=t=function(t,r={bubbles:!1,cancelable:!1,detail:void 0}){return e=dt.createEvent("CustomEvent"),e.initCustomEvent(t,r.bubbles,r.cancelable,r.detail),e},t.prototype=ct.Event.prototype,ct.MouseEvent=t=function(t,r={bubbles:!1,cancelable:!1,detail:void 0}){return e=dt.createEvent("MouseEvents"),e.initMouseEvent(t,r.bubbles,r.cancelable,dt.defaultView||ct,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,document),e},t.prototype=ct.Event.prototype,ct.KeyboardEvent=t=function(t,r={bubbles:!1,cancelable:!1,detail:void 0}){const n=`${r.shiftKey?"Shift ":""}${r.ctrlKey?"Control":""}`;return e=dt.createEvent("KeyboardEvent"),e.initKeyboardEvent(t,r.bubbles,r.cancelable,dt.defaultView||ct,r.key,r.location,n,!1,""),e},t.prototype=ct.Event.prototype}if(!Object.getOwnPropertyDescriptor(SVGElement.prototype,"dataset")||!Object.getOwnPropertyDescriptor(SVGElement.prototype,"dataset").get){var Rt={enumerable:!0,get:function(){var e,t,r,n,s,i={},o=this.attributes,a=o.length,l=function(e){return e.charAt(1).toUpperCase()},c=function(){return this},d=function(e,t){return void 0!==t?this.setAttribute(e,t):this.removeAttribute(e)};for(e=0;e<a;e++)(s=o[e])&&s.name&&/^data-\w[\w-]*$/.test(s.name)&&(t=s.value,n=(r=s.name).substr(5).replace(/-./g,l),Object.defineProperty(i,n,{enumerable:this.enumerable,get:c.bind(t||""),set:d.bind(this,r)}));return i}};Object.defineProperty(SVGElement.prototype,"dataset",Rt)}const Mt=DOMTokenList.prototype.add,kt=DOMTokenList.prototype.remove;DOMTokenList.prototype.add=function(e){Array.isArray(e)?Mt.call(this,...e):Mt.call(this,...arguments)},DOMTokenList.prototype.remove=function(e){Array.isArray(e)?kt.call(this,...e):kt.call(this,...arguments)},Et._$name="DomHelper";const It=["border-top-width","border-right-width","border-bottom-width","border-left-width"],Ft=["padding-top","padding-right","padding-bottom","padding-left"],At="border-top-width",Pt="border-right-width",Lt="border-bottom-width",Ot="border-left-width",_t="padding-top",$t="padding-right",jt="padding-bottom",Ht="padding-left",Nt=Object.freeze({x:0,y:0}),Bt=/^([trblc])(\d*)-([trblc])(\d*)$/i,zt=/^([trblc])(\d*)$/i,Vt=["top","right","bottom","left"],Wt={t:0,r:1,b:2,l:3},Gt=["b-t","l-r","t-b","r-l"],Ut=Object.freeze([0,0]),Yt=["width","height"];function qt(e){return`${Vt[(Wt[e.myEdge]+2)%4][0]}${e.myOffset}-${Vt[(Wt[e.targetEdge]+2)%4][0]}${e.targetOffset}`}class Xt{static from(e,t,r){if(e instanceof Xt)return e;if(void 0===r&&"boolean"==typeof t&&(r=t,t=null),t){let{scrollLeft:e,scrollTop:r}=t;(P.isEdge||P.isSafari)&&t===document.body&&(e=r=0),t=Xt.from(t).translate(-e,-r)}else t=Nt;const n=e===document||e===window,s=n?new Xt(0,0,window.innerWidth,window.innerHeight):e.getBoundingClientRect(),i=r||n?[0,0]:[window.pageXOffset,window.pageYOffset];return new Xt(s.left+i[0]-t.x,s.top+i[1]-t.y,s.width,s.height)}static inner(e,t,r=!1){const n=this.from(e,t,r);if(document.body.contains(e)){const t=Et.getStyleValue(e,It);n.x+=parseInt(t[Ot]),n.y+=parseInt(t[At]),n.right-=parseInt(t[Pt]),n.bottom-=parseInt(t[Lt])}return n}static content(e,t,r=!1){const n=this.from(e,t,r);if(document.body.contains(e)){const t=Et.getStyleValue(e,It),r=Et.getStyleValue(e,Ft);n.x+=parseInt(t[Ot])+parseInt(r[Ht]),n.y+=parseInt(t[At])+parseInt(r[_t]),n.right-=parseInt(t[Pt])+parseInt(r[$t]),n.bottom-=parseInt(t[Lt])+parseInt(r[jt])}return n}static client(e,t,r=!1){const n=this.content(e,t,r),s=Et.scrollBarWidth;let i;return s&&(e.scrollHeight>e.clientHeight&&"hidden"!==Et.getStyleValue(e,"overflow-y")&&(i=parseInt(Et.getStyleValue(e,"padding-right")),n.right+=i-Math.max(i,s)),e.scrollWidth>e.clientWidth&&"hidden"!==Et.getStyleValue(e,"overflow-x")&&(i=parseInt(Et.getStyleValue(e,"padding-bottom")),n.bottom+=i-Math.max(i,s))),n}static union(...e){let t,{x:r,y:n,right:s,bottom:i}=e[0];if(e.length>1)for(let o=1;o<e.length;o++)t=e[o],t.x<r&&(r=t.x),t.y<n&&(n=t.y),t.right>s&&(s=t.right),t.bottom>i&&(i=t.bottom);return new Xt(r,n,s-r,i-n)}round(e){return A.deprecate("Core","3.0.0","Use Rectangle.roundPx() method instead."),this.roundPx(e)}roundPx(e=window.devicePixelRatio||1){const t=this;return t._x=Et.roundPx(t._x,e),t._y=Et.roundPx(t._y,e),t._width=Et.roundPx(t._width,e),t._height=Et.roundPx(t._height,e),t}static get $name(){return Object.prototype.hasOwnProperty.call(this,"_$name")&&this._$name||this.name}get $name(){return this.constructor.$name}constructor(e,t,r,n){ze.assertNumber(e,"Rectangle.x"),ze.assertNumber(t,"Rectangle.y"),ze.assertNumber(r,"Rectangle.width"),ze.assertNumber(n,"Rectangle.height");this._x=e,this._y=t,this._width=r,this._height=n}clone(){const e=this,t=new Xt(e.x,e.y,e.width,e.height);return t.minHeight=e.minHeight,t.minWidth=e.minWidth,t}contains(e){const t=this;return e instanceof Xt&&(e._x>=t._x&&e._y>=t._y&&e.right<=t.right&&e.bottom<=t.bottom)}intersect(e,t=!1,r=!1){const n=Math.max(this.y,e.y),s=Math.min(this.right,e.right),i=Math.min(this.bottom,e.bottom),o=Math.max(this.x,e.x);return!!(r?i>=n&&s>=o:i>n&&s>o)&&(!!t||new Xt(o,n,s-o,i-n))}equals(e,t=!1){const r=t?e=>Math.round(e):e=>e;return e instanceof Xt&&r(e.x)===r(this.x)&&r(e.y)===r(this.y)&&r(e.width)===r(this.width)&&r(e.height)===r(this.height)}translate(e,t){return this._x+=e||0,this._y+=t||0,this}moveTo(e,t){return null!=e&&(this._x=e),null!=t&&(this._y=t),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){return new Xt.Point(this.x+this.width/2,this.y+this.height/2)}set x(e){const t=e-this._x;this._x=e,this._width-=t}get x(){return this._x}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){const t=e-this._y;this._y=e,this._height-=t}get y(){return this._y}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}get area(){return this.width*this.height}set minWidth(e){const t=this;isNaN(e)?t._minWidth=null:(t._minWidth=Number(e),t.width=Math.max(t.width,t._minWidth))}get minWidth(){return this._minWidth}set minHeight(e){const t=this;isNaN(e)?t._minHeight=null:(t._minHeight=Number(e),t.height=Math.max(t.height,t._minHeight))}get minHeight(){return this._minHeight}adjust(e,t,r,n){const s=this;return s.x+=e,s.y+=t,s.width+=r,s.height+=n,s}inflate(e){return this.adjust(-e,-e,e,e)}constrainTo(e,t){const r=this,n=r.height,s=r.y,i=r.minWidth||r.width,o=r.minHeight||r.height;if(r.height>=e.height){if(t&&o>e.height)return!1;r._y=e.y,r.height=e.height}if(r.width>=e.width){if(t&&i>e.width)return r.y=s,r.height=n,!1;r._x=e.x,r.width=e.width}let a=r.bottom-e.bottom;return a>0&&r.translate(0,-a),a=r.right-e.right,a>0&&r.translate(-a),a=e.y-r.y,a>0&&r.translate(0,a),a=e.x-r.x,a>0&&r.translate(a),r}alignTo(e){let t,r,n,s,i=this.clone(),o=e.target,a=e.constrainTo;if(!o||o instanceof Xt||(o=Xt.from(o.element?o.element:o)),a&&!(a instanceof Xt)){s=a===window||a===document;const t="ignorePageScroll"in e?e.ignorePageScroll:!s;a=Xt.from(a.element?a.element:a,null,t),e.constrainPadding&&a.inflate(-e.constrainPadding)}const l=this,c=null==(w=e.offset)?Ut:"number"==typeof w?[w,w]:w,{align:d,axisLock:u,anchorSize:h,anchorPosition:g}=e,m=function(e){const t=Bt.exec(e),r=parseInt(t[2]||50),n=parseInt(t[4]||50);return{myAlignmentPoint:t[1]+r,myEdge:t[1],myOffset:r,targetAlignmentPoint:t[3]+n,targetEdge:t[3],targetOffset:n,startZone:Wt[t[3]]}}(d),p=e.position||(o&&"Point"===o.$name?o:null),f=a&&a.clone(),v=[],y=[{zone:r=m.startZone,align:d}],b=e.matchSize&&Yt[1&m.startZone],C=l[b];var w;if(b&&u&&(i[b]=o[b]),a&&i.constrainTo(a),a&&null!=m.startZone)if(u)y.push({zone:r=(r+2)%4,align:qt(m)}),"flexible"===u&&(y.push({zone:r=(m.startZone+1)%4,align:Gt[r]}),y.push({zone:r=(r+2)%4,align:Gt[r]}));else for(let e=1;e<4;e++)y.push({zone:r=(r+1)%4,align:Gt[r]});if(g){const e=1&m.startZone?"y":"x";t={[e]:g[e],edge:Vt[(m.startZone+2)%4]}}if(f&&o&&(f.adjust(-o.width,-o.height,o.width,o.height),o.constrainTo(f)),i.minWidth=l.minWidth,i.minHeight=l.minHeight,p)i.moveTo(p.x,p.y),a&&i.constrainTo(a);else{const e=h?[h[1]+c[0],h[1]+c[1]]:c,r=o.getAlignmentPoint(m.targetAlignmentPoint,e),d=i.getAlignmentPoint(m.myAlignmentPoint);i.translate(r[0]-d[0],r[1]-d[1]);if(i.intersect(o,!0))a&&i.constrainTo(a),n=m.startZone,i.translate(...e);else if(a&&!a.contains(i)){let r,c,d=i.clone(),h=[];t=null,v[0]=r=a.clone(),r.bottom=o.y-e[1],v[1]=r=a.clone(),r.x=o.right+e[0],v[2]=r=a.clone(),r.y=o.bottom+e[1],v[3]=r=a.clone(),r.right=o.x-e[0];for(let t=0;t<y.length;t++){if(b&&2==t&&(i[b]=C),r=v[n=y[t].zone],i=i.alignTo({target:o,offsets:e,align:y[t].align}),i.constrainTo(r,!0)&&(h.push({result:i,zone:n}),!c||i.width<l.width||i.height<l.height)){i.align=y[t].align;break}if(!c||r.area>c.area){const e=i.clone();switch(n){case 0:e.moveTo(null,r.bottom-e.height);break;case 1:e.moveTo(r.left);break;case 2:e.moveTo(null,r.top);break;case 3:e.moveTo(r.right-e.width)}c={area:r.area,result:e,zone:n}}}h.length?(h.length>1&&!u&&h.sort((e,t)=>Math.sqrt((d.x-e.result.x)**2+(d.y-e.result.y)**2)-Math.sqrt((d.x-t.result.x)**2+(d.y-t.result.y)**2)),i=h[0].result,n=h[0].zone):(i=c.result,n=c.zone,s&&i.constrainTo(a))}else n=m.startZone;if(i.zone=n,h){if(!t){let e=1&n,r=e?"y":"x",s=e?"bottom":"right",a=Math.max(o[r],i[r]),l=a+(Math.min(o[s],i[s])-a)/2-h[0]/2,c=l+h[0];c>i[s]&&(l-=c-i[s]),l<i[r]&&(l+=i[r]-l),t={[r]:l-i[r],edge:Vt[(n+2)%4]}}i.anchor=t}}return i}getAlignmentPoint(e,t=Ut){const r=this,n=zt.exec(e),s=n[1].toLowerCase(),i=Math.min(Math.max(parseInt(n[2]||50),0),100)/100;switch(s){case"t":return[r.x+r.width*i,r.y-t[1]];case"r":return[r.right+t[0],r.y+r.height*i];case"b":return[r.x+r.width*i,r.bottom+t[1]];case"l":return[r.x-t[0],r.y+r.height*i];case"c":{const e=r.center;return[e.x+t[0],e.y+t[1]]}}}highlight(){const e=Et.createElement({parent:document.body,style:`position:absolute;z-index:9999999;pointer-events:none;\n                            left:${this.x}px;top:${this.y}px;width:${this.width}px;height:${this.height}px`});return Et.highlight(e).then(()=>e.remove())}}Xt._$name="Rectangle";class Kt extends Xt{static from(e){const t=e.changedTouches;return new Kt(t?t[0].screenX:e.screenX,t?t[0].screenY:e.pageY)}constructor(e,t){super(e,t,0,0)}constrain(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}toArray(){return[this.x,this.y]}}Kt.__proto__.Point=Kt,Kt._$name="Point";class Zt{static curry(e){return function t(...r){return r.length>=e.length?e.apply(this,r):function(...e){return t.apply(this,r.concat(e))}}}static bindAll(e){for(let t in e)"function"==typeof e[t]&&(e[t]=e[t].bind(e))}static createInterceptor(e,t,r){return(...n)=>!1!==t.call(r,...n)&&e.call(r,...n)}static createSequence(e,t,r){return(...n)=>{const s=e.call(r,...n),i=t.call(r,...n);return void 0===i?s:i}}static createThrottled(e,t,r,n,s){let i,o,a,l=0;const c=()=>{o=0,l=performance.now(),i.push.apply(i,n),e.apply(r,i)};return a=function(...e){let a=performance.now()-l;i=e,a>=t?(clearTimeout(o),c()):(o||(o=setTimeout(c,t-a)),s&&(i.push.apply(i,n),s.apply(r,i)))},a.cancel=()=>clearTimeout(o),a}static createBuffered(e,t,r,n){let s,i,o;const a=()=>{i=0,s.push.apply(s,n),e.apply(r,s)};return o=function(...e){s=e,i&&clearTimeout(i),i=setTimeout(a,t)},o.cancel=()=>clearTimeout(i),o}static returnTrue(){return!0}static animate(e,t,r,n="linear"){let s=!1;const i=new Promise(i=>{const o=performance.now(),a=()=>{const l=Math.min((performance.now()-o)/e,1),c=r&&r.setTimeout?r:window;s||!1===t.call(r,this.easingFunctions[n](l))&&i(),s||1===l?c.requestAnimationFrame(()=>i()):c.requestAnimationFrame(a)};a()});return i.cancel=()=>(s=!0,!1),i}}const Jt=1.70158,Qt=7.5625,er=1.525,tr=2/2.75,rr=2.25/2.75,nr=1/2.75,sr=1.5/2.75,ir=2.5/2.75,or=2.625/2.75,ar=.984375;Zt.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=.5)<1?.5*Math.pow(e,2):-.5*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=.5)<1?.5*Math.pow(e,5):.5*(Math.pow(e-2,5)+2),easeInSine:e=>1-Math.cos(e*(Math.PI/2)),easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-.5*(Math.cos(Math.PI*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*--e)),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<nr?Qt*e*e:e<tr?Qt*(e-=sr)*e+.75:e<ir?Qt*(e-=rr)*e+.9375:Qt*(e-=or)*e+ar,easeInBack:e=>e*e*((Jt+1)*e-Jt),easeOutBack:e=>(e-=1)*e*((Jt+1)*e+Jt)+1,easeInOutBack:e=>{let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=er))*e-t)*.5:.5*((e-=2)*e*((1+(t*=er))*e+t)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=er))*e-t)*.5:.5*((e-=2)*e*((1+(t*=er))*e+t)+2)},swingFrom:e=>e*e*((Jt+1)*e-Jt),swingTo:e=>(e-=1)*e*((Jt+1)*e+Jt)+1,bounce:e=>e<nr?Qt*e*e:e<tr?Qt*(e-=sr)*e+.75:e<ir?Qt*(e-=rr)*e+.9375:Qt*(e-=or)*e+ar,bouncePast:e=>e<nr?Qt*e*e:e<tr?2-(Qt*(e-=sr)*e+.75):e<ir?2-(Qt*(e-=rr)*e+.9375):2-(Qt*(e-=or)*e+ar),easeFromTo:e=>(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},Zt._$name="FunctionHelper";const lr=["clientX","clientY","pageX","pageY","screenX","screenY"],cr={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1,expires:1},dr={get:()=>!0},ur={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},hr=e=>{const{type:t}=e;if(t.startsWith("key")){const t=ur[e.key];t&&Object.defineProperty(e,"key",{get:()=>t})," "!==e.key||e.code||Object.defineProperty(e,"code",{get:()=>"Space"})}if(e.metaKey&&!e.ctrlKey&&Object.defineProperty(e,"ctrlKey",dr),e.target&&e.target.shadowRoot&&e.composedPath&&!P.isIE11&&!P.isEdge){const t=e.composedPath()[0],r=e.target;e.target!==t&&(Object.defineProperty(e,"target",{get:()=>t}),Object.defineProperty(e,"originalTarget",{get:()=>r}))}if(P.isChrome&&e.target){const{target:t}=e,{offsetX:r,offsetY:n}=e,{offsetWidth:s,offsetHeight:i}=t,o=Math.min(Math.max(r,0),s-1),a=Math.min(Math.max(n,0),i-1);!Object.getOwnPropertyDescriptor(e,"offsetX")&&(r<0||r>=s)&&Object.defineProperty(e,"offsetX",{get:()=>o}),!Object.getOwnPropertyDescriptor(e,"offsetY")&&(n<0||n>=i)&&Object.defineProperty(e,"offsetY",{get:()=>a})}if(e.target&&9===e.target.nodeType&&"clientX"in e){const t=Et.elementFromPoint(e.clientX,e.clientY);Object.defineProperty(e,"target",{get:()=>t})}if(e.target&&3===e.target.nodeType){const t=e.target.parentElement;Object.defineProperty(e,"target",{get:()=>t})}if(e.relatedTarget&&3===e.relatedTarget.nodeType){const t=e.target.parentElement;Object.defineProperty(e,"relatedTarget",{get:()=>t})}return t.startsWith("touch")&&e.touches.length&&gr.normalizeEvent(e),e};class gr{static normalizeEvent(e){return ze.copyPropertiesIf(e,e.touches[0]||e.changedTouches[0],lr)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,t){const r=this.getXY(e),n=this.getXY(t);return Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2))}static getPagePoint(e){return new Kt(e.pageX,e.pageY)}static getClientPoint(e){return new Kt(e.clientX,e.clientY)}static addListener(e,t,r,n){return n=e.nodeType?"string"==typeof t?Object.assign({element:e,[t]:r},n):Object.assign({element:e},t):e,this.on(n)}static on(e){const t=this,r=e.element,n=e.thisObj,s=[],i=ze.allKeys(e);let o,a,l=i.length;for(o=0;o<l;o++)if(a=i[o],!cr[a]){let i=e[a];"object"!=typeof i&&(i={handler:i});const o=i.element||r;P.isTouchDevice&&!P.isAndroid&&"contextmenu"===a&&s.push(t.addElementListener(o,"touchstart",{handler:t.createContextMenuWrapper(i.handler,i.thisObj||n)},e)),s.push(t.addElementListener(o,a,i,e))}const c=()=>{for(l=s.length,o=0;o<l;o++){const e=s[o];e[0].removeEventListener(e[1],e[2],e[3])}s.length=0};return n&&!1!==e.autoDetach&&(n.doDestroy=Zt.createInterceptor(n.doDestroy,c,n)),c}static addElementListener(e,t,r,n){const s=this.createHandler(e,t,r,n),i="passive"in r,o=r.expires||n.expires,a=n.thisObj;let l=r.capture||n.capture;if((i||"passive"in n)&&P.supportsPassive&&(l={capture:!!l,passive:i?r.passive:n.passive}),e.addEventListener(t,s,l),o){const r=a&&a.setTimeout?a:window;("number"==typeof o?r.setTimeout:r.requestAnimationFrame).call(r,()=>e.removeEventListener(t,s,l),o)}return[e,t,s,l]}static createHandler(e,t,r,n){const s=r.delay||n.delay,i=r.throttled||n.throttled,o=r.once||n.once,a=r.thisObj||n.thisObj,l=r.capture||n.capture,c=r.delegate||n.delegate;let d=r.handler,u=(e,...t)=>{if(!(this.playingDemo&&e.isTrusted||a&&a.isDestroyed)){if(hr(e),c){const t=e.target instanceof HTMLElement&&e.target.closest(c);if(!t)return;Object.defineProperty(e,"currentTarget",{get:()=>t,configurable:!0})}"string"==typeof d&&(d=a[d]),d.call(a,e,...t)}};if(null!=s){const e=u,t=a&&a.setTimeout?a:window;u=(...r)=>{t.setTimeout(()=>{e(...r)},s)}}if(null!=i){let e,t=i;i.buffer&&(e=e=>i.alt.call(this,hr(e)),t=i.buffer),u=a&&a.isDelayable?a.throttle(u,t,a,null,e):Zt.createThrottled(u,t,a,null,e)}if(o){const r=u;u=(...n)=>{e.removeEventListener(t,u,l),r(...n)}}return r.thisObj&&!1!==r.autoDetach&&(a.doDestroy=Zt.createInterceptor(a.doDestroy,()=>e.removeEventListener(t,u),a)),u}static onTransitionEnd({element:e,property:t,handler:r,timeout:n,thisObj:s=window}){let i;const o=gr.on({element:e,thisObj:s,transitionend(e){e.propertyName===t&&(i&&(s.isDelayable?s.clearTimeout(i):clearTimeout(i),i=null),o(),r.call(s))}});null==n&&(n=Et.getPropertyTransitionDuration(e,t)),null!=n&&(i=s.isDelayable?s.setTimeout(()=>{o(),r.call(s)},n):setTimeout(()=>{o(),r.call(s)},n))}static createContextMenuWrapper(e,t){const r=this;return n=>{if(1===n.touches.length){const s=n.touches[0],i=setTimeout(()=>{a();const i=new MouseEvent("contextmenu",s);Object.defineProperty(i,"target",{get:()=>s.target}),"string"==typeof e&&(e=t[e]),i.browserEvent=n,e.call(t,i),r.contextMenuTouchId=s.identifier},r.longPressTime),o=()=>{r.contextMenuTouchId=null,a(),clearTimeout(i)},a=r.on({element:document,touchmove:o,touchend:o,pointermove:o,pointerup:o,capture:!0})}}}static createDblClickWrapper(e,t,r){const n=this;let s,i,o;return()=>{i||(i=n.on({element:e,touchstart:e=>{s=e.changedTouches[0].identifier,e.preventDefault()},touchend:e=>{if(e.changedTouches[0].identifier===s){e.preventDefault(),clearTimeout(o),s=i=null;const n=Xt.from(e.changedTouches[0].target,null,!0),a=e.changedTouches[0].pageX-n.x,l=e.changedTouches[0].pageY-n.y,c=Object.assign({browserEvent:e},e),d=new MouseEvent("dblclick",c);Object.defineProperty(d,"target",{get:()=>e.target}),Object.defineProperty(d,"offsetX",{get:()=>a}),Object.defineProperty(d,"offsetY",{get:()=>l}),"string"==typeof t&&(t=r[t]),t.call(r,d)}},once:!0}),o=setTimeout(()=>{i(),s=i=null},n.dblClickTime))}}static lockComposedPath(e){var t;e.composedPath&&(e.composedPath=(t=e.composedPath(),()=>t))}}gr.longPressTime=500,gr.dblClickTime=300,gr.on({element:document,mousedown(){Et.isTouchEvent||(Et.usingKeyboard=!1,document.body.classList.remove("b-using-keyboard"))},touchmove(){Et.usingKeyboard=!1,document.body.classList.remove("b-using-keyboard")},keydown(){Et.usingKeyboard=!0,document.body.classList.add("b-using-keyboard")}}),P.isTouchDevice&&gr.on({element:document,touchmove:e=>{e.target.closest(".b-dragging")&&e.preventDefault()},passive:!1,capture:!0}),gr._$name="EventHelper";let mr=null;const pr=[],fr=e=>1===e.nodeType&&"absolute"===e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("position");class vr{static addResizeListener(e,t){const r=this;if(e!==document&&e!==window||(e=document.body),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)r.hasWindowResizeListener||(window.addEventListener("resize",r.onWindowResize),r.hasWindowResizeListener=!0);else if(window.ResizeObserver)r.resizeObserver||(r.resizeObserver=new ResizeObserver(r.onElementResize)),r.resizeObserver.observe(e);else{const[n,s,i]=Et.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},!0);s.scrollLeft=s.scrollTop=i.scrollLeft=i.scrollTop=1e6,s.addEventListener("scroll",r.onSizeMonitorScroll,!0),i.addEventListener("scroll",r.onSizeMonitorScroll,!0),(t.targetMutationMonitor=new MutationObserver(e=>{const t=[];for(const r of e)"childList"===r.type&&(t.push.apply(t,r.removedNodes),t.push.apply(t,r.addedNodes));t.length>0&&t.every(fr)||s.dispatchEvent(new CustomEvent("scroll",{bubbles:!1}))})).observe(e,{childList:!0,subtree:!0}),t.monitorElement=n}e._bResizemonitor.handlers.push(t)}static removeResizeListener(e,t){if(e){e!==document&&e!==window||(e=document.body);const r=e._bResizemonitor;let n=0;r&&r.handlers&&(z.remove(r.handlers,t),n=r.handlers.length),n||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(t.monitorElement&&(t.monitorElement.remove(),t.monitorElement=null),t.targetMutationMonitor&&t.targetMutationMonitor.disconnect()))}}static onElementResize(e){for(const t of e){const e=t.target,r=e._bResizemonitor,n=t.contentRect||e.getBoundingClientRect();if(e.offsetParent&&(!r.rectangle||n.width!==r.rectangle.width||n.height!==r.rectangle.height)){const t=r.rectangle;r.rectangle=n;for(const s of r.handlers)s(e,t,n)}}}static onSizeMonitorScroll(e){if(document.body.contains(e.target)){e.stopImmediatePropagation();const t=e.target.parentNode,r=t.parentNode,n=r._bResizemonitor,s=r.getBoundingClientRect();n.rectangle&&s.width===n.rectangle.width&&s.height===n.rectangle.height||(pr.push([r,n.rectangle,s]),n.rectangle=s,mr||(mr=requestAnimationFrame(vr.fireResizeEvents))),t.firstChild.scrollLeft=t.firstChild.scrollTop=t.childNodes[1].scrollTop=t.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){const t=document.body,r=t._bResizemonitor,n=r.rectangle;r.rectangle=document.documentElement.getBoundingClientRect();for(const e of r.handlers)e(t,n,r.rectangle)}static fireResizeEvents(){for(const e of pr)for(const t of e[0]._bResizemonitor.handlers)e[0].offsetParent&&t.apply(this,e);mr=null,pr.length=0}}vr._$name="ResizeMonitor";let yr=null;A.isTestEnv&&(yr=window.bryntum.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,isEmpty:(e=!1)=>yr.timeouts.size+yr.animationFrames.size+(e?yr.intervals.size:0)===0});var br=e=>class extends(e||B){get isDelayable(){return!0}doDestroy(){const e=this;e.timeoutIds&&(e.timeoutIds.forEach((e,t)=>{"function"==typeof e&&e(),clearTimeout(t),yr&&yr.timeouts.delete(t)}),e.timeoutIds=null),e.timeoutMap&&(e.timeoutMap.forEach((e,t)=>clearTimeout(t)),e.timeoutMap=null),e.intervalIds&&(e.intervalIds.forEach(e=>{clearInterval(e),yr&&yr.intervals.delete(e)}),e.intervalIds=null),e.animationFrameIds&&(e.animationFrameIds.forEach(e=>{cancelAnimationFrame(e),yr&&yr.animationFrames.delete(e)}),e.animationFrameIds=null),super.doDestroy()}hasTimeout(e){return!(!this.timeoutMap||!this.timeoutMap.has(e))}setTimeout({fn:e,delay:t,name:r,runOnDestroy:n,cancelOutstanding:s,args:i}){(arguments.length>1||"function"==typeof arguments[0])&&([e,t,r,n]=arguments),"string"==typeof e?r=e:r||(r=e.name),s&&this.clearTimeout(r);const o=this,a=o.timeoutIds||(o.timeoutIds=new Map),l=o.timeoutMap||(o.timeoutMap=new Map),c=setTimeout(()=>{"string"==typeof e&&(e=o[r]),a&&a.delete(c),l&&l.delete(r),yr&&yr.timeouts.delete(c),e.apply(o,i)},t);return a.set(c,!n||e),yr&&yr.timeouts.set(c,{fn:e,delay:t,name:r}),r&&l.set(r,c),c}clearTimeout(e){let t=e;if("string"==typeof t){if(!this.timeoutMap)return;t=this.timeoutMap.get(e),this.timeoutMap.delete(e)}clearTimeout(t),this.timeoutIds&&this.timeoutIds.delete(t),yr&&yr.timeouts.delete(t)}clearInterval(e){clearInterval(e),this.intervalIds&&this.intervalIds.delete(e),yr&&yr.intervals.delete(e)}setInterval(e,t){const r=setInterval(e,t);return(this.intervalIds||(this.intervalIds=new Set)).add(r),yr&&yr.intervals.set(r,{fn:e,delay:t}),r}requestAnimationFrame(e,t=[],r=this){const n=this.animationFrameIds||(this.animationFrameIds=new Set),s=requestAnimationFrame(()=>(yr&&yr.animationFrames.delete(s),n.delete(s),e.apply(r,t)));return n.add(s),yr&&yr.animationFrames.set(s,{fn:e,extraArgs:t,thisObj:r}),s}createOnFrame(e,t=[],r=this,n){let s;const i=(...i)=>{s&&n&&(this.cancelAnimationFrame(s),s=null),s||(s=this.requestAnimationFrame(()=>{"string"==typeof e&&(e=r[e]),s=null,i.push(...t),e.apply(r,i)}))};return i.cancel=()=>this.cancelAnimationFrame(s),i}cancelAnimationFrame(e){cancelAnimationFrame(e),this.animationFrameIds&&this.animationFrameIds.delete(e),yr&&yr.animationFrames.delete(e)}buffer(e,t,r=this){let n=null;"string"==typeof e&&(e=r[e]);const s=(...i)=>{s.called=!1,null!==n&&this.clearTimeout(n),n=this.setTimeout(()=>{e.call(r,...i),s.called=!0},t)};return s.cancel=()=>this.clearTimeout(n),s}throttle(e,t,r=this,n,s){const i=this;let o,a,l=0;const c=()=>{a=0,l=performance.now(),o.push.apply(o,n),e.apply(r,o),d.called=!0},d=(...e)=>{const u=performance.now()-l;o=e,u>=t?(i.clearTimeout(a),c()):(a||(a=i.setTimeout(c,t-u),d.called=!1),s&&(o.push.apply(o,n),s.apply(r,o)))};return d.cancel=()=>i.clearTimeout(a),d}get widgetClass(){}};class Cr extends B{static get defaultConfig(){return{property:null,value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null}}construct(e){"function"==typeof e&&(e={filterBy:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||K.generateId("b-filter"))}set id(e){this._id=e}onChange(e){const t=this;!t.isConfiguring&&t.owner&&!t.owner.isConfiguring&&t.owner.onFilterChanged&&t.owner.onFilterChanged(t,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){return this[this.operator](this.convert(e[this.property]))}set property(e){this._property=e,this.onChange("property")}get property(){return this._property}set value(e){this._value=this.caseSensitive||"string"!=typeof e?e:e.toLowerCase(),this.onChange("value")}get value(){return this._value}set operator(e){this._operator=e,this.onChange("operator")}get operator(){return this._operator||("string"==typeof this.value?"*":"=")}convert(e){return this.caseSensitive||"string"!=typeof e?e:e.toLowerCase()}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.value)}endsWith(e){return String(e).endsWith(this.value)}"="(e){return ze.isEqual(e,this.value)}"!="(e){return!ze.isEqual(e,this.value)}">"(e){return ze.isMoreThan(e,this.value)}">="(e){return ze.isMoreThan(e,this.value)||ze.isEqual(e,this.value)}"<"(e){return ze.isLessThan(e,this.value)}"<="(e){return ze.isLessThan(e,this.value)||ze.isEqual(e,this.value)}"*"(e){return ze.isPartial(e,this.value)}static generateFiltersFunction(e){return e&&(e.length||e.count)?function(t){let r=!0;for(const n of e)if(n.disabled||(r=n.filter(t)),!r)break;return r}:Zt.returnTrue}}Cr._$name="CollectionFilter";class wr extends B{static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){"function"==typeof e&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||K.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,t){const{convert:r,property:n,useLocaleSort:s}=this,i="desc"===this.direction.toLowerCase()?-1:1;if(e=e[n],t=t[n],r&&(e=r(e),t=r(t)),s&&null!=e&&null!=t){if(!0===s)return String(e).localeCompare(t);if("string"==typeof s)return String(e).localeCompare(t,s);if("object"==typeof s)return String(e).localeCompare(t,s.locale,s)}return(e>t?1:e<t?-1:0)*i}static generateSortFunction(e,t){const r=e.isCollection?e.values:e,n=r.length;return(e,s)=>{let i,o;for(o=0;o<n;++o)if(i=r[o].sortFn(e,s),i)return i;return t?t(e,s):0}}}wr._$name="CollectionSorter";const Sr=()=>0,Dr=(e,t)=>t-e,Er=Symbol("filteredIndicesProperty"),xr=Object.freeze([]),Tr=Object.freeze({action:"sort",added:xr,removed:xr,replaced:xr}),Rr=Object.freeze({action:"filter",added:xr,removed:xr,replaced:xr}),Mr={string:1,number:1},kr=new WeakMap,Ir=e=>{if(e&&"object"==typeof e){let t=kr.get(e);void 0===t&&(t=Symbol("bscik"),kr.set(e,t)),e=t}return e};class Fr extends(G(B)){static get defaultConfig(){return{idProperty:"id",extraKeys:null,autoFilter:!0}}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){super.doDestroy(),this._values.length=0,this.isFiltered&&(this._filteredValues.length=0,this.filters.destroy()),this._sorters&&this._sorters.destroy()}get isCollection(){return!0}clear(){const e=this,t=this._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:t}))}replaceValues({values:e,filteredValues:t,silent:r=!1,isNewDataset:n=!1}){const s=this;let i,o;if(s.isFiltered&&!n){Boolean(t)?e&&(i=s._values,s._values=e.slice()):(t=e.slice(),e=null),o=s._filteredValues,s._filteredValues=t.slice()}else i=s._values,s._values=e.slice(),t=null,s.isFiltered&&n&&s.autoFilter?(s._filterFunction=null,s._filteredValues=s._values.filter(s.filterFunction),s._indicesInvalid=!0):s._filteredValues&&(s._filteredValues.length=0);s._indicesInvalid=!0,s.generation++,r||s.trigger("change",{action:"replaceValues",replacedValues:i,replacedFilteredValues:o,values:e,filteredValues:t})}set values(e){this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,t=!1){(this.isFiltered&&!t?this._filteredValues:this._values).forEach(e)}map(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).map(e)}find(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}add(...e){1===e.length?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){1===e.length?this.splice(0,...e):this.splice(0,e)}move(e,t){const r=this,{_values:n}=r,s=r.indexOf(e,!0);let i=t?r.indexOf(t,!0):n.length;if(-1===s||-1===i)throw new Error("Collection move parameters must be present in Collection");return s!==i&&s!==i-1&&(s<i&&i--,n.splice(s,1),n.splice(i,0,e),r._indicesInvalid=!0,r.trigger("change",{action:"move",item:e,from:s,to:i})),i}splice(e=0,t,...r){const n=this,s=n.idProperty,i=n._values,o={},a=[],l=[],c=n.totalCount;let d,u;if(r)if(1===r.length&&Array.isArray(r[0])&&(r=r[0]),c&&r.length){const e=n.indices[s];d=[];for(let t=0;t<r.length;t++){const n=r[t],a=Ir(n[s]),c=e[a];o[a]=!0,null!=c?i[c]!==n&&(l.push([i[c],n]),i[c]=n):d.push(n)}}else d=r;if(t)if("number"==typeof t)for(let r=e;t;--t){o[Ir(i[r][s])]?(e++,r++):(a.push(i[r]),i.splice(r,1),n._indicesInvalid=u=!0)}else{let e,r=0===d.length;Array.isArray(t)||(t=[t]);const l=t.reduce((t,s)=>{const i="number"==typeof s,o=i?s:n.indexOf(s,!0);return r&&(null!=e&&o!==e+1||i)&&(r=!1),o>=0&&o<c&&t.push(o),e=o,t},[]).sort(Dr);if(r)l.length&&(a.push.apply(a,t),i.splice(l[l.length-1],l.length),n._indicesInvalid=u=!0);else for(let e=0;e<l.length;e++){const t=l[e];if(-1!==t){o[Ir(i[t][s])]||(a.unshift(i[t]),i.splice(t,1),n._indicesInvalid=u=!0)}}}d.length&&(i.splice(Math.min(e,i.length),0,...d),n._indicesInvalid=u=!0),n.isSorted?n.onSortersChanged():n.isFiltered&&(n.autoFilter?n.onFiltersChanged():n._filteredValues.push(...d)),u||l.length?(n.generation++,n.trigger("change",{action:"splice",removed:a,added:d,replaced:l,oldCount:c})):n.trigger("noChange",{index:e,toRemove:t,toAdd:r})}changeId(e,t){const r=this,{idProperty:n}=r,s=Mr[typeof e]?e:e[n],i=r.get(s);if(i){const e=r.get(t);if(e&&i!==e)throw new Error(`Attempt to set item ${s} to already existing member's id ${t}`);if(i[n]=t,!r._indicesInvalid){const e=r.indices.id,n=e[s];delete e[s],e[t]=n}}}get(e,t=!1){return this.getBy(this.idProperty,e,t)}getAt(e,t=!1){return this.isFiltered&&!t?this._filteredValues[e]:this._values[e]}getBy(e,t,r=!1){const n=this;if(n.isFiltered&&r){const r=n.findIndex(e,t,!0);if(-1!==r)return n._values[r]}else{const r=n.findIndex(e,t);if(-1!==r)return n.values[r]}}get count(){return this.values.length}get totalCount(){return this._values.length}set idProperty(e){this._idProperty=e,this.addIndex(e)}get idProperty(){return this._idProperty}set extraKeys(e){Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;t++)this.addIndex(e[t])}get sorters(){return this._sorters||(this._sorters=new Fr({listeners:{change:"onSortersChanged",thisObj:this}})),this._sorters}addSorter(e){const t=e instanceof wr?e:new wr(e);return this.sorters.add(t),t}get isSorted(){return Boolean(this._sorters&&this._sorters.count)}onSortersChanged(){const e=this;delete e._sortFunction,e._values.sort(e.sortFunction),e._indicesInvalid=!0,e.trigger("change",Tr)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=wr.generateSortFunction(this.sorters.values):this._sortFunction=Sr),this._sortFunction}get filters(){return this._filters||(this._filters=new Fr({listeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const t=e instanceof Cr?e:new Cr(e);return this.filters.add(t),t}get isFiltered(){return Boolean(this._filters&&this._filters.count)}onFiltersChanged(){const e=this;e._filterFunction=null,e._filteredValues=e._values.filter(e.filterFunction),e._indicesInvalid=!0,e.trigger("change",Rr)}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=Cr.generateFiltersFunction(this.filters.values):this._filterFunction=Zt.returnTrue),this._filterFunction}addIndex(e){(this._indices||(this._indices={}))[e]={},this._indicesInvalid=!0}findIndex(e,t,r=!1){const n=this,s=n.isFiltered,i=s&&!r?n.indices[Er][e]:n.indices[e];if(i){const e=i[Ir(t)];if(null!=e)return e}else{const i=s&&!r?n._filteredValues:n._values,o=i.length;for(let r=0;r<o;r++)if(i[r][e]==t)return r}return-1}indexOf(e,t=!1){return this.findIndex(this.idProperty,Mr[typeof e]?e:e[this.idProperty],t)}includes(e,t=!1){return-1!==this.indexOf(e,t)}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}rebuildIndices(){const e=this,t=e.isFiltered,r=e._indices||(e._indices={}),n=Object.keys(r),s=n.length,i=e._values,o=i.length;let a,l;for(t&&(r[Er]={}),a=0;a<s;a++)r[n[a]]={},t&&(r[Er][n[a]]={});for(a=0;a<o;a++){const e=i[a];for(l=0;l<s;l++){const t=n[l];r[t][Ir(e[t])]=a}}if(t){const t=e._filteredValues,r=t.length,i=e._indices[Er];for(a=0;a<r;a++){const e=t[a];for(l=0;l<s;l++){const t=n[l];i[t][Ir(e[t])]=a}}}e._indicesInvalid=!1}}Fr._$name="Collection";const Ar={true:"auto",false:"hidden","hidden-scroll":"auto"},Pr={block:"nearest"},Lr=new Promise(e=>e()),Or={x:1};class _r extends(br(G(B))){static get defaultConfig(){return{element:null,overflowX:null,overflowY:null,translate:null,_x:0,_y:0,scrollEndBuffer:100}}addPartner(e,t=Or){"string"==typeof t&&(t={[t]:1}),(this.partners||(this.partners=new Fr)).add({id:e.id,scroller:e,axes:t}),e.partners&&e.partners.includes(this.id)||e.addPartner(this,t)}removePartner(e){this.partners&&this.partners.includes(e)&&(this.partners.remove(e),e.removePartner(this))}scrollIntoView(e,t=Pr){const r=e instanceof Xt,n=r?e:Xt.from(e),{xDelta:s,yDelta:i}=this.getDeltaTo(e,t),o=this.scrollBy(s,i,t);return(t.highlight||t.focus)&&o.then(()=>{r&&(e=n.translate(-s,-i)),t.highlight&&Et.highlight(e,this),t.focus&&e.focus()}),o}scrollBy(e=0,t=0,r=Pr){const n=this,s="object"==typeof r?r.animate:r,i=Math.abs(e),o=Math.abs(t);n.scrollAnimation&&(n.scrollAnimation.cancel(),n.scrollAnimation=null),(e||t)&&(n.silent=r.silent);let a=s&&("number"==typeof s?s:"number"==typeof s.duration?s.duration:300);if(a&&(i>10||o>10)){const{x:l,y:c}=n;let d=l,u=c;return Math.max(i,o)<50&&(a=Math.min(a,500)),n.scrollAnimation=Zt.animate(a,s=>{const i=1===s;if(e){if(n.x!==d&&!r.force)return n.scrollAnimation&&n.scrollAnimation.cancel();n.x=Math.max(l+(i?e:Math.round(e*s)),0)}if(t){if(n.y!==u&&!r.force)return n.scrollAnimation&&n.scrollAnimation.cancel();n.y=Math.max(c+(i?t:Math.round(t*s)),0)}d=n.x,u=n.y},n,s.easing),n.element.classList.add("b-scrolling"),n.scrollAnimation.then(()=>{n.isDestroyed||(n.element.classList.remove("b-scrolling"),n.scrollAnimation=null)}),n.scrollAnimation}return e|t?(n.x+=e,n.y+=t,l=n.element,new Promise(e=>gr.on({element:l,scroll:e,once:!0}))):Lr;var l}scrollTo(e,t,r){const{x:n,y:s}=this,i=null==e?0:e-n,o=null==t?0:t-s;return this.scrollBy(i,o,r)}doDestroy(){const e=this;e._element&&(e._element.removeEventListener("scroll",e.scrollHandler),e.wheelListenerRemover&&e.wheelListenerRemover()),e.scrollAnimation&&e.scrollAnimation.cancel(),e.partners&&e.partners.forEach(t=>t.scroller.removePartner(e)),super.doDestroy()}onElMutation(e){const t=this,[r,n]=Et.getTranslateXY(t.element);if(t._x!==-r||t.y!==-n){const e=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(e,"target",{get:()=>t.element}),t.onScroll(e)}}onScroll(e){const t=this;t.widget&&t.widget.isDestroyed||(t.positionDirty=!0,t.element.classList.contains("b-scrolling")||t.element.classList.add("b-scrolling"),e.widget=t.widget,t.silent||t.trigger("scroll",e),t.syncPartners(),t.controllingPartner=null,t.scrollEndHandler(e))}syncPartners(){const e=this;e.partners&&e.partners.forEach(({axes:t,scroller:r})=>{r!==e.controllingPartner&&r.sync(e,t)})}onScrollEnd(e){this.silent&&(this.silent=!1),this.trigger("scrollEnd",e),this.controllingPartner=null,this.element.classList.remove("b-scrolling")}getDeltaTo(e,t){const r=this;if(!r.viewport)return{xDelta:0,yDelta:0};const n=e instanceof Xt?e:Xt.from(e),s=t.block||"nearest",i=r.viewport,o=t.edgeOffset||0,a=i.width>=n.width+2*o?o:0,l=i.height>=n.height+2*o?o:0,c=n.clone().adjust(-a,-l,a,l).constrainTo(new Xt(i.x-r.x,i.y-r.y,r.scrollWidth,r.scrollHeight)),d=c.clone();let u=0,h=0;if("start"===s)d.moveTo(i.x,i.y),u=c.x-d.x,h=c.y-d.y;else if("end"===s)d.translate(i.right-d.right,i.bottom-d.bottom),u=c.x-d.x,h=c.y-d.y;else if("center"===s){const e=i.center;d.moveTo(e.x-d.width/2,e.y-d.height/2),u=u||c.x-d.x,h=h||c.y-d.y}else d.width>i.width?u=d.x-i.x:d.right>i.right?u=d.right-i.right:d.x<i.x&&(u=d.x-i.x),d.height>i.height?h=d.y-i.y:d.bottom>i.bottom?h=d.bottom-i.bottom:d.y<i.y&&(h=d.y-i.y);return{xDelta:!1===t.x?0:Math.round(Math.max(Math.min(u,r.maxX-r.x),-r.x)),yDelta:!1===t.y?0:Math.round(Math.max(Math.min(h,r.maxY-r.y),-r.y))}}get viewport(){return Xt.client(this.element)}get element(){return this._element}set element(e){const t=this,r=t.scrollHandler||(t.scrollHandler=t.onScroll.bind(t));if(t.scrollEndHandler||(t.scrollEndHandler=t.buffer(t.onScrollEnd,t.scrollEndBuffer)),t._element&&(t.translate?t.mutationObserver&&t.mutationObserver.disconnect(t._element):(t._element.removeEventListener("scroll",r),t._element.classList.remove("b-widget-scroller"))),t._element=e,t.translate){if(t.mutationObserver||(t.mutationObserver=new MutationObserver(e=>t.onElMutation(e))),t.mutationObserver.observe(e,{attributes:!0}),t._x=t._y=0,document.contains(e)){const[r,n]=Et.getTranslateXY(e);t._x=-r,t._y=-n}}else e.addEventListener("scroll",r),e.classList.add("b-widget-scroller");t.updateOverflowX(t.overflowX),t.updateOverflowY(t.overflowY)}get x(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[r,n]=Et.getTranslateXY(t);e._x=-r,e._y=-n}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._x}set x(e){const{element:t,widget:r}=this;r&&r.isConfiguring||(this._x=e,t&&(this.trigger("scrollStart",{x:e}),this.translate?Et.setTranslateX(t,-e):t.scrollLeft=e,this.positionDirty=!0))}sync(e,t){const{x:r,y:n}=t;null!=r&&this.x!==e.x&&(this.controllingPartner=e,this.x=e.x),null!=n&&this.y!==e.y&&(this.controllingPartner=e,this.y=e.y)}get y(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[r,n]=Et.getTranslateXY(t);e._x=-r,e._y=-n}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._y}set y(e){const{element:t,widget:r}=this;r&&r.isConfiguring||(this._y=e,t&&(this.trigger("scrollStart",{y:e}),this.translate?Et.setTranslateY(t,-e):t.scrollTop=e,this.positionDirty=!0))}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}get overflowX(){return this._overflowX}set overflowX(e){this._overflowX=e,this.element&&this.updateOverflowX(e)}updateOverflowX(e){const{element:t,translate:r}=this;"hidden-scroll"!==e||r||(t.classList.add("b-hide-scroll"),this.enableWheel()),r||(t.style.overflowX=Ar[e]||e),this.positionDirty=!this.isConfiguring}get overflowY(){return this._overflowY}set overflowY(e){this._overflowY=e,this.element&&this.updateOverflowY(e)}updateOverflowY(e){const{element:t,translate:r}=this;"hidden-scroll"!==e||r||(t.classList.add("b-hide-scroll"),this.enableWheel()),r||(t.style.overflowY=Ar[e]||e),this.positionDirty=!this.isConfiguring}enableWheel(){P.isChrome||P.isSafari||this.wheelListenerRemover||(this.wheelListenerRemover=gr.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&!1!==this.overflowX?(this.x+=e.deltaX,e.stopPropagation()):!1!==this.overflowY&&(this.y+=e.deltaY,e.stopPropagation())}get scrollWidth(){return this.element?this.element.scrollWidth:0}set scrollWidth(e){const t=this;let r=t.widthStretcher;r&&null==e?(r.remove(),t.widthStretcher=null):e&&(r||(r=t.widthStretcher=Et.createElement({className:"b-scroller-stretcher"})),r.style.transform=`translateX(${e-1}px)`,t.element&&t.element.lastChild!==r&&t.element.appendChild(r))}get scrollHeight(){return this.element?this.element.scrollHeight:0}set scrollHeight(e){const t=this,r=t.stretcher||(t.stretcher=Et.createElement({className:"b-scroller-stretcher"}));r.style.transform=`translateY(${e-1}px)`,t.element&&t.element.lastChild!==r&&t.element.appendChild(r)}get clientWidth(){return this.element?this.element.clientWidth:0}get clientHeight(){return this.element?this.element.clientHeight:0}get id(){return this._id||(this.widget?this._id=this.widget.id+"-scroller":this._id=K.generateId("scroller-")),this._id}}_r._$name="Scroller";const $r={localeName:"En",localeDesc:"English",Object:{Yes:"Yes",No:"No",Cancel:"Cancel"},Combo:{noResults:"No results"},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:e=>"Value must be less than or equal to "+e.max,rangeUnderflow:e=>"Value must be greater than or equal to "+e.min,stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:"Invalid date input"},TimeField:{invalidTime:"Invalid time input"},List:{loading:"Loading..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:e=>"of "+e.lastPage,summaryTemplate:e=>`Displaying records ${e.start} - ${e.end} of ${e.allCount}`},DateHelper:{locale:"en-US",weekStartDay:0,unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"second",plural:"seconds",abbrev:"s"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"hour",plural:"hours",abbrev:"h"},{single:"day",plural:"days",abbrev:"d"},{single:"week",plural:"weeks",abbrev:"w"},{single:"month",plural:"months",abbrev:"mon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"year",plural:"years",abbrev:"yr"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A"},ordinalSuffix:e=>e+({1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th")}};ne.registerLocale("En",{desc:"English",locale:$r});const jr=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,Hr={INPUT:1,TEXTAREA:1},Nr=e=>{e.isVisible&&e.triggerPaint()},Br=/^:not\((.+)\)$/,zr=Et.createElement({html:"Â ",style:"position:absolute;top:-10000em;left:-10000em"});class Vr extends(br(G(ae(B)))){static get $name(){return"Widget"}static get defaultConfig(){return{element:!0,callOnFunctions:!0,id:"",html:null,hasGeneratedId:null,cls:null,style:null,disabled:null,adopt:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:null,preventTooltipOnTouch:null,monitorResize:null,cache:{},floating:null,positioned:null,draggable:null,align:"t-b",centered:null,constrainTo:null,anchor:null,scrollAction:null,hideAnimation:null,showAnimation:null,x:null,y:null,scrollable:null,scrollerClass:_r,defaultBindProperty:"html",defaultAction:null,width:null,height:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title"],requireSize:!1,ref:null,hidden:null,ignoreScrollDuration:500}}construct(e={},...t){const r=this;r.alignConstrained=0,r.afterHideShowAnimate=r.afterHideShowAnimate.bind(r),r.onConstrainElementResize=r.realign.bind(r),r.doHideOrRealign=r.doHideOrRealign.bind(r),r.initialRender=!0,r._isUserAction=!1,super.construct(e,t),r.finalizeInit()}isType(e,t){return K.isType(this,e,t)}startConfigure(e){const t=this,{adopt:r,element:n}=t;if(r){const s="string"==typeof r?document.getElementById(r):r,i=K.fromElement(s);i&&i!==t&&i.destroy(),t.preExistingElements=Array.from(s.childNodes),t.adoptedElementClassName=s.className,t.adoptedElementCssText=s.style.cssText,s.id&&!e.id&&(t.id=n.id=s.id),Et.syncAttributes(n,s);for(let e=0,{length:t}=n.childNodes;e<t;e++)s.appendChild(n.childNodes[0]);t._element=s,delete t._contentRange}super.startConfigure(e)}set title(e){this._title!==e&&(this._title=e,this.titleElement&&(this.titleElement.innerHTML=e))}get title(){return this._title}get element(){return this._element}set element(e){const t=this;"string"==typeof e?e=Et.createElementFromTemplate(e):"Object"===e.constructor.name?e=Et.createElement(e):1!==e.nodeType&&(e=Et.createElementFromTemplate(t.template(t))),t._element=e;const r=e.classList;e.id=t.id,e.className+=" "+t.widgetClassList.join(" "),t._hidden&&r.add("b-hidden"),t.parent||(t.floating||t.owner||r.add("b-outer"),P.isTouchDevice&&r.add("b-touch-events"),Et.scrollBarWidth?r.add("b-visible-scrollbar"):r.add("b-overlay-scrollbar"),P.isChrome?r.add("b-chrome"):P.isSafari?r.add("b-safari"):P.isFirefox?r.add("b-firefox"):P.isIE11?r.add("b-ie"):P.isEdge&&r.add("b-edge"));const n=e.querySelectorAll("[reference]");for(const e of n){const r=e.getAttribute("reference");e.removeAttribute("reference"),t[r]=e,e.dataset&&(e.dataset.ownerCmp=t.id)}}set constrainTo(e){this._constrainTo=e}get constrainTo(){return"_constrainTo"in this?this._constrainTo:window}set centered(e){if(this._centered=e,e&&!this.floating)throw new Error("`centered` is only relevant when a Widget is `floating`");e?this.element.classList.add("b-centered"):this.element.classList.remove("b-centered")}get centered(){return this._centered}get contentElement(){return this.element}get contentRange(){const e=this,{contentElement:t}=e,r=e._contentRange||(e._contentRange=P.isIE11?document.createRange():new Range);return r.collapsed&&(r.setStart(t,e.contentRangeStartOffset||0),r.setEnd(t,e.contentRangeEndOffset||t.childNodes.length)),r}get id(){return this._id}set id(e){const t=this,r=t._id;if(e?t.hasGeneratedId=!1:(e=K.generateId(`b-${t.$name.toLowerCase()}-`),t.hasGeneratedId=!0),r){const n=t.element.querySelectorAll(`[data-owner-cmp="${r}"]`);K.unregister(t);for(let t=0,{length:r}=n;t<r;t++)n[t].dataset.ownerCmp=e;t.element.id=e}t._id=e,K.register(t)}get style(){return this.element?this.element.ownerDocument.defaultView.getComputedStyle(this.element):this._style}set style(e){this._style=e,this.element&&Et.applyStyle(this.element,this._style)}get dataset(){return this.element.dataset}set dataset(e){Object.assign(this.dataset,e)}finalizeInit(){(this.insertBefore||this.appendTo||this.insertFirst||this.adopt)&&this.render()}doDestroy(){var e,t;const r=this,{tooltip:n,preExistingElements:s,element:i}=r;if(r.scrollable&&r.scrollable.destroy(),n&&(r._tooltip?n.destroy():n.activeTarget===i&&n.isVisible&&n.hide()),r.unmask(),r.removeTransientListeners(),r.floating||r.positioned?r.hide():r.revertFocus(),vr.removeResizeListener(i.parentElement,r.onParentElementResize),vr.removeResizeListener(i,r.onElementResize),r.adopt){for(let e=Array.from(i.childNodes),t=0,{length:r}=e;t<r;t++){const r=e[t];s.includes(r)||r===Vr.floatRoot||r.remove()}i.className=r.adoptedElementClassName,i.style.cssText=r.adoptedElementCssText}else i.remove();null===(e=r.dragEventDetacher)||void 0===e||e.call(r),null===(t=r.dragOverEventDetacher)||void 0===t||t.call(r),zr.remove(),K.unregister(r),super.doDestroy()}render(e,t=!0){const r=this,{element:n}=r;vr.removeResizeListener(n.parentElement,r.onParentElementResize),vr.removeResizeListener(n,r.onElementResize),r.emptyCache(),r.syncElement&&r.currentElement?Et.sync(n,r.currentElement):(e?(r.appendTo="string"==typeof e?document.getElementById(e):e,r.appendTo.appendChild(n)):r.insertBefore?(r.insertBefore="string"==typeof r.insertBefore?document.getElementById(r.insertBefore):r.insertBefore,r.insertBefore.parentElement.insertBefore(n,r.insertBefore)):r.insertFirst?(r.insertFirst="string"==typeof r.insertFirst?document.getElementById(r.insertFirst):r.insertFirst,r.insertFirst.firstChild?r.insertFirst.insertBefore(n,r.insertFirst.firstChild):r.insertFirst.appendChild(n)):r.appendTo&&(r.appendTo="string"==typeof r.appendTo?document.getElementById(r.appendTo):r.appendTo,r.appendTo.appendChild(n)),r.currentElement=n),r.rendered=!0,t&&(r._thisIsAUsedExpression(r.contentRange),r.triggerPaint())}template(e){return`<div class="${e.html?"b-html":""}" ${e.name?`data-name="${e.name}"`:""}>${e.html||""}</div>`}alignTo(e){(1===e.nodeType||e instanceof Vr||e instanceof Kt)&&(e={target:e}),this.releaseSizeConstraints();const t=this,{scrollable:r,element:n}=t,s=e.target,i=s&&(s instanceof Xt?s:s.element||s),o=Xt.from(n,t.positioned?n.offsetParent:null,!0),a=i&&1===i.nodeType;if(e=ze.assign({constrainTo:t.positioned?null:t.constrainTo,axisLock:t.axisLock,anchor:t.anchor},"object"==typeof t.align?t.align:{align:t.align},e),o.minWidth=e.minWidth||t.minWidth,o.minHeight=e.minHeight||t.minHeight,t.lastAlignSpec=e,a&&i.offsetParent){(e=Object.setPrototypeOf({},e)).target=Xt.from(i,t.positioned?n.offsetParent:null,!t.positioned),e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1);const r=t.clippedBy;if(r){const n=e.target.intersect(r);if(!n){const e=t.hide();return t.lastAlignSpec.targetHidden=!0,e}e.target=n}t.anchoredTo=i}else t.anchoredTo=null;e.anchor&&(e.anchorSize=t.anchorSize,n.appendChild(t.anchorElement)),t.isAligning=!0,t.trigger("beforeAlign",e),t.isAligning=!1;const{constrainTo:l}=e,c=o.alignTo(e);let{align:d,anchor:u,x:h,y:g,width:m,height:p,bottom:f,right:v}=c;if(t.lastAlignSpec.zone=c.zone,p!==o.height&&("configuredHeight"in t||(t.configuredHeight=n.style.height),t.height=p,t.alignConstrained=1|t.alignConstrained,r&&(r.overflowY=!0)),m!==o.width&&("configuredWidth"in t||(t.configuredWidth=n.style.width),t.width=m,t.alignConstrained=2|t.alignConstrained,r&&(r.overflowX=r.clientWidth>r.scrollWidth)),d&&t.alignConstrained){e.align=d;const r=Xt.from(n,t.positioned?n.offsetParent:null,!0).alignTo(e);u=r.anchor,h=r.x,g=r.y,m=r.width,p=r.height,f=r.bottom,v=r.right}if(t.setXY(h,g),u){const{edge:e}=u,{anchorElement:r}=t,s=[],i=n.style.pointerEvents;n.style.pointerEvents="all","top"===e||"bottom"===e?(s[0]=h+u.x,s[1]="top"===e?g+1:f-1):(s[0]="left"===e?h+1:v-1,s[1]=g+u.y);const o=document.elementFromPoint(...s);if(n.style.pointerEvents=i||null,o){const e=Et.getStyleValue(o,"background-color");e.match(jr)?t.anchorPathElement.setAttribute("fill",t.defaultAnchorBackgroundColor):t.anchorPathElement.setAttribute("fill",e)}r.classList.remove("b-hide-display"),r.style.transform="",r.className="b-anchor b-anchor-"+e,Et.setTranslateXY(r,u.x,u.y)}else t._anchorElement&&t.anchorElement.classList.add("b-hide-display");"hide"!==t.scrollAction||a||(n.style.pointerEvents="none",t.anchoredTo=document.elementFromPoint(h,g),n.style.pointerEvents=""),("realign"===t.scrollAction&&a||"hide"===t.scrollAction)&&!t.documentScrollListener&&(t.clearTimeout(t.scrollListenerTimeout),t.scrollListenerTimeout=t.setTimeout(()=>{t.documentScrollListener=!0,document.addEventListener("scroll",t.doHideOrRealign,!0)},"hide"===t.scrollAction?t.ignoreScrollDuration:0)),P.isAndroid||t.constrainListeners||l instanceof Xt||(t.clearTimeout(t.resizeListenerTimeout),t.resizeListenerTimeout=t.setTimeout(()=>{t.constrainListeners=!0,vr.addResizeListener(l||window,t.onConstrainElementResize)},this.ignoreScrollDuration))}realign(e){const t=this;if(t.isVisible&&(t.floating||t.positioned)&&t.lastAlignSpec){const r=t.lastAlignSpec.target;if(r&&1===r.nodeType){const n=Xt.from(r);if(n.minHeight=n.minWidth=1,r!==document.body&&!r.offsetParent||e&&1===e.nodeType&&e.contains(r)&&!Xt.from(e).intersect(n))return t.hide()}t.alignTo(t.lastAlignSpec)}}releaseSizeConstraints(){const e=this,t=e.scrollable;1&e.alignConstrained&&(e.height=e.configuredHeight,t&&(t.overflowY=t.config.overflowY)),2&e.alignConstrained&&(e.width=e.configuredWidth,t&&(t.overflowX=t.config.overflowX)),e.alignConstrained=0}toFront(){this.element&&this.element.nextSibling&&this.element.parentNode.appendChild(this.element)}set ref(e){this._ref=e,this.element.dataset.ref=e}get ref(){return this._ref}set clippedBy(e){this._clippedBy=Array.isArray(e)?e:e?[e]:null}get clippedBy(){const e=this._clippedBy;if(e){let t,r=Xt.from(e[0],null,!0);for(t=1;t<e.length;t++)r=r.intersect(Xt.from(e[t],null,!0));return r}}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}set scrollable(e){const t=this.overflowElement;"boolean"==typeof e&&(e={overflowX:e,overflowY:e}),t&&(e.element=t),e.widget=this,this._scrollable=new this.scrollerClass(e)}get scrollable(){return this._scrollable}get html(){return this.initializingElement||!this.element?this.content||this._html:this.contentElement.innerHTML}set html(e){const t=this,r=null==e,{element:n,contentElement:s}=t;if(t._html!==e&&(t._html=e,n)){const i=s===n&&t._anchorElement;n.classList[r?"remove":"add"]("b-html"),i&&t.element.removeChild(i),t.contentElement.innerHTML=r?"":e,i&&n.appendChild(i),(t.floating||t.positioned)&&(t.isAligning||t.realign())}}set content(e){const t=this,r=null==e,{element:n}=t;if(t._html!==e&&(t._html=e,n)){const{contentRange:s}=t;n.classList[r?"remove":"add"]("b-html"),Ct(n)?(s.deleteContents(),r||s.insertNode(Et.createElementFromTemplate(e,{fragment:!0}))):t.contentElement.innerHTML=e,t.contentRangeStartOffset=s.startOffset,t.contentRangeEndOffset=s.endOffset,t.isAligning&&!t.positioned||t.realign()}}onThemeChange(){this.anchorElement&&this.anchorElement.offsetParent&&(this._anchorSize=null,this.realign())}get anchorSize(){const e=this;let t=this._anchorSize;if(!t){const r=parseFloat(Et.getStyleValue(e.element,"border-top-width")),n=Et.getStyleValue(e.element,"border-top-color"),s=e.anchorElement,i=s.firstElementChild,o=e.anchorPathElement=i.lastElementChild,a=e._hidden;let l=Et.getStyleValue(e.contentElement,"background-color");l.match(jr)&&(l=Et.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=l,t=s.getBoundingClientRect();const[c,d]=t=e._anchorSize=[t.width,t.height];i.setAttribute("height",d+r),i.setAttribute("width",c),o.setAttribute("d",`M0,${d}L${c/2},0.5L${c},${d}`),r&&(o.setAttribute("stroke-width",r),o.setAttribute("stroke",n)),t[1]-=r,a&&e.element.classList.add("b-hidden"),e.themeChangeListener||(e.themeChangeListener=Yr.on({theme:"onThemeChange",thisObj:e}))}return e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor),t}get anchorElement(){let e=this._anchorElement;return e||(e=this._anchorElement=Et.createElement({parent:this.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[{tag:"defs",children:[{tag:"filter",id:"shadow-filter",children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:2,"flood-opacity":.05}]}]},{tag:"path",filter:P.isIE11||P.isEdge?null:"url(#shadow-filter)"}]}]})),e}set anchor(e){this._anchor=e,this._anchorElement&&this._anchorElement.classList[e?"remove":"add"]("b-hide-display")}get draggable(){return this._draggable}set draggable(e){const t=this,{element:r}=t;t._draggable=e,r.setAttribute("draggable",Boolean(e)),e?t.dragEventDetacher=gr.addListener({element:t.element,dragstart:t.onWidgetDragStart,dragend:t.onWidgetDragEnd,thisObj:t}):(t.dragEventDetacher&&t.dragEventDetacher(),t.dragOverEventDetacher&&t.dragOverEventDetacher())}onWidgetDragStart(e){const t=this,r=document.elementFromPoint(e.clientX,e.clientY),{handleSelector:n}=t.draggable;if(n){const s=Br.exec(n)[1];if(s){if(r.closest(`#${t.element.id} ${s}`))return void e.preventDefault()}else if(!r.closest(`#${t.element.id} ${n}`))return void e.preventDefault()}t.removeTransientListeners();const s=e.clientX,i=e.clientY,o=document.scrollingElement||document.body,a=t.getXY()[0],l=t.getXY()[1];document.body.appendChild(zr),e.dataTransfer.setDragImage&&(e.dataTransfer.setData("application/node type",""),e.dataTransfer.setDragImage(zr,0,0)),e.dataTransfer.effectAllowed="none",t.dragOverEventDetacher=gr.addListener({element:document.body,dragover:e=>t.setXY(a+e.clientX-s-o.scrollLeft,l+e.clientY-i-o.scrollTop)}),t.anchor=null}onWidgetDragEnd(e){zr.remove(),this.dragOverEventDetacher()}get anchor(){return this._anchor}get floating(){return this._floating}set floating(e){e=Boolean(e),Boolean(this.floating)!==e&&(this._floating=e)}get positioned(){return this._positioned}set positioned(e){e=Boolean(e),Boolean(this.positioned)!==e&&(this.element.classList[e?"add":"remove"]("b-positioned"),this._positioned=e)}getXY(){return[Et.getPageX(this.element),Et.getPageY(this.element)]}setXY(e,t){const r=this;(r.floating||r.positioned)&&(null!=e&&(r._x=e,r.centered=!1),null!=t&&(r._y=t,r.centered=!1),Et.setTranslateXY(r.element,r._x||0,r._y||0))}set x(e){this.setXY(e)}get x(){return this.getXY()[0]}set y(e){this.setXY(null,e)}get y(){return this.getXY()[1]}get width(){const e=this,t=e.element;return e.monitorResize?(null==e._width&&(e._width=t.offsetWidth),e._width):t.offsetWidth}set width(e){Et.setLength(this.element,"width",e),this._width=null,this._flex=null,this.element.style.flex=P.isIE11?"":null}get maxWidth(){return Et.measureSize(this.element.style.maxWidth,this.element)}set maxWidth(e){Et.setLength(this.element,"maxWidth",e)}get minWidth(){return Et.measureSize(this.element.style.minWidth,this.element)}set minWidth(e){Et.setLength(this.element,"minWidth",e)}get flex(){return this._flex}set flex(e){this._flex=e,("number"==typeof e||"string"==typeof e&&1===e.split(/\s/).length)&&(e=`${e} ${e}`),this.element.style.flex=e,this.element.style.width=P.isIE11?"":null}get alignSelf(){return this._alignSelf}set alignSelf(e){this.element.style.alignSelf=e}get margin(){return this._margin}set margin(e){this.element.style.margin=this._margin=this.parseTRBL(e).join(" ")}get height(){const e=this,t=e.element;return e.monitorResize?(null==e._height&&(e._height=t.offsetHeight),e._height):t.offsetHeight}set height(e){Et.setLength(this.element,"height",e),this._height=null}get maxHeight(){return Et.measureSize(this.maxHeightElement.style.maxHeight,this.element)}set maxHeight(e){const t=this,{element:r}=t;Et.setLength(t.maxHeightElement,"maxHeight",e),P.isIE11&&t.contentElement!==r&&(null==e?vr.removeResizeListener(r,t.boundMaxHeightBugHandler):(vr.addResizeListener(r,t.boundMaxHeightBugHandler||(t.boundMaxHeightBugHandler=t.fixIEMaxHeightBug.bind(t))),document.body.contains(r)&&t.fixIEMaxHeightBug()))}fixIEMaxHeightBug(){const{element:e,contentElement:t}=this;if("column"===Et.getStyleValue(e,"flex-direction")){t.style.maxHeight="";let r=Xt.client(e).height;const n=e.childNodes,s=n.length;for(let e=0;e<s;e++){const s=n[e];s===t||s.classList.contains("b-resize-monitors")||(r-=s.offsetHeight)}this.contentElement.style.maxHeight=r+"px"}}get minHeight(){return Et.measureSize(this.element.style.minHeight,this.element)}set minHeight(e){Et.setLength(this.element,"minHeight",e)}get disabled(){return this._disabled}set disabled(e){const t=this.element,r=this.focusElement;e&&this.revertFocus(),t&&(t.classList[e?"add":"remove"]("b-disabled"),r&&(r.disabled=e)),this._disabled=e,this.onDisabled(e)}onDisabled(e){}disable(){this.disabled=!0}enable(){this.disabled=!1}get tooltip(){if(this._tooltip)return this._tooltip;{const e=this.constructor.tooltip;return e&&e.trigger("pointerOver",{source:e,target:this.element}),e}}set tooltip(e){const t=this;t._tooltip&&(t._tooltip.destroy(),t._tooltip=null),delete t.element.dataset.btip,e&&(t.preventTooltipOnTouch&&P.isTouchDevice||("Object"!==e.constructor.name&&(e={html:"string"==typeof e?e:t.placeholder,textContent:!0}),e.newInstance?(e.type="tooltip",e.forElement||(e.forElement=t.element),"showOnHover"in e||e.forSelector||(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),t._tooltip=J.createWidget(e)):(t.element.dataset.btip=!0,t.tipConfig=e)))}get isVisible(){const e=this,{element:t}=e;return Boolean(t&&!e._hidden&&!e.isDestroying&&Ct(t)&&(!e.requireSize||bt(t))&&(!e.owner||e.owner.isVisible))}focus(){this.isFocusable&&Et.focusWithoutScrolling(this.focusElement)}get focusElement(){}get isFocusable(){const e=this.focusElement;return e&&this.isVisible&&!this.disabled&&(e===document.body||e.offsetParent)}show(){return new Promise(e=>{const t=this,{showAnimation:r,element:n}=t,s=Vr.floatRoot,i=n.style;let o,a;t.isVisible||!1===t.trigger("beforeShow")||t.internalBeforeShow&&!1===t.internalBeforeShow()?e():(t.cancelHideShowAnimation(),r&&(o=Object.keys(r)[0],a=r[o],t.currentAnimation={styleProp:o,resolve:e},t.isAnimating=!0,n.addEventListener("transitionend",t.afterHideShowAnimate),i[o]=a.from),t.floating&&(s.contains(n)||(t.rendered?s.appendChild(t.element):t.render(s,!1))),t._hidden=!1,n.classList.remove("b-hidden"),r&&(i.transition=`${o} ${a.duration} ease ${a.delay}`,t.requestAnimationFrame(()=>{i[o]=a.to})),t.afterShow(!r&&e),!t.inShowBy&&t.floating&&t.forElement&&!t.hidden&&t.alignTo(t.forElement))})}showBy(e){const t=this;t.inShowBy=!0;const r=t.show();return t.inShowBy=!1,t.isVisible&&t.alignTo(e),r}showByPoint(e,t,r){const n=1===arguments.length?e:[e,t];return this.showBy(Object.assign({target:new Xt(n[0],n[1],1,1),align:"t-b"},r))}afterShow(e){this.boundMaxHeightBugHandler&&this.boundMaxHeightBugHandler(),this.trigger("show"),this.triggerPaint(),e&&e()}triggerPaint(){const e=this,{element:t}=e,r=!e.isPainted;e.isVisible&&(r&&(e.scaleToFitWidth?(e.onParentElementResize=e.onParentElementResize.bind(e),vr.addResizeListener(t.parentElement,e.onParentElementResize),e.isVisible&&e.updateScale()):e.monitorResize&&(e.onElementResize=e.onElementResize.bind(e),vr.addResizeListener(t,e.onElementResize))),e.eachWidget&&e.eachWidget(Nr,!1),e.trigger("paint",{firstPaint:r}),r&&e.monitorResize&&!e.scaleToFitWidth&&vr.onElementResize([{target:e.element}]),e.isPainted=!0)}cancelHideShowAnimation(){const e=this,t=e.element,r=t.style;e.currentAnimation&&(e.isAnimating=!1,t.classList.remove("b-hiding"),t.removeEventListener("transitionend",e.afterHideShowAnimate),r.transition=r[e.currentAnimation.styleProp]="",e.currentAnimation=null)}afterHideShowAnimate(e){if(this.isDestroyed)return;const t=this,r=t.element,n=r.style,{styleProp:s,resolve:i}=t.currentAnimation;e.target===r&&e.propertyName===s&&(r.classList.remove("b-hiding"),t.isAnimating=!1,t.currentAnimation=null,r.removeEventListener("transitionend",t.afterHideShowAnimate),n.transition=n[s]="",t._hidden&&t.afterHideAnimation(),i())}hide(e=!0){return new Promise(t=>{const r=this,n=r.element,s=n.style,i=e&&r.hideAnimation;if(!r._hidden&&!1!==r.trigger("beforeHide")){if(r._hidden=!0,!n)return;if(r.revertFocus(),r.isDestroyed)return void t();if(r.cancelHideShowAnimation(),i){const e=Object.keys(i)[0],o=i[e];Number(getComputedStyle(r.element)[e])!==o.to?(r.currentAnimation={styleProp:e,resolve:t},n.classList.add("b-hiding"),r.isAnimating=!0,n.addEventListener("transitionend",r.afterHideShowAnimate),s[e]=o.from,s.transition=`${e} ${o.duration} ease ${o.delay}`,r.requestAnimationFrame(()=>{s[e]=o.to})):n.classList.add("b-hidden")}else n.classList.add("b-hidden");r.afterHide(!i&&t)}})}doHideOrRealign(e){const t=this,{anchoredTo:r,lastAlignSpec:n}=t,s=n&&n.target,i=document.activeElement,[o,a]=t.getXY();if(!t.element.contains(e.target)&&e.isTrusted&&!(9===e.target.nodeType&&t.element.contains(i)&&Hr[i]&&window.innerHeight<document.body.offsetHeight)&&(t.realign(e.target),!t.isDestroyed&&"hide"===t.scrollAction)){const[n,i]=t.getXY();!(n!==o||i!==a||s instanceof Kt)||r&&!Et.isDescendant(e.target,r)||t.hide()}}afterHide(e=null){const t=this,{lastAlignSpec:r}=t;r&&(r.targetHidden=null),t.removeTransientListeners(),t.hideAnimation||t.afterHideAnimation(),t.trigger("hide"),e&&e()}removeTransientListeners(){const e=this;e.documentScrollListener&&(document.removeEventListener("scroll",e.doHideOrRealign,!0),e.documentScrollListener=!1),e.constrainListeners&&(vr.removeResizeListener(e.lastAlignSpec.constrainTo||window,e.onConstrainElementResize),e.constrainMutationMonitor&&e.constrainMutationMonitor.disconnect(),e.constrainListeners=!1)}afterHideAnimation(){const{element:e}=this;this.floating&&Vr.floatRoot.contains(e)?e.remove():e.classList.add("b-hidden")}set visible(e){this.hidden=!e}set hidden(e){this.isConfiguring?(this._hidden=e,this.element.classList[e?"add":"remove"]("b-hidden")):e?this.hide():this.show()}get hidden(){return Boolean(this._hidden)}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){return this.parent||this._owner||this._element&&K.fromElement(this.forElement||this.element.parentNode)}set owner(e){this._owner=e}get previousSibling(){return this.getSibling(-1)}get nextSibling(){return this.getSibling(1)}getSibling(e){const{parent:t}=this,r=t?t.childItems:Array.from(this.element.parentElement.querySelectorAll(".b-widget"));return t?r[r.indexOf(this)+e]:K.fromElement(r[r.indexOf(this.element)+e])}up(e,t,r){const n=typeof r,s="number"===n,i="string"===n;for(let n=this.owner,o=1;n;n=n.owner,o++){if(Z(n,e,t))return n;if(s&&o>=r)return;if(i&&Z(n,r,t))return;if(n===r)return}}owns(e){if(e){if(e.eventPhase&&(e=e.target),1===e.nodeType){if(this.element.contains(e))return!0;e=K.fromElement(e)}for(;e;){if(e===this)return!0;e=e.owner}}return!1}onFocusIn(e){const t=this,{element:r}=t;t.containsFocus=!0,t.focusInEvent=e,r.classList.add("b-contains-focus"),r.contains(e.target)&&t.onInternalKeyDown&&!t.keyDownListenerRemover&&(t.keyDownListenerRemover=gr.on({element:r,keydown:"onInternalKeyDown",thisObj:t})),t.trigger("focusin",e)}onFocusOut(e){const t=this;t.keyDownListenerRemover&&(t.keyDownListenerRemover(),t.keyDownListenerRemover=null),t.isDestroyed||(e.relatedTarget||t.revertFocus(!0),t.containsFocus=!1,t.element.classList.remove("b-contains-focus"),t.trigger("focusout",e))}revertFocus(e){let t=this.focusInEvent&&this.focusInEvent.relatedTarget;(e||this.containsFocus&&t&&1===t.nodeType&&this.element.contains(document.activeElement))&&(t&&Et.isFocusable(t)||(t=this.getFocusRevertTarget()),t&&Et.isFocusable(t)&&Et.focusWithoutScrolling(t))}getFocusRevertTarget(){const e=this,{owner:t,focusInEvent:r}=e,n=r&&r.backwards?1:-1;let s=r&&r.relatedTarget;const i=s&&K.fromElement(s);if(t&&!t.isDestroyed&&(!s||!Et.isFocusable(s)||i&&!i.isFocusable)){if(s=null,t.eachWidget){const r=[];if(t.eachWidget(t=>{(t===e||t.isFocusable)&&r.push(t)},!1),r.length>1){const t=r.indexOf(e);s=r[t+n]||r[t-n]}}!s&&t.isFocusable&&(s=t),s=s?s.focusElement:t.getFocusRevertTarget()}return s}get widgetClassList(){const e=this,t=e.cls,r=e.classHierarchy(Vr).reduce((t,r)=>{const n=Reflect.getOwnPropertyDescriptor(r.prototype,"widgetClass");let s;if(n&&n.get)s=n.get.call(e);else{const e=Object.prototype.hasOwnProperty.call(r,"$name")||Object.prototype.hasOwnProperty.call(r,"_$name")?r.$name:r.name;(e.length<3||e.includes("$"))&&console.warn(`Widget class ${e} with no $name getter found`),s="b-"+e.toLowerCase()}return s&&t.push(...s.split(" ")),t},t?t.split(" "):[]);return e.floating&&r.push("b-floating"),P.isTouchDevice&&r.push("b-touch"),r}fromCache(e,t=!1,r=this.element){if(!r)return null;const n=this;return n.cache[e]||(n.cache[e]=t?Et.children(r,e):Et.down(r,e)),n.cache[e]}emptyCache(){this.cache={}}mask(e){const t=this;return t.maskInstance&&t.maskInstance.destroy(),"string"==typeof e?t.maskInstance=J.mask(t.element,e):(e.element=t.element,t.maskInstance=J.mask(e))}unmask(){this.maskInstance&&(J.unmask(this.element),this.maskInstance=null)}onInternalResize(e,t,r,n,s){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e){const t=this,r=t.element,n=t._width,s=t._height,i=r.offsetWidth,o=r.offsetHeight;t.suspendResizeMonitor||n===i&&s===o||(t.onInternalResize(r,i,o,n,s),t.trigger("resize",{width:i,height:o,oldWidth:n,oldHeight:s}))}updateScale(){const e=this,t=e.element,r=t.parentElement;e.configuredWidth||(e.configuredWidth=e.width),e.parentHeight||(e.parentHeight=r.offsetHeight),t.style.display="none";const n=r.offsetWidth/e.configuredWidth,s=e.allowGrowWidth?Math.min(n,1):n;t.style.transform=`scale(${s})`,t.style.transformOrigin="top left",t.style.display="",r.style.height=e.parentHeight*s+"px",e.allowGrowWidth&&n>1&&(e.width=e.configuredWidth*n)}onParentElementResize(e){this.updateScale()}parseTRBL(e,t="px"){if("number"==typeof(e=e||0))return[`${e}${t}`,`${e}${t}`,`${e}${t}`,`${e}${t}`];const r=e.split(" "),n=r.length;return 1===n?r[1]=r[2]=r[3]=r[0]:2===n?(r[2]=r[0],r[3]=r[1]):3===n&&(r[3]=r[1]),[isFinite(r[0])?`${r[0]}${t}`:r[0],isFinite(r[1])?`${r[1]}${t}`:r[2],isFinite(r[2])?`${r[2]}${t}`:r[3],isFinite(r[3])?`${r[3]}${t}`:r[4]]}static get floatRoot(){const e=this;return e._floatRoot||(e._floatRoot=document.querySelector(".b-float-root")),e._floatRoot?document.body.contains(e._floatRoot)||document.body.appendChild(e._floatRoot):(e._floatRoot=Et.createElement({className:"b-float-root",parent:document.body}),P.isAndroid&&(e._floatRoot.style.height=screen.height+"px",gr.on({element:window,orientationchange:()=>e._floatRoot.style.height=screen.height+"px"}))),e._floatRoot}get isAnimating(){return this._animating}set isAnimating(e){const t=this;e!==t.isAnimating&&(t.element.classList[e?"add":"remove"]("b-animating"),t._animating=e)}}Vr._$name="Widget",U.register("widget",Vr);let Wr,Gr,Ur=!1,Yr=(window.bryntum||(window.bryntum={})).GlobalEvents=new class extends(G(B)){suspendFocusEvents(){Ur=!0}resumeFocusEvents(){Ur=!1}get lastInteractionType(){return Gr}},qr=e=>e.isVisible&&e.isTopModal;function Xr(e,t,r,n,s,i,o){const a=new CustomEvent(e,o);return Object.defineProperty(a,"target",{get:()=>t}),Object.defineProperty(a,"relatedTarget",{get:()=>r}),a.fromWidget=n,a.toWidget=s,a.backwards=i,a}function Kr(e,t){if(e===t)return e;const r=e instanceof Vr;for(;e&&!e[r?"owns":"contains"](t)&&e!==t;)e=e[r?"owner":"parentNode"];return e}const Zr={element:document,touchstart(e){Wr=Wr||1!==e.changedTouches.length?null:e.changedTouches[0]},touchend:{handler:e=>{Wr&&(Wr.identifier===gr.contextMenuTouchId?(e.stopImmediatePropagation(),e.preventDefault()):1===e.changedTouches.length&&e.changedTouches[0].identifier===Wr.identifier&&Yr.trigger("globaltap",{event:e}),Wr=null)},passive:!1},mousedown:{handler:e=>{Gr="mouse",Wr||Yr.trigger("globaltap",{event:e})},passive:!1},keydown(){Gr="key"},keypress(){Gr="key"},focusin(e){if(Vr.floatRoot.scrollTop=Vr.floatRoot.scrollLeft=0,Ur)return;const t=e.relatedTarget?e.relatedTarget instanceof HTMLElement?e.relatedTarget:document.body:null,r=e.target||document.body,n=K.fromElement(t),s=K.fromElement(r),i=Kr(n,s),o=!!(t&&4&r.compareDocumentPosition(t)),a=K.query(qr),l=document.activeElement;if(a&&(!s||!a.owns(s)))return void a.focus();let c=Xr("focusout",t,e.target,n,s,o);for(let e=n;e&&e!==i;e=e.owner)if(!e.isDestroyed&&!e.isDestroying&&e.onFocusOut&&(e.onFocusOut(c),l!==document.activeElement))return;if(i&&e.target===i.element)document.activeElement===r&&i.focusElement&&i.focusElement!==i.element&&i.setTimeout(()=>i.focus&&i.focus(),0);else{c=Xr("focusin",r,t,n,s,o);for(let e=s;e&&e!==i;e=e.owner)e.isDestroyed||e.isDestroying||e.onFocusIn&&e.onFocusIn(c)}const d=Kr(t&&1===t.nodeType?t:null,r)||r.parentNode;c=Xr("focusmove",r,t,n,s,o,{bubbles:!0}),d.dispatchEvent(c)},focusout(e){Ur||e.relatedTarget&&K.fromElement(e.relatedTarget)||Zr.focusin({target:e.relatedTarget,relatedTarget:e.target})},capture:!0,passive:!0};function Jr(e=document){const t=ze.assign({},Zr,{element:e});gr.on(t)}Jr();class Qr extends(br()){static get $name(){return"Mask"}static get defaultConfig(){return{mode:"dark",icon:"b-icon b-icon-spinner",text:null,type:null,progress:null,maxProgress:null,useTransition:!1}}construct(e){super.construct(e),this.element||(this.element=document.body),this.show()}doDestroy(){const e=this;e.maskElement&&(e.maskElement.remove(),e.maskElement=null,e.mode.endsWith("blur")&&Et.forEachChild(e.element,t=>{t.classList.remove("b-masked-"+e.mode)}),e.elementMask=null),super.doDestroy()}get typeName(){return"string"==typeof this.type?this.type.trim():""}get maskName(){return"mask"+this.typeName}get elementMask(){return this.element&&this.element[this.maskName]}set elementMask(e){this.element&&(this.element[this.maskName]=e)}create(){const e=this;e.elementMask=e,Object.assign(e,Et.createElement({parent:e.element,className:{"b-mask":1,"b-mask-type":1,"b-widget":1,["b-mask-"+e.mode]:1,"b-progress":e.maxProgress,"b-prevent-transitions":!e.useTransition},reference:"maskElement",children:[{className:"b-mask-content",reference:"maskContent",children:[e.maxProgress?{className:"b-mask-progress-bar",reference:"progressElement",style:{width:Math.round(e.progress/e.maxProgress*100)+"%"}}:null,{className:"b-mask-text",reference:"maskText"}]}]})),e.text=e._text}static mask(e,t=document.body){return new Qr("string"!=typeof e?Object.assign({element:t},e):{element:t,text:e})}static unmask(e=document.body){return e.mask&&e.mask.close()}set text(e){const t=this;t._text=e||"",t.maskText&&(t.maskText.innerHTML=`<i class="b-mask-icon ${t.icon}"></i>${t._text}`)}get text(){return this._text}set progress(e){this._progress=e,this.progressElement&&null!=e&&(this.progressElement.style.width=Math.round(e/this._maxProgress*100)+"%")}get progress(){return this._progress}set maxProgress(e){this._maxProgress=e,this.progress=this.progress}get maxProgress(){return this._maxProgress}show(){const e=this;e.hasTimeout("hide")&&(e.resolve(),e.clearTimeout("hide")),e.elementMask||e.create();const{element:t,maskElement:r}=e;r&&(t.classList.add("b-masked"),r.classList.add("b-visible"),r.classList.remove("b-hidden"),e.shown=!0,e.mode.endsWith("blur")&&Et.forEachChild(t,t=>{t!==r&&t.classList.add("b-masked-"+e.mode)}))}hide(){const e=this,{element:t,maskElement:r}=e;return new Promise(n=>{e.shown?(e.shown=!1,r.classList.remove("b-visible"),r.classList.add("b-hidden"),t.classList.remove("b-masked"),e.mode.endsWith("blur")&&Et.forEachChild(t,t=>{t!==r&&t.classList.remove("b-masked-"+e.mode)}),e.resolve=n,e.setTimeout(()=>n(),500,"hide")):n()})}close(){return new Promise(e=>{this.hide().then(()=>{this.destroy(),e()})})}}Qr._$name="Mask";class en extends Vr{static get $name(){return"Tool"}template(){return'<div class="b-icon"></div>'}construct(e){super.construct(e),gr.on({element:this.element,click:"onClick",mousedown:"onMousedown",thisObj:this})}onClick(e){const t=this,r=t.panel,n="function"==typeof t.handler?t.handler:r[t.handler];!1!==r.trigger("toolclick",{tool:t})&&n&&t.callback(n,r,[e])}onMousedown(e){const t=this.panel,r=t.focusElement;e.preventDefault(),r&&document.activeElement!==r&&t.focus()}get panel(){return this.parent}}en._$name="Tool",U.register("tool",en);class tn extends(G(B)){static get defaultConfig(){return{containerCls:null,itemCls:null}}static getLayout(e,t){if(e instanceof tn)return e;const r="string"==typeof e,n={owner:t};return new(r?rn[e]:e)(r?n:Object.assign(n,e))}static registerLayout(e,t=e.$name.toLowerCase()){rn[t]=e}renderChildren(){const{owner:e,containerCls:t,itemCls:r}=this,{contentElement:n,items:s}=e,i=e.itemCls,o=s&&s.length;if(n.classList.add("b-content-element"),t&&n.classList.add(t),o){e.textContent=!1;for(let t=0;t<o;t++){const o=s[t],{element:a}=o;a.dataset.itemIndex=t,r&&a.classList.add(r),i&&a.classList.add(i),a.classList.remove("b-outer"),o.render(n,Boolean(e.isPainted))}}}removeChild(e){const{element:t}=e,{owner:r,itemCls:n}=this,{contentElement:s}=r,i=r.itemCls;s.removeChild(t),delete t.dataset.itemIndex,n&&t.classList.remove(n),i&&t.classList.remove(i),this.fixChildIndices()}appendChild(e){const{element:t}=e,r=this.owner.indexOfChild(e),{owner:n,itemCls:s}=this,{contentElement:i}=n,o=n.itemCls;t.dataset.itemIndex=r,n.textContent=!1,s&&t.classList.add(s),o&&t.classList.add(o),i.appendChild(t)}insertChild(e,t){const{element:r}=e,{owner:n,itemCls:s}=this,{contentElement:i}=n,o=i.querySelector(`[data-item-index="${t-1}"]`),a=n.itemCls;n.textContent=!1,s&&r.classList.add(s),a&&r.classList.add(a),i.insertBefore(r,o&&o.nextSibling),this.fixChildIndices()}fixChildIndices(){this.owner.items.forEach((e,t)=>{e.element.dataset.itemIndex=t})}}const rn={default:tn};tn._$name="Layout";let nn=0;const sn=e=>e.ripple,on=window.Ripple=new class extends Vr{static get defaultConfig(){return{id:"bryntum-ripple",old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,scrollAction:"realign",color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}static get $name(){return"Ripple"}afterConstruct(){super.afterConstruct(),gr.on({element:document,mousedown:"onRippleControllingEvent",thisObj:this,capture:!0,once:!0})}onRippleControllingEvent(e){const t=this;t.show();const r=Et.getStyleValue(t.circleElement,"animationName");t.hide(),t.listenerDetacher&&t.listenerDetacher(),r&&"none"!==r&&(t.listenerDetacher=gr.on({mousedown:{element:document,capture:!0,handler:"onDocumentMousedown"},touchstart:{element:document,capture:!0,handler:"onDocumentTouchStart"},animationend:{element:t.circleElement,handler:"onAnimationEnd"},thisObj:t}),"mousedown"===e.type&&(t.onDocumentMousedown(e),Yr.on({theme:"onRippleControllingEvent",thisObj:this})))}onDocumentTouchStart(e){nn=performance.now(),this.handleTriggerEvent(e)}onDocumentMousedown(e){performance.now()-nn>200&&this.handleTriggerEvent(e)}handleTriggerEvent(e){const t=K.fromElement(e.target,sn);if(t){const r=t.ripple,n=r.delegate?e.target.closest(r.delegate):t.focusElement||t.element;if(n){const s=ze.assign({event:e,target:n,radius:this.radius},r);if("string"==typeof s.clip&&(s.clip=t[s.clip]||e.target.closest(s.clip),!s.clip))return;this.ripple(s)}}}ripple({event:e,point:t=gr.getClientPoint(e),target:r=e.target,clip:n=r,radius:s=this.radius,color:i=this.color}){this.clip=n,n=Xt.from(n,null,!0);const o=this,a=n.getDelta(t),l=o.rippleElement.style,c=o.circleElement;o.hide(),o.alignTo(n),l.transform=`translateX(${a[0]}px) translateY(${a[1]}px)`,l.height=l.width=s+"px",c.setAttribute("r",s),c.setAttribute("fill",i),o.show(),o.requestAnimationFrame(()=>{document.addEventListener("scroll",o.callRealign,!0),o.documentScrollListener=!0})}alignTo(e){1===e.nodeType&&(e=Xt.from(e,null,!0));const{x:t,y:r,width:n,height:s}=e;this.x=t,this.y=r,this.height=s,this.width=n}onAnimationEnd(e){"b-ripple-expand"===e.animationName&&this.hide()}realign(){this.isVisible&&this.alignTo(this.clip)}};class an{constructor(e){const t=this;t.generation=0,t.items=new Set,t.idMap={},t.idProperty="id",e&&(e.idProperty&&(t.idProperty=e.idProperty),e.values&&(t.values=e.values))}get(e){return this.idMap[Ir(e)]}get count(){return this.items.size}add(...e){1===e.length&&Array.isArray(e[0])&&(e=e[0]);const t=this,{items:r,idMap:n,idProperty:s}=t,i=e.length;for(let o=0;o<i;o++){const i=e[o],a=Mr[typeof i]?i:Ir(i[s]),l=n[a];null==l?(n[a]=i,r.add(i),t.generation++):l!==i&&(n[a]=i,r.delete(l),r.add(i))}}remove(e){Array.isArray(e)||(e=[e]);const{items:t,idMap:r,idProperty:n}=this,s=e.length;for(let i=0;i<s;i++){const s=e[i],o=Mr[typeof s]?s:Ir(s[n]),a=r[o];null!=a&&(t.delete(a),delete r[o],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}changeId(e,t){const r=this,{idMap:n,idProperty:s}=r,i=Mr[typeof e]?e:Ir(e[s]),o=r.get(i);if(o){const e=r.get(t);if(e&&o!==e)throw new Error(`Attempt to set item ${i} to already existing member's id ${t}`);o[s]=t,delete n[i],n[t]=o}}includes(e){const t=Mr[typeof e]?e:Ir(e[this.idProperty]);return Boolean(this.idMap[t])}map(e,t){const{items:r}=this,n=new Array(r.size);let s=0;return r.forEach(i=>{n[s]=e.call(t,i,s++,r)}),n}forEach(e,t){return this.items.forEach(e,t)}find(e){for(const t of this.items)if(e(t))return t}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(e){return this.values.indexOf(e)}get values(){return[...this.items]}set values(e){Array.isArray(e)||(e=[e]),this.clear(),this.add.apply(this,e),this.generation++}sort(e){this.values=this.values.sort(e)}some(e,t){return this.values.some(e,t)}}an._$name="Bag";const ln=Object.freeze({}),cn=e=>e.weight,dn=(e,t)=>(e.weight||0)-(t.weight||0);class un extends Vr{static get $name(){return"Container"}static get defaultConfig(){return{items:null,widgets:null,defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:"default",namedItems:null,textContent:!0}}setConfig(e,t){e.widgets&&(e.items=e.widgets),super.setConfig(e,t)}startConfigure(e){const{items:t}=this;this.hasItems=Boolean(t&&t.length),super.startConfigure(e)}remove(...e){let t=!0;1===e.length&&(Array.isArray(e[0])?e=e[0]:t=!1);const r=this,n=[];for(let t=0;t<e.length;t++){const s=e[t];r._items.includes(s)&&(r._items.remove(s),r.layout.removeChild(s),n.push(s),r.unregisterReference(s))}return t?n:n[0]}removeAll(){return this.remove(this.items)}add(...e){let t=!0;1===e.length&&(Array.isArray(e[0])?e=e[0]:t=!1);const r=this,n=[];for(let t=0;t<e.length;t++){let s=e[t];s instanceof Vr?s.parent=r:s=r.createWidget(s),r._items.includes(s)||(r.registerReference(s),r._items.add(s),r.layout.appendChild(s),n.push(s))}return t?n:n[0]}insert(e,t){const r=this,{_items:n}=r;e instanceof Vr?e.parent=r:e=r.createWidget(e),n.includes(t)&&(t=r.indexOfChild(t)),t=Math.min(t,n.count);const s=n.values;return s.splice(t,0,e),n.values=s,r.registerReference(e),r.layout.insertChild(e,t),e}indexOfChild(e){return this._items.indexOf(e)}set widgets(e){console.warn("`widgets` was deprecated in 2.1, please change your code to use `items`")}get widgets(){return console.warn("`widgets` was deprecated in 2.1, please change your code to use `items`"),this.items}set items(e){this.configuredItems=e}get items(){const e=this,t=e._items||(e._items=new an),{configuredItems:r}=e;return r&&(e.configuredItems=!1,Array.isArray(r)?e.processItemsArray(r,t):r&&e.processItemsObject(r,e.namedItems,t),t.some(cn)&&t.sort(dn),t.forEach(e.registerReference,e)),t.values}processItemsArray(e,t){const r=e.length;let n,s;for(n=0;n<r;n++)s=e[n],s instanceof Vr?s.parent=this:s=this.createWidget(s),s&&t.add(s)}processItemsObject(e,t=ln,r){let n,s;for(s in e)n=e[s],n&&(s in t&&(n="object"==typeof n?ze.merge(ze.clone(t[s]),n):t[s]),n&&(n instanceof Vr?n.parent=this:n=this.createWidget(n),n&&(n.ref=s,r.add(n))))}registerReference(e){const t=e.ref||e.id;if(t)for(let r=this;r;r=r.parent)r.widgetMap[t]||(r.widgetMap[t]=e)}unregisterReference(e){const t=e.ref||e.id;if(t)for(let r=this;r;r=r.parent)r.widgetMap[t]===e&&delete r.widgetMap[t]}get widgetMap(){return this._widgetMap||(this._widgetMap={}),this._thisIsAUsedExpression(this.items),this._widgetMap}set record(e){this._record=e,this.setValues(e,!0)}get record(){return this._record}getValues(e){const t=this.queryAll(e=>e.name),r=t.length,n={};for(let s=0;s<r;s++){const r=t[s],i=r.name;e&&!e(r)||(n[i]=r.value)}return n}set textContent(e){this._textContent=e,this.element.classList[e?"add":"remove"]("b-text-content")}get textContent(){return this._textContent}set layoutStyle(e){Et.applyStyle(this.contentElement,e),this._layoutStyle=e}get layoutStyle(){return this._layoutStyle}set layout(e){this._layout=tn.getLayout(e,this)}get layout(){return this._layout||(this._layout=new tn)}get childItems(){return this.items}eachWidget(e,t=!0){const r=this.childItems,n=r?r.length:0;for(let s=0;s<n;s++){const n=r[s];if(!1===e(n))return!1;if(t&&n.eachWidget&&!1===n.eachWidget(e,t))return!1}return!0}queryAll(e){const t=[];return this.eachWidget(r=>{e(r)&&t.push(r)}),t}query(e){let t=null;return this.eachWidget(r=>{if(e(r))return t=r,!1}),t}getWidgetById(e){return this.widgetMap[e]}processWidgetConfig(e){}createWidget(e){const t=this;"string"==typeof e?e={html:e}:1===e.nodeType&&(e={element:e,id:e.id}),(e=Object.setPrototypeOf({parent:t},e)).type||(e.type=t.defaultType);for(let t=e.parent;t;t=t.parent)if(!1===t.processWidgetConfig(e))return null;return!1===t.trigger("beforeWidgetCreate",{widget:e})?null:J.createWidget(ze.assign({},t.defaults,e),t.defaultType||"widget")}render(){this.layout.renderChildren(),super.render(...arguments)}get focusElement(){const e=this.query(this.defaultFocus||(e=>e.isFocusable));return e?e.focusElement:super.focusElement}doDestroy(){!this.configuredItems&&this.items&&this.items.forEach(e=>e.destroy&&e.destroy()),super.doDestroy()}get isValid(){let e=!0;return this.eachWidget(t=>{if("isValid"in t&&!t.isValid)return e=!1},!0),e}get values(){const e={};return this.eachWidget(t=>{"value"in t&&(e[t.name||t.ref||t.id]=t.value)},!0),e}set values(e){this.setValues(e)}get isSettingValues(){return this._isSettingValues||this.parent&&this.parent.isSettingValues}setValues(e,t=!1){this._isSettingValues=!0,this.eachWidget(r=>{const n=r.highlightExternalChange,s=t?r.name:r.name||r.ref||r.id;"value"in r&&s&&(r.highlightExternalChange=!1,r.value=e&&s in e?e[s]:null,r.highlightExternalChange=n)},!0),this._isSettingValues=!1}}un._$name="Container",U.register("container",un);class hn extends un{static get $name(){return"Toolbar"}static get defaultConfig(){return{defaultType:"button",widgetCls:null,layout:"default"}}createWidget(e){"->"===e?e={type:"widget",cls:"b-toolbar-fill"}:"|"===e?e={type:"widget",cls:"b-toolbar-separator"}:"string"==typeof e&&(e={type:"widget",cls:"b-toolbar-text",html:e});const t=super.createWidget(e);return this.widgetCls&&t.element.classList.add(this.widgetCls),t}}hn._$name="Toolbar",U.register("toolbar",hn);const gn=e=>!e.classList.contains("b-focus-trap")&&Et.isFocusable(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP,mn=(e,t)=>(e.weight||0)-(t.weight||0),pn=(e,t)=>(t.weight||0)-(e.weight||0);gn.acceptNode=gn;class fn extends un{static get $name(){return"Panel"}static get defaultConfig(){return{trapFocus:null,title:null,header:null,footer:null,tools:null,tbar:null,bbar:null}}set element(e){const t=this,r=t.title&&(!t.parent||!t.parent.suppressChildHeaders),n=t.header||(t.tools||r?{}:null),s=t.footer,i=n&&("string"==typeof n?n:t.title||n.title),o=n&&(n.titleAlign||"start"),a=t.classHierarchy(fn).map(e=>`b-${e.$name.toLowerCase()}-header`).join(" "),l=t.tbar,c=t.bbar||t.buttons,d=[{reference:"topFocusTrap",className:"b-focus-trap",tabIndex:0}],u=[],h=[],g={children:d};if((t.hasItems||t.focusable)&&(g.tabIndex=0),n){const e=[{reference:"titleElement",className:"b-header-title b-align-"+o,html:i}];for(const e in t.tools){const r=t.tools[e];"start"===r.align?u.unshift(r):h.push(r)}u.sort(mn),h.sort(pn),e.unshift(...u.map(e=>e.element)),e.push(...h.map(e=>e.element)),d.push({tag:"header",reference:"headerElement",className:`${a} b-dock-${n.dock||"top"} ${n.cls||""}`,children:e})}l&&(l.layout.renderChildren(),d.push(l.element)),d.push(t.bodyConfig),c&&(c.layout.renderChildren(),d.push(c.element)),s&&d.push({tag:"footer",reference:"footerElement",className:`${a} b-dock-${s.dock||"bottom"} ${s.cls||""}`}),d.push({reference:"bottomFocusTrap",className:"b-focus-trap",tabIndex:0}),super.element=g}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){return this._bodyConfig||{reference:"bodyElement",className:this.classHierarchy(fn).map(e=>`b-${e.$name.toLowerCase()}-content`).join(" "),html:this.html}}get element(){return super.element}get tbar(){return this._tbar}set tbar(e){e instanceof hn?e.parent=this:(Array.isArray(e)&&(e={items:e}),e=new hn(Object.assign({parent:this},e))),this.hasItems=this.hasItems||e.hasItems,e.element.classList.add("b-top-toolbar","b-dock-"+(e.dock||"top")),this._tbar=e}get bbar(){return this._bbar}set bbar(e){e instanceof hn?e.parent=this:(Array.isArray(e)&&(e={items:e}),e=J.createWidget(Object.assign({type:"toolbar",parent:this},e))),this.hasItems=this.hasItems||e.hasItems,e.element.classList.add("b-bottom-toolbar","b-dock-"+(e.dock||"bottom")),this._bbar=e}get childItems(){const e=this,t=e.items?e.items.slice():[];return e.tools&&t.unshift(...Object.values(e.tools)),e.tbar&&t.unshift(e.tbar),e.bbar&&t.push(e.bbar),t}set tools(e){const t=this,r=t._tools={};for(const n in e){const s=r[n]=J.createWidget(ze.assign({type:"tool",ref:n,reference:n,parent:t},e[n]),t.defaultToolType||"tool");t.registerReference(s,s.ref)}}get tools(){return this._tools}set trapFocus(e){const t=this;t.element.classList[e?"add":"remove"]("b-focus-trapped"),e?(t.focusTrapListener=gr.on({element:t.element,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:t}),t.treeWalker||(t.treeWalker=document.createTreeWalker(t.element,NodeFilter.SHOW_ELEMENT,gn,!1))):t.focusTrapListener&&(t.focusTrapListener(),t.focusTrapListener=null),t._trapFocus=e}get trapFocus(){return this._trapFocus}onFocusTrapped(e){const t=this,r=t.treeWalker;e.target===t.bottomFocusTrap?(r.currentNode=t.topFocusTrap,r.nextNode()):(r.currentNode=t.bottomFocusTrap,r.previousNode()),t.requestAnimationFrame(()=>r.currentNode.focus())}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}get widgetClassList(){const e=this,t=super.widgetClassList,r=e.header;return(r||e.title||e.tools)&&t.push("b-panel-has-header b-header-dock-"+(r&&r.dock||"top")),e.tbar&&t.push("b-panel-has-top-toolbar"),e.bbar&&t.push("b-panel-has-bottom-toolbar"),t}doDestroy(){const{tools:e}=this;if(e)for(const t of Object.values(e))t.destroy();this.tbar&&this.tbar.destroy(),this.bbar&&this.bbar.destroy(),super.doDestroy()}}fn._$name="Panel",U.register("panel",fn);class vn extends fn{static get $name(){return"Popup"}static get defaultConfig(){return{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,hideAnimation:P.isIE11?null:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:P.isIE11?null:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},testConfig:{hideAnimation:null,showAnimation:null},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,modal:null}}startConfigure(e){this._thisIsAUsedExpression(this.closable),super.startConfigure(e)}finalizeInit(){const e=this;e.anchoredTo=e.forElement,e.initialAnchor=e.anchor,e.forElement&&e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),gr.on({element:e.forElement,click:"onElementUserAction",thisObj:e})),super.finalizeInit(),e.autoShow&&(!0===e.autoShow?e.show():e.setTimeout(()=>e.show(),e.autoShow))}doDestroy(){this.syncModalMask(),super.doDestroy()}close(){const e=this;if(!e._hidden&&!1!==e.trigger("beforeClose")||e._hidden&&"destroy"===e.closeAction)return e.containsFocus&&e.setTimeout(()=>document.body.classList.add("b-using-keyboard"),0),e[e.closeAction]()}onElementResize(e,t,r){const n=this,{lastAlignSpec:s}=n;if(n.isVisible&&s&&s.target){const e=!t||r.height!==t.height,i=!t||r.width!==t.width;(e&&2!==s.zone||i&&1!==s.zone)&&n.requestAnimationFrame(()=>n.realign())}super.onElementResize(e)}onInternalKeyDown(e){"Escape"===e.key&&(e.stopImmediatePropagation(),this.close(!0))}onDocumentMouseDown({event:e}){const t=this;t.modal&&e.target===vn.modalMask?(e.preventDefault(),t.modal.closeOnMaskTap?t.close():t.containsFocus||t.focus()):t.owns(e.target)||!t.autoClose||t.containsFocus||t.close()}get isTopModal(){return Et.isVisible(vn.modalMask)&&this.element.previousElementSibling===vn.modalMask}onFocusIn(e){const t=document.activeElement;super.onFocusIn(e),document.activeElement===t&&e.target===this.element&&this.focus()}onFocusOut(e){!this.modal&&this.autoClose&&this.close(),super.onFocusOut(e)}onShow(){const e=this;e.autoClose&&e.addDocumentMouseDownListener(),e.focusOnToFront&&e.focus(),super.onShow&&super.onShow(),e.syncModalMask()}addDocumentMouseDownListener(){this.mouseDownRemover||(this.mouseDownRemover=Yr.on({globaltap:"onDocumentMouseDown",thisObj:this}))}syncModalMask(){const e=this,{modal:t}=e,{modalMask:r}=vn;if(t&&e.isVisible)e._x||e._y||(e.centered=!0),r.classList.remove("b-hide-display"),r.parentNode.insertBefore(r,e.element),e.element.classList.add("b-modal");else{e.element.classList.remove("b-modal");const t=e.constructor.floatRoot.querySelectorAll(".b-modal");if(t.length){const e=t[t.length-1];r.classList.remove("b-hide-display"),r.parentNode.insertBefore(r,e)}else r.classList.add("b-hide-display")}}onHide(){const e=this;e.mouseDownRemover&&(e.mouseDownRemover(),e.mouseDownRemover=null),super.onHide&&super.onHide(),e.syncModalMask()}onElementUserAction(){this.show()}set closable(e){this._closable=e,this.tools||(this.tools={})}get closable(){return this._closable}set tools(e){this.closable&&((e||(e={})).close={cls:"b-popup-close",handler:"close",weight:-1e3}),super.tools=e}get tools(){return super.tools}static get modalMask(){const e=this;return e._modalMask?e.floatRoot.contains(e._modalMask)||e.floatRoot.appendChild(e._modalMask):e._modalMask=Et.createElement({className:"b-modal-mask b-hide-display",parent:e.floatRoot}),e._modalMask}}vn._$name="Popup",U.register("popup",vn);const yn=/>[ \t\r\n]+</g,bn=/\s\s+/g;class Cn{static tpl(e,...t){let r=0,n=t.map((t,n)=>{let s=e[n];return Array.isArray(t)?s+=t.reduce((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n"),""):(void 0===t&&(t=""),s+="string"==typeof t?t.trim():t),r++,s}).join("");return r<=e.length&&(n+=e[e.length-1]),n.replace(yn,"><").replace(bn," ").trim()}static docsTpl(e,...t){let r=0,n=t.map((t,n)=>{let s=e[n];return Array.isArray(t)?s+=t.reduce((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n"),""):(void 0===t&&(t=""),s+="string"==typeof t?t.trim():t),r++,s}).join("");return r<=e.length&&(n+=e[e.length-1]),n.replace(yn,"><").trim()}static repeat(e){return function(...t){return Cn.tpl(...t).repeat(e)}}static loop(e){}}Cn._$name="TemplateHelper";const wn=/^b-icon-/,Sn=/^b-fa-/;class Dn extends Vr{static get $name(){return"MenuItem"}static get defaultConfig(){return{menu:null,icon:null,text:null,checked:null,closeParent:null,href:null,target:null,localizableProperties:["text"]}}doAction(e){const t=this,r=this.parent,n={menu:r,item:t,element:t.element,bubbles:!0};"boolean"==typeof t.checked&&(t.checked=!t.checked),t.trigger("beforeItem",n),t.trigger("item",n),t.closeParent&&r&&(r.rootMenu.close(),e&&!t.href&&e.preventDefault())}doDestroy(){const e=this._menu;e instanceof Vr&&e.destroy(),super.doDestroy()}template(e){const t=e.icon||("boolean"==typeof e.checked?`b-fw-icon b-icon-${e.checked?"":"un"}checked`:""),r=wn.test(t)?" b-icon":Sn.test(t)?" b-fa":"",n=e.href?"a":"div";return Cn.tpl`
            <${n} ${"a"===n?`href="${e.href}"`:""} ${"a"===n&&e.target?`target="${e.target}"`:""} class="${e.hasMenu?"b-has-submenu":""}" ${e.name?`data-name="${e.name}"`:""} tabIndex="-1">
                ${t?`<i class="b-menuitem-icon ${t}${r}" reference="iconElement"></i>`:""}
                <span class="b-menu-text" reference="textElement">${e.text}</span>
                ${e.hasMenu?'<i class="b-fw-icon b-icon-sub-menu" reference="subMenuIcon"></i>':""}
            </${n}>`}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const e=this.focusElement;return e&&this.isVisible&&(e===document.body||e.offsetParent)}onFocusIn(e){super.onFocusIn(e),!this.disabled&&this.menu&&this.openMenu()}onFocusOut(e){super.onFocusOut(e),this.closeMenu()}openMenu(e){const t=this.menu;!this.disabled&&t&&(t.focusOnToFront=e,t.show(),this.owner.currentSubMenu=t)}closeMenu(){this._menu instanceof Vr&&this.menu.close()}set checked(e){const t=this,{isConfiguring:r}=t;(r||"boolean"==typeof t._checked)&&(e=!!e)!==t._checked&&(t._checked=e,r||(t.iconElement.classList[e?"add":"remove"]("b-icon-checked"),t.iconElement.classList[e?"remove":"add"]("b-icon-unchecked"),t.trigger("toggle",{menu:t.owner,item:t,checked:t._checked,element:t.element,bubbles:!0})))}get checked(){return this._checked}set menu(e){this._menu=e}get text(){return this.html}set text(e){this.html=e}get menu(){const e=this;let t=e._menu;return!t||t instanceof Vr||("object"!=typeof t||"items"in t||"widgets"in t||"html"in t||(t={items:t}),t=e.menu=J.createWidget(Object.assign({type:"menu",autoShow:!1,autoClose:!0,scrollAction:e.owner.scrollAction,constrainTo:e.owner.constrainTo,forElement:e.element,align:"l0-r0",anchor:!0,owner:e,cls:"b-sub-menu"},t))),t}set closeParent(e){this._closeParent=e}get closeParent(){return("boolean"==typeof this.checked?this._closeParent:!1!==this._closeParent)&&!this.hasMenu}get hasMenu(){const e=this.isConfiguring?this.initialConfig.menu:this._menu;return e&&(e instanceof Vr||"object"==typeof e||e.length>0)}}Dn._$name="MenuItem",U.register("menuitem",Dn);const En={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1};class xn extends vn{static get $name(){return"Menu"}static get defaultConfig(){return{align:"t-b",scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem"}}construct(e){Array.isArray(e)&&(e={items:e}),super.construct(e),gr.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseleave:"onMouseLeave",thisObj:this})}afterShow(e){this.items.some(e=>Boolean(e._menu))&&this.element.classList.add("b-menu-with-submenu");this.items.some(e=>e.icon)&&this.element.classList.add("b-menu-with-icon"),super.afterShow(e)}createWidget(e){return"string"==typeof e&&(e={text:e}),super.createWidget(e)}get focusElement(){const e=this.parentMenu&&this.parentMenu.element.contains(document.activeElement),t=this.items[0];return!e&&t instanceof Dn?this.element:super.focusElement}onDocumentMouseDown(e){this.parentMenu&&this.parentMenu.owns(e.event.target)||super.onDocumentMouseDown(e)}hide(e){super.hide(e),this.currentSubMenu&&!this.currentSubMenu.isDestroyed&&this.currentSubMenu.hide(e),this.parentMenu&&(this.parentMenu.currentSubMenu=null)}onMouseClick(e){const t=this,r=e.target.closest(".b-menuitem");r&&(t.triggerElement(r,e),e.stopImmediatePropagation())}onMouseOver(e){const t=this;if(!1!==this.focusOnHover){const r=Et.up(e.relatedTarget,".b-widget"),n=Et.up(e.target,".b-widget"),s=K.fromElement(n);!Et.isTouchEvent&&n&&n!==r&&s.parent===this&&t.setTimeout({fn:"handleMouseOver",delay:30,args:[s],cancelOutstanding:!0})}}handleMouseOver(e){e.focus()}onMouseLeave(e){const t=this,{relatedTarget:r}=e,n=r&&t.owns(r);let s=r&&r instanceof HTMLElement&&K.fromElement(r),i=!n;if(s){for(;s.ownerCmp;)s=s.ownerCmp;i&=!Et.getAncestor(s.element,[e.target])}!n&&i&&(t.currentSubMenu&&t.currentSubMenu.hide(),t.currentSubMenu=t.selectedElement=null,t.element.contains(document.activeElement)&&document.activeElement.matches(".b-menuitem")&&t.focusElement.focus())}onInternalKeyDown(e){const t=K.fromElement(e),r=t&&t!==this&&!(t instanceof Dn);if("Escape"===e.key)return void(r?this:this.rootMenu).close();if(super.onInternalKeyDown(e),r)return;En[e.key]&&e.preventDefault();const n=document.activeElement,s=this.element;this.navigateFrom(n!==s&&s.contains(n)?n:null,e.key,e)}navigateFrom(e,t,r){const n=this,s=n.treeWalker,i=e&&n.getItem(e);let o;switch(t){case"ArrowUp":s.currentNode=e||(e=n.bottomFocusTrap),s.previousNode(),o=s.currentNode;break;case"ArrowDown":s.currentNode=e||(e=n.topFocusTrap),s.nextNode(),o=s.currentNode;break;case" ":e&&!e.classList.contains("b-disabled")&&(i&&i.menu?n.openSubMenu(e,i):n.triggerElement(e,r));break;case"ArrowRight":if(e&&i&&i.menu&&!e.classList.contains("b-disabled")){const t=n.openSubMenu(e,i);t&&t.focus()}else s.currentNode=e||(e=n.topFocusTrap),s.nextNode(),o=s.currentNode;break;case"ArrowLeft":n.isSubMenu?n.hide():e||(s.currentNode=e||(e=n.topFocusTrap),s.nextNode(),o=s.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&n.triggerElement(e,r)}o&&(o===n.element?n.navigateFrom(n.bottomFocusTrap,"ArrowUp",r):o===e?n.navigateFrom(n.topFocusTrap,"ArrowDown",r):o.focus())}getItem(e){if(null!=e)return"number"==typeof e?this.items[e]:1===e.nodeType?K.fromElement(e,"menuitem",this.contentElement):this.items.find(t=>t.id==e)}triggerElement(e,t){const r=this.getItem(e);r&&!r.disabled&&r.doAction(t)}get isSubMenu(){return this.owner&&this===this.owner.menu}openSubMenu(e,t){const r=this,n=t.menu;if(n){if(!n.isVisible){const s={item:t,element:e};if(!1===r.trigger("beforeSubMenu",s))return;if(t.onBeforeSubMenu&&!1===t.onBeforeSubMenu(s))return;n.show()}return r.currentSubMenu=n}}set selectedElement(e){const t=this,r=t._selectedElement;if(r){const e=t.getItem(r),n=e&&e.menu;n&&n.hide(),r.classList.remove("b-active")}if(t._selectedElement=e,e){const r=Et.isFocusable(e);e.classList.add("b-active"),t.scrollable.scrollIntoView(e,{animate:!r,focus:r})}}get selectedElement(){return this._selectedElement}selectFirst(){const e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame(()=>e.currentNode.focus())}get parentMenu(){let e=this.owner;if(e instanceof Dn&&(e=e.owner),e instanceof xn)return e}get rootMenu(){let e=this;for(;e.parentMenu&&e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}}xn._$name="Menu",U.register("menu",xn);class Tn extends Vr{static get $name(){return"Toast"}static get defaultConfig(){return{testConfig:{timeout:100,destroyTimeout:1},floating:!0,timeout:2500,destroyTimeout:200,showProgress:!0,color:null,bottomMargin:20}}doDestroy(){const e=Tn.toasts.indexOf(this);e>-1&&Tn.toasts.splice(e,1),super.doDestroy()}set element(e){}get element(){if(!this._element&&!this.isConfiguring){const e=this,t=Tn.toasts.length&&Tn.toasts[0].element,r=t?t._nextBottom:e.bottomMargin,n=super.element=Et.createElement({parent:e.appendTo||Vr.floatRoot,children:e.showProgress?[{className:"b-toast-progress",style:`animation-duration:${e.timeout/1e3}s;`}]:null,html:e._html,className:e.color||"",style:e._style||""});gr.on({element:n,click:"hide",thisObj:e}),Tn.toasts.unshift(e),n._nextBottom=r+n.offsetHeight+e.bottomMargin,n.style.cssText+=`;bottom:${r}px;transform:translateY(0)`}return super.element}show(){super.show(),this.timeout>0&&(this.hideTimeout=this.setTimeout("hide",this.timeout))}hide(){const e=this;e.destroyTimer||(e.element.classList.add("b-toast-hide"),e.element.style.bottom="",e.destroyTimer=e.setTimeout("destroy",e.destroyTimeout))}static hideAll(){Tn.toasts.reverse().forEach(e=>e.hide())}static show(e){const t=new Tn("string"==typeof e?{html:e}:e);return t.show(),t}}Tn.toasts=[],Tn._$name="Toast",U.register("toast",Tn);const Rn={left:!0,right:!0,top:!0,bottom:!0,transform:!0};class Mn extends vn{static get $name(){return"Tooltip"}static get defaultConfig(){return{mouseOffsetX:15,mouseOffsetY:15,floating:!0,getHtml:null,forElement:null,trackMouse:null,updateContentOnMouseMove:!1,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:!1,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:!1,anchor:!0,align:"b-t",axisLock:!0,showAnimation:null,hideAnimation:null,testConfig:{hideDelay:100,hoverDelay:100}}}afterConstruct(){const e=this,{forSelector:t}=e;t&&(e.showOnHover=!0,e.forElement||(e.trackMouse=!0,e.forElement=document.body)),super.afterConstruct(),e.forElement&&e.showOnHover&&(e.pointerOverOutDetacher=gr.on({element:e.forElement,mouseover:"internalOnPointerOver",mouseout:"internalOnPointerOut",thisObj:e})),e.autoShow&&e.show(),e.allowOver&&gr.on({element:e.element,mouseenter:"onOwnElementMouseEnter",mouseleave:"internalOnPointerOut",thisObj:e})}doDestroy(){this.pointerOverOutDetacher&&this.pointerOverOutDetacher(),super.doDestroy()}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get anchorToTarget(){return this._anchorToTarget}set anchorToTarget(e){this._anchorToTarget=e,e||(this.anchor=!1)}set trackMouse(e){this._trackMouse=e}get trackMouse(){return this._trackMouse&&!this.anchorToTarget}onDocumentMouseDown({event:e}){const t=this,{triggeredByEvent:r}=t;r&&Et.isTouchEvent&&e.pageX===r.pageX&&e.pageY===r.pageY&&t.activeTarget.contains(e.target)&&performance.now()-r.timeStamp<500||(t.abortDelayedShow(),super.onDocumentMouseDown({event:e}))}internalOnPointerOver(e){const t=this,r=t.forElement,n=t.forSelector,s=t.activeTarget;let i;if(!(t.disabled||t.allowOver&&t.element.contains(e.target))){if(n){if(s&&s.contains(e.target)&&s.contains(e.relatedTarget))return;if(i=e.target.closest(n),i&&e.relatedTarget&&e.relatedTarget.closest(n)===i)return}else{if(r.contains(e.relatedTarget))return;i=r}i?t.handleForElementOver(e,i):s&&t.handleForElementOut()}}onTransitionEnd(e){const t=this,r=Mn.currentOverElement;if(Rn[e.propertyName]){if(t.allowOver&&t.element.contains(r))return;t.activeTarget&&t.activeTarget.contains(r)&&!t.trackMouse&&t.realign()}}async handleForElementOver(e,t){const r=this;if(!1===r.trigger("pointerOver",{event:e,target:t}))r.internalOnPointerOut(e);else if(r.triggeredByEvent=e,r.abortDelayedHide(),r.isVisible&&!r.hideOnDelegateChange){if(r.updateActiveTarget(t),!1===r.trigger("beforeShow"))return r.hide();const e=r.updateContent();ze.isPromise(e)&&!r.loadingMsg&&await e,r.alignTo({target:r.anchorToTarget?t:new Kt(r.triggeredByEvent.pageX-window.pageXOffset+r.mouseOffsetX,r.triggeredByEvent.pageY-window.pageYOffset+r.mouseOffsetY),overlap:!(r.anchorToTarget&&r.anchor)}),r.trigger("show"),r.afterShowByTarget()}else r.hideOnDelegateChange&&r.hide(),r.updateActiveTarget(t),r.delayShow(t)}async delayShow(e){const t=this;if(t.currentAnimation&&(t.cancelHideShowAnimation(),t._hidden=!0),t.isVisible||t.hasTimeout("show"))t.isVisible&&t.showByTarget(e);else if(!t.hoverDelay||t.forSelector&&Date.now()-t.lastHidden<t.quickShowInterval){const r=t.updateContent();ze.isPromise(r)&&!t.loadingMsg&&await r,t.showByTarget(e)}else t.addDocumentMouseDownListener(),t.listeningForMouseMove||t.anchorToTarget||(t.mouseMoveRemover=gr.on({element:document,mousemove:"onMouseMove",thisObj:t})),t.setTimeout(async()=>{if(!Et.isOrphaned(e)){const r=t.updateContent();ze.isPromise(r)&&!t.loadingMsg&&await r,t.showByTarget(e)}},t.triggeredByEvent&&"mouseover"!==t.triggeredByEvent.type?0:t.hoverDelay,"show")}async updateContent(){const e=this;if(e.getHtml){const t=e.getHtml({tip:e,element:e.element,activeTarget:e.activeTarget,event:e.triggeredByEvent});return e.html=t,t}}get hasContent(){return Boolean("string"==typeof this.html&&this.html.length||this.items.length)}internalBeforeShow(){return this.updateContentOnMouseMove||this.hasContent}showAsyncMessage(e=this.L(this.loadingMsg)){e&&(this.html=`\n                <div class="b-tooltip-loading">\n                    <i class="b-icon b-icon-spinner"></i>\n                    ${e}\n                </div>\n            `)}showByTarget(e){const t=this;t.mouseMoveRemover&&(t.mouseMoveRemover(),t.mouseMoveRemover=null),t.showBy({target:t.anchorToTarget?e:new Kt(t.triggeredByEvent.pageX-window.pageXOffset+t.mouseOffsetX,t.triggeredByEvent.pageY-window.pageYOffset+t.mouseOffsetY),overlap:!(t.anchorToTarget&&t.anchor)})}afterShowByTarget(){const e=this,t=e.dismissDelay;e.abortDelayedShow(),t&&e.setTimeout("hide",t),e.toFront()}updateActiveTarget(e){const t=this,r=t.activeTarget;t.activeTarget=e,t.isConfiguring||t.trigger("overtarget",{newTarget:e,lastTarget:r})}internalOnPointerOut(e){const t=this,r=e.relatedTarget;t.allowOver&&t.element.contains(r)||t.element.contains(e.target)&&t.activeTarget&&t.activeTarget.contains(r)||t.activeTarget&&!t.activeTarget.contains(e.relatedTarget)&&t.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:t}=e;!1!==e.trigger("pointerOut")?(e.abortDelayedShow(),e.isVisible&&!1!==t&&(e.abortDelayedHide(),t>0?e.setTimeout("hide",t):e.hide())):e.activeTarget=null}show(){const e=this;e.forElement&&e.anchorToTarget&&!e.forSelector&&!e.inShowBy?e.showByTarget(e.forElement):(e.inShowBy&&(e.y=-1e4),super.show()),e.afterShowByTarget(),e.mouseMoveRemover||e._hidden||!e.trackMouse&&!e.updateContentOnMouseMove||(e.mouseMoveRemover=gr.on({element:document,[P.supportsPointerEvents?"pointermove":"touchmove"]:"onMouseMove",thisObj:e})),!e.forElement||e.transitionEndDetacher||e._hidden||(e.transitionEndDetacher=gr.on({element:e.forElement,transitionend:"onTransitionEnd",thisObj:e}))}hide(...e){const t=this;t.abortDelayedShow(),t.isVisible&&(t.abortDelayedHide(),super.hide(...e),t.lastHidden=Date.now(),t.activeTarget=null,t.mouseMoveRemover&&(t.mouseMoveRemover(),t.mouseMoveRemover=null),t.transitionEndDetacher&&(t.transitionEndDetacher(),t.transitionEndDetacher=null),t.listeningForMouseMove=!1)}abortDelayedShow(){const e=this;e.hasTimeout("show")&&(e.mouseDownRemover&&(e.mouseDownRemover(),e.mouseDownRemover=null),e.clearTimeout("show"),e.mouseMoveRemover&&(e.mouseMoveRemover(),e.mouseMoveRemover=null),e.transitionEndDetacher&&(e.transitionEndDetacher(),e.transitionEndDetacher=null))}abortDelayedHide(){this.clearTimeout("hide")}realign(e){const t=this,r=t.lastAlignSpec,n=t.clippedBy;if(!t.isConfiguring&&n&&!t.isVisible&&r&&r.targetHidden){Xt.from(r.target,t.positioned?t.element.offsetParent:null,!t.positioned).intersect(n)&&(t.show(),r.targetHidden=!1)}super.realign(e)}alignTo(e){this.isVisible&&(this.triggeredByEvent&&this.element.contains(this.triggeredByEvent.target)||1===e.nodeType&&(e={target:e}),super.alignTo(e))}set html(e){const t=this,r=ze.isPromise(e);return!1===e?(A.deprecate("Grid","5.0.0","Setting false to indicate loading is deprecated, in favor of `showAsyncMessage`. Please see https://bryntum.com/docs/grid/#guides/upgrades/3.0.1.md for more information"),void this.showAsyncMessage()):r?(t.showAsyncMessage(),e.target=t.activeTarget,void e.then(r=>{e.target===t.activeTarget&&(t.html=r)})):(e=null!=e?t.L(String(e)):"",super.html=e,void(t.hasContent?(t.isVisible&&t.realign(),r||t.trigger("innerHtmlUpdate")):t.hide()))}get html(){return super.html}onMouseMove(e){const t=this,r=e.pageX-window.pageXOffset+t.mouseOffsetX,n=e.pageY-window.pageYOffset+t.mouseOffsetY,s=t.hasTimeout("hide"),i=e.target;if(t.triggeredByEvent=e,!t._hidden){let o;t.forSelector&&t.activeTarget&&!s&&1===i.nodeType&&!i.matches(t.forSelector)&&!(t.allowOver&&t.element.contains(i))&&(o=t.handleForElementOut()),(o||!s||t.forElement.contains(i))&&(t.dismissDelay&&!s&&t.setTimeout("hide",t.dismissDelay),t.updateContentOnMouseMove&&t.getHtml&&(t.html=t.getHtml({tip:t,element:t.element,forElement:t.activeTarget,event:e})),t.trackMouse&&t.alignTo({position:new Kt(r,n),ignorePageScroll:!0}))}}onOwnElementMouseEnter(e){this.abortDelayedHide()}}gr.on({element:document,mouseenter:e=>Mn.currentOverElement=e.target,capture:!0}),Mn._$name="Tooltip",U.register("tooltip",Mn),Vr.tooltip=new Mn({id:"bryntum-tooltip",forElement:window,forSelector:"[data-btip]",header:!0,resetCfg:{},listeners:{pointerOver({source:e,target:t}){for(const t in e.resetCfg)"listeners"===t?e.un(e.resetCfg[t].set):"was"in e.resetCfg[t]?e[t]=e.resetCfg[t].was:delete e[t];e.resetCfg={};const r=K.get(t.id),n=r?r.tipConfig:e.gatherDataConfigs(t.dataset);for(const t in n)e.resetCfg[t]={set:n[t]},Object.prototype.hasOwnProperty.call(e,t)&&(e.resetCfg[t].was=e[t]),"listeners"===t?e.on(n[t]):e[t]=n[t];e.headerElement.style.display=e.title?"":"none"}},gatherDataConfigs(e){const t=this,r={};for(const n in e)if(n.startsWith("btip"))if(n.length>4){const s=I.lowercaseFirstLetter(n.substr(4));if(s in t.getDefaultConfiguration()){const t=e[n];r[s]=isNaN(t)?t:parseInt(t,10)}}else r.html=e[n];return r}});var kn=e=>class extends(e||B){construct(e){super.construct(e),this._badge&&(this.badge=this._badge)}set badge(e){const{element:t}=this;this._badge=e,t&&(null!=e&&""!==e?(t.dataset.badge=e,t.classList.add("b-badge")):(t.dataset.badge&&delete t.dataset.badge,t.classList.remove("b-badge")))}get badge(){return this._badge}get widgetClass(){if(this.badge)return"b-badge"}};const In=/^b-icon-/,Fn=/^b-fa-/;class An extends(kn(Vr)){static get $name(){return"Button"}static get defaultConfig(){return{icon:null,pressedIcon:null,iconAlign:"start",text:"",color:null,toggleable:!1,pressed:!1,toggleGroup:null,ripple:{radius:75},defaultBindProperty:"text",localizableProperties:["text"],menu:null,href:null,target:null,onMenuHideTimeout:300,testConfig:{onMenuHideTimeout:0}}}template(){const e=this,t=e.href?"a":"button";return Cn.tpl`
            <${t} ${"a"===t?`href="${e.href}"`:""} ${"a"===t&&e.target?`target="${e.target}"`:""} class="${e.color||""} ${e.toggleable&&e.pressed?"b-pressed":""}" ${e.toggleGroup?`data-group="${e.toggleGroup}"`:""}>
                <label reference="label">\xa0</label>
            </${t}>
        `}construct(e={},...t){e.toggleGroup&&(e.toggleable=!0),super.construct(e,...t),gr.on({element:this.element,click:"onInternalClick",thisObj:this})}doDestroy(){this.destroyProperties("menu"),super.doDestroy()}eachWidget(e,t=!0){const{menu:r}=this;if(r){if(!1===e(r))return;t&&r.eachWidget&&r.eachWidget(e,t)}}onFocusOut(e){super.onFocusOut(e),this.menu&&this.menu.hide()}get focusElement(){return this.element}get text(){return this._text}set text(e){const{element:t,label:r}=this;null==e&&(e=""),r.innerText=this._text=e,t.classList[String(e).length?"add":"remove"]("b-text")}get menu(){const e=this;let t=e._menu;return!t||t instanceof Vr||("object"!=typeof t||"type"in t||"items"in t||"widgets"in t||"html"in t||(t={items:t}),t=e.menu=J.createWidget(Object.assign({type:"menu",floating:!0,autoShow:!1,autoClose:!0,scrollAction:"realign",constrainTo:document.body,forElement:e.element,align:"t0-b0",owner:e,onHide(){e.setTimeout(()=>e.toggle(!1),e.onMenuHideTimeout)}},t))),t}set menu(e){this._menu=e,this.toggleable=Boolean(e)}set pressed(e){const t=this;e&&t.toggleGroup&&Et.forEachSelector(`button[data-group=${t.toggleGroup}]`,e=>{e!==t.element&&J.getById(e.id).toggle(!1)}),t._pressed=e,t.element&&t.element.classList[e?"add":"remove"]("b-pressed")}get pressed(){return this._pressed}set icon(e){this._icon=e,this.syncIconCls()}get icon(){return this._icon}set pressedIcon(e){this._pressedIcon=e,this.syncIconCls()}get pressedIcon(){return this._pressedIcon}set iconAlign(e){const t=this,r=t._iconAlign;e!==r&&(r&&t.element.classList.remove("b-icon-align-"+r),t.element.classList.add("b-icon-align-"+e),t._iconAlign=e)}get iconAlign(){return this._iconAlign}onInternalClick(e){const t=this,r={event:e};if(t.toggleable){if(t.toggleGroup&&t.pressed)return;t.toggle(!t.pressed)}t.trigger("click",r),t.isDestroyed||t.trigger("action",r),this.href||(e.preventDefault(),e.stopPropagation())}toggle(e=null){const t=this,{menu:r}=t;t.toggleable&&(null===e&&(e=!t.pressed),t.pressed=e,t.toggling=!0,r&&(r.minWidth=t.width,r[e?"show":"hide"]()),t.syncIconCls(),t.trigger("toggle",{pressed:e}),t.toggling=!1)}syncIconCls(){const e=this;let t=e._iconEl;if(e.icon){t||(t=e._iconEl=Et.createElement({tag:"i",nextSibling:e.element.firstChild}));const r=e.pressed&&e.pressedIcon?e.pressedIcon:e.icon;e._iconEl.className=r,In.test(r)?t.classList.add("b-icon"):Fn.test(r)&&t.classList.add("b-fa")}else t&&t.remove()}}An._$name="Button",U.register("button",An);class Pn extends un{static get $name(){return"ButtonGroup"}static get defaultConfig(){return{defaultType:"button",cls:null,items:null,color:null,toggleGroup:null,valueSeparator:",",columns:null}}construct(e={}){super.construct(e),this.items.forEach(e=>e.on("click",this.onItemClick,this))}onItemClick(){this._value=null}createWidget(e){const t=this;t.color&&!e.color&&(e.color=t.color),t.toggleGroup&&!e.toggleGroup&&("boolean"==typeof t.toggleGroup&&(t.toggleGroup=K.generateId("toggleGroup")),e.toggleGroup=t.toggleGroup),t.columns&&(e.width=100/t.columns+"%");const r=super.createWidget(e);if(!(r instanceof An))throw new Error("A ButtonGroup can only contain buttons");return r}get value(){if(!this._value){const e=[];this.items.forEach(t=>{t.pressed&&void 0!==t.value&&e.push(t.value)}),this._value=e.join(this.valueSeparator)}return this._value}set value(e){Array.isArray(e)||(e=null==e?[]:"string"==typeof e?e.split(this.valueSeparator):[e]),this._value=e,this.items.forEach(t=>{void 0!==t.value&&(t.pressed=e.indexOf(t.value)>-1)})}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.items.forEach(t=>t.disabled=e)}get widgetClassList(){const e=super.widgetClassList;return this.columns&&e.push("b-columned"),e}}Pn._$name="ButtonGroup",U.register("buttonGroup",Pn);class Ln extends(br(B)){static get defaultConfig(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3}}doDestroy(){this.mousedownRemover&&this.mousedownRemover(),super.doDestroy()}set element(e){this._element=e,this.mousedownRemover=gr.on({element:e,mousedown:"onMouseDown",thisObj:this})}get element(){return this._element}onMouseDown(e){const t=this,r=t.delegate?e.target.closest(t.delegate):t.element;r&&(t.triggerEvent=e,gr.lockComposedPath(t.triggerEvent),t.activeListenerRemover=gr.on({mouseup:{element:document,handler:"onMouseUp"},mousemove:{element:r,handler:"onTargetMouseMove"},mouseleave:{element:r,handler:"onTargetMouseLeave"},mouseenter:{element:r,handler:"onTargetMouseEnter"},thisObj:t}),t.setTimeout("startAutoRepeat",t.delay))}onMouseUp(e){const t=this;t.acceleration&&t.acceleration.cancel(),t.activeListenerRemover&&t.activeListenerRemover(),t.clearTimeout("startAutoRepeat"),t.clearTimeout(t.repeatTimer)}onTargetMouseLeave(){this.clearInterval(this.repeatTimer)}onTargetMouseEnter(e){this.triggerEvent=e,this.fireClick()}onTargetMouseMove(e){this.triggerEvent=e}startAutoRepeat(){const e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=Zt.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}nextTick(e){this.interval=this.startInterval-this.accelerationDelta*e}fireClick(){const e=this,t=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(t),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}}Ln._$name="ClickRepeater";const On=(e,t)=>(e.weight||0)-(t.weight||0),_n=(e,t)=>(t.weight||0)-(e.weight||0),$n={array:!0};class jn extends(kn(Vr)){static get $name(){return"Field"}static get defaultConfig(){return{value:"",name:null,label:null,labels:null,required:null,clearable:null,revertOnEscape:null,labelWidth:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",triggers:null,highlightExternalChange:!0,localizableProperties:["label","title","placeholder"],autoSelect:!1,autoComplete:"off",inputAttributes:null,updatedClsDuration:1500,testConfig:{updatedClsDuration:10}}}doDestroy(){const e=this,{triggers:t}=e,r=jn._errorTip;if(e.inputListenerRemover&&e.inputListenerRemover(),e.keyListenerRemover&&e.keyListenerRemover(),super.doDestroy(),t)for(const e of Object.values(t))e.destroy();r&&r.field===e&&r.hide()}get invalidValueError(){return this.L("L{invalidValue}")}get errorTip(){return this.constructor.errorTip}static get errorTip(){return jn._errorTip||(jn._errorTip=new Mn({id:"bryntum-field-errortip",cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:"l-r",scrollAction:"realign",onBeforeShow(){const e=this,t=K.fromElement(e.activeTarget);if(t){const r=t.getErrors();if(r)return e.html=r.join("<br>"),e.field=t,!0}return!1}}))}construct(e){const t=this;t.highlightChanged=t.createOnFrame("addUpdatedCls"),super.construct(e),t.keyStrokeChangeDelay&&(t.changeOnKeyStroke=t.buffer(t.internalOnChange,t.keyStrokeChangeDelay))}onFocusIn(e){this.valueOnFocus=ze.clone(this.value),super.onFocusIn(e)}onFocusOut(e){super.onFocusOut(e),this.updateRequired(),this.onEditComplete()}onEditComplete(){}set element(e){const t=this,r=t.initialConfig.value,n=Et.createElementFromTemplate(t.inputTemplate(t),$n),s=[{className:"b-field-inner",reference:"inputWrap",children:n}],i=[],o=[],a=t.labels||[];t.label&&a.push({reference:"labelElement",html:t.label}),a&&a.forEach(e=>{const r=Object.assign({tag:"label",htmlFor:t.id+"_input",className:"b-align-"+(e.align||"start")},e);e.align&&"start"!==e.align?s.push(r):s.unshift(r)}),t._thisIsAUsedExpression(t.clearable);for(const e in t.triggers){const r=t.triggers[e];"start"===r.align?i.unshift(r):o.push(r)}i.sort(On),o.sort(_n),n.unshift(...i.map(e=>e.element)),n.push(...o.map(e=>e.element)),super.element={className:a.length?"b-has-label":"",children:s},null!=r&&(t.value=r),t.updateEmpty(),t.updateInvalid();const l=t.input||t.focusElement;l&&(t.keyListenerRemover=gr.on({element:l,thisObj:t,keydown:"internalOnKeyPress",keypress:"internalOnKeyPress",keyup:"internalOnKeyPress"}))}get element(){return super.element}get focusElement(){return this.input}select(e,t){const r=this.focusElement;if(r.value.length){if(0===arguments.length)return void this.selectAll();if(!this.supportsTextSelection)return;P.isIE11?(r.focus(),r.setSelectionRange(e,t)):r.setSelectionRange(e,t)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const t=e.createTextRange();t.collapse(!1),t.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}updateEmpty(){const{isEmptyInput:e,isEmpty:t,element:r,clearIcon:n}=this,s=e&&t;r&&(n&&n.classList[s?"add":"remove"]("b-icon-hidden"),r.classList[s?"add":"remove"]("b-empty"))}updateInvalid(){this.updatingInvalid=!0;const{isValid:e,element:t,errorTip:r,inputWrap:n}=this;t&&(t.classList[e?"remove":"add"]("b-invalid"),e?r.isVisible&&r.field===this&&r.hide():n.contains(Mn.currentOverElement)&&(r.activeTarget===n&&r.isVisible?r.onBeforeShow():(r.activeTarget=n,r.showBy(n)))),this.updatingInvalid=!1}get attributeString(){const e=this;let t=e.attributes.map(t=>null!=e[t]?`${t.toLowerCase()}="${e[t]}"`:"").join(" ");return e.inputAttributes&&(t+=Object.keys(e.inputAttributes).map(t=>`${t}="${e.inputAttributes[t]}"`).join(" ")),t}get editable(){return this._editable}set editable(e){const t=this,r=t.input;t._editable=e,r&&(r.readOnly=!1===e?"readOnly":null,!1!==e?t.inputListenerRemover=gr.on({element:r,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput"}):t.inputListenerRemover&&t.inputListenerRemover())}set clearable(e){this._clearable=e,e&&!this.triggers&&(this.triggers={})}get clearable(){return this._clearable}set triggers(e){const t=this,r=t._triggers={};t.clearable&&((e||(e={})).clear={cls:"b-icon-remove",handler(){t._isUserAction=!0,t.clear(),t._isUserAction=!1},weight:1e3});for(const n in e)r[n]=J.createWidget(ze.assign({type:"trigger",reference:n,parent:t},e[n]),t.defaultTriggerType||"trigger")}get triggers(){return this._triggers}set labelWidth(e){this.labelElement&&(this.labelElement.style.flex="0 0 "+Et.setLength(e),this.inputWrap.style.flexBasis=null==e?"":0)}get label(){return this._label}set label(e){null==e&&(e=""),this._label=e,this.labelElement&&(this.labelElement.innerHTML=e)}get readOnly(){return this._readOnly||this.disabled}set readOnly(e){const t=this;e=Boolean(e),Boolean(t._readOnly)!==e&&(t._readOnly=e,t.element.classList[e?"add":"remove"]("b-readonly"),e?(t.readWriteEditability=t.editable,t.editable=!1):t.editable=t.readWriteEditability)}get isValid(){const e=this;if(!e.disabled){if(e.updateRequired(),e.errors&&ze.getTruthyValues(e.errors).length)return!1;if(e.input&&e.input.validity)return e.input.validity.valid}return!0}get isEmpty(){return null==this.value||""===this.value}get isEmptyInput(){return!this.input||null==this.input.value||""===this.input.value}get value(){return this._value}set value(e){const t=this,r=t._value;t.hasChanged(r,e)?(t._value=e,t.isConfiguring||(t.updateRequired(),t.inputting||t.triggerChange()),t.inputting||(t._lastValue=e),t.syncInputFieldValue()):""===e&&t.updateRequired()}hasChanged(e,t){return t!==e}syncInputFieldValue(e=!1){const t=this,{input:r}=t;r&&!t.inputting&&(t.input.value=t.inputValue,t.isConfiguring||t.containsFocus||!t.highlightExternalChange||(r.classList.remove("b-field-updated"),t.clearTimeout("removeUpdatedCls"),e||t.parent&&t.parent.isSettingValues||t.highlightChanged())),t.updateEmpty(),t.updateInvalid()}addUpdatedCls(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",this.updatedClsDuration)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return null==this.value?"":this.value}get supportsTextSelection(){const e=this.focusElement;return e&&("textarea"===e.tagName.toLowerCase()||e.type&&(/text|search|password|tel|url/.test(e.type)||P.isEdge))}internalOnInputFocus(){const e=this.input.value.length;P.isIE11&&e&&!this.autoSelect&&this.select(e,e)}internalOnChange(e){const t=this;t.isValid&&t.hasChanged(t._lastValue,t.value)&&(t.triggerChange(e,!0),t._lastValue=t.value)}triggerChange(e,t=Boolean(this._isUserAction)){const r=this,{value:n,_lastValue:s,isValid:i}=r;r.trigger("change",{value:n,oldValue:s,event:e,userAction:t,valid:i}),"change"===r.defaultAction&&r.trigger("action",{value:n,oldValue:s,event:e,userAction:t,valid:i})}internalOnInput(e){const t=this;t.inputting=!0,t.value=t.input.value,t.inputting=!1,t.trigger("input",{value:t.value,event:e}),t.changeOnKeyStroke&&t.changeOnKeyStroke(e)}internalOnKeyPress(e){const t=this,{value:r}=t;let n=!1;if("keydown"===e.type)if("Escape"!==e.key||t.readOnly)"Enter"===e.key&&P.isIE11&&t.internalOnChange(e);else{const e="initialValue"in t?t.initialValue:t.valueOnFocus,s=t.hasChanged(e,r),i=t.input.value!==String(t.inputValue);t.revertOnEscape&&(!t.isValid||s||i)?(s&&(t.value=e),i&&t.syncInputFieldValue(!0),t.clearError(),n=!0):t.clearable&&(r||t.input.value)&&t.clear()}t.isDestroyed||(n&&e.stopImmediatePropagation(),t.trigger(e.type,{event:e}))}clear(){this.value=null,this.trigger("clear")}onDisabled(){this.updateInvalid()}updateRequired(){const e=this;e.isConfiguring||!e.required||""!==e.value&&null!=e.value?e.clearError("L{fieldRequired}",e.updatingInvalid):e.setError("L{fieldRequired}",e.updatingInvalid)}setError(e,t){e=this.L(e),(this.errors||(this.errors={}))[e]=e,t||this.updateInvalid()}clearError(e,t){e=this.L(e),this.errors&&(e?delete this.errors[e]:this.errors={}),t||this.updateInvalid()}getErrors(){const e=this;if(!e.isValid){const t=e.input.validity,r=ze.allKeys(t).find(e=>"valid"!==e&&"customError"!==e&&t[e]);let n;if(e.errors)n=ze.getTruthyValues(e.errors);else if(t.customError)n=[e.input.validationMessage];else if(r){const t=`L{${r}}`;n=[e.L(t,{min:e.min,max:e.max})]}else n=[e.invalidValueError];if(n&&n.length)return n}}}jn.Trigger=class extends Vr{static get $name(){return"FieldTrigger"}static get defaultConfig(){return{align:null}}template(){return`<div class="b-icon b-align-${this.align||"end"}"></div>`}construct(e){super.construct(e),gr.on({element:this.element,click:{handler:"onClick",thisObj:this},mousedown:{handler:"onMousedown",thisObj:this}})}onClick(e){const t=this,r=t.field,n="function"==typeof t.handler?t.handler:r[t.handler];r.disabled||r.readOnly||n&&!1!==r.trigger("trigger",{trigger:t})&&n.call(r,e)}onMousedown(e){const t=this.field;!("key"in e)&&Et.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout(()=>t.editable=!0,500)),e.preventDefault(),document.activeElement!==t.input&&t.focus()}get field(){return this.parent}},jn.SpinTrigger=class extends jn.Trigger{static get $name(){return"SpinTrigger"}static get defaultConfig(){return{repeat:!0}}doDestroy(){this.clickRepeater&&this.clickRepeater.destroy(),super.doDestroy()}template(){return`<div class="b-icon b-align-${this.align||"end"}">\n                    <div reference="upButton" class="b-icon b-spin-up"></div>\n                    <div reference="downButton" class="b-icon b-spin-down"></div>\n                </div>`}set repeat(e){const t=this;e?t.clickRepeater=new Ln(Object.assign({element:t.element},e)):t.clickrepeater&&(t.clickRepeater.destroy(),t.clickrepeater=null)}onClick(e){const t=this.field;t.disabled||(e.target===this.upButton?t.doSpinUp():e.target===this.downButton&&t.doSpinDown())}},jn._$name="Field",U.register("trigger",jn.Trigger),U.register("spintrigger",jn.SpinTrigger);class Hn extends jn{static get $name(){return"Checkbox"}static get defaultConfig(){return{text:"",color:null,value:"",toggleGroup:null,defaultBindProperty:"value",localizableProperties:["label","text"]}}construct(e){super.construct(e);const t=this;t.initialConfig.readOnly&&(t.readOnly=!0),t.isConfiguring=!0,t.initialConfig.checked&&(t.checked=!0),t.isConfiguring=!1}inputTemplate(){const e=this;return Cn.tpl`
            <input type="checkbox" id="${e.id}_input" reference="input" ${e.toggleGroup?`data-group="${e.toggleGroup}"`:""}/>
            <label class="b-checkbox-label" for="${e.id}_input" reference="textLabel">${e.text||""}</label>
        `}set element(e){const t=this;super.element=e,t.color&&t.element.classList.add(t.color),t.text&&t.element.classList.add("b-text")}get element(){return super.element}get text(){return this._text}set text(e){this._text=e,this.textLabel&&(this.textLabel.innerHTML=e)}get value(){return this.checked}set value(e){this.checked="false"!==e&&Boolean(e)}get checked(){return this.input.checked}set checked(e){const t=this;e=Boolean(e),t.inputting||t.input.checked===e||(t.input.checked=e,t.uncheckToggleGroupMembers(),t.isConfiguring||t.triggerChange(!1))}getToggleGroupMembers(){const{checked:e,toggleGroup:t,input:r}=this,n=[];return e&&t&&Et.forEachSelector(`input[type=checkbox][data-group=${t}]`,e=>{if(e!==r){const t=J.fromElement(e);t&&n.push(t)}}),n}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach(e=>e.checked=!1)}get readOnly(){return this._readOnly}set readOnly(e){this._readOnly=e,this.element.classList[e?"add":"remove"]("b-readonly"),this.input.disabled=e}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnChange(e){this.triggerChange(!0)}triggerChange(e){const t=this,{checked:r}=t.input;(!r&&e&&t.toggleGroup&&t.getToggleGroupMembers().filter(e=>e.isVisible&&!e.disabled).length||!t.callPreventable("change",{checked:r,value:r,userAction:e},r=>(e&&t.uncheckToggleGroupMembers(),t.trigger("action",r),!0)))&&(t.input.checked=!t.input.checked)}}Hn._$name="Checkbox",U.register("checkbox",Hn),U.register("check",Hn);class Nn extends(ae(G(B))){static get defaultConfig(){return{disabled:!1}}static initPlugins(e,...t){const r=e.plugins||(e.plugins={});for(const n of t)r[n.$name]=new n(e)}get client(){return this._client}set client(e){this._client=e}construct(e,t){this.pluggedInto=this.client=e,super.construct(t),this.applyPluginConfig(e)}applyPluginConfig(e){const t=this,r=t.pluginConfig||t.constructor.pluginConfig;if(r){const{assign:n,chain:s,after:i,before:o,override:a}=r;n&&t.applyAssign(e,n),(s||i)&&t.applyChain(e,s||i),o&&t.applyChain(e,o,!1),a&&t.applyOverride(e,a)}}applyAssign(e,t){t.forEach(t=>this.assign(e,t))}applyChain(e,t,r=!0){t.forEach(t=>{e[t]?this.chain(e,t,r):this.assign(e,t)})}applyOverride(e,t){const r=this;r.overridden||(r.overridden={}),t.forEach(t=>{if(!r[t])throw new Error(`Trying to chain fn ${e.$name}#${t}, but plugin fn ${r.$name}#${t} does not exist`);"function"==typeof e[t]&&(r.overridden[t]=e[t].bind(e)),e[t]=r[t].bind(r)})}assign(e,t){const r=this,n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(r),t);n&&(n.get||n.set)?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:n.get&&n.get.bind(r),set:n.set&&n.set.bind(r)}):e[t]=r[t].bind(r)}chain(e,t,r=!0){const n=this,s=e.pluginFunctionChain||(e.pluginFunctionChain={});if(s[t]||(s[t]=[e[t].bind(e)]),!n[t])throw new Error(`Trying to chain fn ${e.$name}#${t}, but plugin fn ${n.$name}#${t} does not exist`);s[t][r?"push":"unshift"](n[t].bind(n)),e[t]=(...e)=>n.functionChainRunner(t,...e)}functionChainRunner(e,...t){const r=this.client.pluginFunctionChain[e];let n;for(let e=0;e<r.length;e++)if(n=r[e](...t),!1===n)return!1;return n}doDisable(e){const{constructor:t}=this,r="featureClass"in t?t.featureClass:"b-"+t.$name.toLowerCase();r&&this.client&&this.client.element&&this.client.element.classList[e?"remove":"add"](r),e?this.trigger("disable"):this.trigger("enable")}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.doDisable(e)}throwOverrideIsMissing(e){throw new Error(`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`)}}Nn._$name="InstancePlugin";var Bn=e=>class extends(e||B){get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(e){e&&(Array.isArray(e)||(e=[e]),Nn.initPlugins(this,...e)),this.initPlugins()}initPlugins(){}addPlugins(...e){Nn.initPlugins(this,...e)}hasPlugin(e){return null!=this.getPlugin(e)}getPlugin(e){return"function"==typeof e&&(e=e.$name),this.plugins&&this.plugins[e]}get widgetClass(){}},zn=e=>class extends(e||B){get state(){return this._state=this.getState(),this._state}set state(e){this._state=e,this.applyState(e)}get widgetClass(){}};const Vn=Symbol("STM_PROP"),Wn={parentIndex:1};var Gn=e=>class extends(e||B){static get defaultConfig(){return{stm:null}}joinStore(e){super.joinStore&&super.joinStore(e),this.stm||(this.stm=e.stm)}unJoinStore(e){this.stm===e.stm&&(this.stm=null),super.unJoinStore&&super.unJoinStore(e)}get stm(){return this[Vn]}set stm(e){this[Vn]=e}beforeSet(e,t,r,n){const s=super.beforeSet?super.beforeSet(e,t,r,n):[],i=this.stm;if(i&&!i.disabled&&!Wn[e]){let r,n;"object"==typeof e?[r,n]=Object.keys(e).reduce((t,r)=>(t[0][r]=e[r],t[1][r]=this.get(r),t),[{},{}]):(r={[e]:t},n={[e]:this.get(e)}),s.push([r,n])}return s}afterSet(e,t,r,n,s,i){const o=this.stm;if(o&&!o.disabled&&!Wn[e]){const e=s.pop();if(i){let[t,r]=e,[n,s]=Object.keys(i).reduce((e,n)=>(e[0][n]=t[n],e[1][n]=r[n],e),[{},{}]);o.onModelUpdate(this,n,s)}}super.afterSet&&super.afterSet(e,t,r,n,s,i)}beforeInsertChild(e){const t=super.beforeInsertChild?super.beforeInsertChild(e):[],r=this.stm;return r&&!r.disabled&&t.push(e.reduce((e,t)=>(t.root===this.root&&e.set(t,{parent:t.parent,index:t.parent?t.parentIndex:void 0}),e),new Map)),t}afterInsertChild(e,t,r,n){const s=this.stm;if(s&&!s.disabled){const t=r.pop();n&&s.onModelInsertChild(this,e,n,t)}super.afterInsertChild&&super.afterInsertChild(e,t,r,n)}beforeRemoveChild(e,t){const r=super.beforeRemoveChild?super.beforeRemoveChild(e,t):[],n=this.stm;return!n||n.disabled||t||r.push(e.reduce((e,t)=>(e.set(t,t.parentIndex),e),new Map)),r}afterRemoveChild(e,t,r){const n=this.stm;if(n&&!n.disabled&&!r){const r=t.pop();e&&e.length&&n.onModelRemoveChild(this,e,r)}super.afterRemoveChild&&super.afterRemoveChild(e,t,r)}},Un=e=>class extends(e||B){static set convertEmptyParentToLeaf(e){!0===e?e={onLoad:!0,onRemove:!0}:!1===e&&(e={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=e}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(e,t=this.stores){const{inProcessChildren:r,constructor:n}=this,s=t[0];if(!0===e)return!!r||[];if(e){Array.isArray(e)||(e=[e]);const t=e.length,r=[];for(let i,o=0;o<t;o++)i=e[o],i=i instanceof Jn?i:s?s.createRecord(i):new n(i,null,null,!0),r.push(i);return r}}processChildren(e=this.stores){const t=this,{meta:r}=t;t.inProcessChildren=!0;const n=t.ingestChildren(t.data[t.constructor.childrenField],e);n&&(n.length?(r.isLeaf=!1,!0===t.children&&(t.children=[]),t.appendChild(n)):!0===n?(r.isLeaf=!1,t.children=!0):t.isRoot||(r.isLeaf=t.constructor.convertEmptyParentToLeaf.onLoad)),t.inProcessChildren=!1}ancestorsExpanded(e){const{parent:t}=this;return!t||t.isExpanded(e)&&t.ancestorsExpanded(e)}isExpanded(e){const t=this.instanceMeta(e.id);return Object.prototype.hasOwnProperty.call(t,"collapsed")||(t.collapsed=!this.expanded),!t.collapsed}get expanded(){return this.data.expanded}get childLevel(){return this.parent?this.parent.childLevel+1:this.isRoot?-1:0}get isLeaf(){return!1!==this.meta.isLeaf&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(e=!1,t=this.firstStore){const r=this.children;return!r||!Array.isArray(r)||e&&!this.isExpanded(t)?0:r.reduce((t,r)=>t+r.getDescendantCount(e),r.length)}get allChildren(){const e=this.children;return e?e.reduce((e,t)=>(e.push(t),e.push.apply(e,t.allChildren),e),[]):[]}get firstChild(){const e=this.children;return e&&e.length&&e[0]||null}get lastChild(){const e=this.children;return e&&e.length&&e[e.length-1]||null}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get root(){return this.parent&&this.parent.root||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(e){const t=this,{parent:r}=t,n=e&&t.firstStore.getById(e);n!==r&&(r||n)&&(t.isBatchUpdating?t.meta.batchChanges.parentId=e:n?n.appendChild(t):t.parent.removeChild(t))}static set parentIdField(e){this._parentIdField=e,Object.defineProperty(this.prototype,e,{set:function(e){this.parentId=e},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}traverse(e,t=!1){const{children:r}=this;t||e.call(this,this);for(let t=0,n=r&&r.length;t<n;t++)r[t].traverse(e)}traverseBefore(e,t=!1){const{children:r}=this;for(let t=0,n=r&&r.length;t<n;t++)r[t].traverse(e);t||e.call(this,this)}traverseWhile(e,t=!1){const r=this;let n=!0;return t||(n=!1!==e.call(r,r)),n&&r.isLoaded&&(n=r.children.every(t=>t.traverseWhile(e))),n}bubble(e,t=!1){let r=this;for(t||e.call(r,r);r.parent;)r=r.parent,e.call(r,r)}bubbleWhile(e,t=!1){let r=this,n=!0;for(t||(n=e.call(r,r));n&&r.parent;)r=r.parent,n=e.call(r,r);return n}contains(e){return e&&"object"==typeof e&&(e=e.id),!this.traverseWhile(t=>t.id!=e)}getTopParent(e){let t;return e?(t=[],this.bubbleWhile(e=>(t.push(e),e.parent&&!e.parent.isRoot))):(t=null,this.bubbleWhile(e=>(e.parent||(t=e),e.parent&&!e.parent.isRoot))),t}appendChild(e,t=!1){return this.insertChild(e,null,t)}insertChild(e,t=null,r=!1){if("number"==typeof e){const r=e;e=t,t=this.children[r]}const n=this,s=n.isLeaf,i=Array.isArray(e);if(Array.isArray(e)||(e=[e]),!r&&!n.stores.every(t=>!1!==t.trigger("beforeAdd",{records:e,parent:n})))return null;e=n.ingestChildren(e);const o=t?t.parentIndex:n.children?n.children.length:0,a=n.beforeInsertChild?n.beforeInsertChild(e):void 0,l=n.internalAppendInsert(e,t,r);return s&&l.length&&(n.meta.isLeaf=!1),n.isLeaf===s||n.root.isLoading||r||n.stores.forEach(e=>{const t={isLeaf:{value:!1,oldValue:!0}};e.trigger("update",{record:n,changes:t}),e.trigger("change",{action:"update",record:n,changes:t})}),n.afterInsertChild&&n.afterInsertChild(o,e,a,l),i||!l?l:l[0]}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(e,t,r){const n=this,{stores:s,root:i}=n,{firstStore:o}=i,a={};let l,c,d,u;if(t&&t.parent!==n&&(t=null),n.children){const r=n.children,s=t?t.parentIndex:r.length;if(r[c=s]===e[0]||r[c=s-1]===e[0])for(l=!0,d=0;l&&d<e.length;d++)e[d]!==r[c+d]&&(l=!1)}if(l)return e;for(d=0;d<e.length;d++){const t=e[d],r=t.parent;if(a[t.id]=t.root===i,o&&t.traverse(e=>{e.root===i&&(a[e.id]=!0)}),r&&!1===r.removeChild(t,a[t.id]))u||(e=e.slice(),u=!0),e.splice(d--,1);else{const{parentIdField:e}=t.constructor,s=n.isAutoRoot?null:n.id;if(t.parent=n,t.data[e]=s,!n.inProcessChildren&&!n.isLoading){const i={[e]:s},{modified:o}=t.meta,a=r?r.id:null,l={[e]:{value:n.id,oldValue:a}};o[e]===n.id?Reflect.deleteProperty(o,e):e in o||(o[e]=a),t.afterChange(i,l)}}}if(e.length){const i=n.addToChildren(n.children||(n.children=[]),t,e);n.addToChildren(n.unfilteredChildren,t,e,!0),s.forEach(t=>{t.isChained||(e.forEach(e=>{e.joinStore(t)}),t.onNodeAddChild(n,e,i,a,r))})}return e}removeChild(e,t=!1,r=!1){const n=this,s=n.isLeaf,{children:i,stores:o}=n;if(Array.isArray(e)||(e=[e]),e=e.filter(e=>e.parent===n),!r)for(const r of o)if(!r.isChained&&!1===r.trigger("beforeRemove",{parent:n,records:e,isMove:t}))return!1;const a=n.beforeRemoveChild?n.beforeRemoveChild(e,t):void 0;for(const s of e){const{parentIdField:e}=s.constructor,{modified:a}=s.meta,l=s.parent?s.parent.id:null;e in a||(a[e]=l);const c=n.removeFromChildren(i,s);n.removeFromChildren(n.unfilteredChildren,s,!0),o.forEach(e=>{e.isChained||e.onNodeRemoveChild(n,[s],c,{isMove:t,silent:r})}),t||(s.parent=s.parentIndex=s.unfilteredIndex=s.nextSibling=s.previousSibling=null,s.data[e]=null)}i.length||!n.constructor.convertEmptyParentToLeaf.onRemove||n.isRoot||(n.meta.isLeaf=!0),n.isLeaf===s||r||n.stores.forEach(e=>{const t={isLeaf:{value:!0,oldValue:!1}};e.trigger("update",{record:n,changes:t}),e.trigger("change",{action:"update",record:n,changes:t})}),n.afterRemoveChild&&n.afterRemoveChild(e,a,t)}clearParentId(){const e=this;Reflect.deleteProperty(e.data,e.parentIdField),Reflect.deleteProperty(e.originalData,e.parentIdField),e.meta.modified&&Reflect.deleteProperty(e.meta.modified,e.parentIdField)}clearChildren(e=!1){const t=this,{children:r,stores:n}=t;r&&(t.children=[],n.forEach(n=>{n.isChained||n.onNodeRemoveChild(t,r,0,{unfiltered:!0,silent:e})}),t.unfilteredChildren&&(t.unfilteredChildren=[]))}clear(){const e=this,{stores:t}=e,r=e.children&&e.children.slice();if(e.isRoot&&r){for(const n of t)if(!n.isChained&&!1===n.trigger("beforeRemove",{parent:e,records:r,isMove:!1,removingAll:!0}))return!1;e.children.length=0,t.forEach(e=>{r.forEach(t=>{t.stores.includes(e)&&t.unJoinStore(e),t.parent=t.parentIndex=t.nextSibling=t.previousSibling=null}),e.storage.suspendEvents(),e.storage.clear(),e.storage.resumeEvents(),e.added.clear(),e.modified.clear(),e.trigger("removeAll"),e.trigger("change",{action:"removeall"})})}}updateChildrenIndex(e,t=!1){const r=t?"unfilteredIndex":"parentIndex";let n=null;for(let s=0;s<e.length;s++){const i=e[s],o=i[r];if(i[r]=s,t||(i.previousSibling=n,n&&(n.nextSibling=i),s===e.length-1&&(i.nextSibling=null),n=i),"parentIndex"===r&&!i.getFieldDefinition(r)&&void 0!==o&&o!==i[r]){let e=!1;i[r]===i.meta.modified[r]?(Reflect.deleteProperty(i.meta.modified,r),e=!0):r in i.meta.modified||(i.meta.modified[r]=o,e=!0),e&&i.stores.forEach(e=>{e.updateModifiedBagForRecord(i)})}}}addToChildren(e,t,r,n=!1){if(e){const s=n?"unfilteredIndex":"parentIndex",i=t?t[s]:e.length;return e.splice(i,0,...r),this.updateChildrenIndex(e,n),i}}removeFromChildren(e,t,r=!1){if(e){const n=t[r?"unfilteredIndex":"parentIndex"];return n>-1&&(e.splice(n,1),this.updateChildrenIndex(e,r)),n}}};const Yn={children:1,data:1,meta:1},qn={},Xn=function(e){return e instanceof Date||(e=je.parse(e,this.format||this.dateFormat||je.defaultParseFormat)),e||void 0},Kn=(e,t,r)=>e&&e.isEqual?e.isEqual(t,r):ze.isEqual(t,r),Zn=()=>{};class Jn extends(Un(Gn())){static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set childrenField(e){this._childrenField=e}static get childrenField(){return this._childrenField||"children"}get indexPath(){const e=[];for(let t=this;t&&!t.isRoot;t=t.parent)e.unshift(t.parentIndex+1);return e}construct(e={},t=null,r=null,n=!1){const s=this,{constructor:i}=s,{fieldMap:o}=i,a=t?Array.isArray(t)?t:[t]:[];let l=null;if(t=a[0],s.meta=Object.assign({modified:{}},i.metaConfig,r),i.applyConfigs){const t=i.getDefaultConfiguration(),r=[...new Set(ze.allKeys(t))];r.length&&(s.useRawData&&s.useRawData.enabled||(e=Object.assign({},e)),l={},r.forEach(r=>{l[r]=e[r]||t[r],delete e[r]}))}if(super.construct(l),n?i.hasOwnProperty("fieldMap")||i.exposeProperties():i.exposeProperties(e),!i.hasOwnProperty("idFieldProcessed")){let e=s.meta.idField;e||(i._assignedIdField?e=i.idField:t&&(e=t.idField)),e&&e!==o.id.dataSource&&i.addField({name:"id",dataSource:e}),i.idFieldProcessed=!0}s._internalId=Jn._internalIdCounter++,s.stores=[],s.unjoinedStores=[],s.originalData||(s.originalData=e),s.data=i.processData(e,!1,t),null==s.id&&s.setData("id",s.generateId(t)),s.data[i.childrenField]&&s.processChildren(a),s.generation=0}equals(e){if(e instanceof this.constructor){for(let{fields:t}=this,r=0,{length:n}=t;r<n;r++){const n=t[r],{name:s}=n;if("id"!==s&&!Kn(n,this[s],e[s]))return!1}return!0}return!1}get subclass(){return new this.constructor(Object.setPrototypeOf({id:void 0},this.data),this.stores[0],null,!0)}static processData(e,t=!1,r){const{fieldMap:n,defaultValues:s}=this,{useRawData:i={enabled:!1}}=r||{},o=i.enabled?e:Object.assign({},e);let a;if(!(t=t||i.disableDefaultValue))for(a in s)void 0===o[a]&&(o[a]=s[a]);if(!i.disableTypeConversion)for(a in n){const r=n[a],{name:s,dataSource:l}=r,c=l!==s&&!ze.pathExists(e,l)&&s in e,d=!i.disableTypeConversion&&r.convert;if(c||d){const n=c?e[s]:e[l];(!t||c&&s in e||!c&&l in e)&&(ze.setPath(o,l,d?r.convert(n):n),c&&delete o[s])}}return o}static exposeProperties(e){const t=this,r=t.superclass,n=t.hasOwnProperty("fields")&&t.fields;if(r.exposeProperties&&!r.hasOwnProperty("fieldMap")&&r.exposeProperties(),t.hasOwnProperty("propertiesExposed")||(t.defaultValues=Object.assign({},r.defaultValues,t.hasOwnProperty("defaults")?t.defaults:null),t.fieldMap=Object.setPrototypeOf({},r.fieldMap||qn),t.fieldDataSourceMap=Object.setPrototypeOf({},r.fieldDataSourceMap||qn),t.propertiesExposed=Object.setPrototypeOf({},r.propertiesExposed||qn),t.hasOwnProperty("idField")&&(t.addField({name:"id",dataSource:t.idField}),t.propertiesExposed[t.idField]=!0),n&&n.length&&n.map(t.addField,t)),t.autoExposeFields&&e&&!t.hasOwnProperty("propertiesExposedForData")){for(const r in e)t.propertiesExposed[r]||t.addField({name:r,dataSource:r,fromData:!0});t.propertiesExposedForData=!0}t.exposeRelations()}static addField(e){if(null==e)return;"string"==typeof e&&(e={name:e});const t=this,{propertiesExposed:r,defaultValues:n}=t,{name:s}=e,i=e.dataSource||(e.dataSource=s);return e.hasOwnProperty("persist")||(e.persist=!0),"date"===e.type&&(e.convert=Xn),t.fieldMap[s]=e,t.fieldDataSourceMap[i]||(t.fieldDataSourceMap[i]=e),i.includes(".")||"model"===e.type?(e.complexMapping=!0,r[i.split(".")[0]]=!0):r[i]=!0,"defaultValue"in e&&(n[i]=e.defaultValue),t.createFieldProperty(s,i,e),e}static removeField(e){const t=this.fieldMap[e];if(t){const{dataSource:r}=t;delete this.fieldMap[e],delete this.fieldDataSourceMap[r],delete this.prototype[e],this._internalFields=null}}static createFieldProperty(e,t,r){const n=this;Yn[t]||e in n.prototype||Object.defineProperty(n.prototype,e,{enumerable:!0,configurable:!0,get(){return this.get(e)},set:r&&r.readOnly?Zn:function(t){this.set(e,t)}})}static exposeRelations(){const e=this;e.hasOwnProperty("relationsExposed")||e.relationConfig&&(e.relationsExposed=!0,e.relations=[],e.relationConfig.forEach(t=>{e.relations.push(t);const r=t.relationName;Reflect.ownKeys(e.prototype).includes(r)||Object.defineProperty(e.prototype,r,{enumerable:!0,get:function(){return this.getForeign(r)},set:function(e){this.setForeign(r,e,t)}})}))}static get autoExposeFields(){return!0}static get fields(){return[]}static get internalFields(){const{fieldMap:e}=this;let t=this._internalFields;if(this.hasOwnProperty("fieldMap")&&!t){t=this._internalFields=[];for(const r in e)t.push(e[r])}return t}get fields(){return this.constructor.internalFields||this.constructor.fields}getFieldDefinition(e){return this.constructor.getFieldDefinition(e)}getFieldDefinitionFromDataSource(e){return this.constructor.fieldDataSourceMap[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){return this.fieldMap[e]}static getFieldDataSource(e){return this.getFieldDefinition(e).dataSource}getDataSource(e){const t=this.constructor.getFieldDefinition(e);if(t)return t.dataSource||t.name}static processField(e,t){const r=this.fieldMap[e];return r&&r.convert?r.convert(t):t}initRelations(){const e=this;e.constructor.relations&&e.stores.forEach(t=>{t.modelRelations||t.initRelations();const r=[];t.modelRelations&&t.modelRelations.forEach(t=>{r.push({related:e.initRelation(t),config:t})}),t.updateRecordRelationCache(e,r)})}initRelation(e){const t=this.get(e.fieldName),r=void 0!==t&&"string"!=typeof e.store&&e.store.getById(t),n={id:t,placeHolder:!0};return this.meta.relationCache||(this.meta.relationCache={}),this.meta.relationCache[e.relationName]=r||(null!=t?n:null),r}removeRelation(e){this.meta.relationCache[e.relationName]&&(delete this.meta.relationCache[e.relationName],e.nullFieldOnRemove&&this.setData(e.fieldName,null))}getForeign(e){return this.meta.relationCache&&this.meta.relationCache[e]}setForeign(e,t,r){const n=Jn.asId(t);return this.set(r.fieldName,n)}get(e){const t=this,r=t.meta.batchChanges,n=t.data;let s=t.constructor.fieldMap[e];const i=s?s.dataSource:e;if(r&&Object.prototype.hasOwnProperty.call(r,e))return r[e];if(i){if(!s&&e.includes(".")){const r=e.split(".")[0];s=t.constructor.fieldMap[r]}return s&&s.complexMapping?ze.getPath(n,i):i in n?n[i]:n[e]}}setData(e,t){const r=this.constructor.fieldMap[e],n=r?r.dataSource:e;n&&ze.setPath(this.data,n,t)}syncId(e){const t=this.id;if(t!==e){this.setData("id",e);const r={id:{value:e,oldValue:t}};this.afterChange(r,r)}}set(e,t,r=!1,n=!1){const s=this;if(s.isBatchUpdating)return s.inBatchSet(e,t),null;{const i=s.beforeSet?s.beforeSet(e,t,r,n):void 0,o=s.inSet(e,t,r,n);return s.afterSet&&s.afterSet(e,t,r,n,i,o),o}}fieldToKeys(e,t){let r;return"string"!=typeof e?(r={},Reflect.ownKeys(e).forEach(t=>r[t]=e[t])):r={[e]:t},r}inBatchSet(e,t){if("string"!=typeof e){const r=this.fieldToKeys(e,t);Object.keys(r).forEach(e=>{this.meta.batchChanges[e]=this.constructor.processField(e,r[e])})}else this.meta.batchChanges[e]=t}inSet(e,t,r,n){const s=this,i=s.constructor.fieldMap,o=s.constructor.prototype,a=s.data,l={},c=s.fieldToKeys(e,t);let d=!1;return r||s.triggerBeforeUpdate(c)?(Object.keys(c).forEach(e=>{if(e===s.constructor.childrenField)return;const t=i[e],r=t&&t.readOnly,u=t?t.dataSource:e,h=!t&&e in o,g=h?s[u]:ze.getPath(a,u),m=s.constructor.processField(e,c[e]),p=c[e]={value:m},f=s.getRelationConfig(e);r||Kn(t,g,m)?delete c[e]:(s.generation++,p.oldValue=g,d=!0,Kn(t,s.meta.modified[e],m)?Reflect.deleteProperty(s.meta.modified,e):(e in s.meta.modified||(s.meta.modified[e]=g),void 0===p.oldValue&&Reflect.deleteProperty(p,"oldValue")),l[e]=p,h?s[e]=m:ze.setPath(a,u,m),f&&!n&&(s.initRelation(f),s.stores.forEach(e=>e.cacheRelatedRecord(s,m,f.relationName,p.oldValue))))}),d&&s.afterChange(c,l,r,n),d?l:null):null}afterChange(e,t,r,n){this.stores.forEach(s=>{s.onModelChange(this,e,t,r,n)})}get isPersistable(){return!0}get isModified(){return Boolean(this.meta.modified&&Object.keys(this.meta.modified).length>0)}isFieldModified(e){return this.isModified&&this.meta.modified[e]}getFieldPersistentValue(e){const t=this.getFieldDefinition(e);let r;return t&&!t.persist||(r=this[e],t&&t.serialize&&(r=t.serialize.call(this,r,this))),r}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,t={};if(!e.isModified)return null;let r=!1;return Object.keys(e.meta.modified).forEach(n=>{const s=e.getFieldPersistentValue(n);void 0!==s&&(t[n]=s,r=!0)}),r?t:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&ze.setPath(e,this.constructor.getFieldDefinition(this.constructor.idField).dataSource,this.id),e}get rawModificationData(){const e=this,{fieldMap:t}=e.constructor,r={};if(!e.isModified)return null;let n=!1;return Object.keys(e.meta.modified).forEach(s=>{const i=t[s];if(i){const t=e.getFieldPersistentValue(s);void 0!==t&&(ze.setPath(r,i.dataSource,t),n=!0)}}),n?r:null}get persistableData(){const e=this,t={};return e.fields.forEach(r=>{const n=e.getFieldPersistentValue(r.name);void 0!==n&&ze.setPath(t,r.dataSource,n)}),t}get isCommitting(){return Boolean(this.meta.committing)}clearChanges(e=!0,t=!0){const r=this,{meta:n}=r;n.modified={},n.committing=!1,e&&r.stores.forEach(e=>{if(e.modified.remove(r),e.added.remove(r),t){const t=e.collectDescendants(r).all;e.added.remove(t),e.modified.remove(t)}})}get internalId(){return this._internalId}get isPhantom(){return""===this.id||null==this.id||this.hasGeneratedId}get isModel(){return!0}get hasGeneratedId(){return this.id&&"string"==typeof this.id&&this.id.startsWith("_generated")}generateId(){return this.constructor.generatedIdIndex||(this.constructor.generatedIdIndex=0),"_generated"+this.$name+ ++this.constructor.generatedIdIndex}static asId(e){return e&&e.isModel?e.id:e}get json(){return JSON.stringify(this.data)}toJSON(){return this.data}get isBatchUpdating(){return Boolean(this.batching)}beginBatch(){const e=this;e.batching||(e.batching=0,e.meta.batchChanges={}),e.batching++}endBatch(e=!1){const t=this,{parentIdField:r}=t.constructor;if(t.batching&&(t.batching--,!(t.batching>0||ze.isEmpty(t.meta.batchChanges)))){const n=Object.assign({},t.meta.batchChanges);t.meta.batchChanges=null,n[r]&&(t.parentId=n[r],delete n[r]),t.set(n,void 0,e),t.cancelBatch()}}cancelBatch(){this.batching=null,this.meta.batchChanges=null}triggerBeforeUpdate(e){return!this.stores.some(t=>{if(!1===t.trigger("beforeUpdate",{record:this,changes:e}))return!0})}copy(e=null){const t=this,r=Object.assign({},t.data),n=t.constructor.idField;let s,i;e&&"object"==typeof e?(s=e.deep,i=e.id,delete e.id):i=e,s&&t.children?r.children=t.children.map(t=>t.copy(e)):(delete r.children,delete r.expanded),i?r[n]=i:null==i&&(r[n]=t.generateId(t.firstStore));const o=new t.constructor(r);return o.originalInternalId=t.internalId,o}remove(e=!1){const t=this,{parent:r}=this;r?r.removeChild(t):t.stores.length&&(t.meta.specialRow||t.stores.forEach(r=>r.remove(t,e,!1,!0)))}get firstStore(){return this.stores.length>0&&this.stores[0]}getRelationConfig(e){return this.firstStore&&this.firstStore.modelRelations&&this.firstStore.modelRelations.find(t=>t.fieldName===e)}get isValid(){return!0}joinStore(e){const t=this,{stores:r,unjoinedStores:n}=t;r.includes(e)||(super.joinStore&&super.joinStore(e),e.register(t),r.push(e),n.includes(e)&&n.splice(n.indexOf(e),1),t.isLoaded&&t.children.forEach(t=>t.joinStore(e)),t.initRelations(),e.tree&&!t.isRoot&&(t.instanceMeta(e.id).collapsed=!t.expanded))}unJoinStore(e){const t=this,{stores:r,unjoinedStores:n}=t;r.includes(e)&&(e.unregister(t),t.children&&t.children.forEach(t=>t.unJoinStore(e)),r.splice(r.indexOf(e),1),n.push(e),super.unJoinStore&&super.unJoinStore(e),e.uncacheRelatedRecord(t)),r.length||(t.meta.removed=!0)}isPartOfStore(e){return e?e.indexOf(this)>=0:this.stores.length>0}instanceMeta(e){const{meta:t}=this,r=e.id||e;return t.map||(t.map={}),t.map[r]||(t.map[r]={})}}Jn._idField="id",Jn._internalIdCounter=1,Jn._assignedIdField=!1,Jn.exposeProperties(),Jn._$name="Model";const Qn=e=>({mixes:(...t)=>t.reduce((e,t)=>t(e),e||B)});class es extends an{add(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),super.add(...e.filter(e=>e.isPersistable))}}es._$name="StoreBag";var ts=e=>class extends(e||B){static get defaultConfig(){return{autoCommit:!1,suspendCount:0}}remove(e,t=!1){const r=this,{storage:n}=r;if((e=(Array.isArray(e)?e:[e]).reduce((e,t)=>((t=r.getById(t))&&e.push(t),e),[])).length){if(r.tree){const r=e.reduce((e,t)=>{const r=t.parent;return r&&(e[r.id]||(e[r.id]=[r,[]]),e[r.id][1].push(t)),e},{});for(const e of Object.values(r))e[0].removeChild(e[1],!1,t);return e}if(r.isGrouped){const t=n.count,s=[],i=new Set;for(const t of e){const{groupParent:e}=t.instanceMeta(r);e&&e.meta.collapsed&&s.push(t),z.remove(e.groupChildren,t),e.meta.childCount--,i.add(e)}for(const e of i)r.onModelChange(e,{},{});s.length&&n.trigger("change",{action:"splice",removed:s,added:[],replaced:[],oldCount:t})}if(!e.length||!t&&!1===r.trigger("beforeRemove",{records:e}))return null;t&&r.suspendEvents(),n.remove(e),t&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit()}return e}clear(e=!0){const t=this,{storage:r}=t;if(t.storage.totalCount){if(e&&!1===t.trigger("beforeRemove",{records:r.allValues,removingAll:!0}))return null;if(!e){const e=t.registeredRecords;for(let r,n=e.length-1;n>=0;n--)r=e[n],r&&!r.isDestroyed&&r.unJoinStore(t);t.removed.clear()}e||r.suspendEvents(),r.clear(),e||r.resumeEvents(),t.added.clear(),t.modified.clear()}}removeAll(e=!1){const t=this,r=t.storage;if(e){r.suspendEvents();const e=t.registeredRecords;for(let r,n=e.length-1;n>=0;n--)r=e[n],r&&!r.isDestroyed&&r.unJoinStore(t)}t.tree?t.rootNode.clear():t.clear(),e&&r.resumeEvents()}add(e,t=!1){const r=this,n=r.storage,s=[];if(Array.isArray(e)){if(!e.length)return}else e=[e];if(r.tree=r.tree||Boolean(r.autoTree&&e[0].children),r.tree){const n=new Map,s=[];return e.forEach(e=>{const t=e[r.modelClass.parentIdField];n.has(t)||n.set(t,[]),n.get(t).push(e)}),n.forEach((e,n)=>{const i=null==n?r.rootNode:r.getById(n);if(!i)throw new Error(`Parent node with id ${n} not found, cannot add children.`);s.push(...i.appendChild(e,t))}),s}return t||!1!==r.trigger("beforeAdd",{records:e})?(r.tree=r.tree||Boolean(r.autoTree&&e[0].children),r.tree?r.rootNode.appendChild(e):(e.forEach(e=>{s.push(e instanceof Jn?e:r.createRecord(e))}),t&&r.suspendEvents(),n.add(s),t&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit(),s)):null}insert(e,t,r=!1){const n=this,s=n.storage,i=[],o=n.getAt(e),a=s.values,l=[];if(Array.isArray(t)||(t=[t]),!1===n.trigger("beforeAdd",{records:t}))return null;let c,d,u;if(a[d=e]===t[0]||a[d=e-1]===t[0])for(c=!0,u=0;c&&u<t.length;u++)t[u]!==a[d+u]&&(c=!1);if(c)return null;if(t.forEach(t=>{const r=t instanceof Jn?t:n.createRecord(t),a=s.indexOf(r);r.children&&r.children.length&&n.autoTree&&(n.tree=!0),i.push(r),a>-1&&(a<e&&o&&e--,l.push(a)),r.meta.previousIndex=a}),n.tree){const r=n.rootNode;return r.insertChild(t,r.children&&r.children[e])}return n.suspendEvents(),n.storage.remove(l),n.resumeEvents(),r&&n.suspendEvents(),s.splice(e,0,...i),r&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),i}move(e,t){this.storage.move(e,t)}setMultiple(e,t,r){const n=this,s=[],i=[];n.forEach(n=>{e(n)&&(i.push(n.set(t,r,!0)),s.push(n))}),n.trigger("updateMultiple",{records:s,all:n.records.length===s.length}),n.trigger("change",{action:"updatemultiple",records:s,all:n.records.length===s.length}),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}setAll(e,t){const r=this,n=[];r.forEach(r=>{n.push(r.set(e,t,!0))}),r.trigger("updateMultiple",{records:r.records,all:!0}),r.trigger("change",{action:"updatemultiple",records:r.records,all:!0}),r.reapplyFilterOnUpdate&&r.isFiltered&&r.filter()}acceptChanges(){const e=this;e.added.forEach(e=>e.clearChanges(!1)),e.modified.forEach(e=>e.clearChanges(!1)),e.added.clear(),e.modified.clear(),e.removed.clear()}commit(e=!1){const{changes:t}=this;return this.callPreventable("commit",{changes:t},()=>(this.acceptChanges(),t),[],e)}clearChanges(){const e=this;e.remove(e.added.values,!0),e.modified.forEach(e=>e.clearChanges(!1)),e.added.clear(),e.modified.clear(),e.removed.clear(),e.trigger("change",{action:"clearchanges"})}get changes(){const e=this,t=e.modified.values.filter(e=>e.modificationData);return e.added.count||t.length||e.removed.count?{added:e.added.values.slice(),modified:t,removed:e.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(e){this._autoCommit=e,e&&this.changes&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(){this.suspendCount--,this.autoCommit&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}applyChangesFromStore(e){const t=this,r=e.changes;r&&(r.added&&t.add(r.added),r.removed&&t.remove(r.removed.map(e=>e.id)),r.modified&&r.modified.forEach(e=>{t.getById(e.id).set(e.modifications)}))}},rs=e=>class extends(e||B){static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set filters(e){const t=this,r=t.filters;if(r.clear(),t._filtersFunction=null,e){if("Object"===e.constructor.name)for(const t of Object.entries(e))"filterBy"===t[0]&&"function"==typeof t[1]?r.add(new Cr({filterBy:t[1]})):r.add(new Cr("Object"===t[1].constructor.name?Object.assign({property:t[0]},t[1]):{property:t[0],value:t[1]}));else Array.isArray(e)?r.add(...e.map(e=>e instanceof Cr?e:new Cr(e))):e.isCollection?r.add(...e.values):r.add(new Cr({filterBy:e}));r.forEach(e=>e.owner=t)}}get filters(){return this._filters||(this._filters=new Fr({extraKeys:["property"]}))}set filtersFunction(e){this._filtersFunction=e}get filtersFunction(){const e=this,{filters:t,isGrouped:r}=e;if(!e._filtersFunction)if(t.count){const n=Cr.generateFiltersFunction(t);e._filtersFunction=e=>r&&e.meta.specialRow?e.groupChildren.some(n):n(e)}else e._filtersFunction=Zt.returnTrue;return e._filtersFunction}get isFiltered(){return this.filters.values.some(e=>!e.disabled)}traverseFilter(e){const t=this,r=!e.isRoot&&t.filtersFunction(e),n=e.unfilteredChildren||e.children;return n&&n.length?(e.unfilteredChildren||(e.unfilteredChildren=e.children.slice()),e.children=e.unfilteredChildren.filter(e=>t.traverseFilter(e)),e.updateChildrenIndex(e.unfilteredChildren,!0),r||Boolean(e.children.length)):r}traverseClearFilter(e){const t=this;e.unfilteredChildren&&(e.children=e.unfilteredChildren.slice(),e.unfilteredChildren=null),e.children&&e.children.forEach(e=>t.traverseClearFilter(e))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}processFieldFilter(e,t){"string"==typeof e&&(e={property:e,value:t}),(e=e instanceof Cr?e:new Cr(e)).owner=this,this.filters.add(e)}filter(e){const t=this,{filters:r}=t;let n=!1;if(e){let s=typeof e;if("object"===s&&("silent"in e||"replace"in e)&&(n=e.silent,e.replace&&r.clear(),s=typeof(e=e.filters)),e&&(t.isConfiguring=!0,Array.isArray(e)?e.forEach(t.processFieldFilter,t):"function"===s?r.add(new Cr(e)):"string"===s?t.processFieldFilter(e,arguments[1]):t.processFieldFilter(e),t.isConfiguring=!1,!t.isFiltered))return}t.filtersFunction=null,t.performFilter(n)}performFilter(e){const t=this,{storage:r,filters:n,rootNode:s}=t,i=t.count;t.tree?(t.isFiltered?t.traverseFilter(s):t.traverseClearFilter(s),r.replaceValues({values:t.collectDescendants(s).visible,silent:!0})):t.isFiltered?r.addFilter({id:"primary-filter",filterBy:t.filtersFunction}):r.filters.clear(),t.afterPerformFilter(e?null:{action:"filter",filters:n,oldCount:i,records:t.storage.values})}afterPerformFilter(e){this.resetRelationCache(),e&&this.triggerFilterEvent(e)}get filtered(){return this.storage.isFiltered}triggerFilterEvent(e){this.trigger("filter",e),this.filterParamName||(this.trigger("refresh",e),this.trigger("change",e))}filterBy(e){this.filter(e)}removeFilter(e,t){const r=this,n=e instanceof Cr?e:r.filters.get(e);n&&(r.filters.remove(n),r._filtersFunction=null,t||r.filter())}clearFilters(){this.filters.clear(),this.filter()}convertFilterToString(e){const t=this.filters.getBy("property",e);return t&&!t.filterBy?String(t):""}get filterState(){return this.filters.values.map(e=>ze.cleanupProperties(e.config))}};const ns={add:1,replace:1};var ss=e=>class extends(e||B){static get defaultConfig(){return{groupers:null}}construct(e){super.construct(e),this.on("change",this.onDataChanged)}get groupers(){return this._groupers}set groupers(e){const t=this;e&&e.length?t._groupers=e:t.groupers&&(delete t._groupers,t.groupRecords.forEach(e=>{e.meta.collapsed&&t.includeGroupRecords(e)}),t.storage.replaceValues({values:t.removeHeadersAndFooters(t.storage._values),filteredValues:t.storage.isFiltered?t.removeHeadersAndFooters(t.storage._filteredValues):null,silent:!0}),t.group(null,null,null,!1),"groupRecords"in t&&delete t.groupRecords)}storeCollapsedGroups(){const e=this;return e.collapsedGroupsHash={},!(!e.groupRecords||!e.groupRecords.length)&&(e.groupRecords.forEach(t=>{e.expand(t)&&(e.collapsedGroupsHash[t.id]=!0)}),!0)}restoreCollapsedGroups(){const e=this;Object.keys(e.collapsedGroupsHash).forEach(t=>e.collapse(e.getById(t)))}onDataChange({source:e,action:t,removed:r}){const n=this,{groupers:s}=n;if(s){const i=e.values;s.length?"splice"===t&&r&&r.length&&(n.storeCollapsedGroups()&&n.storage.replaceValues({values:n.removeHeadersAndFooters(i),silent:!0}),n.storage.replaceValues({values:n.prepareGroupRecords(i),silent:!0}),n.restoreCollapsedGroups()):e.replaceValues({values:n.removeHeadersAndFooters(i),silent:!0})}super.onDataChange&&super.onDataChange(...arguments)}collapse(e){return!(!e||e.meta.collapsed)&&(this.excludeGroupRecords(e),e.meta.collapsed=!0,!0)}expand(e){return!(!e||!e.meta.collapsed)&&(this.includeGroupRecords(e),e.meta.collapsed=!1,!0)}removeHeadersAndFooters(e){const t=this;return e.filter(e=>!e.meta.specialRow||(t.unregister(e),!1),!0)}prepareGroupRecords(e){const t=this;if(e=t.removeHeadersAndFooters(e),!t.isGrouped)return e;const r=[],n=t.groupers[0].field,s=[];let i=null,o=null,a=0;function l(){const e=o.meta.groupRowFor,n="group-footer-"+("number"==typeof e?e:I.createId(e)),i=t.getById(n)||new t.modelClass({id:n},t,{specialRow:!0,groupFooterFor:e,groupRecord:o});return t.register(i),i.groupChildren=o.groupChildren,s.push(i),r.push(i),t.allRecords.push(i),o.groupChildren.push(i),a++,i}return e.forEach(e=>{const c=null==e[n]?"__novalue__":e[n],d="group-header-"+("number"==typeof c?c:I.createId(c));!e.groupChildren||e.groupChildren.length?(ze.isEqual(c,i)||(o&&(t.useGroupFooters&&l(),o.meta.childCount=a),o=t.getById(d)||new t.modelClass({id:d},t,{specialRow:!0,groupRowFor:c,groupField:n}),t.register(o),o.groupChildren=[],r.push(o),t.allRecords.push(o),s.push(o),i=c,a=0),e.instanceMeta(t.id).groupParent=o,r.push(e),o.groupChildren.push(e),a++):t.unregister(e)}),o&&(o.meta.childCount=a,t.useGroupFooters&&l()),t.groupRecords=s,r}get isGrouped(){return Boolean(this.groupers&&this.groupers.length)}group(e,t,r=!1,n=!0,s=!1){const i=this;let o;if(r?i.groupers.push(o={field:e,ascending:t,complexMapping:e.includes(".")}):e&&(null==t&&(t=!i.groupInfo||i.groupInfo.field!==e||!i.groupInfo.ascending),i.groupInfo=o={field:e,ascending:t,complexMapping:e.includes(".")},i.groupers=[i.groupInfo]),o){const{prototype:t}=i.modelClass;o.complexMapping&&!Object.prototype.hasOwnProperty.call(t,e)&&Object.defineProperty(t,e,{get(){return ze.getPath(this,e)}})}!1!==n&&i.sort(null,null,!1,!0),s||(i.trigger("group",{isGrouped:i.isGrouped,groupers:i.groupers,records:i.storage.values}),i.trigger("refresh",{action:"group",isGrouped:i.isGrouped,groupers:i.groupers,records:i.storage.values}))}addGrouper(e,t=!0){this.group(e,t,!0)}removeGrouper(e){const t=this,r=t.groupers.findIndex(t=>t.field===e);r>-1&&(t.groupers.splice(r,1),t.group())}clearGroupers(){this.groupers=null}isRecordInGroup(e,t){if(!this.isGrouped)return null;return e[this.groupers[0]&&this.groupers[0].field]===t&&!e.meta.specialRow}isInCollapsedGroup(e){const t=e.instanceMeta(this).groupParent;return t&&t.meta.collapsed}getGroupRecords(e){const t=this;return t.isGrouped?t.storage.values.filter(r=>t.isRecordInGroup(r,e)):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0]&&this.groupers[0].field):null}onDataChanged(e){this.isGrouped&&(!e.changes&&ns[e.action]||e.changes&&this.groupers.some(t=>t.field in e.changes))&&this.sort()}internalIncludeExcludeGroupRecords(e,t){const r=this,n=r.indexOf(e),s=r.id;if(-1!==n&&!(e.meta.collapsed&&!t||!e.meta.collapsed&&t)){if(e.groupChildren.forEach(e=>e.instanceMeta(s).hiddenByCollapse=!t),t){const t=e.groupChildren.filter(e=>!r.isAvailable(e));r.storage.values.splice(n+1,0,...t)}else r.storage.values.splice(n+1,e.groupChildren.length);r.storage._indicesInvalid=!0,r._idMap=null}}excludeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!1)}includeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!0)}collectGroupRecords(){return this.records.reduce((e,t)=>(t.meta.specialRow&&(e.push(t),"groupRowFor"in t.meta&&e.push.apply(e,t.groupChildren)),e),[])}},is=e=>class extends(e||B){initRelations(e){const t=this,r=t.modelClass.relations;e&&t.modelRelations&&t.modelRelations.forEach(e=>{e.storeDetacher&&e.storeDetacher()}),t.modelRelations&&0!==t.modelRelations.length&&!e||!r||(t.modelRelations=[],r&&r.forEach(e=>{const r=Object.assign({},e),n="string"==typeof r.store?t[r.store]:r.store;if(r.dependentStore=t,t.modelRelations.push(r),n){r.storeProperty=r.store,r.store=n;const e=n.dependentStoreConfigs;e.has(t)?e.get(t).push(r):e.set(t,[r]),r.collectionName&&n.initRelationCollection(r,t),n.count>0&&n.updateDependentStores("dataset",n.records)}}))}initRelationCollection(e,t){const r=this,n=e.collectionName;r.collectionStores||(r.collectionStores={}),r.collectionStores[n]={store:t,config:e},r[n+"Store"]||(r[n+"Store"]=t),r.count>0&&r.initModelRelationCollection(n,r.records)}initModelRelationCollection(e,t){const r=this;t.forEach(t=>{t.traverse(t=>{!(e in t)&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r.getCollection(this,e)},set:function(t){return r.setCollection(this,e,t)}})})})}resetRelationCache(){this.relationCache={},this.forEach(e=>e.initRelations())}updateRecordRelationCache(e,t){const r=this;t&&t.forEach(t=>{const n=t.related?t.related.id:e.get(t.config.fieldName);void 0!==n&&r.cacheRelatedRecord(e,n,t.config.relationName,n)})}getCollection(e,t){const{config:r,store:n}=this.collectionStores[t];return n.relationCache[r.relationName]&&n.relationCache[r.relationName][e.id]||[]}setCollection(e,t,r){const{config:n,store:s}=this.collectionStores[t];s.relationCache[n.relationName]||(s.relationCache[n.relationName]={});const i=(s.relationCache[n.relationName][e.id]||[]).slice(),o=[],a=[];s.suspendEvents(),i.forEach(e=>{r.includes(e)||(e[n.fieldName]=null,s.remove(e),a.push(e))}),r.forEach(t=>{t instanceof Jn?t.stores.includes(s)||(s.add(t),o.push(t)):([t]=s.add(t),o.push(t)),t[n.fieldName]=e.id}),s.resumeEvents(),a.length&&(s.trigger("remove",{records:a}),s.trigger("change",{action:"remove",records:a})),o.length&&(s.trigger("add",{records:o}),s.trigger("change",{action:"add",records:o}))}cacheRelatedRecord(e,t,r,n=null){const s=this,i=s.relationCache[r]||(s.relationCache[r]={});null!==n&&s.uncacheRelatedRecord(e,r,n),null!=t&&z.include(i[t]||(i[t]=[]),e)}uncacheRelatedRecord(e,t=null,r=null){const n=this;function s(t,r){const s=n.relationCache[t],i=s&&s[r];if(i){const t=i.indexOf(e);t>=0&&i.splice(t,1),0===i.length&&delete s[r]}}null!=r?s(t,r):e.meta.relationCache&&Object.entries(e.meta.relationCache).forEach(([e,t])=>{s(e,t&&t.id)})}updateDependentStores(e,t){this.dependentStoreConfigs.forEach(r=>{r.forEach(r=>{const n=r.dependentStore,s=n.relationCache[r.relationName];return"dataset"===e?(r.collectionName&&this.initModelRelationCollection(r.collectionName,t),void n.forEach(e=>{const t=e.initRelation(r);t&&n.cacheRelatedRecord(e,t.id,r.relationName,t.id)})):"removeall"===e?(n.forEach(e=>{e.removeRelation(r)}),void delete n.relationCache[r.relationName]):("add"===e&&r.collectionName&&this.initModelRelationCollection(r.collectionName,t),void("add"!==e&&"remove"!==e||t.forEach(t=>{const i=s&&s[t.id];switch(e){case"remove":i&&i.forEach(e=>e.removeRelation(r));break;case"add":n.forEach(e=>{e.get(r.fieldName)==t.id&&(e.initRelation(r),n.cacheRelatedRecord(e,t.id,r.relationName))})}})))})})}updateDependentRecordIds(e,t){this.dependentStoreConfigs&&this.dependentStoreConfigs.forEach(r=>{r.forEach(r=>{const n=r.dependentStore,s=n.relationCache[r.relationName],i=s&&s[e]&&s[e].slice();i&&i.forEach(s=>{s.set(r.fieldName,t,!1,!0),n.cacheRelatedRecord(s,t,r.relationName,e)})})})}},os=e=>class extends(e||B){sum(e,t=this.storage.values){return t?t.reduce((t,r)=>{if(r.meta.specialRow)return t;const n=Number(r[e]);return isNaN(n)?t:t+n},0):0}min(e,t=this.storage.values){return t&&t.length?t.reduce((t,r)=>("number"==typeof r[e]&&r[e]<t&&(t=r[e]),t),t[0][e]):0}max(e,t=this.storage.values){return t&&t.length?t.reduce((t,r)=>("number"==typeof r[e]&&r[e]>t&&(t=r[e]),t),t[0][e]):0}average(e,t=this.storage.values){if(!t||!t.length)return 0;let r=0;const n=t.reduce((t,n)=>{if(n.meta.specialRow)return t;const s=parseFloat(n[e]);return isNaN(s)?t:(r++,t+s)},0);return r>0?n/r:0}groupSum(e,t){return this.sum(t,this.getGroupRecords(e))}};const as=(e,t)=>-1!==String(e).toLowerCase().indexOf(t),ls={string:as,number:as,boolean:as,date:(e,t)=>e instanceof Date&&t instanceof Date?String(e)===String(t):-1!==String(e.getMonth()+1).indexOf(t)||-1!==String(e.getDate()).indexOf(t)||-1!==String(e.getFullYear()).indexOf(t)};var cs=e=>class extends(e||B){search(e,t=null){const r=this.storage.values,n=r.length,s=[];if(null==e)return null;let i,o,a,l,c;for("string"==typeof e&&(e=String(e).toLowerCase()),i=0;i<n;i++){o=r[i];for(const r of t||o.fieldNames)a=o[r],l=a instanceof Date?"date":typeof a,c=ls[l],a&&c&&c(a,e)&&s.push({index:i,data:o,field:r,id:o.id})}return s}findByField(e,t){let r,n,s,i=this.storage.values,o=i.length,a=[];for(null!=t&&(t=String(t).toLowerCase()),r=0;r<o;r++){n=i[r],s=n[e];const o=s instanceof Date?"date":typeof s,l={date:()=>Boolean(s)&&s.toLocaleString().includes(t),string:()=>Boolean(s)&&s.toLowerCase().includes(t),number:()=>"number"==typeof s&&s.toString().includes(t),object:()=>s===t,undefined:()=>s===t};(null==t&&s===t||t&&l[o]())&&a.push({id:n.id,index:r,data:n})}return a}find(e){return this.storage.values.find(e)}findRecord(e,t,r=!1){const n=r=>ze.isEqual(r[e],t);return this.tree?this.query(n)[0]:(r?this.storage.allValues:this.storage.values).find(n)}query(e,t=!1){if(this.isTree){const t=[];return this.traverse(r=>{e(r)&&t.push(r)}),t}return(t?this.storage.allValues:this.storage.values).filter(e)}some(e){return this.storage.values.some(e)}},ds=e=>class extends(e||B){static get defaultConfig(){return{sorters:[],useLocaleSort:null}}get isSorted(){return Boolean(this.sorters.length)||this.isGrouped}sort(e,t,r=!1,n=!1){const s=this,i=s.allRecords,o=s.sorters?s.sorters.slice():[];let a,l=null;if(e)if(Array.isArray(e))s.sorters=e.map(e=>s.normalizeSorterConfig(e,"string"==typeof e||t));else{const n=s.normalizeSorterConfig(e,t);r?(a=s.getCurrentSorterByField(n.field),a?(l=a.ascending,a.ascending=n.ascending):s.sorters.push(n)):s.sorters=[n]}return n||!1!==s.trigger("beforeSort",{sorters:s.sorters,records:i,currentSorters:o})?s.performSort(n):(s.sorters=o,void(null!==l&&(a.ascending=l)))}normalizeSorterConfig(e,t){const r=this,n={ascending:t};if("object"==typeof e?(n.field=e.field,n.sortFn=e.fn||e.sortFn,n.useLocaleSort=e.useLocaleSort,n.ascending=null!=e.ascending?e.ascending:t):"function"==typeof e?n.sortFn=e:n.field=e,null==n.ascending){const e=r.getCurrentSorterByField(n.field);n.ascending=!e||!e.ascending}return n}getCurrentSorterByField(e){return"string"==typeof e&&this.sorters.find(t=>t.field===e)||null}addSorter(e,t=!0){this.sort(e,t,!0)}removeSorter(e){let t=this,r=t.sorters.findIndex(t=>t.field==e);r>-1&&(t.sorters.splice(r,1),t.sort())}clearSorters(){this.sorters.length=0,this.sort()}createSorterFn(e){const t=this.useLocaleSort;return(r,n)=>{for(let s=0;s<e.length;s++){const i=e[s],{field:o,ascending:a=!0,useLocaleSort:l=t}=i,c=i.fn||i.sortFn,d=a?1:-1;if(c){const e=c(r,n);if(null!==e)return e*d}const u=r[o],h=n[o];if(null==u)return-d;if(null==h)return d;if(l){if(!0===l)return String(u).localeCompare(h)*d;if("string"==typeof l)return String(u).localeCompare(h,l)*d;if("object"==typeof l)return String(u).localeCompare(h,l.locale,l)*d}if(u>h)return d;if(u<h)return-d}return 0}}performSort(e){const t=this,{rootNode:r,storage:n,sorters:s}=t,i=t.createSorterFn(t.isGrouped?t.groupers.concat(s):s);t.isGrouped&&t.storeCollapsedGroups()&&n.replaceValues({values:t.removeHeadersAndFooters(n.values),silent:!0}),t.tree?(r.traverse(e=>{e.isLoaded&&e.isParent&&(e.children=e.children.sort(i),e.updateChildrenIndex(e.children))}),n.replaceValues({values:t.collectDescendants(r).visible,silent:!0})):n.replaceValues({values:n.values.sort(i),silent:!0}),t.afterPerformSort(e)}afterPerformSort(e){const t=this,{storage:r}=t;if(t._idMap=null,t.isGrouped&&(r.replaceValues({values:t.prepareGroupRecords(r.values),silent:!0}),t.restoreCollapsedGroups()),!e){const e={action:"sort",sorters:t.sorters,records:t.allRecords};t.trigger("sort",e),t.sortParamName||t.trigger("refresh",e)}}};const us=()=>!0;var hs=e=>class extends(e||B){static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],keepUncommittedChanges:!1,excludeCollapsedRecords:!0}}construct(e){const t=this;super.construct(e),t.masterStore&&(t.methodNamesToRelay.forEach(e=>t[e]=(...r)=>t.relayToMaster(e,r)),t.removeAll=(...e)=>{t.masterStore.remove(t.getRange(),...e)},t.masterStore.on({change:t.onMasterDataChanged,prio:1,thisObj:t}),t.masterStore.chainedStores||(t.masterStore.chainedStores=[]),t.masterStore.chainedStores.push(t),t.fillFromMaster())}get isChained(){return Boolean(this.masterStore)}set chainedFilterFn(e){this._chainedFilterFn=this.thisObj?e.bind(this.thisObj):e}get chainedFilterFn(){return this._chainedFilterFn||us}get methodNamesToRelay(){const e=Array.isArray(this.doRelayToMaster),t=Array.isArray(this.dontRelayToMaster);return e&&this.doRelayToMaster.filter(e=>!t||!this.dontRelayToMaster.includes(e))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach(e=>e.fillFromMaster())}fillFromMaster(){const e=this,{masterStore:t,isTree:r}=e;if(!e.isChained)throw new Error("fillFromMaster only allowed on chained store");if(e.keepUncommittedChanges){if(r)throw new Error("Cannot use keepUncommittedChanges on a chained tree store");e.data=[].concat(e.added.values.filter(t=>!e.removed.includes(t)),t.allRecords.filter(t=>!e.removed.includes(t)&&!e.added.includes(t)&&e.chainedFilterFn(t)))}else{let n=t.allRecords.filter(e.chainedFilterFn);if(r&&(e.idRegister={},e.internalIdRegister={},n.forEach(t=>{t.stores.includes(e)?e.register(t):t.joinStore(e)}),e.excludeCollapsedRecords)){const t=e.getChildren(e.rootNode);n=e.doIncludeExclude(t,!0)}e.data=n}}commitToMaster(){const e=this,t=e.masterStore;if(!e.isChained)throw new Error("commitToMaster only allowed on chained store");return t.beginBatch(),t.remove(e.removed.values),t.add(e.added.values),t.endBatch(),e.commit()}relayToMaster(e,t){return this.masterStore[e](...t)}onMasterDataChanged({action:e,changes:t}){const r=this;if("update"===e){if(!(r.chainedFields&&r.chainedFields.some(e=>e in t)))return}r.fillFromMaster()}},gs=e=>class extends(e||B){getState(){const e=this,t={};return e.sorters&&e.sorters.length&&(t.sorters=e.sorters.slice()),e.groupers&&e.groupers.length&&(t.groupers=e.groupers.slice()),e.filters&&e.filters.values.length&&(t.filters=e.filterState),t}applyState(e){const t=this;"sorters"in e&&(t.sorters=e.sorters.slice()),"groupers"in e&&(t.groupers=e.groupers.slice()),("sorters"in e||"groupers"in e)&&t.sort(),"filters"in e&&(t.filters=e.filters.slice(),t.filter())}};const ms=Object.freeze([]);var ps=e=>class extends(e||B){get isTree(){return this.tree||this.masterStore&&this.masterStore.tree}get leaves(){const e=this,t=[];return e.isTree?(e.traverse(e=>{e.isLeaf&&t.push(e)}),t):(e.allRecords.forEach(e=>{e.isLeaf&&t.push(e),e.traverse(e=>{e.isLeaf&&t.push(e)},!0)}),t)}async loadChildren(e){}onNodeAddChild(e,t,r,n,s=!1){const i=this,o=e===i.rootNode&&e.isLoading,{storage:a}=i,l=[],c=[],d=t[0].previousSibling;let u;if(i.collectDescendants(t,l,c,{inCollapsedBranch:!(e.isExpanded(i)&&e.ancestorsExpanded(i))}),!o&&c.length)for(const e of c)i.modified.includes(e)||n[e.id]||(i.removed.includes(e)?i.removed.remove(e):i.added.add(e));if(o&&i.rootVisible&&(l.unshift(e),c.unshift(e)),l.length&&(u=0!==r&&d?a.indexOf(d)+d.getDescendantCount(!0,i):a.indexOf(e),a.suspendEvents(),i.storage.splice(++u,0,l),a.resumeEvents()),i.updateDependentStores("add",t),o&&l.length){if(i.sorters.length&&i.sort(null,null,!1,!0),!s){const e={action:"dataset",data:i._data,records:l};i.trigger("refresh",e),i.trigger("change",e)}}else if(!s){const r={action:"add",parent:e,isChild:!0,isMove:n,records:t,allRecords:c,index:u};i.trigger("add",r),i.trigger("change",r)}}onNodeRemoveChild(e,t,r,n={isMove:!1,silent:!1,unfiltered:!1}){const s=this,{storage:i}=s,o=[],a=[],{isMove:l,silent:c,unfiltered:d}=n,u=d&&s.isFiltered,h=u&&e.unfilteredChildren?e.unfilteredChildren:t;if(s.collectDescendants(h,o,a,{inCollapsedBranch:!(e.isExpanded(s)&&e.ancestorsExpanded(s)),unfiltered:u}),!l){for(const e of t)e.unJoinStore(s);if(a.length){for(const e of a)e.stores.includes(s)&&e.unJoinStore(s),s.added.includes(e)?s.added.remove(e):s.removed.add(e);s.modified.remove(a)}}if(o.length?(r=i.indexOf(o[0]))>-1&&(i.suspendEvents(),i.splice(r,o.length),i.resumeEvents()):r=-1,!c){const n={action:"remove",parent:e,isChild:!0,isMove:l,records:t,allRecords:a,index:r};s.trigger("remove",n),s.trigger("change",n)}}collectDescendants(e,t=[],r=[],n={inCollapsedBranch:!1,unfiltered:!1}){const s=this,{inCollapsedBranch:i,unfiltered:o}=n,a=Array.isArray(e)?e:s.getChildren(e,o);if(a)for(let e,n=0,l=a.length;n<l;n++)e=a[n],i||t.push(e),r.push(e),s.collectDescendants(e,t,r,{inCollapsedBranch:i||!e.isExpanded(s),unfiltered:o});return{visible:t,all:r}}getChildren(e,t=!1){const r=(t||this.isChained)&&e.unfilteredChildren||e.children;return r&&r.length?this.isChained?r.filter(this.chainedFilterFn):r:ms}internalToggleTreeSubRecords(e,t){const r=this,{storage:n}=r,s=n.indexOf(e),i=r.doIncludeExclude(r.getChildren(e),t);if(i.length&&!1!==s){if(n.suspendEvents(),t){n.splice(s+1,0,...i);const e={action:"add",isExpand:!0,records:i,index:s+1};r.trigger("add",e),r.trigger("change",e)}else{n.splice(s+1,i.length);const e={action:"remove",isCollapse:!0,records:i,index:s+1};r.trigger("remove",e),r.trigger("change",e)}n.resumeEvents()}}doIncludeExclude(e,t,r=[]){const n=this,s=e&&e.length;for(let i=0;i<s;i++){const s=e[i];if(!n.isChained||n.chainedFilterFn(s)){const e=s.instanceMeta(n.id);t?r.push(s):e.hidden||r.push(s),e.hidden=!t,s.isExpanded(n)&&n.doIncludeExclude(n.getChildren(s),t,r)}}return r}async toggleCollapse(e,t){const r=this,n=r.getById(e),s=n.instanceMeta(r);if(void 0===t&&(t=!s.collapsed),!s.isLoadingChildren&&!n.isLeaf&&n.isExpanded(r)===t){if(r.trigger("beforeToggleNode",{record:n,collapse:t}),s.collapsed=t,s.collapsed)return r.onNodeCollapse(n),!0;{r.onNodeExpand(n);let e=!0;if(!n.isLoaded){s.isLoadingChildren=!0;try{await r.loadChildren(n)}catch(t){s.collapsed=!0,e=!1,r.trigger("loadChildrenException",{record:n,exception:t})}finally{s.isLoadingChildren=!1}}return e}}}onNodeCollapse(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!1)}onNodeExpand(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!0)}};class fs{static preWalk(e,t,r){const n=[e];let s,i;for(;n.length;)s=n.pop(),r(s),i=t(s),i&&n.push.apply(n,i.slice().reverse())}static preWalkWithParent(e,t,r){const n=[{node:e,parent:null}];for(;n.length;){const{parent:e,node:s}=n.pop();r(e,s);const i=t(s);i&&n.push(...i.slice().reverse().map(e=>({node:e,parent:s})))}}static preWalkUnordered(e,t,r){let n,s,i=[e];for(;i.length;)n=i[i.length-1],r(n),s=t(n),s?i.splice(i.length-1,1,...s):i.length=i.length-1}static postWalk(e,t,r){let n,s,i=new Map,o=[e];for(;o.length;)n=o[o.length-1],i.has(n)?(r(n),o.pop()):(s=t(n),s&&(o=o.concat(s.slice().reverse())),i.set(n,n))}static prePostWalk(e,t,r,n){let s,i,o=new Map,a=[e];for(;a.length;)s=a[a.length-1],o.has(s)?(n(s),a.pop()):(r(s),i=t(s),i&&(a=a.concat(i.slice().reverse())),o.set(s,s))}}fs._$name="WalkHelper";var vs=e=>class extends(e||B){static get defaultConfig(){return{syncDataOnLoad:null}}syncDataset(e){const t=this,{storage:r}=t,{toAdd:n,toRemove:s,updated:i}=t.tree?t.syncTreeDataset(e):t.syncFlatDataset(e);let{threshold:o}=t.syncDataOnLoad,a=!1;if(o&&("string"==typeof o&&(o=parseInt(o,10)/100*t.count),a=n.length+s.length+i.length>o),t.tree){if(n.length){t.add(n,a).forEach(e=>e.clearParentId())}t.remove(s,a)}else a&&r.suspendEvents(),r.splice(t.count-s.length,s,n),a&&r.resumeEvents();o&&!a&&i.forEach(({record:e,toSet:r,wasSet:n})=>t.onModelChange(e,r,n)),t.acceptChanges();const l={added:n,removed:s,updated:i,thresholdSurpassed:a};a&&this.trigger("refresh",{action:"batch",data:e,records:r.values,syncInfo:l}),t.isFiltered&&t.filter(),t.isGrouped?t.group():t.isSorted&&t.sort(),t.trigger("loadSync",l)}syncFlatDataset(e){if(!e)return;const t=this,r=t.modelClass.idField,n=[],s=[],i=[],o={};let{threshold:a}=t.syncDataOnLoad,l=0;return e.forEach(e=>{const n=e[r],c=t.getById(n);if(c){const t=c.set(e,null,Boolean(a));t&&i.push({record:c,wasSet:t,toSet:e}),l++}else s.push(t.createRecord(e));o[n]=1}),l<t.allCount&&t.forEach(e=>{o[e.id]||n.push(e)}),{toAdd:s,toRemove:n,updated:i}}syncTreeDataset(e){if(!e)return;const t=this,{idField:r,parentIdField:n}=t.modelClass,s=[],i=[],o=[],a={};let{threshold:l}=t.syncDataOnLoad;return fs.preWalkWithParent({isRoot:!0,children:e},e=>e.children,(e,s)=>{if(e){const c=s[r],d=t.getById(c);if(d){const e=d.set(s,null,Boolean(l));e&&o.push({record:d,wasSet:e,toSet:s})}else s[n]=e[r],i.push(s);a[c]=1}}),t.traverse(e=>{a[e.id]||s.push(e)}),{toAdd:i,toRemove:s,updated:o}}};const ys=Symbol("STM_PROP");var bs=e=>class extends(e||B){static get defaultConfig(){return{stm:null}}get stm(){return this[ys]}set stm(e){const t=this;t.stm!=e&&(t.stm&&t.stm.hasStore(t)&&t.stm.removeStore(t),t[ys]=e,t.stm&&!t.stm.hasStore(t)&&t.stm.addStore(t))}add(e,t=!1){let r;const n=this.stm;return this.tree||!n||n.disabled?r=super.add(e,t):(r=super.add(e,t),r&&r.length&&n.onStoreModelAdd(this,r,t)),r}insert(e,t,r=!1){let n;const s=this.stm;if(this.tree||!s||s.disabled)n=super.insert(e,t,r);else{const i=(Array.isArray(t)?t:[t]).reduce((e,t)=>{const r=t instanceof Jn?this.indexOf(t):void 0;return void 0!==r&&-1!==r&&e.set(t,r),e},new Map);n=super.insert(e,t),n&&n.length&&(e=this.indexOf(n[0]),s.onStoreModelInsert(this,e,n,i,r))}return n}remove(e,t=!1,r){let n;const s=this.stm;if(this.tree||!s||s.disabled)n=super.remove(e,t,r);else{const i=(Array.isArray(e)?e:[e]).map(e=>this.getById(e)).filter(e=>!!e).reduce((e,t)=>{const r=this.indexOf(t);return void 0!==r&&-1!=r&&e.set(t,r),e},new Map);n=super.remove(e,t,r),n&&n.length&&s.onStoreModelRemove(this,n,i,t)}return n}removeAll(e){const t=this.stm;if(t&&!t.disabled){const{tree:r,rootNode:n,allRecords:s}=this,i=s.length,o=r?n.children.slice():s.slice();super.removeAll(e),i&&0===this.count&&t.onStoreRemoveAll(this,o,e)}else super.removeAll(e)}};class Cs extends(Qn(B).mixes(G,Bn,zn,rs,ts,is,os,cs,ds,ss,hs,gs,ps,bs,vs)){static get properties(){return{relationCache:{},dependentStoreConfigs:new Map}}static get defaultConfig(){return{storeId:null,id:!0,fields:null,autoTree:!0,modelClass:Jn,data:null,tree:!1,callOnFunctions:!0,storage:null,useRawData:!1,allowNoId:!0,preventSubClassingModel:null}}construct(e={}){Object.assign(this,{added:new es,removed:new es,modified:new es,idRegister:{},internalIdRegister:{}}),super.construct(e),this.initRelations()}doDestroy(){const e=this,t=e.registeredRecords;for(let r,n=t.length-1;n>=0;n--)r=t[n],r&&!r.isDestroyed&&r.unJoinStore(e);e.storage.destroy(),delete Cs.storeMap[e.id],e.stm&&e.stm.removeStore(e),super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){this.resumeEvents()&&this.trigger("refresh",{action:"batch",data:this.storage.values,records:this.storage.values})}set storage(e){const t=this;e&&e.isCollection?t._storage=e:t._storage=new Fr(e),t._storage.autoFilter=t.reapplyFilterOnAdd;for(const e of t._storage)e.joinStore(t);t._storage.on({change:"onDataChange",thisObj:t})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){const e=this;if(e.isTree){const t=e.collectDescendants(e.rootNode,void 0,void 0,{unfiltered:!0}).all;return e.rootVisible&&t.unshift(e.rootNode),t}return e.isGrouped?e.collectGroupRecords():e.storage.allValues}onDataChange({source:e,action:t,added:r,removed:n,replaced:s,oldCount:i,item:o,from:a,to:l}){const c=this,d=r&&r.length,u=n&&n.length;let h;if(c._idMap=null,d&&r.forEach(e=>{e.joinStore(c)}),s&&s.forEach(([e,t])=>{e.unJoinStore(c),t.joinStore(c)}),super.onDataChange(...arguments),!c.isTree){if(d){for(const e of r)e.joinStore(c),c.removed.includes(e)?c.removed.remove(e):c.added.add(e);h=!c.filterParamName&&c.filtered&&c.reapplyFilterOnAdd,h&&c.filter({silent:!0})}if(u){for(const e of n)e.unJoinStore(c),c.added.includes(e)?c.added.remove(e):c.removed.add(e);c.modified.remove(n),h=!c.filterParamName&&c.filtered,h&&c.filter({silent:!0})}}switch(t){case"clear":c.relationCache={},c.updateDependentStores("removeall"),c.trigger("removeAll"),c.trigger("change",{action:"removeall"});break;case"splice":if(d){c.updateDependentStores("add",r);const t=r.reduce((e,t)=>{const{previousIndex:r}=t.meta;return r>-1&&r<e&&(e=r),e},r[0].meta.previousIndex),n={records:r,index:e.indexOf(r[0],!e.autoFilter)};t>-1&&(n.oldIndex=t),c.trigger("add",n),c.trigger("change",Object.assign({action:"add"},n)),h&&c.triggerFilterEvent({action:"filter",filters:c.filters,oldCount:i,records:c.storage.allValues})}n.length&&(c.updateDependentStores("remove",n),c.trigger("remove",{records:n}),c.trigger("change",{action:"remove",records:n})),s.length&&(c.trigger("replace",{records:s,all:c.records.length===s.length}),c.trigger("change",{action:"replace",replaced:s,all:c.records.length===s.length}));break;case"filter":c.isGrouped?c.group(null,null,null,null,!0):c.isSorted&&c.performSort(!0);break;case"move":for(let e=c.storage.allValues,t=Math.min(a,l);t<=Math.max(a,l);t++)e[t].parentIndex=t;c.trigger("move",{record:o,from:a,to:l}),c.trigger("change",{action:t,record:o,from:a,to:l})}}onModelChange(e,t,r,n,s){const i=this,o=e.constructor.idField,a={record:e,changes:r,batch:null!=e.batching,fromRelationUpdate:s},l=i.updateModifiedBagForRecord(e);if(!n){if(o in r){const{oldValue:r,value:n}=t[o];i.updateDependentRecordIds(r,n),i.onRecordIdChange({record:e,oldValue:r,value:n}),i.trigger("idChange",{store:i,record:e,oldValue:r,value:n})}i.onUpdateRecord(e,r),i.trigger("update",a),i.trigger("change",Object.assign({action:"update"},a))}i.autoCommit&&l&&i.doAutoCommit()}updateModifiedBagForRecord(e){const t=this;let r=!1;return e.isModified?t.modified.includes(e)||t.added.includes(e)||(e.isPartOfStore(t)&&e.isPhantom?t.added.add(e):t.modified.add(e),r=!0):t.modified.remove(e),r}get idMap(){const e=this.storage.values,t=!this._idMap,r=this._idMap||(this._idMap={});if(t)for(let t,n=0,s=0;n<e.length;n++)t=e[n],r[t.id]={index:n,visibleIndex:s,record:t},t.meta.specialRow||s++;return r}get modelClass(){return this._modelClass}set modelClass(e){const t=this.fields;let r=null;t&&t.length?(r=class extends e{static get fields(){return t}},r.exposeProperties()):r=this.preventSubClassingModel?e:class extends e{},r.exposeRelations(),this._modelClass=r}set storeId(e){this.id=e}get storeId(){return this.id}set id(e){const t=this;t._id&&delete Cs.storeMap[t._id],t._id=!0===e?K.generateId("store-"):e,e&&(Cs.storeMap[e]=t)}get id(){return this._id}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}buildRootNode(){return{}}static getStore(e,t){if(e instanceof Cs)return e;if(this.storeMap[e])return this.storeMap[e];if(Array.isArray(e)){let r;const n=e.map(e=>(e instanceof Jn?r=e.constructor:"string"==typeof e&&(e={text:e}),e));e={autoCreated:!0,data:n,modelClass:r||class extends Jn{},allowNoId:!0},t||(t=Cs)}return t?new t(e):void 0}static get stores(){return Object.values(this.storeMap)}get rootNode(){return this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){const t=this,r=t._rootNode;e!==r&&(r&&t.clear(!1),e instanceof Jn?(e.instanceMeta(t).collapsed=!1,t._rootNode=e):t._rootNode=e=new t.modelClass(Object.assign({expanded:!0,[t.modelClass.idField]:t.id+"-rootNode"},e),t,null,!0),t._tree=!0,e.isRoot=!0,e.joinStore(t),(e.children&&e.children.length||t.rootVisible)&&(e.isLoading=!0,t.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),t.trigger("rootChange",{oldRoot:r,rootNode:e}))}set data(e){const t=this;if(t._thisIsAUsedExpression(t.plugins),t.processConfiguredListeners(),t.tree=!t.isChained&&(t.tree||Boolean(t.autoTree&&e&&e.some(e=>e[t.modelClass.childrenField]))),t.syncDataOnLoad&&t._data)t.syncDataset(e);else{if(t._data=e,t.tree){const r=t.rootNode;r.clearChildren(!0),r.isLoading=!0,r.appendChild(e),t.updateDependentStores("dataset",[r]),r.isLoading=!1,0===e.length?t.trigger("refresh",{action:"dataset",data:[],records:[]}):t.isFiltered&&t.filter()}else t.loadData(e);t.added.clear(),t.removed.clear(),t.modified.clear()}}loadData(e,t="dataset"){const r=this,{storage:n,allowNoId:s}=r,i=r.modelClass.fieldMap.id.dataSource;if(r.storeCollapsedGroups(),r.removeHeadersAndFooters(r.storage.values),r.allCount&&r.clear(!1),r._idMap=null,e){if(!(e[0]instanceof Jn)){r.modelClass.exposeProperties(e[0]);const t=e.length,o=new Array(t);for(let n=0;n<t;n++){const t=e[n];if(!s&&null==t[i])throw new Error("Id required but not found on row "+n);o[n]=r.createRecord(t,!0),o[n].parentIndex=n}n.replaceValues({values:o,silent:!0,isNewDataset:!0})}else n.replaceValues({values:e.slice(),silent:!0,isNewDataset:!0});if(r.storage.allValues.forEach(e=>{e.joinStore(r)}),r.prepareGroupRecords(r.storage.values),r.restoreCollapsedGroups(),!r.filterParamName&&r.isFiltered&&r.filter({silent:!0}),r.isGrouped&&r.group(null,null,!1,!r.sorters.length,!0),!r.sortParamName&&r.sorters.length&&r.sort(null,null,!1,!0),!r.useRawData.disableDuplicateIdCheck){const e=r.idMap;if(Object.keys(e).length<r.storage.values.length){const t=[];throw r.storage.values.forEach(r=>e[r.id]?delete e[r.id]:t.push(r)),new Error("Id collision on "+t.map(e=>e.id))}}const o={action:t,data:e,records:r.storage.values};r.updateDependentStores(o.action,o.records),r.trigger("refresh",o),r.trigger("change",o)}else r._data=null}get data(){return this._data}getRange(e,t,r=!0){return(r?this.storage.allValues:this.storage.values).slice(e,t)}createRecord(e,t=!1){return new this.modelClass(e,this,null,t)}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:t,value:r}){const n=this,s=n._idMap,{idRegister:i}=n;n.storage._indicesInvalid=!0,s&&(delete s[t],s[r]=e),n.added.changeId(t,r),n.removed.changeId(t,r),n.modified.changeId(t,r),delete i[t],i[r]=e,e.index=n.storage.indexOf(e)}onUpdateRecord(e,t){const{internalId:r}=t,{internalIdRegister:n}=this;r&&(this.storage._indicesInvalid=!0,delete n[r.oldValue],n[r.value]=e),this.reapplyFilterOnUpdate&&this.isFiltered&&this.filter()}get useRawData(){return this._useRawData}set useRawData(e){this._useRawData=!0===e?{enabled:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0,disableDefaultValue:!1}:e?Object.assign(e,{enabled:!0}):{enabled:!1}}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){return this.storage.totalCount}get count(){return this.storage.count}get allCount(){return this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,t=!1){return this.storage.getAt(e,t)}register(e){const t=this.isTree&&this.idRegister[e.id];if(t&&t!==e)throw new Error("Id collision on "+e.id);this.idRegister[e.id]=e,this.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){return e&&e.isModel?e:this.idRegister[e]}isVisible(e){return this.isAvailable(e)}isAvailable(e){const t=this.getById(e);return t&&this.storage.includes(t)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?null!=this.idRegister[Jn.asId(e)]:this.indexOf(e)>-1}indexOf(e,t=!1){const r=Jn.asId(e);if(null==r)return-1;if(this.isTree)return this.storage.indexOf(r);const n=this.idMap[r];return n?n[t?"visibleIndex":"index"]:-1}allIndexOf(e){if(this.isTree){const t=this.getById(e);let r=-1;return t&&t.bubble(e=>{e.parent?r+=e.parentIndex+1:e===this.rootNode&&this.rootVisible&&(r+=1)}),r}return this.storage.indexOf(e,!0)}getDistinctValues(e){const t=[],r={};let n;return this.forEach(s=>{s.meta.specialRow||s.isRoot||(n=s.get(e),r[n]||(t.push(n),r[n]=1))}),t}getValueCount(e,t){let r=0;return this.forEach(n=>{ze.isEqual(n.get(e),t)&&r++}),r}get json(){return JSON.stringify(this,null,4)}toJSON(){return(this.isTree?this.rootNode.children:this).map(e=>e.toJSON())}forEach(e,t=this){const r=(r,n)=>{if(!r.isRoot&&!r.meta.specialRow)return e.call(t,r,n)};if(this.isTree)this.rootNode.traverseWhile(r);else{const e=this.storage.values;for(let t=0;t<e.length;t++)if(!1===r(e[t],t))return}}map(e,t=this){return this.storage.values.map(e,t)}reduce(e,t=[],r=this){return r!==this&&(e=e.bind(r)),this.storage.values.reduce(e,t,r)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,t=this.rootNode,r=t===this.rootNode){const n=this;if(n.isTree){if("boolean"==typeof t&&(r=t,t=n.rootNode),n.isChained){const t=e;e=e=>{n.chainedFilterFn(e)&&t(e)}}t.traverse(e,r)}else for(const t of n.storage)t.traverse(e)}traverseWhile(e,t=this.rootNode,r=t===this.rootNode){const n=this;if(n.isTree){if("boolean"==typeof t&&(r=t,t=n.rootNode),n.isChained){const t=e;e=e=>{n.chainedFilterFn(e)&&t(e)}}t.traverseWhile(e,r)}else for(const t of n.storage)if(!1===t.traverse(e))break}getNext(e,t=!1,r=!1){const n=this,s=n.storage.values;let i=n.indexOf(e);if(i>=s.length-1){if(!t)return null;i=-1}const o=s[i+1];return r&&o&&o.meta.specialRow?n.getNext(s[i+1],t,!0):o}getPrev(e,t=!1,r=!1){const n=this,s=n.storage.values;let i=n.indexOf(e);if(0===i){if(!t)return null;i=s.length}const o=s[i-1];return r&&o&&o.meta.specialRow?n.getNext(s[i+1],t,!0):o}getAdjacent(e,t=!0,r=!1,n=!1){return t?this.getNext(e,r,n):this.getPrev(e,r,n)}getNextLeaf(e,t=!1){const r=this.leaves,n=this.getById(e);let s=r.indexOf(n);if(s>=r.length-1){if(!t)return null;s=-1}return r[s+1]}getPrevLeaf(e,t=!1){const r=this.leaves,n=this.getById(e);let s=r.indexOf(n);if(0===s){if(!t)return null;s=r.length}return r[s-1]}getAdjacentLeaf(e,t=!0,r=!1){return t?this.getNextLeaf(e,r):this.getPrevLeaf(e,r)}makeChained(e=(()=>!0),t,r){return new this.constructor(Object.assign(r||{},{tree:!1,autoTree:!1,masterStore:this,modelClass:this.modelClass,chainedFilterFn:e,chainedFields:t}))}chain(){return this.makeChained(...arguments)}}Cs.storeMap={},Cs._$name="Store";const ws=(e,t)=>(Array.isArray(t[1])?t[1].forEach(r=>e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(r))):e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(t[1])),e),Ss=new Promise(e=>e());class Ds extends Cs{static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:!1,writeAllFields:null,parentIdParamName:"id",responseDataProperty:"data",responseTotalProperty:"total",filterParamName:null,sortParamName:null,pageParamName:null,pageStartParamName:null,pageSizeParamName:"pageSize",pageSize:50,useRestfulMethods:!1,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"}}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch(()=>{})}get isLoading(){return this._isLoading}get isCommitting(){return Boolean(this.commitPromise)}set pageParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this._pageParamName=e}get pageParamName(){return this._pageParamName}set pageStartParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this._pageStartParamName=e}get pageStartParamName(){return this._pageStartParamName}get isPaged(){return this.pageParamName||this.pageStartParamName}get allCount(){return"remoteTotal"in this?this.remoteTotal:super.allCount}get lastPage(){if(this.isPaged)return Math.floor((this.allCount+this.pageSize-1)/this.pageSize)}buildQueryString(...e){const t=Object.entries(Object.assign({},...e)).reduce(ws,[]).join("&");return t?"?"+t:""}performSort(e){const t=this;if(t.sortParamName){const{groupRecords:r}=t,n={};return t.isGrouped&&r&&r.length&&r.forEach(e=>{e.meta.collapsed&&(t.includeGroupRecords(e),n[e.id]=!0)}),t.internalLoad({},"",r=>{t.data=r.data,t.afterPerformSort(e,n)})}super.performSort(e)}performFilter(e){const t=this;if(t.filterParamName){const r=t.count,{filters:n}=t;return t.currentPage=1,t.internalLoad({},"",s=>{t.data=s.data,t.afterPerformFilter(e?null:{action:"filter",filters:n,oldCount:r,records:t.storage.values})})}super.performFilter()}encodeFilterParams(e){const t=[];for(const{property:r,operator:n,value:s,caseSensitive:i}of e)t.push({field:r,operator:n,value:s,caseSensitive:i});return JSON.stringify(t)}encodeSorterParams(e){return JSON.stringify(e.map(e=>e))}internalLoad(e,t,r){const n=this,s=Object.assign({},n.params,e),i={action:"read"+t,params:s};return n.readUrl?new Promise((e,o)=>{if(!1===n.trigger("beforeLoad"+t,i))return o(!1);if(n._isLoading=!0,n.trigger(`load${t}Start`,i),n.trigger("beforeRequest",i),n.filterParamName&&n.isFiltered&&(s[n.filterParamName]=n.encodeFilterParams(n.filters.values)),n.sortParamName&&n.isSorted&&(s[n.sortParamName]=n.encodeSorterParams(n.groupers?n.groupers.concat(n.sorters):n.sorters)),n.isPaged){if(!s[n.pageParamName]&&!s[n.pageStartParamName]){const e=Math.min(n.currentPage||1,n.allCount?n.lastPage:1/0);n.pageParamName?s[n.pageParamName]=e:s[n.pageStartParamName]=(e-1)*n.pageSize}s[n.pageSizeParamName]=n.pageSize}const a={headers:n.headers,parseJson:!0};n.useRestfulMethods&&(a.method=n.httpMethods.read),ee.get(n.readUrl+n.buildQueryString(s),Object.assign(a,n.fetchOptions)).then(a=>{const l=a.parsedJson,c=Array.isArray(l),d=c||l&&!1!==l.success;if(n._isLoading=!1,i.response=a,i.json=l,d){if(n.responseTotalProperty in l&&(n.remoteTotal=parseInt(l[n.responseTotalProperty],10)),n.isPaged){if(!(n.remoteTotal>=0))throw new Error("A paged store must receive its responseTotalProperty in each data packet");{const e=n.pageParamName?s[n.pageParamName]:s[n.pageStartParamName]/n.pageSize+1;n.currentPage=Math.min(e,n.lastPage)}}i.data=c?l:l[n.responseDataProperty],r(i),n.trigger("load"+t,i),e(i)}else i.exception=!0,i.exceptionType="server",n.trigger("exception",i),o(i);n.trigger("afterRequest",i)}).catch(e=>{n._isLoading=!1,i.exception=!0,e instanceof Response?(i.exceptionType=e.ok?"server":"network",i.response=e,i.error=e.error):(i.exceptionType="server",i.error=e),n.trigger("exception",i),o(i),n.trigger("afterRequest",i)})}):null}load(e){const t=this;return t.isPaged?t.loadPage((t.currentPage||0)+1,e):t.internalLoad(e,"",e=>{t.data=e.data})}async loadChildren(e){return this.internalLoad({[this.parentIdParamName]:e.id},"Children",t=>{t.parentRecord=e,e.data[e.constructor.childrenField]=t.data,e.processChildren(e.stores)})}async loadPage(e,t){this.allCount&&(e=Math.min(e,this.lastPage));const r=this,n=r.pageParamName?{[r.pageParamName]:e}:{[r.pageStartParamName]:(e-1)*r.pageSize};return n[r.pageSizeParamName]=r.pageSize,r.internalLoad(Object.assign(n,t),"Page",e=>{r.loadData(e.data,"pageLoad")})}async nextPage(e){return this.isPaged&&this.currentPage!==this.lastPage?this.loadPage(this.currentPage+1,e):Ss}async previousPage(e){return this.isPaged&&1!==this.currentPage?this.loadPage(this.currentPage-1,e):Ss}commit(){const e=this,t=e.changes,r=[];if(!t||e.commitPromise)return Ss;if([...t.added,...t.modified,...t.removed].forEach(e=>e.meta.committing=!0),!1!==e.trigger("beforeCommit",{changes:t})){const n={action:"commit",exception:!1,changes:t};let s=e.commitRemoved(n);return s&&r.push(s),s=e.commitAdded(n),s&&r.push(s),s=e.commitModified(n),s&&r.push(s),r.length?(s=1===r.length?r[0]:Promise.all(r),e.commitPromise=new Promise((r,i)=>{s.then(()=>{e.commitPromise=null,n.exception?(e.trigger("exception",n),i(n)):(e.trigger("commit",{changes:t}),r(n))}).catch(()=>{e.commitPromise=null,i(n)})})):(e.modified.forEach(e=>e.clearChanges(!1)),e.modified.clear(),e.added.forEach(e=>e.clearChanges(!1)),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:t}),Ss)}}doAutoCommit(){this.suspendCount<=0&&this.commit().catch(e=>{const{response:t}=e;if(!t||!(t.ok&&t.parsedJson||[500,404].includes(t.status)))throw e})}commitAdded(e){const t=this,r=t.added,n={action:"create",params:t.params};return r.count&&t.createUrl?new Promise(s=>{const i=r.values.map(e=>e.persistableData);e.create=n;let o=n.body={data:i};if(t.trigger("beforeRequest",n),t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(i)),o=e}const a={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(a.method=t.httpMethods.create),ee.post(t.createUrl+t.buildQueryString(t.params),o,Object.assign(a,t.fetchOptions)).then(i=>{const o=i.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;e.response=i,n.json=o,n.response=i,l?(t.processReturnedData(r.values,a?o:o[t.responseDataProperty]),r.clear(),t.trigger("commitAdded"),t.trigger("refresh",n),s(e)):(r.forEach(e=>e.meta.committing=!1),e.exception=n.exception=!0,e.exceptionType=n.exceptionType="server",t.trigger("exception",n),s(e)),t.trigger("afterRequest",n)}).catch(i=>{r.forEach(e=>e.meta.committing=!1),e.exception=n.exception=!0,i instanceof Response?(e.response=i,n.exceptionType=i.ok?"server":"network",n.response=i,n.error=i.error):(n.exceptionType="server",n.error=i),t.trigger("exception",n),s(e),t.trigger("afterRequest",n)})}):null}commitModified(e){const t=this,r=t.modified,n=[];if(r.forEach(e=>{const r=e.modificationData;ze.isEmpty(r)||n.push(t.writeAllFields?e.persistableData:r)}),!n.length||!t.updateUrl)return null;const s={action:"update",params:t.params};return new Promise(i=>{e.update=s;let o=s.body={data:n};if(t.trigger("beforeRequest",s),t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(n)),o=e}const a={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(a.method=t.httpMethods.update),ee.post(t.updateUrl+t.buildQueryString(t.params),o,Object.assign(a,t.fetchOptions)).then(n=>{const o=n.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;e.response=n,s.json=o,s.response=n,l?(t.processReturnedData(t.modified.values,a?o:o[t.responseDataProperty],!0),r.clear(),t.trigger("commitModified"),t.trigger("refresh",s),i(e)):(r.forEach(e=>e.meta.committing=!1),e.exception=s.exception=!0,s.exceptionType="server",t.trigger("exception",s),i(e)),t.trigger("afterRequest",s)}).catch(n=>{r.forEach(e=>e.meta.committing=!1),e.exception=s.exception=!0,n instanceof Response?(e.response=n,s.exceptionType=n.ok?"server":"network",s.response=n,s.error=n.error):(s.exceptionType="server",s.error=n),t.trigger("exception",s),i(e),t.trigger("afterRequest",s)})})}processReturnedData(e,t,r=!1){const n=this.modelClass,s=n.fieldMap.id.dataSource;t.forEach((t,i)=>{const o=e[i];o.clearChanges(!1),o.syncId(t[s]),Object.assign(e[i].data,n.processData(t,r))})}commitRemoved(e){const t=this,r=t.removed,n={action:"delete",params:t.params};return r.count&&t.deleteUrl?new Promise(s=>{e.delete=n;let i=n.body={ids:r.map(e=>e.id)};if(t.trigger("beforeRequest",n),t.sendAsFormData){const e=new FormData;e.append("id",JSON.stringify(i.ids)),i=e}const o={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(o.method=t.httpMethods.delete),ee.post(t.deleteUrl+t.buildQueryString(t.params),i,Object.assign(o,t.fetchOptions)).then(i=>{const o=i.parsedJson,a=Array.isArray(o)||o&&!1!==o.success;e.response=i,n.json=o,n.response=i,a?(r.forEach(e=>e.meta.committing=!1),r.clear(),t.trigger("commitRemoved"),t.trigger("refresh",n),s(e)):(r.forEach(e=>e.meta.committing=!1),e.exception=n.exception=!0,n.exceptionType="server",t.trigger("exception",n),s(e)),t.trigger("afterRequest",n)}).catch(i=>{r.forEach(e=>e.meta.committing=!1),e.exception=n.exception=!0,i instanceof Response?(e.response=i,n.exceptionType=i.ok?"server":"network",n.response=i,n.error=i.error):(n.exceptionType="server",n.error=i),t.trigger("exception",n),s(e),t.trigger("afterRequest",n)})}):null}}Ds._$name="AjaxStore";class Es extends jn{static get defaultConfig(){return{attributes:["placeholder","autoComplete","minLength","maxLength","pattern","tabIndex"],localizableProperties:["label","title","placeholder"]}}static get $name(){return"TextField"}inputTemplate(){const e=this,t="inputWidth"in e?`style="width:${Et.setLength(e.inputWidth)}"`:"";return Cn.tpl`<input type="${e.inputType||"text"}"
            reference="input"
            class="${e.inputCls||""}"
            name="${e.name||e.id}"
            id="${e.id+"_input"}"
            ${t}
            ${e.attributeString}/>`}construct(e){"hidden"===e.inputType&&(e.hidden=!0),super.construct(...arguments)}set value(e){super.value="TextField"===this.$name&&null==e?"":e}get value(){return super.value}set placeholder(e){this._placeholder=e,this.input&&(this.input.placeholder=e)}get placeholder(){return this._placeholder}}Es._$name="TextField",U.register("textfield",Es),U.register("text",Es);class xs extends Es{static get $name(){return"PickerField"}static get defaultConfig(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoClose:!0,autoExpand:null,picker:null,inputType:"text",monitorResize:!0}}doDestroy(){this.globalTapListener&&this.globalTapListener(),this.picker=null,super.doDestroy()}finalizeInit(){super.finalizeInit();const e=this,t=e.element;!1===e.editable?(t.classList.add("b-not-editable"),gr.on({element:e.input,click:"onTriggerClick",thisObj:e})):e.globalTapListener=Yr.on({globaltap:"showKeyboard",thisObj:e})}get picker(){let{_picker:e}=this;return e instanceof Vr||(this.picker=e=this.createPicker(e||{})),e}set picker(e){const{_picker:t}=this;t&&t.destroy&&(t.hide(),t.destroy()),this._picker=e}createPicker(){throw new Error("createPicker must be implemented in PickerField subclass implementations")}onEditComplete(){super.onEditComplete(),this.autoClosePicker()}onElementResize(e){const t=this;t.pickerVisible&&t.picker.requestAnimationFrame(t.picker.realign,null,t.picker),super.onElementResize(e)}internalOnKeyPress(e){const t=this;let r=!0;if("keydown"===e.type&&!t.disabled)if(t.pickerVisible){const{picker:n}=t;"Escape"===e.key?(e.stopImmediatePropagation(),t.hidePicker(),r=!1):n.onInternalKeyDown?n.onInternalKeyDown(e):"ArrowDown"===e.key&&n.focusable&&n.focus()}else"ArrowDown"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),t.onTriggerClick(e));r&&super.internalOnKeyPress(e)}onFocusIn(e){super.onFocusIn(e),this.autoExpand&&(this.minChars=0,this.onTriggerClick(e))}onFocusOut(e){this.autoClosePicker(),super.onFocusOut(e)}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}showKeyboard({event:e}){const t=this.input;Et.isTouchEvent&&document.activeElement===t&&e.target===t&&(Yr.suspendFocusEvents(),t.blur(),t.focus(),Yr.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){const t=this,r=t.picker;t.pickerHideShowListenersAdded||(r.on({show:"onPickerShow",hide:"onPickerHide",thisObj:t}),t.pickerHideShowListenersAdded=!0),r.autoClose=t.autoClose,r.show(),r.isVisible&&e&&t.focusPicker()}onPickerShow(){const e=this;e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=Yr.on({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=gr.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){const e=this;e.pickerVisible=!1,e.element.classList.remove("b-open"),e.trigger("togglePicker",{show:!1}),e.pickerTapOutRemover&&e.pickerTapOutRemover(),e.pickerKeyDownRemover&&e.pickerKeyDownRemover()}onPickerTapOut({event:e}){this.owns(e.target)||this.autoClosePicker()}onPickerKeyDown(e){if("Tab"===e.key){const t=document.activeElement,r=new KeyboardEvent("keydown",e);this.input.dispatchEvent(r),r.defaultPrevented&&e.preventDefault(),document.activeElement===t?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}autoClosePicker(){this.autoClose&&this.hidePicker()}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}focus(){const e=this.input;Et.isTouchEvent&&this.editable&&(e.readOnly=!0,this.setTimeout(()=>e.readOnly=!1,500)),super.focus()}}xs._$name="PickerField";class Ts extends(G(B)){static get defaultConfig(){return{ownerCmp:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null,scrollDuration:50,testConfig:{scrollDuration:1}}}set itemSelector(e){this._itemSelector=e}get itemSelector(){return this._itemSelector||"."+this.ownerCmp.itemCls}onKeyDown(e){const t=this,r=t.ownerCmp,n=t.activeItem,s=t.target.querySelector(t.itemSelector),i=(e.key||"").trim()||e.code,o=`${e.ctrlKey?"CTRL+":""}${e.shiftKey?"SHIFT+":""}${e.altKey?"ALT+":""}${i}`;if(s&&t.target.offsetParent){if(null==t.inlineFlow){const e=s.parentNode,r=Et.getStyleValue(s,"position"),n=Et.getStyleValue(s,"display"),i=Et.getStyleValue(s,"float");t.inlineFlow="absolute"===r||"inline"===n||"inline-block"===n||"left"===i||"right"===i||"flex"===Et.getStyleValue(e,"display")&&"row"===Et.getStyleValue(e,"flex-direction"),t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown")}if(t.processEvent&&!(e=t.processEvent.call(r,e)))return;if(n)switch(i){case t.prevKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),t.navigatePrevious(e);break;case t.nextKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),t.navigateNext(e);break;default:{const n=t.keys&&t.keys[o];n&&!t.disabled?t.callback(n,t.thisObj||r,[e]):r.onInternalKeyDown&&r.onInternalKeyDown(e)}}else t.activeItem=t.previousActiveItem||t.getDefaultNavigationItem(e);t.activeItem!==n&&t.trigger("navigate",{event:e,item:t.activeItem})}}getDefaultNavigationItem(e){const{target:t,itemSelector:r,prevKey:n,nextKey:s}=this;return 4&t.compareDocumentPosition(e.target)&&e.key===n?t.querySelector(r+":last-of-type"):2&t.compareDocumentPosition(e.target)&&e.key===s?t.querySelector(""+r):void 0}navigatePrevious(e){const t=this,r=t.previous;e.preventDefault(),r&&t.ownerCmp.scrollable.scrollIntoView(r,{animate:t.scrollDuration}).then(()=>{t.activeItem=r,t.trigger("navigate",{event:e,item:t.activeItem})})}navigateNext(e){const t=this,r=t.next;e.preventDefault(),r&&t.ownerCmp.scrollable.scrollIntoView(r,{animate:t.scrollDuration}).then(()=>{t.activeItem=r,t.trigger("navigate",{event:e,item:t.activeItem})})}get owner(){return this.ownerCmp}get previous(){const e=this.treeWalker;if(e.currentNode=this.activeItem,e.previousNode(),e.currentNode!==this.activeItem)return e.currentNode}get next(){const e=this.treeWalker;if(e.currentNode=this.activeItem,e.nextNode(),e.currentNode!==this.activeItem)return e.currentNode}onTargetFocusIn(e){e.target.matches(this.itemSelector)&&(this.skipScrollIntoView=!0,this.activeItem=e.target,this.skipScrollIntoView=!1)}onTargetFocusOut(e){e.relatedTarget&&this.target.contains(e.relatedTarget)||(this.activeItem=null)}onTargetMouseDown(e){if(!1===this.ownerCmp.itemsFocusable)this.onFocusGesture(e);else{const t=e.target.closest(this.itemSelector);t&&(e.preventDefault(),Et.focusWithoutScrolling(t))}}onTargetClick(e){const t=this;t.disabled||(t.skipScrollIntoView=!0,t.processEvent&&(e=t.processEvent.call(t.ownerCmp,e)),e&&(t.activeItem=e.target.closest(t.itemSelector),t.trigger("navigate",{event:e,item:t.activeItem})),t.skipScrollIntoView=!1)}onFocusGesture(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&!1===this.ownerCmp.itemsFocusable)&&e.preventDefault()}acceptNode(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}get activeItem(){return this._activeItem}set activeItem(e){const t=this,{ownerCmp:r}=t,n=t.activeItem,s=n&&t.target.contains(n);if(s&&(t.previousActiveItem=n),null!=e){if(r.getItem&&(e=t.ownerCmp.getItem(e)),!e)return;if(t.skipScrollIntoView||r.scrollable.scrollIntoView(e,{block:"nearest",focus:Et.isFocusable(e)&&e!==document.activeElement,silent:t.scrollSilently}),e===n&&s)return;n&&t.activeItem.classList.remove(t.focusCls),e.classList.add(t.focusCls),t._activeItem=e}else n&&(n.classList.remove(t.focusCls),n===document.activeElement&&t.ownerCmp.revertFocus()),t._activeItem=null}get target(){return this._target}set target(e){const t=this,r={element:e,thisObj:t,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut",mousedown:"onTargetMouseDown",click:"onTargetClick"};t._target=e,Object.prototype.hasOwnProperty.call(t,"acceptNode")||(t.acceptNode=t.acceptNode.bind(t),t.acceptNode.acceptNode=t.acceptNode),gr.on(r),t.treeWalker=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,t.acceptNode,!1),t.keyEventTarget||(t.keyEventTarget=e),(t.targetMutationMonitor=new MutationObserver(t.onTargetChildListChange.bind(t))).observe(e,{childList:!0})}onTargetChildListChange(){const e=this.activeItem;e&&!this.target.contains(e)&&(this.activeItem=this.target.querySelector(`${this.itemSelector}[data-id="${e.dataset.id}"]`))}get keyEventTarget(){return this._keyEventTarget}set keyEventTarget(e){this._keyEventTarget=e,gr.on({element:e,keydown:"onKeyDown",thisObj:this})}}Ts._$name="Navigator";const Rs=document.createRange();class Ms extends Vr{static get $name(){return"List"}static get defaultConfig(){return{itemCls:"b-list-item",selectedCls:"b-selected",items:null,store:null,navigator:!0,scrollable:{x:!1,y:!0},itemsFocusable:!0,multiSelect:!1,itemTpl:e=>e.text,selected:{},activateOnMouseover:null}}construct(e,...t){const r=this;Array.isArray(e)&&(e={items:e}),super.construct(e,...t);const n=r.element,s=n.classList;r.multiSelect&&s.add("b-multiselect"),r.store.count?r.refresh():s.add("b-empty"),gr.on({element:n,delegate:r.itemSelector,mouseover:"onMouseOver",click:"onClick",thisObj:r})}doDestroy(){this.detachListeners("store"),super.doDestroy()}contentTpl(){return Cn.tpl`${this.store.records.map((e,t)=>this.itemWrapperTpl(e,t))}`}itemWrapperTpl(e,t){return Cn.tpl`<div class="${this.getItemClasses(e,t)}" data-index="${t}" data-id="${e.id}" ${this.itemsFocusable?'tabindex="-1"':""}>
            ${this.itemContentTpl(e,t)}
            </div>`}itemContentTpl(e,t){return Cn.tpl`${this.multiSelect?'<div class="b-selected-icon b-icon b-icon-check"></div>':""}${this.itemTpl(e,t)}`}getItemClasses(e){const t=this,r=t._navigator&&t._navigator.activeItem,n=r&&r.dataset.id==e.id,s=t.selected.includes(e);return`${t.itemCls} ${e.cls||""} ${s?t.selectedCls:""} ${n?t.navigator.focusCls:""}`}onBeforeStoreLoad(){this.mask(this.L("L{loading}"))}onAfterStoreRequest(){this.unmask()}onStoreChange({source:e,action:t,records:r,record:n}){switch(t){case"remove":this.selected.remove(r);break;case"clear":this.selected.clear();break;case"update":return void this.refreshItem(n)}this.refresh()}onStoreRefresh(){this.refresh()}refresh(){const e=this;if(e.isVisible){const{activeItem:t}=e.navigator;e.paintListener=null,e.clearItems().insertNode(Et.createElementFromTemplate(e.contentTpl(),{fragment:!0})),t&&e.restoreActiveItem(t),e.refreshCount=(e.refreshCount||0)+1,e.element.classList[e.store.count>0?"remove":"add"]("b-empty")}else e.paintListener||(e.paintListener=e.on({paint:"refresh",thisObj:e,once:!0}))}clearItems(){const e=this,t=e.contentElement.querySelector(e.itemSelector),r=e.contentElement.lastChild;if(t){const r=e.contentElement.querySelectorAll(e.itemSelector+":not(.b-mask)");Rs.setStartBefore(t),Rs.setEndAfter(r[r.length-1]),Rs.deleteContents()}else r?(Rs.setStartAfter(r),Rs.setEndAfter(r)):(Rs.setStart(e.contentElement,0),Rs.setEnd(e.contentElement,0));return Rs}refreshItem(...e){for(const t of e){const e=this.getItem(t);if(e){const r=this.store.indexOf(t),n=Et.createElementFromTemplate(this.itemWrapperTpl(t,r));Et.sync(n,e)}}}getItem(e){if(null!=e)return"number"==typeof e?this.contentElement.querySelector(`[data-index="${e}"]`):(1===e.nodeType&&(e=e.dataset.id),null!=e.id&&(e=e.id),this.contentElement.querySelector(`[data-id="${e}"]`))}getRecord(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}set items(e){const t=this;t.store&&t.store.autoCreated&&t.store.destroy(),t.store=Cs.getStore(e)}set selected(e){e&&e instanceof Fr||(e=new Fr(e)),this._selected=e,e.on({change:"onSelectionChange",thisObj:this})}get itemSelector(){return"."+this.itemCls}get selected(){return this._selected}get store(){return this._thisIsAUsedExpression(this.items),this._store}set store(e){const t=this;if(e instanceof Cs||(e=new Cs(e)),t._store=e,t.detachListeners("store"),e){const r={name:"store",change:"onStoreChange",refresh:"onStoreRefresh",thisObj:t};e.readUrl&&(r.beforeLoad="onBeforeStoreLoad",r.afterRequest="onAfterStoreRequest"),t.store.on(r)}t.refresh()}get navigator(){return this._navigator}set navigator(e){const t=this,{element:r}=t;t._navigator=r?new(e.class||Ts)(Object.assign({ownerCmp:t,target:r,keyEventTarget:r},e)):e}get minHeight(){return super.minHeight}set minHeight(e){super.minHeight=this._minHeight=e}get minAlignHeight(){const e=this.element.lastElementChild,t=this.minHeight;if(null!=t)return this.store.count?Math.min(e.offsetTop+e.offsetHeight,t):0}alignTo(...e){super.minHeight=this.minAlignHeight,super.alignTo(...e)}hide(...e){this.navigator.activeItem=null,super.hide(...e)}show(){const{refreshCount:e}=this,{previousActiveItem:t}=this.navigator;super.minHeight=this._minHeight,super.show(),this.refreshCount===e&&this.restoreActiveItem(t,!0)}restoreActiveItem(e=this.navigator.previousActiveItem,t="nearest"){const r=this,{navigator:n,lastAlignSpec:s}=r;if(null!=e){if("string"!=typeof t){const e=s?s.zone:1;t=1&e?"nearest":e?"start":"end"}(e=r.getItem(e))&&(r.scrollable.scrollIntoView(e,{block:t}),n.activeItem=e)}}onMouseOver(e){const t=this,r=e.currentTarget;!Et.isTouchEvent&&r&&t.navigator&&t.activateOnMouseover&&t.setTimeout({fn:"handleMouseOver",delay:30,args:[r],cancelOutstanding:!0})}handleMouseOver(e){this.navigator.activeItem=e}onClick(e){const t=e.target.closest(this.itemSelector);t&&this.onItemClick(t,e)}onInternalKeyDown(e){const t=this.navigator.activeItem;switch(e.key){case" ":if(!e.target.readOnly)break;case"Enter":t&&(this.onItemClick(t,e),e.stopImmediatePropagation(),e.preventDefault())}}onItemClick(e,t){const r=this,n=parseInt(e.dataset.index),s=r.store.getAt(n),i=r.selected,o=i.includes(s);r.trigger("item",{item:e,record:s,index:n,event:t}),e.contains(t.target.closest("[data-noselect]"))||(r.multiSelect?i[o?"remove":"add"](s):i.splice(0,i.count,s)),r.lastClicked=s}onSelectionChange({action:e,removed:t,added:r,replaced:n}){const s=this,{selectedCls:i}=s;let o,a;if("clear"===e)for(a of s.element.querySelectorAll("."+i))a.classList.remove(i);else{for(o of t)a=s.getItem(o),a&&a.classList.remove(i);for(o of r)a=s.getItem(o),a&&a.classList.add(i)}}}Ms.prototype.navigatorClass=Ts,Ms._$name="List",U.register("list",Ms);class ks extends Ms{static get $name(){return"ChipView"}static get defaultConfig(){return{itemCls:"b-chip",closable:!0,iconTpl:null,closeHandler:null}}itemContentTpl(e,t){return Cn.tpl`${this.iconTpl?this.iconTpl(e):""}
            ${this.itemTpl(e,t)}
            ${this.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(e){"Delete"===e.key||"Backspace"===e.key&&this.selected.count?this.callback(this.closeHandler,this.owner,[this.selected.values,{isKeyEvent:!0}]):super.onInternalKeyDown(e)}onClick(e){const t=this,r=e.target.closest("."+t.itemCls);if(t.closable&&e.target.classList.contains("b-close-icon")){const e=t.store.getAt(parseInt(r.dataset.index));t.callback(t.closeHandler,t.owner,[[e]])}else super.onClick(e)}}ks._$name="ChipView",U.register("chipview",ks);const Is=Symbol("Combo.queryAll"),Fs=Symbol("Combo.queryLast");class As extends xs{static get $name(){return"Combo"}static get defaultConfig(){return{items:null,store:null,valueField:null,displayField:"text",pickerWidth:null,minChars:null,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},filterParamName:null,encodeFilterParams:null,hideTrigger:null,overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:Is,filterOperator:"startsWith",caseSensitive:!1,multiSelect:null,hidePickerOnSelect:null,chipView:null,filterSelected:null,emptyText:null,value:null,validateFilter:!0,clearTextOnPickerHide:!0}}afterConfigure(){super.afterConfigure(),"_value"in this||(this._value=this.valueField===this.displayField?"":null)}encodeFilterParams(e){return e.map(e=>e.value)}eachWidget(e,t=!0){for(const r of[this.chipView,this._picker])if(r){if(!1===e(r))return;t&&r.eachWidget&&r.eachWidget(e,t)}}set element(e){const t=this;super.element=e,t.multiSelect&&(t.element.classList.add("b-multiselect"),t.chipView=new Ps(ze.assign({parent:t,insertBefore:t.input,store:t.chipStore=new Cs({storage:t.valueCollection}),navigator:{class:Ls,keyEventTarget:t.input}},t.chipView)),t.chipView.element.appendChild(t.input),gr.on({element:t.chipView.element,mousedown:"onChipViewMousedown",thisObj:t}))}onChipViewMousedown(e){e.preventDefault(),this.containsFocus||this.focus()}onChipClose(e,t={}){(t.isKeyEvent&&""===this.input.value||!t.isKeyEvent)&&this.valueCollection.remove(e)}get element(){return super.element}set filterParamName(e){this._filterParamName=e,!1!==this.hideTrigger&&(this.hideTrigger=Boolean(e))}get filterParamName(){return this._filterParamName}set hideTrigger(e){this._hideTrigger=e,this.element.classList[e?"add":"remove"]("b-hide-trigger")}get hideTrigger(){return this._hideTrigger}set keyStrokeFilterDelay(e){const t=this;e&&(t.filterList=t.buffer(t.doFilter,e)),t._keyStrokeFilterDelay=e}get keyStrokeFilterDelay(){return this._keyStrokeFilterDelay}set minChars(e){this._minChars=e}get minChars(){return"_minChars"in this?this._minChars:this.filterParamName?4:1}set items(e){const t=this;if(null==e){if(t.store&&!t.store.isItemStore)return;e=[]}if(e instanceof Cs)return t.store=e;const r=t.displayField;let n,s,i=t.valueField;if(Array.isArray(e)?s=e.map(e=>{let s=e;return e instanceof Jn?(n=e.constructor,i||(t.valueField=i=n.idField)):"string"==typeof e||"number"==typeof e?(i||(t.valueField=i=t.displayField),s={[i]:e,[r]:e}):(i||(t.valueField=i="value"),Array.isArray(e)&&(s={[i]:e[0],[r]:e[1]})),s.selected&&(t.value=s),s}):(i||(t.valueField=i="value"),s=[],Object.entries(e).forEach(([e,t])=>{s.push({[i]:e,[r]:t})})),t.store)t.store.data=s;else{const e=i===r?{name:"value",dataSource:r}:i;t.store=new Cs({isItemStore:!0,data:s,idField:i,modelClass:n||class extends Jn{static get idField(){return t.valueField}static set idField(e){super.idField=e}static get fields(){return[e,r]}}})}}get items(){return this.store.allRecords}set value(e){const t=this;if(e===t.value)return void t.syncInputFieldValue(!0);if(!t.multiSelect&&Array.isArray(e)&&e.length>1)throw new Error("Multiple values cannot be set to a non-multiselect Combo");t._thisIsAUsedExpression(t.items);const{valueField:r,displayField:n,store:s,valueCollection:i}=t;if(t.filterParamName){if(null!=e){const r=t.isConfiguring;return t.primaryFilter.setConfig({value:e,disabled:!1}),s.performFilter(!0).then(()=>{const{isConfiguring:e}=t;t.isConfiguring=r,i.splice(0,i.count,s.allRecords),t.isConfiguring=e})}}else s.filtered&&(t.primaryFilter.disabled=!0,s.filter());let o;if(null!=e){const a=Array.isArray(e)?e.slice():[e];for(let e=0,t=a.length;e<t;e++){let i=a[e];if(i instanceof Jn)s.storage.includes(i)||s.add(i);else{const l=i instanceof Object;l&&(i=i[r]),o=s.storage.getBy(n,i)||s.storage.getBy(r,i),o?(l&&o.set(a[e]),a[e]=o):(a.splice(e,1),t--,e--)}}const l=i.generation;i.splice(0,i.count,a),i.generation===l&&t.syncInputFieldValue(),a.length||(t._value=e)}else if(i.count)i.clear();else{const r=t._value;t._value=null,t.syncInputFieldValue(),t.updateEmpty(),t.isConfiguring||t.trigger("change",{value:e,oldValue:r,userAction:t._isUserAction,valid:t.isValid})}}get value(){const e=this;return e.multiSelect?e.valueCollection.map(t=>t[e.valueField]):e.valueCollection.count?e.valueCollection.first[e.valueField]:e._value}onComboStoreChange({action:e}){"filter"!==e&&this.syncInputFieldValue(!0)}syncInputFieldValue(e){this.multiSelect||super.syncInputFieldValue(e)}get isEmpty(){return 0===this.valueCollection.count}get isValid(){const e=this;return e.isConfiguring||!e.required||e.valueCollection.count?e.clearError("L{Field.fieldRequired}",!0):e.setError("L{Field.fieldRequired}",!0),super.isValid}get inputValue(){const e=this;let t=e.value;return t=e.selected?e.selected[e.displayField]:t,e.displayValueRenderer&&(t=e.displayValueRenderer(e.selected)),null==t?"":t}set displayValueRenderer(e){this._displayValueRenderer=e}get displayValueRenderer(){return this._displayValueRenderer}get valueCollection(){return this._valueCollection||(this._valueCollection=new Fr({listeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),this._valueCollection}set store(e){const t=this,{filterParamName:r}=t,n=[],s={thisObj:this};if(Array.isArray(e))return t.initialConfig.store=null,t.items=e;if(!e||e instanceof Cs||(e=new(e.readUrl?Ds:Cs)(e)),r&&(e.filterParamName=r,t.encodeFilterParams&&(e.encodeFilterParams=t.encodeFilterParams),s.filter="onRemoteFilter"),t.valueField||(t.valueField=e.modelClass.idField),!t.primaryFilter){const e="primary";t.primaryFilter=new Cr({id:e,property:t.displayField,operator:t.filterOperator,disabled:!0,caseSensitive:t.caseSensitive})}n.push(t.primaryFilter),r?t.filterSelected&&(e.storage.autoFilter=!0,e.storage.addFilter({id:t.id+"-selected-filter",filterBy:e=>!t.valueCollection.includes(e)})):t.filterSelected&&(t.selectedItemsFilter=e=>!t.valueCollection.includes(e),n.push(t.selectedItemsFilter),e.reapplyFilterOnAdd=!0),e.filter(n),t._store=e,t._picker&&(t.picker.store=e),e.storage.addIndex(t.displayField),e.storage.addIndex(t.valueField),t.displayValueRenderer&&(s.change="onComboStoreChange",t.syncInputFieldValue()),e.on(s)}get store(){return this._store}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){return this.valueCollection.first}onEditComplete(){const e=this,t=e.valueCollection.count;super.onEditComplete(),t&&(e.clearError("L{Field.validateFilter}"),e.syncInputFieldValue()),e.required&&!t&&e.setError("L{Field.fieldRequired}")}onTriggerClick(){const e=this;if(e.pickerVisible)e.hidePicker();else if(!e.readOnly&&!e.disabled)switch(e.triggerAction){case Is:e.doFilter(null);break;case Fs:e.doFilter(e.lastQuery);break;default:e.doFilter(e.input.value)}}internalOnInput(e){const t=this,r=t.input.value,n=r.length;t.editable&&(t.updateEmpty(),t.syncInputWidth(),t.inputting=!0,n>=t.minChars?t.filterList(r):(t.validateFilter&&!t.filterParamName&&t[n?"setError":"clearError"]("L{Field.validateFilter}"),t.hidePicker()),t.inputting=!1,t.trigger("input",{value:r,event:e}))}syncInputWidth(){const e=this;if(e.multiSelect){const t=e.input,r=e._inputPadding||(e._inputPadding=Et.getEdgeSize(t,"padding","lr")),n=t.value||"",s=Et.measureText(n+"W",t,!1,e.element)+r.width;t.style.flex=`1 1 ${Math.ceil(s)}px`}}filterList(e){this.doFilter(e)}doFilter(e){const t=this,{store:r,filterParamName:n}=t,s=null==e||""===e;t.lastQuery=e,t.primaryFilter.setConfig({value:e,disabled:s}),n&&r.clear(!0),r.filter(),t.showPicker(),r.count?s||(t.picker.navigator.activeItem=0):n||s||!t.validateFilter||t.setError("L{Field.validateFilter}")}onRemoteFilter(){const e=this,t=e._picker;e.store.count?t&&(t.navigator.activeItem=0):e.validateFilter&&e.setError("L{Field.validateFilter}"),e.filterSelected&&e.valueCollection.count&&(e.store.storage.onFiltersChanged(),t&&t.refresh())}onValueCollectionChange({source:e}){const t=this,{multiSelect:r}=t,n="hidePickerOnSelect"in t?t.hidePickerOnSelect:!r,s=r?e.values.slice():e.first,i=e.values.slice(),o=t._isUserAction||n&&t.pickerVisible||!1,a=t._value;n&&t.hidePicker(),!e.count&&t.required?t.setError("L{Field.fieldRequired}"):(t.clearError("L{Field.fieldRequired}"),t.clearError("L{Field.validateFilter}")),t.validateFilter&&s&&t.clearError("L{Field.validateFilter}"),t.filterSelected&&(t.filterParamName?(t.store.storage.onFiltersChanged(),t._picker&&t._picker.refresh()):t.store.filter()),t._value=null;const l=t._value=t.value;t.syncInputFieldValue(),t.updateEmpty(),t.isConfiguring||(t.trigger("change",{value:l,oldValue:a,userAction:o,valid:t.isValid}),t.trigger("select",{record:s,records:i,userAction:t.containsFocus}),"select"===t.defaultAction&&t.trigger("action",{value:l,record:s,records:i}))}onValueCollectionNoChange({toAdd:e}){!this.multiSelect&&e.length&&this.pickerVisible&&this.picker.hide()}showPicker(){const e=this,{picker:t}=e;super.showPicker(),e.overlayAnchor&&!t.align.offset&&(t.align.offset=-t.anchorSize[1],t.realign()),!e.multiSelect&&e.selected&&t.restoreActiveItem(e.selected,!0),e.input.focus()}createPicker(e){const t=this,{multiSelect:r}=t,n=t.pickerWidth||e.width,s=J.createWidget(ze.merge({type:"list",owner:t,floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,store:t.store,selected:t.valueCollection,multiSelect:r,cls:t.listCls,itemTpl:t.listItemTpl||(e=>e[t.displayField]),forElement:t[t.pickerAlignElement],align:{align:"t-b",axisLock:!0,matchSize:null==n,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},width:n,navigator:{keyEventTarget:t.input},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},e));return s.element.dataset.emptyText=t.emptyText||t.L("L{noResults}"),s}onPickerHide(){const e=this;super.onPickerHide(),e.multiSelect&&e.clearTextOnPickerHide&&(e.input.value="")}}As.queryAll=Is,As.queryLast=Fs;class Ps extends ks{static get $name(){return"MultiSelectChipView"}static get defaultConfig(){return{itemsFocusable:!1,multiSelect:!0,closeHandler:"up.onChipClose",itemTpl:function(e){return e[this.owner.displayField]}}}}class Ls extends Ts{static get defaultConfig(){return{allowShiftKey:!0}}onTargetClick(e){const t=e.target.closest(this.itemSelector);!t||e.shiftKey||t.contains(e.target.closest("[data-noselect]"))||this.ownerCmp.selected.clear(),super.activeItem=t}onKeyDown(e){"Enter"!==e.key&&super.onKeyDown(e)}set activeItem(e){const t=this.ownerCmp;e=t.getItem(e),super.activeItem=e,e&&t.selected.add(t.getRecord(e))}get activeItem(){return super.activeItem}navigatePrevious(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.previous?super.navigatePrevious(e):this.activeItem=null}navigateNext(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.next?super.navigateNext(e):this.activeItem=null}}As._$name="Combo",U.register("combo",As),U.register("combobox",As),U.register("dropdown",As);class Os{constructor(e){let{date:t,weekStartDay:r,sixWeeks:n}=e;this.constructor.updateDayNumbers(r),this.sixWeeks=n,this.date=t}set date(e){const t="string"==typeof e;if(e=new Date(e),t){if(isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a valid argument to the Date constructor");e=je.add(e,e.getTimezoneOffset(),"minute")}const r=this,n=je.getFirstDateOfMonth(e),s=je.getLastDateOfMonth(n),i=r.dayNumbers[n.getDay()],o=r.dayNumbers[s.getDay()];if(r._date=e,r.startDayOfMonth=1-i,r.endDayOfMonth=s.getDate()+(6-o),r.sixWeeks)for(;r.weekCount<6;)r.endDayOfMonth+=7;const a=new Date(r.year,0,1),l=new Date(r.year,1,31),c=r.month?new Os({date:a,weekStartDay:r.weekStartDay}):r;r.dayNumbers[a.getDay()]>3?r.weekBase=c.startDate:r.weekBase=new Date(r.year,0,c.startDayOfMonth-7),r.has53weeks=l.getDay()<4}set year(e){this.date.setFullYear(e),this.date=this.date}get year(){return this.date.getFullYear()}set month(e){this.date.setMonth(e),this.date=this.date}get month(){return this.date.getMonth()}get date(){return this._date}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){return new Date(this.year,this.month,this.startDayOfMonth)}get endDate(){return new Date(this.year,this.month,this.endDayOfMonth)}eachDay(e){const t=this;for(let r=t.startDayOfMonth;r<=t.endDayOfMonth;r++)e(new Date(t.year,t.month,r))}eachWeek(e){const t=this,{weekCount:r}=t;for(let n=t.startDayOfMonth,s=0;s<r;s++){const r=[],s=t.getWeekNumber(new Date(t.year,t.month,Math.max(n,1)));for(let e=0;e<7;e++,n++)r.push(new Date(t.year,t.month,n));e(s,r)}}getWeekNumber(e){const t=this,{weekStartDay:r}=t;if((e=je.clearTime(e))<t.startDate||e>t.endDate)return new Os({date:e,weekStartDay:r}).getWeekNumber(e);let n=Math.floor((e-t.weekBase)/864e5/7),s=e.getFullYear();if(!n){const e=new Date(t.year,0,0);return new Os({date:e,weekStartDay:r}).getWeekNumber(e)}return 53!==n||t.has53weeks||(n=1,s++),[s,n]}static applyLocale(){this.updateDayNumbers()}static updateDayNumbers(e=je.weekStartDay){const t=this.prototype,r=t.dayNumbers=[],n=t.canonicalDayNumbers=[];t.weekStartDay=e;for(let t=0;t<7;t++){const s=(e+t)%7;n[t]=s,r[s]=t}}}ne.on({locale:"applyLocale",thisObj:Os}),Os._$name="Month";class _s extends fn{static get $name(){return"CalendarPanel"}static get defaultConfig(){return{weekStartDay:null,sixWeeks:!0,showWeekNumber:!1,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,tip:null,cellCls:"b-calendar-cell",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today"}}construct(e){$s(),this.weekStartDay=e&&e.weekStartDay||null,super.construct(e),this.refresh()}doDestroy(){this.tip&&this.tip.destroy(),super.doDestroy()}ingestDate(e){if(!(e instanceof Date)){if(e=new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a valid argument to the Date constructor");const t=e.getTimezoneOffset();t&&(e=je.add(e,t,"minute"))}return je.clearTime(e)}set tip(e){this._tip=new Mn(Object.assign({forElement:this.element,forSelector:".b-calendar-cell"},e)),this._tip.on({pointerOver:"onTipOverCell",thisObj:this})}get tip(){return this._tip}get element(){return super.element}set element(e){super.element=e,this.weekElements=Array.from(this.element.querySelectorAll(".b-calendar-week")),this.cellElements=Array.from(this.element.querySelectorAll(".b-calendar-week > div"))}set date(e){const t=this;e=t._date=t.ingestDate(e),t.month&&t.month.month===e.getMonth()||(t.month=new Os({date:e,weekStartDay:t._weekStartDay,sixWeeks:t.sixWeeks})),t.refresh()}get date(){return this._date}set month(e){e instanceof Os?this._month=e:(this.month.month=e,this.refresh())}get month(){return this._month}set year(e){this.month.year=e,this.refresh()}get year(){return this.month.year}set showWeekNumber(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-week-number"),t.floating&&(t.isAligning||t.realign())}refresh(){const e=this,t=je.clearTime(new Date),{cellElements:r,weekElements:n,date:s,month:i,cellCls:o,disabledCls:a,otherMonthCls:l,weekendCls:c,todayCls:d}=e;if(!s)return e.date=t;for(let e=0,t=r.length;e<t;e++)r[e].className=r[e].innerHTML="";for(let t=0;t<7;t++){const r=e.weekdayCells[t],n=e.canonicalDayNumbers[t];r.className=r.innerHTML="",e.headerRenderer?e.headerRenderer(r,t):r.innerHTML=Hs[n],r.classList.add("b-calendar-day-header"),r.dataset.columnIndex=t,r.dataset.cellDay=n}let u=0,h=0;i.eachWeek((r,s)=>{const g=n[u].children;g[0].className="b-week-number-cell",e.weekRenderer?e.weekRenderer(g[0],r):g[0].innerHTML=r[1];for(let r=0;r<7;r++){const n=s[r],u=n.getDay(),m=g[r+1],p=m.classList;p.add(o),e.isDisabledDate(n)&&p.add(a),n.getMonth()!==i.month&&p.add(l),0!==u&&6!==u||p.add(c),n.getTime()===t.getTime()&&p.add(d),m.dataset.date=je.format(n,"YYYY-MM-DD"),m.dataset.cellIndex=h,m.dataset.columnIndex=r,e.cellRenderer?e.cellRenderer(m,n):m.innerHTML=n.getDate(),h++}u++}),e.floating&&(e.isAligning||e.realign())}isDisabledDate(e){const t=e.getDay(),r=this.disabledDates;if(this.disableWeekends&&(0===t||6===t))return!0;if(r){if("function"==typeof r)return r(e);if(Array.isArray(r))return r.some(t=>je.clearDate(t,!0).getTime()===je.clearDate(e,!0).getTime())}}get bodyConfig(){const e=super.bodyConfig,t=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",children:this.dayNameCells},{className:"b-weeks-container notranslate",reference:"weeksElement",children:t}];for(let e=0;e<6;e++){const e={className:"b-calendar-row b-calendar-week",children:[]};for(let t=0;t<8;t++)e.children.push({});t.push(e)}return e}updateWeekStartDay(e){const t=this;t.dayNames=[],t.dayNumbers=[],t.canonicalDayNumbers=[];for(let r=0;r<7;r++){const n=(e+r)%7;t.canonicalDayNumbers[r]=n,t.dayNumbers[n]=r,t.dayNames[r]=Hs[n]}}set weekStartDay(e){this._weekStartDay=e,this.updateWeekStartDay(this.weekStartDay)}get weekStartDay(){return null!=this._weekStartDay?this._weekStartDay:je.weekStartDay}get dayNameCells(){const e=this,t=document.createElement("div"),r=[t];e.weekdayCells=[],t.className="b-week-number-cell";for(let t=0;t<7;t++){const t=document.createElement("div");r.push(t),e.weekdayCells.push(t)}return r}onTipOverCell({source:e,target:t}){e.date=je.parse(t.dataset.date,"YYYY-MM-DD")}updateLocalization(){$s(),this.updateWeekStartDay(this.weekStartDay),this.refresh(),super.updateLocalization()}}function $s(){Hs.length=0;for(let e=2;e<9;e++)js.setDate(e),Hs.push(je.format(js,"ddd"))}const js=new Date("2000-01-01T00:00:00"),Hs=[];_s._$name="CalendarPanel",U.register("calendarpanel",_s);class Ns extends tn{static get $name(){return"Fit"}static get defaultConfig(){return{containerCls:"b-fit-container",itemCls:"b-fit-item"}}}Ns._$name="Fit",tn.registerLayout(Ns);class Bs extends un{static get $name(){return"Editor"}static get defaultConfig(){return{positioned:!0,hidden:!0,layout:"fit",align:{align:"t0-t0",offset:[0,0]},inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",allowInvalid:null,invalidAction:"block",completeOnChange:null}}afterConfigure(){const e=this;super.afterConfigure(),e.onTargetSizeChange=e.onTargetSizeChange.bind(e),(e.completeKey||e.cancelKey)&&gr.on({element:e.element,keydown:"onKeyDown",thisObj:e}),e.on({hide:"afterHide",thisObj:e}),ne.on({locale:"onLocaleChange",thisObj:e})}onLocaleChange(){const{inputField:e}=this;e&&!e.isDestroyed&&e.syncInputFieldValue&&e.syncInputFieldValue(!0)}startEdit({target:e,align:t=this.align,hideTarget:r=!1,matchSize:n=!0,matchFont:s=!0,fitTargetContent:i=!1,value:o,record:a,field:l=this.inputField.name,focus:c=!0}){const d=this,{inputField:u}=d,h=Et.getStyleValue(e,"font-size"),g=Et.getStyleValue(e,"font-family");if(!1!==d.trigger("beforestart",{value:o})){if(a&&l&&void 0===o&&(d.record=a,d.dataField=l,o=a[l]),n&&(e instanceof HTMLElement&&d.updateSize(e),e instanceof HTMLElement&&vr.addResizeListener(e,d.onTargetSizeChange)),u.input&&(s?(u.input.style.fontSize=h,u.input.style.fontFamily=g):u.input.style.fontSize=u.input.style.fontFamily=""),u.clearError&&u.clearError(),u.value=o,u.initialValue=u.value,d.showBy({target:e,...t}),i){const e=u.input.scrollWidth-u.input.clientWidth;e>0&&(d.width+=e+Et.scrollBarWidth)}return c&&d.inputField.focus&&d.inputField.focus(),1===e.nodeType&&(e.classList.add("b-editing"),r&&e.classList.add("b-hide-visibility")),d.trigger("start",{value:u.value}),d.oldValue=u.value,Array.isArray(d.oldValue)&&(d.oldValue=d.oldValue.slice()),!0}return!1}refreshEdit(){if(this.isVisible){const{record:e,dataField:t,inputField:r}=this;if(e&&t){const n=e[t];ze.isEqual(r.value,n)||(r.value=n)}}}onKeyDown(e){const t=this;switch(e.key){case t.completeKey:t.completeEdit(),e.stopImmediatePropagation();break;case t.cancelKey:t.cancelEdit(),e.stopImmediatePropagation()}t.trigger("keydown",{event:e})}onFocusOut(e){if(super.onFocusOut(e),!this.isFinishing){const e=this[this.blurAction+"Edit"];e&&e.call(this)}}set allowInvalid(e){this._allowInvalid=e,this.invalidAction=e?"allow":"block"}get allowInvalid(){return this._allowInvalid}async completeEdit(e){const t=this,{inputField:r,oldValue:n,record:s}=t,i=r.invalidAction||(!1===r.allowInvalid?"block":t.invalidAction),{value:o}=r;if(r.isValid){if(ze.isEqual(o,n))return t.cancelEdit(),!0;{const a={inputField:r,record:s,value:o,oldValue:n};if(!1!==t.trigger("beforeComplete",a)){if(e||(e=a.finalize||a.editorContext&&a.editorContext.finalize),e){let s=await e(a);if(!0===s)t.onEditComplete();else{if(r.setError){const e=s||r.invalidValueError,t=()=>{n(),r.clearError(e)},n=r.on({change:t,input:t});r.setError(e)}"block"===i?r.focus&&r.focus():"revert"===i&&(r.value=n,s=!0),s=!1}return s}return t.onEditComplete(),!0}r.focus&&r.focus()}}else{if("block"===i)return r.focus&&r.focus(),!1;if("revert"===i)return t.cancelEdit(),!0}return!1}cancelEdit(){const e=this,{inputField:t,oldValue:r,lastAlignSpec:n}=e,{target:s}=n,{value:i}=t;e.isFinishing||!1===e.trigger("beforeCancel",{value:i,oldValue:r})||(e.isFinishing=!0,e.hide(),e.trigger("cancel",{value:i,oldValue:r}),1===s.nodeType&&(s.classList.remove("b-editing"),s.classList.remove("b-hide-visibility")),e.isFinishing=!1)}onEditComplete(){const e=this,{record:t,dataField:r,inputField:n,oldValue:s,lastAlignSpec:i}=e,{target:o}=i,{value:a}=n;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),t){const e="set"+I.capitalizeFirstLetter(r);t[e]?t[e](a):t[r]=a}e.trigger("complete",{value:a,oldValue:s}),1===o.nodeType&&(o.classList.remove("b-editing"),o.classList.remove("b-hide-visibility")),e.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(e){this._owner=e}get owner(){return this._owner||K.fromElement(this.element.parentNode)}set inputField(e){const t=this;t._inputField&&t._inputField.destroy(),"string"==typeof e&&(e={type:e}),e instanceof Vr?t._inputField=e:(t._inputField=J.createWidget(e),t.createdInputField=!0),t.completeOnChange&&t._inputField.on({change:"onInputFieldChange",thisObj:t}),t._inputField.parent=t,t.removeAll(),t.add(e)}get inputField(){return this.items[0]}onInputFieldChange(){this.containsFocus&&this.completeEdit()}onTargetSizeChange(e,t,r){t&&r&&this.updateSize(e)}updateSize(e){const t=e.getBoundingClientRect();this.width=t.width-this.align.offset[0],this.height=t.height}afterHide(){vr.removeResizeListener(this.lastAlignSpec.target,this.onTargetSizeChange)}}Bs._$name="Editor",U.register("editor",Bs);class zs extends _s{static get $name(){return"DatePicker"}static get defaultConfig(){return{focusable:!0,tools:{prevMonth:{align:"start",cls:"b-icon b-icon-angle-left",handler:"gotoPrevMonth"},nextMonth:{align:"end",cls:"b-icon b-icon-angle-right",handler:"gotoNextMonth"}},header:{title:'<div class="b-editable b-datepicker-month" reference="monthElement"></div> <div class="b-editable b-datepicker-year" reference="yearElement"></div>',titleAlign:"center"},minDate:null,maxDate:null,outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date",focusDisabledDates:null,multiSelect:!1,editOnHover:!0}}construct(e){const t=this;t.selection=[],t.refresh=t.createOnFrame(t.refresh),super.construct(e),t.element.setAttribute("aria-activedescendant",t.id+"-active-day"),gr.on({element:t.element,mouseover:"onPickerMouseover",mousedown:"onPickerMousedown",click:"onPickerClick",keydown:"onPickerKeyDown",thisObj:t})}doDestroy(){this._yearEditor&&this._yearEditor.destroy(),this._monthEditor&&this._monthEditor.destroy(),super.doDestroy()}get focusElement(){return this.element}eachWidget(e,t){const r=this.items||[];this._yearEditor&&r.unshift(this._yearEditor),this._monthEditor&&r.unshift(this._monthEditor);for(let n=0;n<r.length;n++){const s=r[n];if(!1===e(s))return;t&&s.eachWidget&&s.eachWidget(e,t)}}refresh(){const e=this,t=Et.scrollBarWidth;super.refresh(),e.monthElement.style.minWidth=`calc(${e.maxMonthLength+1}ch + ${t}px)`,e.monthElement.innerHTML=je.format(e.month.date,"MMMM"),e.yearElement.style.minWidth=t?`calc(3ch + ${t}px`:"7ch",e.yearElement.innerHTML=je.format(e.month.date,"YYYY")}cellRenderer(e,t){const r=this,{activeCls:n,selectedCls:s}=r,i=e.classList;e.innerHTML=t.getDate(),e.setAttribute("aria-label",je.format(t,"MMMM D, YYYY")),r.isActiveDate(t)&&(i.add(n),e.id=r.id+"-active-day"),r.isSelectedDate(t)&&i.add(s),(r.minDate&&t<r.minDate||r.maxDate&&t>r.maxDate)&&i.add(r.outOfRangeCls)}onPickerMousedown(e){e.preventDefault()}onPickerMouseover(e){if(this.editOnHover){if(Et.up(e.target,".b-editable"))return this.onEditGesture(e)}}onPickerClick(e){const t=this,{target:r}=e,n=Et.up(r,`.${t.cellCls}:not(.${t.disabledCls}):not(.${t.outOfRangeCls})`),s=Et.up(r,".b-editable");return n?t.onCellClick(e):t.editOnHover&&!Et.isTouchEvent||!s?(t._monthEditor&&!t._monthEditor.owns(e)&&t._monthEditor.cancelEdit(),void(t._yearEditor&&!t._yearEditor.owns(e)&&t._yearEditor.cancelEdit())):t.onEditGesture(e)}onCellClick(e){this.onDateActivate(je.parse(e.target.dataset.date,"YYYY-MM-DD"),e)}onEditGesture(e){const t=this,{month:r}=t,{target:n}=e;n===t.monthElement?t.monthEditor.startEdit({target:n,value:r.month,fitTargetContent:!1,hideTarget:!0}):n===t.yearElement&&(t.yearEditor.minWidth=`calc(50px + ${Et.scrollBarWidth}px)`,t.yearEditor.startEdit({target:n,value:r.year,fitTargetContent:!0,hideTarget:!0}))}onDateActivate(e,t){const r=this,{lastClickedDate:n,selection:s}=r;r.activeDate=e,r.lastClickedDate=e,r.multiSelect?r.multiRange||n&&e.getTime()===n.getTime()||(n&&t.shiftKey?(s[1]=e,s.sort()):(s.length=0,s[0]=e),r.trigger("selectionChange",{selection:s})):r.value&&r.value.getTime()===e.getTime()?r.hide():r.value=e}onPickerKeyDown(e){const t=this,r=e.key.trim()||e.code,n=t.activeDate,s=new Date(n);if(n){do{switch(r){case"Escape":t.hide();break;case"ArrowLeft":e.preventDefault(),e.ctrlKey?s.setMonth(s.getMonth()-1):s.setDate(s.getDate()-1);break;case"ArrowUp":e.preventDefault(),s.setDate(s.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?s.setMonth(s.getMonth()+1):s.setDate(s.getDate()+1);break;case"ArrowDown":e.preventDefault(),s.setDate(s.getDate()+7);break;case"Enter":t.onDateActivate(n,e)}}while(t.isDisabledDate(s)&&!t.focusDisabledDates);if(t.minDate&&s<t.minDate)return;if(t.maxDate&&s>t.maxDate)return;t.activeDate=s}}set minDate(e){this._minDate=e?this.ingestDate(e):null,this.refresh()}get minDate(){return this._minDate}set maxDate(e){this._maxDate=e?this.ingestDate(e):null,this.refresh()}get maxDate(){return this._maxDate}set activeDate(e){const t=this;t._activeDate=e?t.ingestDate(e):je.clearTime(new Date),t.month.month!==t._activeDate.getMonth()&&(t.month.date=t._activeDate),t.refresh()}get activeDate(){return this._activeDate}set value(e){const t=this,{selection:r}=t;let n;e?(e=t.ingestDate(e),t.value&&e.getTime()===t.value.getTime()||(r.length=0,r[0]=e,n=!0),t.date=e):(n=r.length,r.length=0,t.date=new Date),n&&t.trigger("selectionChange",{selection:r})}get value(){return this.selection[this.selection.length-1]}gotoPrevMonth(){const e=this.date;e.setMonth(e.getMonth()-1),this.date=e}gotoNextMonth(){const e=this.date;e.setMonth(e.getMonth()+1),this.date=e}isActiveDate(e){return this.activeDate&&this.ingestDate(e).getTime()===this.activeDate.getTime()}isSelectedDate(e){return this.selection.some(t=>t.getTime()===e.getTime())}get monthEditor(){const e=this;return e._monthEditor||(e._monthEditor=new Bs({owner:e,appendTo:e.element,inputField:e.monthInput=new As({editable:!1,autoExpand:!e.editOnHover,items:e.monthItems,highlightExternalChange:!1,picker:{align:{align:"t0-b0"},cls:"b-month-picker-list",scrollable:{overflowX:!1}}}),completeOnChange:!0,listeners:{complete:"onMonthPicked",thisObj:e}})),e._monthEditor}onMonthPicked({value:e}){this.month=e}get yearEditor(){const e=this;return e._yearEditor||(e._yearEditor=new Bs({owner:e,appendTo:e.element,inputField:e.yearInput=new As({editable:!1,autoExpand:!e.editOnHover,items:e.yearItems,highlightExternalChange:!1,picker:{cls:"b-year-picker-list",scrollable:{overflowX:!1}}}),completeOnChange:!0,listeners:{complete:"onYearPicked",thisObj:e}})),e._yearEditor}onYearPicked({value:e}){this.year=e}get monthItems(){return je.getMonthNames().map((e,t)=>[t,e])}get yearItems(){const e=[],t=(new Date).getFullYear();for(let r=t-20;r<t+21;r++)e.push(r);return e}get maxMonthLength(){if(!this._maxMonthLength){this._maxMonthLength=0;for(let e=0,t=this.monthItems;e<12;e++)this._maxMonthLength=Math.max(this._maxMonthLength,t[e][1].length)}return this._maxMonthLength}updateLocalization(){this._monthEditor&&(this._monthEditor.doDestroy(),this._monthEditor=null),this._yearEditor&&(this._yearEditor.doDestroy(),this._yearEditor=null),this._maxMonthLength=0,super.updateLocalization()}}zs._$name="DatePicker",U.register("datepicker",zs);class Vs extends xs{static get $name(){return"DateField"}static get defaultConfig(){return{format:"L",fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200}},stepTriggers:{back:{cls:"b-icon-angle-left b-step-trigger",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon-angle-right b-step-trigger",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:null,weekStartDay:null,picker:null,value:null}}inputTemplate(){const e=this;return Cn.tpl`<input type="${e.inputType||"text"}"
            reference="input"
            class="${e.inputCls||""}"
            min="${e.min}"
            max="${e.max}"
            placeholder="${e.placeholder}"
            name="${e.name||e.id}"
            id="${e.id+"_input"}"/>`}createPicker(e){const t=this;return e=new zs(Object.assign({owner:t,forElement:t[t.pickerAlignElement],floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},value:t.value,minDate:t.min,maxDate:t.max,weekStartDay:t._weekStartDay,onSelectionChange:({selection:e,source:r})=>{r.isVisible&&(t._isUserAction=!0,t.value=e[0],t._isUserAction=!1,r.hide())}},e)),t.calendarContainerCls&&e.element.classList.add(t.calendarContainerCls),e}set triggers(e){super.triggers=ze.assign(e,this.stepTriggers)}get triggers(){return super.triggers}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const r=je.add(e.value,-1*e._step.magnitude,e._step.unit);(!t||t.getTime()<=r)&&(e.value=r)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const r=je.add(e.value,e._step.magnitude,e._step.unit);(!t||t.getTime()>=r)&&(e.value=r)}}showPicker(e){this.picker.value=this.picker.activeDate=this.value,super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this,t=e.min,r=e.max;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let n=e.value;if(n){if(n=n.getTime(),t&&t.getTime()>n)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(r&&r.getTime()<n)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(e){return null!=e&&(je.isDate(e)||(e="string"==typeof e?je.parse(e,this.format)||je.parse(e,this.fallbackFormat):new Date(e)),je.isValidDate(e))?this.transformTimeValue(e):null}transformTimeValue(e){const t=this.keepTime;if(e=je.clone(e),t){const r=je.parse(t,this.timeFormat);je.isValidDate(r)?je.copyTimeValues(e,r):je.isValidDate(this.value)&&je.copyTimeValues(e,this.value)}else je.clearTime(e,!1);return e}set min(e){const t=this;t._min=t.transformDateValue(e),t.input&&(t.input.min=t._min),t._picker&&(t._picker.minDate=t._min),t.updateInvalid()}get min(){return this._min}set max(e){const t=this;t._max=t.transformDateValue(e),t.input&&(t.input.max=t._max),t._picker&&(t._picker.maxDate=t._max),t.updateInvalid()}get max(){return this._max}set weekStartDay(e){this._weekStartDay=e,this._picker&&(this._picker.weekStartDay=e)}get weekStartDay(){return null!=this._weekStartDay?this._weekStartDay:this._picker?this._picker.weekStartDay:je.weekStartDay}set value(e){const t=this,r=t.value,n=t._picker,s=t.transformDateValue(e);!e||s?(t.clearError("L{invalidDate}"),t.hasChanged(r,s)?(n&&!t.inputting&&(n.value=s),super.value=s):t.inputting||t.syncInputFieldValue()):t.setError("L{invalidDate}")}get value(){return super.value}set step(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-steppers"),"number"==typeof e?e={magnitude:e,unit:t._step?t._step.unit:"day"}:"object"!=typeof e&&(e=je.parseDuration(e)),e&&e.magnitude&&e.unit&&(e.magnitude=Math.abs(e.magnitude),t._step=e,t.updateInvalid())}get step(){return this._step}hasChanged(e,t){return e&&e.getTime&&t&&t.getTime?e.getTime()!==t.getTime():super.hasChanged(e,t)}get inputValue(){const e=this.value;return e?je.format(e,this.format):""}set format(e){this._format=e,this.syncInputFieldValue(!0)}get format(){return this._format}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyPress(e){super.internalOnKeyPress(e),"Enter"===e.key&&this.isValid&&this.picker.hide()}}Vs._$name="DateField",U.register("datefield",Vs),U.register("date",Vs);const Ws=/[.,]/;class Gs extends jn{static get $name(){return"NumberField"}static get defaultConfig(){return{min:null,max:null,step:1,value:0,decimalPrecision:null,leadingZeroes:null,triggers:{spin:{type:"spintrigger"}},attributes:["placeholder","autoComplete","min","max","tabIndex"],changeOnSpin:!0}}construct(e){const t=this;super.construct(e),t.input.addEventListener("dblclick",()=>{t.select()}),"number"==typeof t.changeOnSpin&&(t.bufferedSpinChange=t.buffer(t.triggerChange,t.changeOnSpin))}inputTemplate(){const e=this,t="inputWidth"in e?`style="width:${e.inputWidth}${"number"==typeof e.inputWidth?"px":""}"`:"";return Cn.tpl`
            <input type="number"
                reference="input"
                value="${e._value}"
                name="${e.name||e.id}"
                id="${e.id}_input"
                step="any"
                ${t}
                ${e.attributeString}/>
            `}internalOnKeyPress(e){"keydown"===e.type&&("ArrowUp"===e.key?(this.doSpinUp(),e.preventDefault()):"ArrowDown"===e.key&&(this.doSpinDown(),e.preventDefault())),super.internalOnKeyPress(e)}doSpinUp(){const e=this,{min:t,max:r}=e;let n=(e.value||0)+e.step;!isNaN(t)&&n<t&&(n=t),(isNaN(r)||n<=r)&&e.applySpinChange(n)}doSpinDown(){const e=this,{min:t,max:r}=e;let n=(e.value||0)-e.step;!isNaN(r)&&n>r&&(n=r),(isNaN(t)||n>=t)&&e.applySpinChange(n)}applySpinChange(e){const t=this;t._isUserAction=!0,!0!==t.changeOnSpin&&(t.silenceChange=!0,t.bufferedSpinChange&&t.bufferedSpinChange(null,!0)),t.value=e,t._isUserAction=!1,t.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}internalOnInput(e){const{input:t}=this,r=this.formatValue(t.value);t.value!==r&&(t.value=r),super.internalOnInput(e)}static formatValue(e,t,r){if("string"!=typeof e)return e;let[n,s]=e.split(Ws);return r&&s&&s.length>r&&(s=s.substr(0,r)),t&&n&&n.length<t&&(n=n.padStart(t,"0")),[n,s].filter(e=>e).join(".")}formatValue(e){return Gs.formatValue(e,this.leadingZeroes,this.decimalPrecision)}set step(e){this.element.classList[e?"remove":"add"]("b-hide-spinner"),this._step=e}get step(){return this._step}set min(e){this._min=e,this.input&&(this.input.min=e)}get min(){return this._min}set max(e){this._max=e,this.input&&(this.input.max=e)}get max(){return this._max}set value(e){const t=this;if(e||0===e){let r;"number"!=typeof e&&(e="string"==typeof e?parseFloat(e):Number(e),r=isNaN(e),r&&(e="")),r||null==t.decimalPrecision||(e=ze.round(e,t.decimalPrecision))}else e=void 0;t.value!==e&&(super.value=e,t.leadingZeroes&&(t.input.value=t.formatValue(e.toString())))}get value(){return super.value}}Gs._$name="NumberField",U.register("numberfield",Gs),U.register("number",Gs);class Us extends Vr{static get $name(){return"Slider"}static get defaultConfig(){return{text:"",showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:null,thumbSize:20,localizableProperties:["text"]}}construct(e){const t=this;super.construct(e),t.updateLabel(),t.showTooltip&&(t.tip=new Mn({forElement:t.input,anchor:!1,align:"b-t",axisLock:!0})),t.input.addEventListener("input",t.onInternalInput.bind(t)),t.input.addEventListener("change",t.onInternalChange.bind(t)),t.input.addEventListener("mouseover",t.onInternalMouseOver.bind(t)),t.input.addEventListener("mouseout",t.onInternalMouseOut.bind(t))}template(e){return Cn.tpl`
            <div class="${e.text?"b-text b-has-label":""}">
                <input type="range"
                   reference="input"
                   id="${e.id}_input"
                   min="${e.min}"
                   max="${e.max}"
                   step="${e.step}"
                   value="${e.value}">
                <label reference="label" for="${e.id}_input">${e.text}</label>
            </div>
        `}get focusElement(){return this.input}onInternalInput(e){const t=this;t._value=parseInt(t.input.value),t.updateUI(),t.trigger("input",{value:t.value})}onInternalChange(e){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}onInternalMouseOver(e){const t=this;t.updateLabel(),t.tip&&t.tip.showBy({target:t.calcThumbPosition(),offset:5})}onInternalMouseOut(e){this.tip&&this.tip.hide()}triggerChange(e){this.trigger("change",{value:this.value,userAction:e})}get text(){return this._text}set text(e){const t=this;t._text=e,t.label&&(t.showValue&&(e=e?`${e} (${t.value})`:t.value),t.label.innerHTML=e),t.tip&&(t.tip.html=t.value)}get value(){return this.input?parseInt(this.input.value):this._value}set value(e){const t=this;t._value!==e&&(t.input&&(t.input.value=e,t.updateUI(),t.triggerChange(!1)),t._value=e)}get min(){return this.input?this.input.min:this._min}set min(e){const t=this;t.input&&(t.input.min=e,t._value<e&&(t.value=e,t.trigger("input",{value:t.value}))),t._min=e}get max(){return this.input?this.input.max:this._max}set max(e){const t=this;t.input&&(t.input.max=e,t._value>e&&(t.value=e,t.trigger("input",{value:t.value}))),t._max=e}get step(){return this.input?this.input.step:this._step}set step(e){this.input&&(this.input.step=e),this._step=e}updateLabel(){this.text=this._text}updateTooltipPosition(){this.tip&&this.tip.alignTo({target:this.calcThumbPosition(),offset:5})}updateUI(){this.updateLabel(),this.updateTooltipPosition()}calcThumbPosition(){const e=this,t=Xt.from(e.input),r=(t.width-e.thumbSize)*e.calcPercentProgress()/100;return new Xt(t.x+r,t.y+t.height/2-e.thumbSize/2,e.thumbSize,e.thumbSize)}calcPercentProgress(){return(this.value-this.min)/(this.max-this.min)*100}}Us._$name="Slider",U.register("slider",Us);const Ys=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"];class qs extends tn{static get $name(){return"Card"}static get defaultConfig(){return{containerCls:"b-card-container",itemCls:"b-card-item",animateCardChange:!0}}setActiveItem(e){const t=this,{owner:r}=t,{contentElement:n,items:s}=r,i=e instanceof Vr,o=parseInt(n.dataset.activeIndex),a=s[o],l=r.items[e=i?e=s.indexOf(e):parseInt(e)],c={prevActiveIndex:o,prevActiveItem:a};if(l&&l!==a){const s=a&&a.element,i=l&&l.element;if(c.activeIndex=e,c.activeItem=l,t.animateDetacher){const e=t.animateDetacher.event;t.animateDetacher(),e.prevActiveItem.element.classList.remove(Ys),e.activeItem.element.classList.remove("b-active",...Ys),t.animateDetacher=null}c.promise=new Promise((a,d)=>{s&&t.animateCardChange?(s.classList.add(e>o?"b-slide-out-left":"b-slide-out-right"),i.classList.add("b-active",e<o?"b-slide-in-left":"b-slide-in-right"),r.isAnimating=!0,l.triggerPaint(),t.animateDetacher=gr.on({element:i,animationend:()=>{t.animateDetacher=null,r.isAnimating=!1,i.classList.remove(...Ys),s&&s.classList.remove("b-active",...Ys),n.dataset.activeIndex=e,l.focus(),a(c)},once:!0}),t.animateDetacher.reject=d,t.animateDetacher.event=c):(s&&s.classList.remove("b-active"),i.classList.add("b-active"),n.dataset.activeIndex=e,l.focus(),l.triggerPaint(),a(c))})}return c}renderChildren(){const{owner:e}=this,t=e.activeIndex;P.isIE11&&(this.animateCardChange=!1),e.items&&null!=t&&e.items[t]&&(e.contentElement.dataset.activeIndex=t,e.items[t].element.classList.add("b-active")),super.renderChildren()}get activeIndex(){return parseInt(this.owner.contentElement.dataset.activeIndex)}get activeItem(){return this.owner.items[parseInt(this.owner.contentElement.dataset.activeIndex)]}}qs._$name="Card",tn.registerLayout(qs);class Xs extends un{static get $name(){return"TabPanel"}static get defaultConfig(){return{template:e=>Cn.tpl`
                <div>
                    <div class="b-tabpanel-tabs" reference="tabStrip">
                        ${e.items.map((t,r)=>`\n                        <div tabindex="-1" data-index="${r}" class="b-tabpanel-tab ${r===e.activeIndex?"b-active":""} ${t.cls||""} ${t.hidden?"b-hidden":""}" style="${e.tabMinWidth?"min-width:"+Et.setLength(e.tabMinWidth)+";":""} ${e.tabMaxWidth?"max-width:"+Et.setLength(e.tabMaxWidth)+";":""}" >\n                            <span class="b-tabpanel-tab-title">${t.title}</span>\n                        </div>\n                        `)}
                    </div>
                    <div class="b-tabpanel-body" reference="tabPanelBody" data-activeIndex="${e.activeIndex}">
                    </div>
                </div>
            `,itemCls:"b-tabpanel-item",defaultType:"container",activeTab:0,tabMinWidth:null,tabMaxWidth:null,animateTabChange:!0,layout:"card",suppressChildHeaders:!0}}construct(e){const t=this;super.construct(e),t.items.forEach((e,r)=>{e.titleElement=t.element.querySelector(`div.b-tabpanel-tab[data-index="${r}"] span`)}),gr.on({element:t.tabStrip,delegate:".b-tabpanel-tab",click:"onTabElementClick",thisObj:this})}createWidget(e){return(e=super.createWidget(e)).on({hide:this.onTabVisibilityChange,show:this.onTabVisibilityChange,thisObj:this}),e}set tabMinWidth(e){this._tabMinWidth=e,this.element&&Et.forEachSelector(this.element,".b-tabpanel-tab",t=>{Et.setLength(t,"minWidth",e||null)})}get tabMinWidth(){return this._tabMinWidth}set tabMaxWidth(e){this._tabMaxWidth=e,this.element&&Et.forEachSelector(this.element,".b-tabpanel-tab",t=>{Et.setLength(t,"maxWidth",e||null)})}get tabMaxWidth(){return this._tabMaxWidth}set layout(e){super.layout=e,this.layout.animateCardChange=this.animateTabChange}get layout(){return super.layout}get contentElement(){return this.tabPanelBody}get focusElement(){const e=this.items[this.activeTab||0];return e&&e.focusElement||this.tabStrip.children[this.activeTab]}set activeTab(e){const t=this;if(e<0||e>=t.items.length)throw new Error("Invalid tab index: "+e);if(t.isConfiguring)t._activeTab=e;else{const r=t.layout.setActiveItem(e),{promise:n,activeIndex:s,activeItem:i}=r;if(i){const{tabStrip:e}=t,i=e.children[t._activeTab];t._activeTab=s,i&&i.classList.remove("b-active"),e.children[s].classList.add("b-active"),n.then(()=>{t.trigger("tabchange",r)})}}}get activeIndex(){return this.activeTab}get activeTab(){return this._activeTab}get activeItem(){return this.layout.activeItem}onTabElementClick(e){this.activeTab=e.currentTarget.dataset.index}onTabVisibilityChange({source:e}){this.element.querySelector(`div.b-tabpanel-tab[data-index="${this.items.indexOf(e)}"]`).classList[e.hidden?"add":"remove"]("b-hidden")}}Xs._$name="TabPanel",U.register("tabpanel",Xs),U.register("tabs",Xs);class Ks extends xs{static get $name(){return"TextAreaField"}static get defaultConfig(){return{triggers:null,inline:!0,resize:"none"}}startConfigure(e){this._thisIsAUsedExpression(this.inline),super.startConfigure(e)}inputTemplate(){const e=this;return e.inline?Cn.tpl`<textarea
                reference="input"
                class="${e.inputCls||""}"
                placeholder="${e.placeholder}"
                name="${e.name||e.id}"
                style="resize:${e.resize}"
                id="${e.id+"_input"}"></textarea>`:Cn.tpl`<input type="text"
                readOnly="readonly"
                reference="displayElement"
                placeholder="${e.placeholder}"/>`}get focusElement(){return this.inline||this._picker&&this._picker.isVisible?this.input:this.displayElement}showPicker(){const{picker:e}=this;e.width=this.pickerWidth||this[this.pickerAlignElement].offsetWidth,super.showPicker(!0)}focusPicker(){this.input.focus()}onPickerKeyDown(e){const t=this,r=t.input;switch(e.key.trim()||e.code){case"Escape":return void t.picker.hide();case"Enter":e.ctrlKey&&(t.syncInputFieldValue(),t.picker.hide())}t.input=t.displayElement;const n=super.onPickerKeyDown(e);return t.input=r,n}syncInputFieldValue(e){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue(e)}set value(e){super.value=null==e?"":e}get value(){return super.value}set inline(e){this._inline=e,e||this.triggers||(this.triggers={})}set triggers(e){this.inline||((e||(e={})).expand={cls:"b-icon-picker",handler:"onTriggerClick"}),super.triggers=e}get triggers(){return super.triggers}get inline(){return this._inline}createPicker(e){const t=this;e.width&&(t.pickerWidth=e.width),e=new Vr(ze.merge({cls:"b-textareafield-picker",owner:t,floating:!0,scrollAction:"realign",forElement:t[t.pickerAlignElement],align:{align:"t-b",axisLock:!0,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},html:`<textarea id="${t.id+"_input"}" style="resize:${t.resize}">${t.value}</textarea>`,autoShow:!1},e));const r=t.input=e.element.querySelector(`#${t.id}_input`);return t.inputListenerRemover=gr.on({element:r,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyPress",keypress:"internalOnKeyPress",keyup:"internalOnKeyPress"}),e}}Ks._$name="TextAreaField",U.register("textareafield",Ks),U.register("textarea",Ks);class Zs extends vn{static get $name(){return"TimePicker"}static get defaultConfig(){return{items:[{type:"number",ref:"fieldHours",min:0,max:23,highlightExternalChange:!1},{html:"<label>:</label>"},{type:"number",ref:"fieldMinutes",min:0,max:59,highlightExternalChange:!1},{type:"button",text:"AM",toggleGroup:"am-pm",ref:"buttonAM",cls:"b-blue"},{type:"button",text:"PM",toggleGroup:"am-pm",ref:"buttonPM",cls:"b-blue"}],float:"1",autoShow:!1,trapFocus:!0,value:je.getTime(0),format:null}}construct(e){const t=this;super.construct(e),t._pm=!1,t.fieldHours.on("change",t.onFieldChange,t),t.fieldMinutes.on("change",t.onFieldChange,t),t.buttonAM.on("click",t.onButtonAMClick,t),t.buttonPM.on("click",t.onButtonPMClick,t),gr.on({element:t.element,keydown:"onPickerKeyDown",thisObj:t}),gr.on({element:t.fieldHours.element,keydown:"onPickerKeyDown",thisObj:t}),gr.on({element:t.fieldMinutes.element,keydown:"onPickerKeyDown",thisObj:t}),t.refresh()}onFieldChange(){const e=this;e._time&&(e.value=e.pickerToTime())}onButtonAMClick(){const e=this;e._pm=!1,e._time&&(e.value=e.pickerToTime())}onButtonPMClick(){const e=this;e._pm=!0,e._time&&(e.value=e.pickerToTime())}onPickerKeyDown(e){const t=this;switch(e.key&&e.key.trim()||e.code){case"Escape":t.triggerTimeChange(t._initialValue),t.hide(),e.preventDefault();break;case"Enter":t.value=t.pickerToTime(),t.hide(),e.preventDefault()}}pickerToTime(){const e=this,t=e._pm;let r=e.fieldHours.value,n=new Date(e._time);return e._is24Hour||(t&&r<12&&(r+=12),t||12!==r||(r=0)),n.setHours(r),n.setMinutes(e.fieldMinutes.value),e._min&&(n=je.max(e._min,n)),e._max&&(n=je.min(e._max,n)),n}triggerTimeChange(e){this.trigger("timeChange",{time:e})}set value(e){const t=this;let r=!1;e&&t._time?e.getTime()!==t._time.getTime()&&(t._time=e,r=!0):(t._time=Zs.defaultConfig.value,r=!0),r&&(t.isVisible&&t.triggerTimeChange(t.value),t.refresh())}get value(){return this._time}set format(e){this._format=e,this._is24Hour=je.is24HourFormat(this._format),this.refresh()}get format(){return this._format}set min(e){this._min=e}get min(){return this._min}set max(e){this._max=e}get max(){return this._max}set initialValue(e){this.value=e,this._initialValue=e}get initialValue(){return this._initialValue}get buttonAM(){return this.widgetMap.buttonAM}get buttonPM(){return this.widgetMap.buttonPM}get fieldHours(){return this.widgetMap.fieldHours}get fieldMinutes(){return this.widgetMap.fieldMinutes}refresh(){const e=this;if(!e.isConfiguring){const t=e._time,r=e._is24Hour,n=t.getHours(),s=e._pm=n>=12,i=e.fieldHours;e.element.classList[r?"add":"remove"]("b-24h"),i.min=r?0:1,i.max=r?23:12,i.value=r?n:n%12||12,e.fieldMinutes.value=t.getMinutes(),e.buttonAM.pressed=!s,e.buttonPM.pressed=s,e.buttonAM.hidden=e.buttonPM.hidden=r}}}Zs._$name="TimePicker",U.register("timepicker",Zs);class Js extends xs{static get $name(){return"TimeField"}static get defaultConfig(){return{format:"LT",triggers:{back:{cls:"b-icon b-icon-angle-left",handler:"onBackClick",align:"start"},expand:{template:()=>`<div class="b-align-${this.align||"end"}"><div class="b-icon-clock-live"></div></div>`,handler:"onTriggerClick",align:"end"},forward:{cls:"b-icon b-icon-angle-right",handler:"onForwardClick",align:"end"}},min:null,max:null,step:"5m",value:null}}createPicker(e){const t=this;return new Zs(Object.assign({owner:t,floating:!0,forElement:t[t.pickerAlignElement],align:{align:"t0-b0",axisLock:!0,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},value:t.value,format:t.format,onTimeChange({time:e}){t._isUserAction=!0,t.value=e,t._isUserAction=!1}},e))}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const r=je.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=r)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const r=je.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=r)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){if(t=t.getTime(),e._min&&e._min.getTime()>t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<t)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}hasChanged(e,t){return e&&e.getTime&&t&&t.getTime?e.getTime()!==t.getTime():super.hasChanged(e,t)}showPicker(e){const t=this,r=t.picker;r.initialValue=t.value,r.format=t.format,r.maxTime=t.max,r.minTime=t.min,t.value=r.value,super.showPicker(e)}onPickerShow(){super.onPickerShow(),this.pickerKeyDownRemover&&this.pickerKeyDownRemover()}focusPicker(){this.picker.focus()}transformTimeValue(e){return null!=e&&(je.isDate(e)||(e="string"==typeof e?je.parse(e,this.format):new Date(e)),je.isValidDate(e))?je.getTime(e):null}set min(e){const t=this;t._min=t.transformTimeValue(e),t.input&&(t.input.min=t._min),t.updateInvalid()}get min(){return this._min}set max(e){const t=this;t._max=t.transformTimeValue(e),t.input&&(t.input.max=t._max),t.updateInvalid()}get max(){return this._max}set value(e){const t=this,r=t.value,n=t.transformTimeValue(e);e&&!n||""===e?t.setError("L{invalidTime}"):(t.clearError("L{invalidTime}"),t.hasChanged(r,n)?(t.triggers.expand&&n&&(t.triggers.expand.element.firstElementChild.style.animationDelay=-(60*n.getHours()+n.getMinutes())/10+"s"),super.value=n):t.inputting||t.syncInputFieldValue())}get value(){return super.value}set step(e){const t=this;"number"==typeof e?e={magnitude:e,unit:t._step.unit}:"object"!=typeof e&&(e=je.parseDuration(e)),e&&e.magnitude&&e.unit&&(e.magnitude=Math.abs(e.magnitude),t._step=e,t.updateInvalid())}get step(){return this._step}set format(e){this._format=e,this.syncInputFieldValue(!0)}get format(){return this._format}get inputValue(){return je.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}}Js._$name="TimeField",U.register("timefield",Js),U.register("time",Js);class Qs{createWidget(e){return U.createWidget(e.type,e)}getClass(e){return U.getClass(e)}appendWidget(e){return this.createWidget(e)}appendWidgets(e,t){return e.map(e=>this.appendWidget(ze.assign({},t||{},e)))}openPopup(e,t){return new vn(ze.assign({forElement:e},"string"==typeof t?{html:t}:t))}showContextMenu(e,t){const r=this;return r.currentContextMenu&&r.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:Array.isArray(e)?t.forElement={target:new Kt(...e)}:e instanceof Kt&&(t.forElement={target:e}),r.currentContextMenu=new xn(t),r.currentContextMenu.on("destroy",()=>{r.currentContextMenu=null}),r.currentContextMenu}attachTooltip(e,t){return"string"==typeof t&&(t={html:t}),new Mn(Object.assign({forElement:e},t)),e}hasTooltipAttached(e){return Mn.hasTooltipAttached(e)}destroyTooltipAttached(e){return Mn.destroyTooltipAttached(e)}mask(e,t="Loading"){if(e)return e instanceof HTMLElement&&(e={element:e,text:t}),Qr.mask(e,e.element)}unmask(e,t=!0){e.mask&&(t?e.mask.close():e.mask.hide())}toast(e){return Tn.show(e)}set defaultStyle(e){this._defaultStyle=e}get defaultStyle(){return this._defaultStyle}}J._adapter||(J.adapter=Qs),Qs._$name="BryntumWidgetAdapter";class ei{static get(e,t){const r=e._domData||(e._domData={});return null!=t?r[t]:r}static set(e,t,r){3===arguments.length?(e._domData||(e._domData={}))[t]=r:e._domData=t}static assign(e,t){Object.assign(e._domData||(e._domData={}),t)}}ei._$name="DomDataStore";class ti{constructor(e,t){"number"==typeof e?(this._magnitude=e,this._unit=t):"object"==typeof e&&Object.assign(this,e)}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude="number"==typeof e&&e}get unit(){return this._unit}set unit(e){this._unit=je.parseTimeUnit(e)}get isValid(){return this._magnitude&&this._unit}get milliseconds(){return this.isValid?je.asMilliseconds(this._magnitude,this._unit):0}isEqual(e){return Boolean(e&&this._magnitude===e.magnitude&&this._unit===e.unit)}toString(e){const t=this,r=t.useAbbreviation?"getShortNameOfUnit":"getLocalizedNameOfUnit";return t.isValid?`${t._magnitude} ${je[r](t._unit,1!==t._magnitude)}`:""}}ti._$name="Duration";const ri=()=>{throw new Error("Abstract method call!")},ni=()=>{throw new Error("Method cannot be called at this state!")};class si extends B{canUndo(e){ri()}canRedo(e){ri()}onUndo(e){ri()}onRedo(e){ri()}onStartTransaction(e){ri()}onStopTransaction(e){ri()}onStopTransactionDelayed(e){ri()}onRejectTransaction(e){ri()}onEnable(e){ri()}onDisable(e){ri()}onAutoRecordOn(e){ri()}onAutoRecordOff(e){ri()}onResetQueue(e){ri()}onModelUpdate(e){ri()}onStoreModelAdd(e){ri()}onStoreModelInsert(e){ri()}onStoreModelRemove(e){ri()}onStoreModelRemoveAll(e){ri()}onModelInsertChild(e){ri()}onModelRemoveChild(e){ri()}}si._$name="StateBase";const ii=Symbol("STATE_PROP"),oi=Symbol("STORES_PROP"),ai=Symbol("QUEUE_PROP"),li=Symbol("POS_PROP"),ci=Symbol("TRANSACTION_PROP"),di=Symbol("TRANSACTION_TIMER_PROP"),ui=Symbol("AUTO_RECORD_PROP"),hi=(Object.freeze([ii,oi,ai,li,ci,di,ui]),new Map);var gi=(e,t)=>{hi.set(e,t)},mi=e=>("string"==typeof e&&(e=hi.get(e)),e);const pi=(e,t)=>{const{undo:r,redo:n}=t;let s;return s=r&&!n?{[ai]:e[ai].slice(e.position),[li]:0}:n&&!r?{[ai]:e[ai].slice(0,e.position)}:{[ai]:[],[li]:0},[s,()=>{e.notifyStoresAboutQueueReset(t)}]};const fi=new class extends si{canUndo(){return!1}canRedo(){return!1}onUndo(){ni()}onRedo(){ni()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){ni()}onAutoRecordOn(){return{[ui]:!0}}onAutoRecordOff(){return{[ui]:!1}}onStartTransaction(){ni()}onStopTransaction(){ni()}onStopTransactionDelayed(){ni()}onRejectTransaction(){ni()}onResetQueue(e,t){return pi(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};gi("disabledstate",fi);const vi=Symbol("ACTION_QUEUE_PROP");class yi extends B{get defaultConfig(){return{title:null}}construct(...e){this[vi]=[],super.construct(...e)}get queue(){return this[vi].slice(0)}get length(){return this[vi].length}addAction(e){this[vi].push(e)}undo(){const e=this[vi];for(let t=e.length-1;t>=0;--t)e[t].undo()}redo(){const e=this[vi];for(let t=0,r=e.length;t<r;++t)e[t].redo()}}yi._$name="Transaction";class bi extends si{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,t){const r=e[ai];let n=e.position,s=Math.max(0,n-t);return[{[ii]:"restoringstate",[li]:s},()=>{for(e.notifyStoresAboutStateRestoringStart();n!=s;)r[--n].undo();return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop()}]}]}onRedo(e,t){const r=e[ai];let n=e.position,s=Math.min(r.length,n+t);return[{[ii]:"restoringstate",[li]:s},()=>{e.notifyStoresAboutStateRestoringStart();do{r[n++].redo()}while(n!=s);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop()}]}]}onEnable(){ni()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[ii]:"autoreadystate",[ui]:!0}}onAutoRecordOff(){ni()}onStartTransaction(e,t){const r=new yi({title:t});return[{[ii]:"recordingstate",[ci]:r},()=>{e.notifyStoresAboutStateRecordingStart(r)}]}onStopTransaction(){ni()}onStopTransactionDelayed(){ni()}onRejectTransaction(){ni()}onResetQueue(e,t){return pi(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}let Ci=new bi;gi("readystate",Ci);class wi extends si{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const t=e[ci];return e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[ii]:"disabledstate",[ci]:null}}onAutoRecordOn(e){return[{[ii]:"autorecordingstate",[ui]:!0},()=>{e[ii].onStopTransactionDelayed(e)}]}onAutoRecordOff(){ni()}onStartTransaction(){ni()}onStopTransaction(e,t){const r=e[ci];let n=e[li],s=e[ai];return r.length&&(r.title||t||!e.getTransactionTitle?t&&(r.title=t):r.title=e.getTransactionTitle(r),s[n]=r,s.length=++n),[{[ii]:"readystate",[li]:n,[ci]:null},()=>{e.notifyStoresAboutStateRecordingStop(r,{stop:!0})}]}onRejectTransaction(e){const t=e[ci];return[{[ii]:"restoringstate",[ci]:null},()=>(t.length&&t.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onStopTransactionDelayed(){ni()}onQueueReset(){ni()}onModelUpdate(e,t,r,n){e[ci].addAction(e.makeModelUpdateAction(t,r,n))}onModelInsertChild(e,t,r,n,s,i){e[ci].addAction(e.makeModelInsertChildAction(t,r,n,s,i))}onModelRemoveChild(e,t,r,n){e[ci].addAction(e.makeModelRemoveChildAction(t,r,n))}onStoreModelAdd(e,t,r,n){e[ci].addAction(e.makeStoreModelAddAction(t,r,n))}onStoreModelInsert(e,t,r,n,s,i){e[ci].addAction(e.makeStoreModelInsertAction(t,r,n,s,i))}onStoreModelRemove(e,t,r,n,s){e[ci].addAction(e.makeStoreModelRemoveAction(t,r,n,s))}onStoreRemoveAll(e,t,r,n){e[ci].addAction(e.makeStoreRemoveAllAction(t,r,n))}}const Si=new wi;gi("recordingstate",Si);const Di=new class extends si{canUndo(){return!1}canRedo(){return!1}onUndo(){ni()}onRedo(){ni()}onEnable(){ni()}onDisable(){ni()}onAutoRecordOn(){return{[ui]:!0}}onAutoRecordOff(){return{[ui]:!1}}onStartTransaction(){ni()}onStopTransaction(){ni()}onStopTransactionDelayed(){ni()}onRejectTransaction(){ni()}onQueueReset(){ni()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};gi("restoringstate",Di);const Ei=new class extends bi{onAutoRecordOn(){ni()}onAutoRecordOff(){return{[ii]:"readystate",[ui]:!1}}onStartTransaction(e,t){const r=new yi({title:t});return[{[ii]:"autorecordingstate",[ci]:r},()=>{e.notifyStoresAboutStateRecordingStart(r),e.stopTransactionDelayed()}]}onModelUpdate(e,t,r,n){e.startTransaction(),e.onModelUpdate(t,r,n)}onModelInsertChild(e,t,r,n,s){e.startTransaction(),e.onModelInsertChild(t,r,n,s)}onModelRemoveChild(e,t,r,n){e.startTransaction(),e.onModelRemoveChild(t,r,n)}onStoreModelAdd(e,t,r,n){e.startTransaction(),e.onStoreModelAdd(t,r,n)}onStoreModelInsert(e,t,r,n,s,i){e.startTransaction(),e.onStoreModelInsert(t,r,n,i)}onStoreModelRemove(e,t,r,n,s){e.startTransaction(),e.onStoreModelRemove(t,r,n,s)}onStoreRemoveAll(e,t,r,n){e.startTransaction(),e.onStoreRemoveAll(t,r,n)}};gi("autoreadystate",Ei);class xi extends(br(wi)){onDisable(e){const t=e[ci],r=e[di];return r&&this.clearTimeout(r),e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[ii]:"disabledstate",[ci]:null,[di]:null}}onAutoRecordOn(e){ni()}onAutoRecordOff(e){const t=e[di];return t&&this.clearTimeout(t),{[ii]:"recordingstate",[ui]:!1,[di]:null}}onStopTransaction(e,t){const r=e[ci],n=e[di];let s=e[li],i=e[ai];return n&&this.clearTimeout(n),r.length&&(r.title||t||!e.getTransactionTitle?t&&(r.title=t):r.title=e.getTransactionTitle(r),i[s]=r,i.length=++s),[{[ii]:"autoreadystate",[li]:s,[ci]:null,[di]:null},()=>{e.notifyStoresAboutStateRecordingStop(r,{stop:!0})}]}onStopTransactionDelayed(e){let t=e[di];return t&&this.clearTimeout(t),t=this.setTimeout(()=>{e.stopTransaction()},e.autoRecordTransactionStopTimeout),{[ii]:Ti,[di]:t}}onRejectTransaction(e){const t=e[ci],r=e[di];return r&&this.clearTimeout(r),[{[ii]:"restoringstate",[ci]:null,[di]:null},()=>(t.length&&t.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onModelUpdate(e,...t){super.onModelUpdate(e,...t),e.stopTransactionDelayed()}onModelInsertChild(e,...t){super.onModelInsertChild(e,...t),e.stopTransactionDelayed()}onModelRemoveChild(e,...t){super.onModelRemoveChild(e,...t),e.stopTransactionDelayed()}onStoreModelAdd(e,...t){super.onStoreModelAdd(e,...t),e.stopTransactionDelayed()}onStoreModelInsert(e,...t){super.onStoreModelInsert(e,...t),e.stopTransactionDelayed()}onStoreModelRemove(e,...t){super.onStoreModelRemove(e,...t),e.stopTransactionDelayed()}onStoreRemoveAll(e,...t){super.onStoreRemoveAll(e,...t),e.stopTransactionDelayed()}}const Ti=new xi;gi("autorecordingstate",Ti);const Ri=()=>{throw new Error("Abstract method call!")};class Mi extends B{get type(){return this.constructor.name}undo(){Ri()}redo(){Ri()}}Mi._$name="ActionBase";const ki=Symbol("MODEL_PROP"),Ii=Symbol("NEW_DATA_PROP"),Fi=Symbol("OLD_DATA_PROP");class Ai extends Mi{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0}}get type(){return"UpdateAction"}get model(){return this[ki]}set model(e){this[ki]=e}get newData(){return this[Ii]}set newData(e){this[Ii]=Object.assign({},e)}get oldData(){return this[Fi]}set oldData(e){this[Fi]=Object.assign({},e)}undo(){this.model.set(this.oldData),this.model.$&&Object.assign(this.model,this.oldData)}redo(){this.model.set(this.newData),this.model.$&&Object.assign(this.model,this.newData)}}Ai._$name="UpdateAction";const Pi=Symbol("PARENT_MODEL_PROP"),Li=Symbol("CHILD_MODELS_PROP"),Oi=Symbol("INSERT_INDEX_PROP"),_i=Symbol("CONTEXT_PROP");class $i extends Mi{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,context:void 0}}get type(){return"InsertChildAction"}get parentModel(){return this[Pi]}set parentModel(e){this[Pi]=e}get childModels(){return this[Li]}set childModels(e){this[Li]=e.slice(0)}get insertIndex(){return this[Oi]}set insertIndex(e){this[Oi]=e}get context(){return this[_i]}set context(e){this[_i]=e}undo(){const{parentModel:e,context:t,childModels:r}=this;r.sort((e,r)=>{const{lhsParent:n,lhsIndex:s}=t.get(e)||{},{rhsParent:i,rhsIndex:o}=t.get(r)||{};return n&&n===i?s-o:0}),r.forEach(r=>{const{parent:n,index:s}=t.get(r)||{};if(n)if(n===e){let e;e=s>r.parentIndex?s+1:s,e=s===n.children.length-1?null:e;const t=n.children[e];n.insertChild(r,t)}else n.insertChild(r,n.children[s]);else e.removeChild(r)})}redo(){const{parentModel:e,insertIndex:t,childModels:r}=this,n=e.children[t];e.insertChild(r,n)}}$i._$name="InsertChildAction";const ji=Symbol("PARENT_MODEL_PROP"),Hi=Symbol("CHILD_MODELS_PROP"),Ni=Symbol("CONTEXT_PROP");class Bi extends Mi{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0}}get type(){return"RemoveChildAction"}get parentModel(){return this[ji]}set parentModel(e){this[ji]=e}get childModels(){return this[Hi]}set childModels(e){this[Hi]=e.slice(0)}get context(){return this[Ni]}set context(e){this[Ni]=e}undo(){const{parentModel:e,context:t,childModels:r}=this;r.sort((e,r)=>t.get(e)-t.get(r)),r.forEach(r=>{e.insertChild(t.get(r),r)})}redo(){this.parentModel.removeChild(this.childModels)}}Bi._$name="RemoveChildAction";const zi=Symbol("STORE_PROP"),Vi=Symbol("MODEL_LIST_PROP");class Wi extends Mi{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return"AddAction"}get store(){return this[zi]}set store(e){this[zi]=e}get modelList(){return this[Vi]}set modelList(e){this[Vi]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}}Wi._$name="AddAction";const Gi=Symbol("STORE_PROP"),Ui=Symbol("MODEL_LIST_PROP"),Yi=Symbol("INSERT_INDEX_PROP"),qi=Symbol("CONTEXT_PROP");class Xi extends Mi{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1}}get type(){return"InsertAction"}get store(){return this[Gi]}set store(e){this[Gi]=e}get modelList(){return this[Ui]}set modelList(e){this[Ui]=e.slice(0)}get insertIndex(){return this[Yi]}set insertIndex(e){this[Yi]=e}get context(){return this[qi]}set context(e){this[qi]=e}undo(){const{store:e,modelList:t,context:r,silent:n}=this;t.sort((e,t)=>{const n=r.get(e),s=r.get(t);return void 0!==n&&void 0!==s?n-s:0}),t.forEach(t=>{const s=r.get(t);void 0!==s?e.insert(s,t,n):e.remove(t,n)})}redo(){this.store.insert(this.insertIndex,this.modelList,this.silent)}}Xi._$name="InsertAction";const Ki=Symbol("STORE_PROP"),Zi=Symbol("MODEL_LIST_PROP"),Ji=Symbol("CONTEXT_PROP");class Qi extends Mi{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return"RemoveAction"}get store(){return this[Ki]}set store(e){this[Ki]=e}get modelList(){return this[Zi]}set modelList(e){this[Zi]=e.slice(0)}get context(){return this[Ji]}set context(e){this[Ji]=e}undo(){const{store:e,context:t,modelList:r,silent:n}=this;r.sort((e,r)=>t.get(e)-t.get(r)),r.forEach(r=>{const s=t.get(r);e.insert(s,r,n)})}redo(){this.store.remove(this.modelList,this.silent)}}Qi._$name="RemoveAction";const eo=Symbol("STORE_PROP"),to=Symbol("ALL_RECORDS_PROP");class ro extends Mi{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[eo]}set store(e){this[eo]=e}get allRecords(){return this[to]}set allRecords(e){this[to]=e.slice(0)}undo(){const{store:e,allRecords:t,silent:r}=this;e.add(t,r)}redo(){this.store.removeAll(this.silent)}}ro._$name="RemoveAllAction";const no=(e,t,r)=>new Ai({model:e,newData:t,oldData:r}),so=(e,t,r,n)=>new $i({parentModel:e,childModels:r,insertIndex:t,context:n}),io=(e,t,r)=>new Bi({parentModel:e,childModels:t,context:r}),oo=(e,t,r)=>new Wi({store:e,modelList:t,silent:r}),ao=(e,t,r,n,s)=>new Xi({store:e,insertIndex:t,modelList:r,context:n,silent:s}),lo=(e,t,r,n)=>new Qi({store:e,modelList:t,context:r,silent:n}),co=(e,t,r)=>new ro({store:e,allRecords:t,silent:r}),uo=(e,t,...r)=>{const n=t.call(e[ii],e,...r);if("string"==typeof n)e[ii]=mi(n);else if(n instanceof si)e[ii]=n;else if(Array.isArray(n)){const[t,s]=n;"string"==typeof t?e[ii]=mi(t):t instanceof si?e[ii]=t:t&&"object"==typeof t&&((e=Object.assign(e,t))[ii]=mi(e[ii])),"function"==typeof s&&uo(e,s,...r)}else n&&"object"==typeof n&&((e=Object.assign(e,n))[ii]=mi(e[ii]))};class ho extends(G(B)){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:no,makeModelInsertChildAction:so,makeModelRemoveChildAction:io,makeStoreModelAddAction:oo,makeStoreModelInsertAction:ao,makeStoreModelRemoveAction:lo,makeStoreRemoveAllAction:co,getTransactionTitle:null}}construct(...e){Object.assign(this,{[ii]:Ci,[oi]:[],[ai]:[],[li]:0,[ci]:null,[di]:null,[ui]:!1}),super.construct(...e)}doDestroy(){super.doDestroy(),this.destroyProperties(ii)}get state(){return this[ii]}get position(){return this[li]}get length(){return this[ai].length}get stores(){return Array.from(this[oi])}hasStore(e){return this[oi].includes(e)}addStore(e){this.hasStore(e)||(this[oi].push(e),e.stm=this)}removeStore(e){this.hasStore(e)&&(this[oi]=this[oi].filter(t=>t!==e),e.stm=null)}getStoreById(e){return this[oi].find(t=>t.id===e)}forEachStore(e){this[oi].forEach(t=>e(t,t.id))}get disabled(){return this.state===fi}set disabled(e){const t=this;t.disabled!=e&&(e?(uo(t,t.state.onDisable,t),t.trigger("stmDisabled",{disabled:!0})):(uo(t,t.state.onEnable,t),t.trigger("stmDisabled",{disabled:!1})))}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===Ci||this.state===Ei}get isRecording(){return this.state===Si||this.state===Ti}get autoRecord(){return this[ui]}set autoRecord(e){const t=this;t.autoRecord!=e&&uo(t,e?t.state.onAutoRecordOn:t.state.onAutoRecordOff,t)}startTransaction(e=null){uo(this,this.state.onStartTransaction,e)}stopTransaction(e=null){uo(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){uo(this,this.state.onStopTransactionDelayed)}rejectTransaction(){uo(this,this.state.onRejectTransaction)}get transaction(){return this[ci]}get queue(){return this[ai].map(e=>e.title)}get isRestoring(){return this.state===Di}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}undo(e=1){uo(this,this.state.onUndo,e)}undoAll(){this.undo(this.length)}redo(e=1){uo(this,this.state.onRedo,e)}redoAll(){this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){uo(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore(t=>{t.onStmRecordingStart&&t.onStmRecordingStart(this,e)}),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,t){this.forEachStore(r=>{r.onStmRecordingStop&&r.onStmRecordingStop(this,e,t)}),this.trigger("recordingStop",{stm:this,transaction:e,reason:t})}notifyStoresAboutStateRestoringStart(){this.forEachStore(e=>{e.onStmRestoringStart&&e.onStmRestoringStart(this)}),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop(){this.forEachStore(e=>{e.onStmRestoringStop&&e.onStmRestoringStop(this)}),this.trigger("restoringStop",{stm:this})}notifyStoresAboutQueueReset(e){this.forEachStore(t=>{t.onStmQueueReset&&t.onStmQueueReset(this,e)}),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,t,r){uo(this,this.state.onModelUpdate,e,t,r)}onModelInsertChild(e,t,r,n){uo(this,this.state.onModelInsertChild,e,t,r,n)}onModelRemoveChild(e,t,r){uo(this,this.state.onModelRemoveChild,e,t,r)}onStoreModelAdd(e,t,r){uo(this,this.state.onStoreModelAdd,e,t,r)}onStoreModelInsert(e,t,r,n,s){uo(this,this.state.onStoreModelInsert,e,t,r,n,s)}onStoreModelRemove(e,t,r,n){uo(this,this.state.onStoreModelRemove,e,t,r,n)}onStoreRemoveAll(e,t,r){uo(this,this.state.onStoreRemoveAll,e,t,r)}}ho._$name="StateTrackingManager";class go{static insertRule(e){const{styleSheet:t}=this,r=t.cssRules.length;if(t.insertRule(e,0),t.cssRules.length>r)return t.cssRules[0]}static findRule(e){let t,r="function"==typeof e;return Array.prototype.find.call(document.head.querySelectorAll("link[rel=stylesheet],style[type*=css]"),n=>{if(t=Array.prototype.find.call(n.sheet.rules||n.sheet.cssRules,t=>r?e(t):t.selectorText===e),t)return!0}),t}static get styleSheet(){return this._stylesheet||(this._stylesheet=Et.createElement({tag:"style",id:"bryntum-private-styles",type:"text/css",parent:document.head}).sheet),this._stylesheet}}go._$name="CSSHelper";const mo=Array.prototype.slice,po={ignore:{_element:1,parent:1,elementData:1,ns:1},evaluate(e,t,r){if("html"===e&&"string"!=typeof t.value&&"compareHtml"in t.object)return t.object.compareHtml===r.object.compareHtml}},fo={tag:1,html:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,_element:1,elementData:1,retainElement:1,compareHtml:1,syncOptions:1,isReleased:1},vo={class:1,className:1,classname:1},yo=Object.freeze([]);class bo{static sync(e){return this.performSync(e,e.targetElement),e.targetElement}static performSync(e,t){const{domConfig:r,callback:n}=e;return(e.configEquality?e.configEquality(r,t.lastDomConfig,po):ze.isDeeplyEqual(r,t.lastDomConfig,po))?(this.relinkElements(r,t),n&&n({action:"none",domConfig:r,targetElement:t}),!1):(r?(r.onlyChildren||(this.syncAttributes(r,t),this.syncContent(r,t)),this.syncChildren(e,t),r._element=t):(t.innerHTML=null,t.syncIdMap=null),t.lastDomConfig=r,!0)}static relinkElements(e,t){e._element=t,e.children&&e.children.forEach((e,r)=>{e&&"string"!=typeof e&&this.relinkElements(e,t.lastDomConfig.children[r]._element)})}static syncDataset(e,t){const{lastDomConfig:r}=t,n=e===r,s=Object.keys(e.dataset),i=r&&r.dataset&&Object.keys(r.dataset),o=z.delta(s,i);for(let r=0;r<o.onlyInA.length;r++){const n=o.onlyInA[r];t.setAttribute("data-"+I.hyphenate(n),e.dataset[n])}for(let s=0;s<o.inBoth.length;s++){const i=o.inBoth[s];(n||e.dataset[i]!=r.dataset[i])&&t.setAttribute("data-"+I.hyphenate(i),e.dataset[i])}for(let e=0;e<o.onlyInB.length;e++)t.removeAttribute("data-"+I.hyphenate(o.onlyInB[e]))}static syncClassList(e,t){const r=e.className||e.class,n="object"==typeof r?ze.getTruthyKeys(r).join(" "):r;t.setAttribute("class",n)}static getSyncAttributes(e){const t={},r=[];return e&&Object.keys(e).forEach(n=>{if(!fo[n]){const s=n.toLowerCase();t[s]=e[n],r.push(s)}}),{attributes:t,names:r}}static syncAttributes(e,t){const{lastDomConfig:r}=t,n=e===r,s=this.getSyncAttributes(e),{attributes:i,names:o}=s,{attributes:a,names:l}=n?s:this.getSyncAttributes(r),{onlyInA:c,onlyInB:d,inBoth:u}=n?{onlyInA:yo,onlyInB:yo,inBoth:o}:z.delta(o,l);for(let r=0;r<c.length;r++){const n=c[r],s=i[n];"style"===n?Et.applyStyle(t,s,!0):"dataset"===n?this.syncDataset(e,t):vo[n]?this.syncClassList(e,t):t.setAttribute(n,s)}for(let e=0;e<d.length;e++)t.removeAttribute(d[e]);for(let r=0;r<u.length;r++){const s=u[r],o=i[s],l=a[s];null==o?t.removeAttribute(s):"style"===s?!n&&ze.isEqual(o,l,!0)||Et.applyStyle(t,o,!0):"dataset"===s?this.syncDataset(e,t):vo[s]?this.syncClassList(e,t):(n||o!==l)&&t.setAttribute(s,o)}}static syncContent(e,t){const{html:r}=e;e.elementData&&(t.elementData=e.elementData),null!=r&&(r instanceof DocumentFragment?1===t.childNodes.length&&0===t.childElementCount&&1===r.childNodes.length&&0===r.childElementCount?Et.setInnerText(t,r.firstChild.data):(t.innerHTML="",t.appendChild(r)):String(r).includes("<")?t.innerHTML=r:Et.setInnerText(t,r))}static appendTextNode(e,t,r){const n=document.createTextNode(e);t.appendChild(n),r&&r({action:"newNode",domConfig:e,targetElement:n})}static insertElement(e,t,r,n,s){const i=s.ns?document.createElementNS(s.ns,e.tag||"svg"):document.createElement(e.tag||"div");t.insertBefore(i,r),this.performSync(s,i),null!=n&&(t.syncIdMap[n]=i),s.callback&&s.callback({action:"newElement",domConfig:e,targetElement:i,syncId:n})}static syncChildren(e,t){let{domConfig:r,syncIdField:n,callback:s,releaseThreshold:i,configEquality:o,ns:a}=e;if(r.html)return;const l=this,c=mo.call(r.children||[]),d=mo.call(t.childNodes),u=t.syncIdMap||{},h=r.syncOptions||{};let g;n=h.syncIdField||n,s=h.callback||s,o=h.configEquality||o,i="releaseThreshold"in h?h.releaseThreshold:i,n&&(t.syncIdMap={});const m={syncIdField:n,releaseThreshold:i,callback:s,configEquality:o};for(;c.length;){const e=c.shift();if(g=null,!e)continue;const r="string"==typeof e;if(m.domConfig=e,m.ns=e.ns||a,!r){if(n&&e.dataset&&(g=e.dataset[n],null!=g&&!e.unmatched)){const r=u[g];r?(!e.retainElement&&l.performSync(m,r)&&s&&s({action:"reuseOwnElement",domConfig:e,targetElement:r,syncId:g}),e.retainElement?(r.retainElement=!0,e._element=r):r.retainElement&&(r.retainElement=!1),t.syncIdMap[g]=r,z.remove(d,r),r.isReleased=!1):(c.push(e),e.unmatched=!0);continue}e.unmatched&&delete e.unmatched}let i;for(let e=0;e<d.length&&!i;e++)d[e].retainElement||(i=d[e],0===e?d.shift():d.splice(e,1));if(i)if(i.nodeType===Node.ELEMENT_NODE&&(e.tag||"div").toLowerCase()===i.tagName.toLowerCase()){const{lastDomConfig:r}=i,n=l.performSync(m,i);null!=g&&(t.syncIdMap[g]=i),i.isReleased=!1,n&&s&&s({action:"reuseElement",domConfig:e,lastDomConfig:r,targetElement:i,syncId:g})}else r&&i.nodeType===Node.TEXT_NODE?i.data=e:(r?this.appendTextNode(e,t,s):this.insertElement(e,t,i,g,m),i.remove());else r?this.appendTextNode(e,t,s):this.insertElement(e,t,null,g,m)}let p=0;d.forEach(e=>{const{lastDomConfig:r}=e;e.retainElement?n&&e.lastDomConfig&&(t.syncIdMap[e.dataset[n]]=e):n&&(null==i||p<i)?(e.isReleased||(e.className="b-released",e.isReleased=!0,s&&s({action:"releaseElement",domConfig:r,lastDomConfig:r,targetElement:e}),r&&(r.isReleased=!0,r.className&&(r.className="b-released")),e.elementData=e.lastConfig=null),p++):(e.remove(),s&&s({action:"removeElement",domConfig:e.lastDomConfig,lastDomConfig:e.lastDomConfig,targetElement:e}))})}}bo._$name="DomSync";var Co=e=>class extends(e||B){initContainerDrag(){if(this.mode||(this.mode="container"),"container"===this.mode&&!this.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(e){const t=this;if(!t.ignoreSelector||!Et.up(e.target,t.ignoreSelector)){const r=Et.getAncestor(e.target,t.containers,t.outerElement);if(r){const n=r.getBoundingClientRect();t.context={element:r,valid:!0,action:"container",offsetX:e.pageX-n.left,offsetY:e.pageY-n.top,originalPosition:{parent:r.parentElement,prev:r.previousElementSibling,next:r.nextElementSibling}}}return!0}return!1}startContainerDrag(e){const{context:t}=this,{element:r}=t,n=r.cloneNode(!0),s=r.getBoundingClientRect();n.classList.add(this.dragProxyCls),n.classList.add(this.draggingCls),document.body.appendChild(n),t.dragProxy=n,n.style.width=s.width+"px",n.style.height=s.height+"px",Et.setTranslateXY(t.dragProxy,s.left,s.top),t.dragging=r,r.classList.add(this.dropPlaceholderCls)}updateContainerDrag(e){const t=this,r=t.context;if(!r.started||!r.targetElement)return;const n=Et.getAncestor(r.targetElement,t.containers,"b-grid"),s=r.dragging&&r.dragging.contains(document.activeElement);n&&Et.isDescendant(r.element,n)||(s&&Yr.suspendFocusEvents(),n&&r.valid?t.moveNextTo(n,e):t.revertPosition(),s&&Yr.resumeFocusEvents(),e.preventDefault())}finishContainerDrag(e){const t=this,r=t.context,{dragging:n,dragProxy:s,valid:i,draggedTo:o,insertBefore:a,originalPosition:l}=r;n&&(r.valid=i&&o&&(n!==a||l.parent!==o),r.finalize=(e=r.valid)=>{!e&&this.context&&t.revertPosition(),n.classList.remove(t.dropPlaceholderCls),s.remove(),t.reset()},r.async=!1,t.trigger("drop",{context:r,event:e}),r.async?r.awaitingFinalization=!0:r.finalize())}abortContainerDrag(e=!1,t=null,r=!1){const n=this,s=n.context;s.dragging&&(s.dragging.classList.remove(n.dropPlaceholderCls),s.dragProxy.remove(),n.context={}),r||n.trigger(e?"drop":"abort",{context:s,event:t})}updateContainerProxy(e){const t=this,r=t.context,n=r.dragProxy;let s,i=e.pageX-r.offsetX,o=e.pageY-r.offsetY;if("number"==typeof t.minX&&(i=Math.max(t.minX,i)),"number"==typeof t.maxX&&(i=Math.min(t.maxX-n.offsetWidth,i)),"number"==typeof t.minY&&(o=Math.max(t.minY,o)),"number"==typeof t.maxY&&(o=Math.min(t.maxY-n.offsetHeight,o)),t.lockX?Et.setTranslateY(n,o):t.lockY?Et.setTranslateX(n,i):Et.setTranslateXY(n,i,o),"touchmove"===e.type){let t=e.changedTouches[0];s=document.elementFromPoint(t.clientX,t.clientY)}else s=e.target;r.targetElement=s}moveNextTo(e,t){const r=this.context,n=r.dragging,s=e.parentElement;if(e!==n){const i=e.getBoundingClientRect().left+e.offsetWidth/2;t.pageX<i?(s.insertBefore(n,e),r.insertBefore=e):e.nextElementSibling?e.nextElementSibling!==n?(r.insertBefore=e.nextElementSibling,s.insertBefore(n,e.nextElementSibling)):r.insertBefore||n.parentElement.lastElementChild===n||(r.insertBefore=e.nextElementSibling):(s.appendChild(n),r.insertBefore=null),r.draggedTo=s}}revertPosition(){const e=this.context,t=e.originalPosition;if(t.next){t.next&&t.next.previousSibling===e.dragging||!t.next&&e.dragging===t.parent.lastChild||t.parent.insertBefore(e.dragging,t.next)}else t.parent.appendChild(e.dragging);e.draggedTo=null}};const wo={pageXOffset:0,pageYOffset:0};var So=e=>class extends(br(e||B)){initTranslateDrag(){const e=this;e.mode=e.mode||"translateXY",!e.isElementDraggable&&e.targetSelector&&(e.isElementDraggable=t=>Et.up(t,e.targetSelector))}grabTranslateDrag(e){const t=this,r=t.getTarget(e);return!!r&&(t.context={valid:!0,action:t.mode,element:r,startPageX:e.pageX,startPageY:e.pageY,startClientX:e.clientX,startClientY:e.clientY},!0)}getTarget(e){return Et.up(e.target,this.targetSelector)}startTranslateDrag(e){const t=this,r=t.context,{relatedElements:n}=r;let s=r.dragProxy||r.element;if(s&&!r.started){const i=s,o=s.parentElement,a=t.dragWithin=t.dragWithin||t.cloneTarget&&document.body,l=t.outerElement;if(t.cloneTarget){const e=Et.getOffsetX(s,a),r=Et.getOffsetY(s,a),n=s.offsetWidth,o=s.offsetHeight;s=this.createProxy(s),Et.setTranslateXY(s,e,r),s.style.width=n+"px",s.style.height=o+"px",s.classList.add(t.dragProxyCls),a.appendChild(s),i.classList.add("b-drag-original"),t.hideOriginalElement&&i.classList.add("b-hidden")}Object.assign(t.context,{element:s,grabbed:i,grabbedParent:o,grabbedNextSibling:s.nextElementSibling,elementStartX:Et.getTranslateX(s),elementStartY:Et.getTranslateY(s),elementX:Et.getOffsetX(s,a||l),elementY:Et.getOffsetY(s,a||l),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!t.cloneTarget||a===l}),s.classList.add(t.draggingCls),a&&(r.parentElement=s.parentElement,a!==s.parentElement&&a.appendChild(s),t.updateTranslateProxy(e)),n&&n.forEach(e=>{e.classList.add(t.draggingCls)})}}applyConstraints(e,t,r){const n=this,s=n.dragWithin,{pageXOffset:i,pageYOffset:o}=s===document.body?window:wo;return s&&n.constrain&&(t<0&&(t=0),t+e.offsetWidth>s.scrollWidth&&(t=s.scrollWidth-e.offsetWidth),r<0&&(r=0),r+e.offsetHeight>s.scrollHeight&&(r=s.scrollHeight-e.offsetHeight)),"number"==typeof n.minX&&(t=Math.max(n.minX+i,t)),"number"==typeof n.maxX&&(t=Math.min(n.maxX+i,t)),"number"==typeof n.minY&&(r=Math.max(n.minY+o,r)),"number"==typeof n.maxY&&(r=Math.min(n.maxY+o,r)),{constrainedX:t,constrainedY:r}}updateTranslateProxy(e,t){const{mode:r,lockX:n,lockY:s}=this,i=this.context,o=i.dragProxy||i.element,{relatedElements:a,relatedElDragFromPos:l}=i;i.scrollManagerElementContainsDragProxy&&t&&(i.scrollX=t.scrollRelativeLeft,i.scrollY=t.scrollRelativeTop),i.pageX=e.pageX,i.pageY=e.pageY,i.clientX=e.clientX,i.clientY=e.clientY;const c=i.elementStartX+e.pageX-i.startPageX+i.scrollX,d=i.elementStartY+e.pageY-i.startPageY+i.scrollY,{constrainedX:u,constrainedY:h}=this.applyConstraints(o,c,d);if("translateXY"!==r||n||s?"translateX"===r||s?Et.setTranslateX(o,u):("translateY"===r||n)&&Et.setTranslateY(o,h):Et.setTranslateXY(o,u,h),a){const e=n||"translateY"===r?0:u-i.elementStartX,t=s||"translateX"===r?0:h-i.elementStartY;a.forEach((r,n)=>{const[s,i]=l[n];Et.setTranslateXY(r,s+e,i+t)})}i.newX=u,i.newY=h}finishTranslateDrag(e){const t=this,r=t.context,n=r.newX!==r.elementStartX,s=r.newY!==r.elementStartY,i=r.dragProxy||r.element,{relatedElements:o}=r;function a(){i.classList.remove(t.invalidCls),i.classList.remove(t.draggingCls),o&&o.forEach(e=>{e.classList.remove(t.invalidCls),e.classList.remove(t.draggingCls)}),i.classList.contains("b-aborting")||(t.hideOriginalElement&&r.grabbed.classList.remove("b-hidden"),r.grabbed.classList.remove("b-drag-original"))}if(!t.ignoreSamePositionDrop||"translateY"!==t.mode&&n||"translateX"!==t.mode&&s){if(!1===r.valid)t.abortTranslateDrag(!0,e);else{const n=Xt.from(t.dragWithin||t.outerElement);!t.minX&&e.pageX<n.left||!t.maxX&&e.pageX>n.right||!t.minY&&e.pageY<n.top||!t.maxY&&e.pageY>n.bottom?(r.valid=!1,t.abortTranslateDrag(!0,e)):(r.finalize=(e=r.valid)=>{r.asyncCleanup&&a(),!e&&t.context?t.abortTranslateDrag(!0,null,!0):(t.cloneTarget||r.dragProxy)&&i.remove(),t.reset()},r.async=!1,t.trigger("drop",{context:r,event:e}),r.async?r.awaitingFinalization=!0:r.finalize())}r.asyncCleanup||a()}else t.abortTranslateDrag(!1,e)}abortTranslateDrag(e=!1,t=null,r=!1){const n=this,s=n.context,{relatedElements:i,relatedElStartPos:o,grabbed:a}=s,l=s.dragProxy||s.element,c=n.cloneTarget&&n.hideOriginalElement?a:l;let{elementStartX:d,elementStartY:u}=s;l&&s.started&&(!n.cloneTarget&&n.dragWithin&&n.dragWithin!==s.grabbedParent&&s.grabbedParent.insertBefore(l,s.grabbedNextSibling),a.classList.remove("b-hidden"),n.cloneTarget&&(n.hideOriginalElement&&([d,u]=Et.getTranslateXY(a),Et.alignTo(a,l),c.getBoundingClientRect()),l.remove()),c.classList.add("b-aborting"),"translateXY"!==n.mode||n.lockX||n.lockY||(Et.setTranslateXY(c,d,u),i&&i.forEach((e,t)=>{e.classList.add("b-aborting"),Et.setTranslateXY(e,o[t][0],o[t][1])})),("translateX"===n.mode||n.lockY)&&(Et.setTranslateX(c,d),i&&i.forEach((e,t)=>{e.classList.add("b-aborting"),Et.setTranslateX(e,o[t][0])})),("translateY"===n.mode||n.lockX)&&(Et.setTranslateY(c,u),i&&i.forEach((e,t)=>{e.classList.add("b-aborting"),Et.setTranslateY(e,o[t][1])})),n.setTimeout(()=>{c.classList.remove("b-aborting"),a.classList.remove("b-dragging"),a.classList.remove("b-drag-original"),n.cloneTarget||(i&&i.forEach((e,t)=>{e.classList.remove("b-aborting")}),l.classList.remove("b-aborting"),l.classList.remove(n.draggingCls),l.classList.remove(n.invalidCls))},n.transitionDuration,void 0,!0),r||n.trigger(e?"drop":"abort",{context:s,event:t})),n.reset()}};const Do="onMouseDown",Eo="onMouseMove",xo="onMouseUp",To="onDocumentClick",Ro="onTouchStart",Mo="onTouchMove",ko="onTouchEnd",Io="onKeyDown";class Fo extends(Qn(B).mixes(G,Co,So)){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:null,isElementDraggable:null,targetSelector:null,dropTargetSelector:null,cloneTarget:!1,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,transitionDuration:300,clickSwallowDuration:50,ignoreSamePositionDrop:!0,testConfig:{transitionDuration:10,clickSwallowDuration:P.isEdge?300:50}}}construct(e){const t=this;super.construct(e),t.initListeners(),"container"===t.mode?t.initContainerDrag():t.mode.startsWith("translate")&&t.initTranslateDrag(),t.initialMode=t.mode}doDestroy(){this.abort(!0),super.doDestroy()}initListeners(){const e={element:this.outerElement,mousedown:Do,thisObj:this};P.isTouchDevice&&(e.touchstart=Ro),gr.on(e)}onPointerDown(e){let t=this,r=!1,n="touches"in e;if(t.context)t.context.awaitingFinalization||(t.onMouseUp(e),t.reset());else if(t.startEvent=e,(!t.isElementDraggable||t.isElementDraggable(e.target,e))&&(t.mode&&(r||"container"!==t.mode||(r=t.grabContainerDrag(e)),!r&&t.mode.startsWith("translate")&&(r=t.grabTranslateDrag(e))),r)){const e={element:document,thisObj:t,keydown:Io};if(n?(e.touchmove={handler:Mo,passive:!1},e.touchend=e.pointerup=ko):(e.mousemove=Eo,e.mouseup=xo),t.removeListeners=gr.on(e),t.dragWithin&&t.dragWithin!==t.outerElement){const e=t.dragWithin.getBoundingClientRect();t.minY=e.top,t.maxY=e.bottom,t.minX=e.left,t.maxX=e.right}}}onTouchStart(e){const t=this;1===e.touches.length&&(t.touchStartTimer=t.setTimeout(()=>{t.touchStartTimer=null},t.touchStartDelay,"touchStartDelay"),t.onPointerDown(e))}onMouseDown(e){0===e.button&&this.onPointerDown(e)}internalMove(e){const t=this,r=t.context,n=gr.getDistanceBetween(t.startEvent,e);if(t.touchStartTimer&&n>t.dragThreshold)t.abort(!0);else if(!t.touchStartTimer&&r&&r.element&&e.target&&e.target.nodeType===Node.ELEMENT_NODE&&(r.started||n>=t.dragThreshold)){if(!r.started&&!1===t.callPreventable("dragStart",{context:r,event:e},()=>{"container"!==t.mode&&(t.lockY?t.mode="translateX":t.lockX?t.mode="translateY":t.mode=t.initialMode);const n=t.lockX?"vertical":t.lockY?"horizontal":"both";r.action.startsWith("translate")?t.startTranslateDrag(e):"container"===r.action&&t.startContainerDrag(e),r.started=!0,t.scrollManager&&t.scrollManager.startMonitoring({direction:n,element:t.dragWithin||t.outerElement,callback:e=>{t.context.element&&t.lastMouseMoveEvent&&(t.lastMouseMoveEvent.isScroll=!0,t.update(t.lastMouseMoveEvent,e))},thisObj:t}),document.body.classList.add("b-draghelper-active")}))return t.abort();"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation()),t.update(e)}}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,t){const r=this,n=r.context,s=n.dragProxy||n.element;let i=e.target,o=document.scrollingElement||document.body;if("touchmove"===e.type){const t=e.changedTouches[0];i=Et.elementFromPoint(t.clientX+o.scrollLeft,t.clientY+o.scrollTop)}n.target=i,r.dropTargetSelector?n.valid=Boolean(i.closest(r.dropTargetSelector)):n.valid=!0,n.action&&("container"===n.action&&r.updateContainerProxy(e,t),n.action.startsWith("translate")&&r.updateTranslateProxy(e,t)),r.trigger("drag",{context:n,event:e}),"container"===n.action&&r.updateContainerDrag(e,t),s.classList[n.valid?"remove":"add"](r.invalidCls),e&&(r.lastMouseMoveEvent=e)}abort(e=!1){const t=this,r=t.context;t.scrollManager&&t.scrollManager.stopMonitoring(t.dragWithin||t.outerElement),r&&(r.element.getBoundingClientRect(),r.valid=!1,"container"===r.action?t.abortContainerDrag(void 0,void 0,e):t.abortTranslateDrag(void 0,void 0,e)),t.reset()}removeListeners(){}reset(e){document.body.classList.remove("b-draghelper-active"),this.removeListeners(),e||this.trigger("reset"),this.context=this.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){const t=this,r=t.context;t.removeListeners(),r&&(t.scrollManager&&t.scrollManager.stopMonitoring(t.dragWithin||t.outerElement),"container"===r.action?t.finishContainerDrag(e):r.started&&r.action.startsWith("translate")&&t.finishTranslateDrag(e),r.started?gr.on({element:document,thisObj:t,click:To,capture:!0,expires:t.clickSwallowDuration,once:!0}):t.reset(!0))}onKeyDown(e){"Escape"===e.key&&this.abort()}createProxy(e){const t=e.cloneNode(!0);return t.removeAttribute("id"),t}}Fo._$name="DragHelper";const Ao="onMouseDown",Po="onMouseMove",Lo="onMouseUp",Oo="onDocumentClick",_o="onTouchStart",$o="onTouchMove",jo="onTouchEnd",Ho="onKeyDown";class No extends(G(B)){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50}}construct(e){const t=this;super.construct(e),!t.handleSelector&&P.isTouchDevice&&(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=t=>Et.up(t,e.targetSelector)),e.grab){const{edge:t,element:r,event:n}=e.grab;e.startEvent=n,e.context={element:r,edge:t,valid:!0,async:!1,elementStartX:Et.getTranslateX(r)||r.offsetLeft,elementStartY:Et.getTranslateY(r)||r.offsetTop,newX:Et.getTranslateX(r)||r.offsetLeft,newY:Et.getTranslateY(r)||r.offsetTop,elementWidth:r.offsetWidth,elementHeight:r.offsetHeight,startX:n.clientX+e.scrollLeft,startY:n.clientY+e.scrollTop,finalize:()=>e.reset&&e.reset()},r.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:Ao,thisObj:e};P.isTouchDevice?t.touchstart=_o:e.handleSelector||(t.mousemove={handler:Po,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),e.removeListeners=gr.on(t)}removeListeners(){}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){const t={element:document,keydown:Ho,thisObj:this};e?(t.touchmove=$o,t.touchend=t.pointerup=jo):(t.mousemove=Po,t.mouseup=Lo),this.removeDragListeners=gr.on(t)}removeDragListeners(){}reset(){this.removeDragListeners&&this.removeDragListeners(),this.context=null}onPointerDown(e,t){const r=this;r.startEvent=t,r.isElementResizable&&!r.isElementResizable(t.target,t)||r.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),r.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){0===e.button&&this.onPointerDown(!1,e)}internalMove(e,t){const r=this,n=r.context;n&&n.element&&(n.started||gr.getDistanceBetween(r.startEvent,t)>=r.dragThreshold)?(n.started||(r.scrollManager&&r.scrollManager.startMonitoring({direction:r.direction,element:r.dragWithin||r.outerElement,callback:e=>r.context&&r.context.element&&r.lastMouseMoveEvent&&r.update(r.lastMouseMoveEvent,e),thisObj:r}),r.trigger("resizeStart",{context:n,event:t}),n.started=!0),r.update(t)):e||r.handleSelector||r.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.context,this.internalMove(!1,e)}onPointerUp(e,t){const r=this,n=r.context;r.removeDragListeners(),n&&(r.scrollManager&&r.scrollManager.stopMonitoring(r.dragWithin||r.outerElement),n.started&&gr.on({element:document,thisObj:r,click:Oo,expires:r.clickSwallowDuration,capture:!0,once:!0}),r.finishResize(t),r.isDestroyed||n.async||r.reset())}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){"Escape"===e.key&&this.abort()}update(e){const t=this,r=t.context,n=Xt.from(t.outerElement.parentElement);r.currentX=Math.max(Math.min(e.clientX,n.right-1),n.x)+t.scrollLeft,r.currentY=Math.max(Math.min(e.clientY,n.bottom-1),n.y)+t.scrollTop,t.updateResize(e),t.trigger("resizing",{context:r,event:e}),r.element.classList[!1===r.valid?"add":"remove"](t.invalidCls),e&&(t.lastMouseMoveEvent=e)}abort(e=!1){const t=this;t.scrollManager&&t.scrollManager.stopMonitoring(t.dragWithin||t.outerElement),t.context?t.abortResize(null,e):t.isDestroyed||t.reset()}grabResizeHandle(e,t){const r=this;if(r.allowResize&&!r.allowResize(t.target,t))return!1;const n=r.handleSelector,s="touchstart"===t.type?t.changedTouches[0]:t,i=s.clientX,o=s.clientY,a=r.targetSelector?Et.up(t.target,r.targetSelector):t.target;if(a){let s;if(n){if(!t.target.matches(n))return!1;s="horizontal"===r.direction?t.pageX<Et.getPageX(a)+a.offsetWidth/2?"left":"right":t.pageY<Et.getPageY(a)+a.offsetHeight/2?"top":"bottom"}else if("horizontal"===r.direction?r.overLeftHandle(t,a)?s="left":r.overRightHandle(t,a)&&(s="right"):r.overTopHandle(t,a)?s="top":r.overBottomHandle(t,a)&&(s="bottom"),!s)return r.context=null,!1;if("touchstart"===t.type&&t.preventDefault(),!1!==r.trigger("beforeResizeStart",{element:a,event:t}))return r.context={element:a,edge:s,valid:!0,async:!1,direction:r.direction,isTouch:e,elementStartX:Et.getTranslateX(a)||a.offsetLeft,elementStartY:Et.getTranslateY(a)||a.offsetTop,newX:Et.getTranslateX(a)||a.offsetLeft,newY:Et.getTranslateY(a)||a.offsetTop,elementWidth:a.offsetWidth,elementHeight:a.offsetHeight,startX:i+r.scrollLeft,startY:o+r.scrollTop,finalize:()=>r.reset&&r.reset()},a.classList.add(r.resizingCls),!0}return!1}checkResizeHandles(e){const t=this,r=t.targetSelector?Et.up(e.target,t.targetSelector):e.target;if(!r||t.allowResize&&!t.allowResize(e.target,e))t.currentElement&&t.unHighlightHandle();else if(t.currentElement=t.handleContainerSelector?Et.up(e.target,t.handleContainerSelector):e.target,t.currentElement){let n=!1;n="horizontal"===t.direction?t.overLeftHandle(e,r)||t.overRightHandle(e,r):t.overTopHandle(e,r)||t.overBottomHandle(e,r),n?t.highlightHandle():t.unHighlightHandle()}}onMouseLeaveTarget(e){const t=this;t.currentElement=t.handleContainerSelector?Et.up(e.target,t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}updateResize(e){const t=this,r=t.context;t.allowEdgeSwitch&&("horizontal"===t.direction?r.edge=r.currentX>r.startX?"right":"left":r.edge=r.currentY>r.startY?"bottom":"top");let n=r.currentX-r.startX,s=r.currentY-r.startY,i=Et.getExtremalSizePX(r.element,"minWidth")||t.minWidth,o=Et.getExtremalSizePX(r.element,"maxWidth")||t.maxWidth,a=Et.getExtremalSizePX(r.element,"minHeight")||t.minHeight,l=Et.getExtremalSizePX(r.element,"maxHeight")||t.maxHeight,c="right"===r.edge||"bottom"===r.edge?1:-1,d=r.elementWidth+n*c,u=Math.max(i,d),h=r.elementHeight+s*c,g=Math.max(a,h);o>0&&(u=Math.min(u,o)),l>0&&(g=Math.min(g,l)),r.element.style.flex&&(r.element.style.flex=""),"horizontal"===t.direction?(r.element.style.width=Math.abs(u)+"px",r.newWidth=u,"left"===r.edge||u<0?(r.newX=Math.max(Math.min(r.elementStartX+r.elementWidth-t.minWidth,r.elementStartX+n),0),t.skipTranslate||Et.setTranslateX(r.element,r.newX)):"right"===r.edge&&t.allowEdgeSwitch&&!t.skipTranslate&&Et.setTranslateX(r.element,r.elementStartX)):(r.element.style.height=Math.abs(g)+"px",r.newHeight=g,"top"===r.edge||g<0?(r.newY=Math.max(Math.min(r.elementStartY+r.elementHeight-t.minHeight,r.elementStartY+s),0),t.skipTranslate||Et.setTranslateY(r.element,r.newY)):"bottom"===r.edge&&t.allowEdgeSwitch&&!t.skipTranslate&&Et.setTranslateY(r.element,r.elementStartY))}finishResize(e){const t=this,r=t.context,n={context:r,event:e};if(r.element.classList.remove(t.resizingCls),r.started){let e=!1;e="horizontal"===t.direction?r.newWidth&&r.newWidth!==r.elementWidth:r.newHeight&&r.newHeight!==r.elementHeight,t.trigger(e?"resize":"cancel",n),r.async||r.finalize()}}abortResize(e=null,t=!1){const r=this,n=r.context;n.element.classList.remove(r.resizingCls),"horizontal"===r.direction?(Et.setTranslateX(n.element,n.elementStartX),n.element.style.width=n.elementWidth+"px"):(Et.setTranslateY(n.element,n.elementStartY),n.element.style.height=n.elementHeight+"px"),!t&&r.trigger("cancel",{context:n,event:e}),r.isDestroyed||r.reset()}highlightHandle(){const e=this,t=e.targetSelector?Et.up(e.currentElement,e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,t=e.targetSelector?Et.up(e.currentElement,e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}overStartHandle(e,t){return"horizontal"===this.direction?this.overLeftHandle(e,t):this.overTopHandle(e,t)}overEndHandle(e,t){return"horizontal"===this.direction?this.overRightHandle(e,t):this.overBottomHandle(e,t)}getDynamicHandleSize(e,t){const r=e?2:1,{handleSize:n}=this;return this.dynamicHandleSize&&n*r>t-this.reservedSpace?Math.max((t-this.reservedSpace)/r,1):n}overLeftHandle(e,t){const r=this,{offsetWidth:n}=t;if(r.leftHandle&&(n>=r.handleVisibilityThreshold||r.dynamicHandleSize)){const s=Xt.from(t);return s.width=r.getDynamicHandleSize(r.rightHandle,n),s.contains(gr.getPagePoint(e))}return!1}overRightHandle(e,t){const r=this,{offsetWidth:n}=t;if(r.rightHandle&&(n>=r.handleVisibilityThreshold||r.dynamicHandleSize)){const s=Xt.from(t);return s.x=s.right-r.getDynamicHandleSize(r.leftHandle,n),s.contains(gr.getPagePoint(e))}return!1}overTopHandle(e,t){const r=this,{offsetHeight:n}=t;if(r.topHandle&&(n>=r.handleVisibilityThreshold||r.dynamicHandleSize)){const s=Xt.from(t);return s.height=r.getDynamicHandleSize(r.bottomHandle,n),s.contains(gr.getPagePoint(e))}return!1}overBottomHandle(e,t){const r=this,{offsetHeight:n}=t;if(r.bottomHandle&&(n>=r.handleVisibilityThreshold||r.dynamicHandleSize)){const s=Xt.from(t);return s.y=s.bottom-r.getDynamicHandleSize(r.bottomHandle,n),s.contains(gr.getPagePoint(e))}return!1}}No._$name="ResizeHelper";class Bo{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){let t,r=this.randomCache;return r[e]?t=r[e]:(t=this.random100.filter(t=>t<e),r[e]=t),t[this.rndIndex++%t.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}}Bo._$name="RandomGenerator";class zo{static reset(){this.rnd.reset(),this.rndTime.reset(),this.rndRating.reset()}static*generate(e,t=!1,r=1){const n=this,s=n.rnd,i=n.rndTime,o=n.rndRating,a=n.firstNames,l=n.surNames,c=n.teams,d=n.foods,u=n.colors,h=n.cities;for(let n=0;n<e;n++){const g=s.fromArray(a),m=s.fromArray(l),p=`${g} ${String.fromCharCode(65+n%25)} ${m}`,f=s.nextRandom(60)+1,v=new Date(2019,0,f),y=new Date(2019,0,f+s.nextRandom(30)+2),b={id:n+r,title:"Row "+n,name:p,firstName:g,surName:m,city:s.fromArray(h),team:s.fromArray(h)+" "+s.fromArray(c),age:10+s.nextRandom(80),food:s.fromArray(d),color:s.fromArray(u),score:10*s.nextRandom(100),rank:s.nextRandom(100)+1,start:v,finish:y,time:je.getTime(i.nextRandom(24),5*i.nextRandom(12)),percent:s.nextRandom(100),done:s.nextRandom(100)<50,rating:o.nextRandom(5),relatedTo:Math.min(e-1,n+r+s.nextRandom(10))};t&&(b.rowHeight=5*s.nextRandom(!0===t?20:t)+20),yield b}}static generateData(e,t=!1,r=1,n=!0){n&&this.reset();const s=[],i=zo.overrideRowCount?zo.overrideRowCount:e,o=this.generate(i,t,r);for(let e=0;e<i;e++)s.push(o.next().value);return s}}Object.assign(zo,{rnd:new Bo,rndTime:new Bo,rndRating:new Bo,cities:["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Moscow"],firstNames:["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"],surNames:["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"],teams:["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"],foods:["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"],colors:["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"]}),zo._$name="DataGenerator";const Vo=["action","target","to","deltaX","deltaY","x","y","text"];class Wo extends(G(br())){static get defaultConfig(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}construct(e){super.construct(e);const t=this;t.widget&&(t.outerElement=t.widget.element,t.widget.playingDemo=!0),gr.playingDemo=!0,Object.assign(t,{prevTarget:null,currentStep:0,mouse:Et.createElement({parent:t.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),t.intervalId=t.setInterval(t.nextStep.bind(t),1e3),t.outerElement.classList.add("b-playing-demo"),t.outerElement.addEventListener("click",e=>{e.isTrusted&&t.abort()})}doDestroy(){this.abort()}abort(e=!1){const t=this;t.mouse.style.top="-100px",t.clearInterval(t.intervalId),t.timeoutId&&t.clearTimeout(t.timeoutId),t.innerIntervalId&&t.clearInterval(t.innerIntervalId),t.outerElement.classList.remove("b-playing-demo"),t.widget&&(t.widget.playingDemo=!1),gr.playingDemo=!1,t.trigger(e?"done":"abort")}triggerEvent(e,t,r){if(!e)return null;let n;if(t.startsWith("mouse")){const e=this.mouse.getBoundingClientRect();n=new MouseEvent(t,Object.assign({view:window,bubbles:!0,cancelable:!0,clientX:e.left,clientY:e.top},r||{}))}else n=document.createEvent("Event"),n.initEvent(t,!0,!1);return e.dispatchEvent(n),n}handleMouseMove(e,t){const r=this,n=r.mouse;n.classList.add("quick"),r.mouseDown&&n.classList.add("drag");let s=Xt.from(n,r.outerElement),i=s.x,o=s.y,a=0,l=0;if(e.to)if("string"==typeof e.to){const t=r.outerElement.querySelector(e.to);if(t){const e=Xt.from(t,r.outerElement),n=e.x+e.width/2,s=e.y+e.height/2;a=(n-i)/10,l=(s-o)/10}}else e.to.x?a=(e.to.x-i)/10:(a=e.to[0]/10,l=e.to[1]/10);else e.deltaX?a=e.deltaX/10:e.x&&(a=(e.x-i)/10);e.deltaY&&(l=e.deltaY/10);let c=0;r.innerIntervalId=r.setInterval(()=>{if(r.shouldPause)return;9==c++&&(clearInterval(r.innerIntervalId),e.then&&e.then());const t=i+a*c,s=o+l*c;n.style.left=t+"px",n.style.top=s+"px";const d=n.getBoundingClientRect(),u=d.left,h=d.top,g=document.elementFromPoint(u,h);g!==r.prevTarget&&(r.prevTarget&&(r.mouseOutElements.push(r.prevTarget),Et.isDescendant(r.mouseOutElements[0],g)||(r.mouseOutElements.forEach(e=>r.triggerEvent(e,"mouseout")),r.mouseOutElements.length=0)),r.prevTarget=g,r.triggerEvent(g,"mouseover")),r.triggerEvent(g,e.action,{clientX:u,clientY:h})},50)}getTarget(e){const t=this,r=e.target;return r?"function"==typeof r?r(e):document.querySelector(r):t.prevTarget||t.outerElement}normalizeStep(e){if(e.action)return"function"==typeof e.action?e.action(e):e;if("function"==typeof e)return e(),e;for(let t in e)e.hasOwnProperty(t)&&!Vo.includes(t)&&(e.action=t.toLowerCase(),e.to=e[t]);return e.target||"string"!=typeof e.to&&"function"!=typeof e.to||(e.target=e.to),e}get isScrolling(){const e=this.outerElement.getBoundingClientRect(),t=this.lastTop&&e.top!==this.lastTop;return this.lastTop=e.top,t}get isInView(){const e=this.outerElement.getBoundingClientRect();return e.top<window.innerHeight&&e.bottom>0}get shouldPause(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}nextStep(){const e=this;if(e.shouldPause)return;if(e.currentStep===e.steps.length){if(!e.repeat)return e.abort(!0);e.currentStep=0}0===e.currentStep&&e.trigger("initialize");const t=e.mouse,r=e.normalizeStep(e.steps[e.currentStep++]),n=e.getTarget(r),s=r.action;if(n&&s)if(t.className="simulated-mouse","mousemove"===s)e.handleMouseMove(r,n);else{if(n!==e.prevTarget){const r=Xt.from(n,e.outerElement);t.style.left=r.x+r.width/2+"px",t.style.top=r.y+r.height/2+"px"}"mousedown"===s&&(e.mouseDown=!0),"mouseup"===s&&(e.mouseDown=!1),e.timeoutId=e.setTimeout(()=>{if(e.prevTarget=n,t.classList.add(s),"type"===s){const e=K.fromElement(n),t=r.text.split("|");e.value=t[1===t.length||e.value!=t[0]?0:1]}else e.triggerEvent(n,s)},"type"===s?100:550)}}}Wo._$name="DemoBot";class Go{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],t=t=>e.map(e=>{let r=t+I.capitalizeFirstLetter(e);return"moz"===t&&(r=r.replace("screen","Screen"),"mozCancelFullScreen"in document&&"exitFullscreen"===e&&(r="mozCancelFullScreen")),r});this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&t("webkit")||"mozFullScreenEnabled"in document&&t("moz")||"msFullscreenEnabled"in document&&t("ms")||[];const r=["fullscreenchange","fullscreenerror"],n=e=>r.map(t=>e+I.capitalizeFirstLetter(t));this.events="fullscreenEnabled"in document&&r||"webkitFullscreenEnabled"in document&&n("webkit")||"mozFullscreenEnabled"in document&&n("moz")||"msFullscreenEnabled"in document&&["MSFullscreenChange","MSFullscreenError"]||[]}static get enabled(){return document[this.functions[0]]}static request(e){return e[this.functions[1]]()}static exit(){return document[this.functions[2]]()}static get isFullscreen(){return!!document[this.functions[3]]}static onFullscreenChange(e){document.addEventListener(this.events[0],e)}static unFullscreenChange(e){document.removeEventListener(this.events[0],e)}}Go.init(),Go._$name="Fullscreen";const Uo={constructor:1,prototype:1,name:1,length:1,arguments:1,caller:1,callee:1,__proto__:1};class Yo{static apply(e){if(!e.target)throw new Error("Override must specify what it overrides, using static getter target");if(!e.target.class)throw new Error("Override must specify which class it overrides, using target.class");if(!this.shouldApplyOverride(e))return!1;const t=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(e.prototype);return t.splice(t.indexOf("target"),1),this.internalOverrideAll(e.target.class,t,e),this.internalOverrideAll(e.target.class.prototype,r,e.prototype),!0}static internalOverrideAll(e,t,r){Reflect.ownKeys(r).forEach(n=>{if(t.includes(n)&&!Uo[n]){const t=Object.getOwnPropertyDescriptor(r,n);let s=e,i=null;for(;!i&&s;)i=Object.getOwnPropertyDescriptor(s,n),i||(s=Object.getPrototypeOf(s));i&&this.internalOverride(s,n,t,i)}})}static internalOverride(e,t,r,n){(e._overridden=e._overridden||{})[t]=e[t],n.get?Object.defineProperty(e,t,{enumerable:!1,configurable:!0,get:r.get}):e[t]=r.value}static shouldApplyOverride(e){const t=e.target;if(!t.maxVersion&&!t.minVersion)return!0;if(!t.product)throw new Error("Override must specify product when using versioning");return(!t.maxVersion||!A[t.product].isNewerThan(t.maxVersion))&&(!t.minVersion||!A[t.product].isOlderThan(t.minVersion))}}Yo._$name="Override";let qo=0;const Xo=new WeakMap,Ko=e=>{const t=new Map;return(...r)=>{const n=((...e)=>e.map(e=>{let t;return e&&"object"==typeof e||"function"==typeof e?(t=Xo.get(e),void 0===t&&(t=++qo,Xo.set(e,t))):t=String(e),t}).join("-"))(r);let s=t.get(n);return void 0===s&&(s=e(...r),t.set(n,s)),s}},Zo=e=>{const t=new Map,r=e=>e[0],n=e=>e[1],s=(e,t)=>r(e).push(t);return(i,o)=>{const a=(e=>{let r=t.get(e);return void 0===r&&(r=[[],[]],t.set(e,r)),r})(i);(e=>!n(e).length&&!r(e).length)(a)?(s(a,o),e(i,e=>{((e,t)=>n(e).some(e=>ze.isEqual(e,t)))(a,e)||(((e,t)=>{n(e).push(t)})(a,e),r(a).forEach(t=>t(e)))})):(s(a,o),n(a).forEach(e=>o(e)))}},Jo=Symbol("success"),Qo=Symbol("failure"),ea=(e,t)=>[Jo,e,t],ta=e=>[Qo,e],ra=e=>e.length&&e[0]===Jo,na=e=>"function"!=typeof e||e.length?e:e(),sa=Ko(e=>Zo((t,r)=>r(ea(e,t)))),ia=Ko(e=>Zo((t,r)=>{const n=Math.min(e.length,t.length),s=t.substr(0,n),i=t.substr(n);r(s===e?ea(s,i):ta(i))})),oa=(e,t)=>(r,n)=>na(e)(r,e=>{if(ra(e)){const[,r,s]=e;t(r)(s,n)}else n(e)}),aa=Ko((...e)=>{const t=Ko((e,t)=>Zo(oa(e,e=>oa(t,t=>sa([].concat(e,t))))));return e.reduce(t,sa([]))}),la=Ko((...e)=>Zo((t,r)=>e.forEach(e=>na(e)(t,r)))),ca=Ko(e=>(t,r)=>{const n=new RegExp("^"+e).exec(t);if(n){const e=n[0],s=t.substr(e.length);r(ea(e,s))}else r(ta(t))}),da=Ko((e,t)=>oa(e,(...e)=>sa(t(...[].concat.apply([],e))))),ua=(e,t)=>{let r=[];return e(t,e=>{if(ra(e)){const[,,t]=e;""===t&&r.push(e)}}),r};var ha={memo:Ko,memoCps:Zo,success:ea,failure:ta,isSuccess:ra,resolveParser:na,succeed:sa,string:ia,bind:oa,seq:aa,alt:la,regexp:ca,red:da,runParser:ua,defineParser:e=>(t,r)=>r?na(e)(t,r):ua(na(e),t)};class ga extends(ae(As)){static get $name(){return"BooleanCombo"}static get type(){return"booleancombo"}static get defaultConfig(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,value:!1}}get store(){const e=this;return e._store||(e.store=new Cs({data:[{id:e.positiveValue,text:e.positiveText||e.L("L{Object.Yes}")},{id:e.negativeValue,text:e.negativeText||e.L("L{Object.No}")}]})),e._store}set store(e){super.store=e}}ga._$name="BooleanCombo",U.register(ga.type,ga);class ma extends Es{static get $name(){return"DisplayField"}static get defaultConfig(){return{readOnly:!0,editable:!1,cls:"b-display-field"}}get focusElement(){}set readOnly(e){}get readOnly(){return!0}}ma._$name="DisplayField",U.register("display",ma),U.register("displayfield",ma);class pa extends Es{static get $name(){return"DurationField"}static get defaultConfig(){return{value:null,step:1,unit:null,defaultUnit:"day",magnitude:null,useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}}}}get inputValue(){return null==this.value?"":this.value.toString(this.useAbbreviation)}set unit(e){this._unit=e,super.value=this.calcValue()}get unit(){return this._unit}set magnitude(e){this._magnitude=this.roundMagnitude(e),super.value=this.calcValue()}get magnitude(){return this._magnitude}roundMagnitude(e){return e&&null!=this.decimalPrecision?ze.round(e,this.decimalPrecision):e}get allowDecimals(){return 0!==this.decimalPrecision}get isValid(){const e=this,t=null==e.value||e.value&&null==e.value.magnitude;return super.isValid&&(t&&!e.required||!t&&(e.allowNegative||e.value.magnitude>=0))}internalOnChange(e){const t=this,r=t.value,n=t._lastValue;t.hasChanged(n,r)&&(t._lastValue=r,t.trigger("change",{value:r,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){return this.syncInputFieldValue(!0),super.onFocusOut(e)}set value(e){const t=this;let r,n;if("number"==typeof e)r=t.roundMagnitude(e),n=t._unit;else if("string"==typeof e){const s=je.parseDuration(e,t.allowDecimals,t._unit||pa.defaultConfig.defaultUnit);s&&(n=s.unit,r=t.roundMagnitude(s.magnitude))}else e&&"unit"in e&&"magnitude"in e?(n=e.unit,r=t.roundMagnitude(e.magnitude)):(n=null,r=null);t._magnitude===r&&t._unit===n||(t._magnitude=r,t._unit=n,super.value=t.calcValue())}get value(){return super.value}calcValue(){const e=this;return e._unit&&e._magnitude||!e.clearable?new ti(e._magnitude,e._unit||pa.defaultConfig.defaultUnit):null}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&!e.isEqual(t)}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){"ArrowUp"===e.key?this.doSpinUp():"ArrowDown"===e.key&&this.doSpinDown()}doSpinUp(){const e=this;e._isUserAction=!0,e.magnitude=(e.magnitude||0)+e.step,e._isUserAction=!1}doSpinDown(){const e=this;(e.allowNegative||(e.magnitude||0)>0)&&(e._isUserAction=!0,e.magnitude=(e.magnitude||0)-e.step,e._isUserAction=!1)}}pa._$name="DurationField",U.register("durationfield",pa),U.register("duration",pa);class fa extends jn{static get $name(){return"FileField"}internalOnChange(e){super.internalOnInput(e),super.internalOnChange(e)}internalOnInput(){}static get defaultConfig(){return{multiple:!1,accept:null}}inputTemplate(){const e=this;return Cn.tpl`
            <input
             type="file"
             reference="input"
             id="${e.id}_input"
             class="${e.inputCls||""}"
             ${e.multiple?"multiple":""}
             ${e.accept?'accept="'+e.accept+'"':""}
            />
        `}get files(){return this.input.files}pickFile(){this.input.click()}clear(){this.input.value=null}triggerChange(e){this.trigger("change",{event:e,value:this.input.value,oldValue:this._lastValue,userAction:!0,valid:!0})}}fa._$name="FileField",U.register("filefield",fa);class va extends un{static get $name(){return"FilePicker"}static get defaultConfig(){return{defaultBindProperty:"value",buttonConfig:null,fileFieldConfig:null}}construct(e={}){const t=this;e.items=[Object.assign({type:"button",ref:"fileButton",text:"L{FilePicker.file}",localeClass:this},e.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},e.fileFieldConfig)].concat(e.items||[]),super.construct(e),t.button.on({click:t.onButtonClick,thisObj:t}),t.fileField.on({change:t.onFileFieldChange,thisObj:t}),t._thisIsAUsedExpression(t.fileTip)}get button(){return this.widgetMap.fileButton}get fileField(){return this.widgetMap.fileField}get files(){return this.fileField.files}get fileTip(){const e=this;return e._fileTip||(e._fileTip=new Mn({cls:"b-file-tip",forElement:e.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",listeners:{beforeshow(){const t=this,r=e.files;return!(!r||!r.length)&&(t.html=""+Array.from(r).map(e=>e.name).join("<br>"),!0)}}}))}clear(){this.fileField.clear(),this.button.badge="",this.trigger("clear")}onButtonClick({event:e}){this.fileField.pickFile(),e.preventDefault()}onFileFieldChange(){this.button.badge=this.files.length||"",this.trigger("change",{files:this.files})}}va._$name="FilePicker",U.register("filepicker",va);class ya extends Hn{static get $name(){return"FlagField"}static get type(){return"flagfield"}static get defaultConfig(){return{value:""}}get value(){return this.checked}set value(e){e=Boolean(e),super.value=e,this.inputting||(this.checked=e)}}ya._$name="FlagField",U.register(ya.type,ya);const ba=new class extends vn{static get $name(){return"MessageDialog"}static get defaultConfig(){return{id:"bryntum-msgdialog",centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:"Â ",items:[{type:"widget",id:"bryntum-msgdialog-message",cls:"b-msgdialog-message",ref:"message"},{type:"textfield",id:"bryntum-msgdialog-input",cls:"b-msgdialog-input",ref:"input"}],bbar:{id:"bryntum-msgdialog-bbar",items:[{ref:"yesButton",id:"bryntum-msgdialog-yesbutton",cls:"b-msgdialog-yesbutton",text:"L{Object.Yes}",onClick:"up.onYesClick"},{ref:"noButton",id:"bryntum-msgdialog-nobutton",cls:"b-msgdialog-nobutton",text:"L{Object.No}",onClick:"up.onNoClick"},{ref:"cancelButton",id:"bryntum-msgdialog-cancelbutton",cls:"b-msgdialog-cancelbutton",text:"L{Object.Cancel}",onClick:"up.onCancelClick"}]}}}async confirm({message:e,title:t="Â "}){const r=this;return r.title=t,r.element.classList.remove(r.showClass),e?(r.showClass="b-show-message-yes-no",r.widgetMap.message.html=e):r.showClass="b-show-yes-no",r.element.classList.add(r.showClass),r.show(),r.promise=new Promise(e=>{r.resolve=e})}doResolve(e){const t=this,{resolve:r}=t;r&&(t.resolve=t.reject=t.promise=null,r(e),t.hide())}onInternalKeyDown(e){"Escape"===e.key&&(e.stopImmediatePropagation(),this.widgetMap.cancelButton.isVisible?this.onCancelClick():this.onNoClick()),super.onInternalKeyDown(e)}onYesClick(){this.doResolve(ba.yesButton)}onNoClick(){this.doResolve(ba.noButton)}onCancelClick(){this.doResolve(ba.cancelButton)}};ba.noButton=0,ba.yesButton=1,ba.cancelButton=3;class Ca extends hn{static get $name(){return"PagingToolbar"}static get defaultConfig(){return{store:null,namedItems:{firstPageButton:{onClick:"up.onFirstPageClick",icon:"b-fa-angle-double-left"},previousPageButton:{onClick:"up.onPreviousPageClick",icon:"b-fa-angle-left"},pageNumber:{type:"numberfield",label:"L{page}",localeClass:this,min:1,max:1,triggers:null,onChange:"up.onPageNumberChange"},pageCount:{type:"widget",cls:"b-pagecount b-toolbar-text"},nextPageButton:{onClick:"up.onNextPageClick",icon:"b-fa-angle-right"},lastPageButton:{onClick:"up.onLastPageClick",icon:"b-fa-angle-double-right"},reloadButton:{onClick:"up.onReloadClick",icon:"b-fa-redo"},dataSummary:{type:"widget",cls:"b-toolbar-text"}},items:{firstPageButton:!0,previousPageButton:!0,pageNumber:!0,pageCount:!0,nextPageButton:!0,lastPageButton:!0,sep:"|",reloadButton:!0,spacer:"->",dataSummary:!0}}}set store(e){const t=this,r={beforerequest:"onStoreBeforeRequest",afterrequest:"onStoreChange",change:"onStoreChange",thisObj:t};t.store&&t.store.un(r),t._store=e,e&&(e.on(r),e.isLoading&&t.onStoreBeforeRequest())}get store(){return this._store}onStoreBeforeRequest(){this.eachWidget(e=>e.disable())}updateLocalization(){const e=this,{reloadButton:t,firstPageButton:r,previousPageButton:n,nextPageButton:s,lastPageButton:i}=e.widgetMap;r.tooltip=e.L("L{firstPage}"),n.tooltip=e.L("L{prevPage}"),s.tooltip=e.L("L{nextPage}"),i.tooltip=e.L("L{lastPage}"),t.tooltip=e.L("L{reload}"),e.updateSummary(),super.updateLocalization()}updateSummary(){const e=this,{pageCount:t,dataSummary:r}=e.widgetMap;let n,s,i,o,a;if(n=s=i=o=a=0,e.store){const{store:t}=e,{pageSize:r,currentPage:l}=t;n=t.count,s=t.lastPage,a=t.allCount,i=Math.max(0,(l-1)*r+1),o=Math.min(a,i+r-1)}t.html=e.L("L{pageCountTemplate}")({lastPage:s}),r.html=n?e.L("L{summaryTemplate}")({start:i,end:o,allCount:a}):e.L("L{noRecords}")}onStoreChange(){const{widgetMap:e,store:t}=this,{count:r,lastPage:n,currentPage:s}=t,{pageNumber:i,pageCount:o,firstPageButton:a,previousPageButton:l,nextPageButton:c,lastPageButton:d,dataSummary:u}=e;this.eachWidget(e=>e.enable()),i.value=s,i.max=n,u.disabled=i.disabled=o.disabled=!r,a.disabled=l.disabled=s<=1||!r,c.disabled=d.disabled=s>=n||!r,this.updateSummary()}onPageNumberChange({value:e}){this.store.currentPage!==e&&this.store.loadPage(e)}onFirstPageClick(){this.store.loadPage(1)}onPreviousPageClick(){this.store.previousPage()}onNextPageClick(){this.store.nextPage()}onLastPageClick(){this.store.loadPage(this.store.lastPage)}onReloadClick(){this.store.loadPage(this.store.currentPage)}}Ca._$name="PagingToolbar",U.register("pagingtoolbar",Ca);const wa=e=>parseInt(Et.getStyleValue(e,"flex-basis"),10)||parseInt(Et.getStyleValue(e,"flex-grow"),10);class Sa extends Vr{static get defaultConfig(){return{orientation:"auto"}}doDestroy(){this.mouseDetacher&&this.mouseDetacher(),super.doDestroy()}template(){return'<div class="b-splitter"></div>'}get element(){return super.element}set element(e){super.element=e;const t={element:this.element,pointerdown:"onMouseDown",thisObj:this};P.supportsPointerEvents||(t.mousedown="onMouseDown",t.touchstart="onMouseDown"),gr.on(t)}get currentOrientation(){return this._currentOrientation}get orientation(){return this._orientation}set orientation(e){this._orientation=e,this._currentOrientation="auto"===e?null:e,this.updateOrientation()}updateOrientation(){const e=this,{element:t}=this;if(e._prevOrientation&&t.classList.remove(e._prevOrientation),!e._currentOrientation&&e.rendered&&t.offsetParent){const r=Et.getStyleValue(t.parentElement,"flex-direction");if(r)e._currentOrientation=r.startsWith("column")?"horizontal":"vertical";else{const r=t.previousElementSibling,n=t.nextElementSibling;if(!r||!n)return;const s=r.getBoundingClientRect(),i=n.getBoundingClientRect(),o=s.top<i.top?s:i,a=o===i?s:i;e._currentOrientation=o.top!==a.top?"horizontal":"vertical"}}e._currentOrientation&&t.classList.add("b-"+e._currentOrientation),e._prevOrientation=e._currentOrientation}onMouseDown(e){e.preventDefault(),e.touches&&(e=e.touches[0]);const t=this,{element:r}=t,n=r.previousElementSibling,s=r.nextElementSibling,i=wa(n),o=wa(s),a=[];t.mouseDetacher&&t.mouseDetacher();for(const e of r.parentElement.children)wa(e)&&e!==r&&a.push({element:e,width:e.offsetWidth,height:e.offsetHeight});t.context={startX:e.pageX,startY:e.pageY,prevWidth:n.offsetWidth,prevHeight:n.offsetHeight,nextWidth:s.offsetWidth,nextHeight:s.offsetHeight,prevHasFlex:i,nextHasFlex:o,flexed:a,prev:n,next:s};const l={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:t};P.supportsPointerEvents||(l.mousemove="onMouseMove",l.touchmove="onMouseMove",l.mouseup=l.touchend="onMouseUp"),t.mouseDetacher=gr.on(l)}onMouseMove(e){const t=this,{context:r}=t,n=e.pageX-r.startX,s=e.pageY-r.startY;if(e.preventDefault(),Object.assign(r,{deltaX:n,deltaY:s}),r.started||(r.started=!0,t.trigger("start",{context:r,event:e}),r.flexed.forEach(e=>{"vertical"===t.currentOrientation?e.element.style.flexGrow=e.width:e.element.style.flexGrow=e.height,e.element.style.flexBasis="0"})),"vertical"===t.currentOrientation){const e=r.prevWidth+n,t=r.nextWidth-n;r.prevHasFlex?r.prev.style.flexGrow=e:r.prev.style.width=e+"px",r.nextHasFlex?r.next.style.flexGrow=t:r.next.style.width=t+"px"}else{const e=r.prevHeight+s,t=r.nextHeight-s;r.prevHasFlex?r.prev.style.flexGrow=e:r.prev.style.height=e+"px",r.nextHasFlex?r.next.style.flexGrow=t:r.next.style.height=t+"px"}t.trigger("move",{context:r,event:e})}onMouseUp(e){const t=this;t.mouseDetacher&&t.mouseDetacher(),t.mouseDetacher=null,t.context.started&&t.trigger("end",{context:t.context,event:e}),t.context=null}render(){super.render(...arguments);const e=this;e._currentOrientation||(e.updateOrientation(),e._currentOrientation||e.requestAnimationFrame(()=>e.updateOrientation()))}}Sa._$name="Splitter",U.register("splitter",Sa);class Da extends(G(ae(Jn))){static get fields(){return["text","field","renderer","width","flex",{name:"editor",defaultValue:{}},"finalizeCellEdit",{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0},{name:"searchable",defaultValue:!0},{name:"filterable",defaultValue:!0},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},"type",{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"}]}static get autoExposeFields(){return!1}construct(e,t){const r=this;r.masterStore=t,t&&(r._grid=Array.isArray(t)?t[0].grid:t.grid),r.localizableProperties=e.localizableProperties||["text"],e.localeClass&&(r.localeClass=e.localeClass),super.construct(e,t,null,!1),r.processConfiguredListeners(e.listeners),"field"in r.data||(r.field="_"+(r.type||"")+ ++Da.emptyCount,r.noFieldSpecified=!0),r.hasComplexMapping=r.field&&r.field.includes("."),r.width||r.flex||r.children||r.set({width:Da.defaultWidth,flex:null},null,!0)}remove(){const{subGrid:e,grid:t}=this,r=e&&t&&t.focusedCell;r&&r.columnId===this.id&&(document.activeElement===t?t.navigateRight():r.columnId=e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0).id),super.remove()}getRawValue(e){const t=this;return t.hasComplexMapping?ze.getPath(e,t.field):e[t.field]||e.get(t.field)}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get nextVisibleSibling(){const e=this.region;let t=this.nextSibling;for(;t&&(t.hidden||t.region!==e);)t=t.nextSibling;return t}get isLastInSubGrid(){return!this.nextVisibleSibling&&(!this.parent||this.parent.isLastInSubGrid)}get element(){return this.grid.getHeaderElement(this)}get textWrapper(){return Et.getChild(this.element,".b-grid-header-text")}get textElement(){return Et.down(this.element,".b-grid-header-text-content")}get contentElement(){return Et.down(this.element,".b-grid-header-children")}get editor(){let e=this.data.editor;if(e&&!(e instanceof Vr)){const t=this.grid.processCellEditor({editor:e,field:this.field});t?e=this.data.editor=t.editor:("string"==typeof e&&(e={type:e}),e=this.data.editor=J.createWidget(Object.assign(this.defaultEditor,e,{owner:this.grid})))}return e}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}get isFocusable(){return this.isLeaf}static get type(){return"column"}static get text(){return this.defaultValues.text}get grid(){return this._grid||this.parent&&this.parent.grid}get locked(){return"locked"===this.data.region}set locked(e){this.region=e?"locked":"normal"}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return this.isLeaf&&this.data.groupable}set groupable(e){this.set("groupable",e)}hide(e=!1){const t=this,r=t.parent;if(!t.hidden){if(t.hidden=!0,r&&!r.isRoot){r.children.some(e=>!0!==e.hidden)||r.hidden||(e=!0,r.hide())}t.children&&t.children.forEach(e=>e.hide(!0)),e||t.stores.forEach(e=>e.trigger("hideColumn"))}}show(e=!1){const t=this,r=t.parent;t.hidden&&(t.hidden=!1,r&&r.hidden&&r.show(),t.children&&t.children.forEach(e=>e.show(!0)),e||t.stores.forEach(e=>e.trigger("showColumn")))}toggle(e=null){return this.hidden&&void 0===e||!0===e?this.show():!this.hidden&&void 0===e||!1===e?this.hide():void 0}generateId(){return Da.generatedIdIndex||(Da.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++Da.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}get width(){return this.data.width}set width(e){const t={width:e};e&&"flex"in this.data&&(t.flex=null),this.set(t)}set subGrid(e){this._subGrid=e}get subGrid(){return this._subGrid||(this.grid?this.grid.getSubGridFromColumn(this):void 0)}get subGridElement(){return this.subGrid.element}measureSize(e){return Et.measureSize(e,this.subGrid?this.subGrid.element:void 0)}calculateMinWidth(){const e=this,t=e.measureSize(e.width),r=e.measureSize(e.minWidth);let n=0;return e.children&&(n=e.children.reduce((e,t)=>e+t.calculateMinWidth(),0)),Math.max(t,r,n)}resizeToFitContent(){const e=this,{grid:t,renderer:r,defaultRenderer:n,element:s}=e,i=t.rowManager,o=t.store,a=o.count,l=r||n;if(a<=0)return;const c=t.element.querySelector(`.b-grid-cell[data-column-id=${e.id}]`),d=c.cssText,u=c.className;let h,g,m,p,f,v=0;if(t.resizeToFitIncludesHeader){const e=window.getComputedStyle(s);v=Et.measureText(s.innerText,s,!1,s.parentElement)+parseInt(e.paddingLeft),s.parentElement.offScreenDiv.parentElement.remove()}for(a>1e3?(h=Math.max(Math.min(i.topIndex+i.rowCount/2-500,a-1e3),0),g=h+1e3):(h=0,g=a),m=h;m<g;m++)p=o.getAt(m),f=e.getRawValue(p),l&&(f=l.call(e,{cellElement:c,rowElement:c.parentNode,value:f,record:p,column:e,size:{height:p.rowHeight||0},grid:t,row:{},updatingSingleRow:!1}),f=null==f?c.innerHTML:String(f)),f&&(v=Math.max(v,Et.measureText(f,c,!(e.htmlEncode&&!e.disableHtmlEncode),e.subGrid.element)));return c.className=u,c.cssText=d,e.width=v}getState(){const e=this,t={[e.flex?"flex":"width"]:e.flex?e.flex:e.width,id:e.id,hidden:e.hidden,index:e.allIndex,region:e.region,filterable:e.filterable,text:e.text,locked:e.locked};return e.children&&(t.children=e.children.map(e=>e.getState())),t}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"minWidth"in e&&(t.minWidth=e.minWidth),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=void 0:"flex"in e&&t.width&&(t.width=void 0),"text"in e&&(t.text=e.text),"region"in e&&(t.region=e.region),"renderer"in e&&(t.renderer=e.renderer),"filterable"in e&&(t.filterable=e.filterable),t.endBatch(),"hidden"in e&&t.toggle(!0!==e.hidden)}clearCell(e){e.innerHTML=""}canEdit(e){return!0}}Da.emptyCount=0,Da.defaultWidth=100,Da.exposeProperties(),Da._$name="Column";class Ea extends(ae(Cs)){static get defaultConfig(){return{modelClass:Da,tree:!0,autoAddField:!1}}construct(e){const t=this;e.grid&&(e.grid._columnStore=t,t.id=e.grid.id+"-columns",e.grid.on({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:t})),super.construct(e),t.on({change:t.clearCaches,thisObj:t,prio:1})}get modelClass(){return this._modelClass}set modelClass(e){this._modelClass=e}doDestroy(){const e=[];this.traverse(t=>e.push(t)),super.doDestroy(),e.forEach(e=>e.destroy())}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.traverseWhile((r,n)=>e.call(t,r,n),!0)}get totalFixedWidth(){let e=0;for(const t of this)t.hidden||(t.flex?e+=t.measureSize(Da.defaultWidth):e+=Math.max(t.measureSize(t.width),t.measureSize(t.minWidth)));return e}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter(e=>!(e.hidden||e.subGrid&&e.subGrid.collapsed))),e._visibleColumns}clearSubGridCaches(e){e.columns.clearCaches(),this.clearCaches()}clearCaches(){this._visibleColumns=null}onMasterDataChanged(e){super.onMasterDataChanged(e),this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,r=!1){const n=this.visibleColumns,s=e instanceof Da?e:this.getById(e);let i=n.indexOf(s)+(t?1:-1);if(!n[i]){if(!r)return null;i=t?0:n.length-1}return n[i]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(e){const{grid:t={}}=this,{store:r}=t;let n=this.modelClass;if(e.type&&(n=Ea.getColumnClass(e.type),!n))throw new Error(`Column type '${e.type}' not registered`);e.locked&&(e.region="locked",delete e.locked);const s=new n(e,this);if(s.data.region||(s.data.region=t.defaultRegion||"normal"),this.autoAddField&&!s.noFieldSpecified&&r&&!r.modelClass.getFieldDefinition(s.field)){let e=s.field;s.constructor.fieldType&&(e={name:s.field,type:s.constructor.fieldType}),r.modelClass.addField(e)}return s}indexOf(e){const t=super.indexOf(e);return t>-1?t:this.records.findIndex(t=>t.field===e)}static registerColumnType(e,t=!1){Ea.columnTypes||(Ea.columnTypes={}),e.simpleRenderer=t,Ea.columnTypes[e.type]=e}static getColumnClass(e){return Ea.columnTypes&&Ea.columnTypes[e]}}Ea.registerColumnType(Da,!0),Ea._$name="ColumnStore";class xa extends Da{static get type(){return"action"}static get fields(){return["actions"]}static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,htmlEncode:!1,resizable:!1,groupable:!1,minWidth:30}}construct(e,t){this.internalCellCls="b-action-cell",super.construct(...arguments),e.width||e.flex||this.grid.on("paint",this.updateAutoWidth,this)}renderer({column:e,record:t}){const r=t&&"groupRowFor"in t.meta;return{className:{"b-action-ct":1},children:e.actions.map((n,s)=>{if("visible"in n){if("function"==typeof n.visible&&!1===n.visible({record:t}))return"";if(!1===n.visible)return""}if(r&&!n.showForGroup||!r&&n.showForGroup)return"";let i;if(i="function"==typeof n.tooltip?n.tooltip({record:t}):n.tooltip||"",n.renderer&&"function"==typeof n.renderer){const r=n.renderer({index:s,record:t,column:e,tooltip:i,action:n});return"string"==typeof r?{tag:"span",dataset:{index:s},html:r}:(r.dataset=r.dataset||{},r.dataset.index=s,r)}return{tag:"i",dataset:{index:s,btip:i},className:{"b-action-item":1,[n.cls]:1}}})}}onCellClick({grid:e,column:t,record:r,target:n}){if(!n.classList.contains("b-action-item")||e.readOnly)return;let s=n.dataset.index;s||(s=n.parentElement.dataset&&n.parentElement.dataset.index);const i=t.actions[s],o=i&&i.onClick;o&&this.callback(o,t,[{record:r,action:i}])}updateAutoWidth(){const e=this,t=[];let r=[];e.actions.forEach(e=>{const n={...e};delete n.visible,n.showForGroup?(delete n.showForGroup,t.push(n)):r.push(n)}),t.length>r.length&&(r=t);const n=Et.createElement(e.renderer({column:{actions:r}})).outerHTML,s=e.grid.element.querySelector(`.b-grid-cell[data-column-id=${e.id}]`);e.width=Et.measureText(n,s,!0,s.parentElement)}}Ea.registerColumnType(xa),xa.exposeProperties(),xa._$name="ActionColumn";class Ta extends Da{static get type(){return"aggregate"}static get fields(){return["function"]}static get defaults(){return{function:"sum"}}construct(e,t){this.configuredAlign="align"in e,this.configuredEditor="editor"in e,super.construct(...arguments);const{grid:r}=t;r&&(this.owner=r,r.on({paint:"onGridPaint",thisObj:this,prio:1e3}))}onGridPaint({source:e}){this.store=e.store}set store(e){const t=this,r={update:"onRecordUpdate",thisObj:t,prio:1e3},n=t._store;if(e!==n){n&&n.un(r),t._store=e;const{modelClass:s}=e,i=s.fieldMap[t.field];i&&"number"===i.type&&(t.configuredAlign||(t.align="end"),t.configuredEditor||(t.editor="number")),e.on(r)}}canEdit(e){return e.isLeaf}get store(){return this._store}sum(...e){let t=0;for(let r=0,{length:n}=e;r<n;r++)t+=parseInt(e[r]||0,10);return t}avg(...e){let t=0;const{length:r}=e;for(let n=0;n<r;n++)t+=parseInt(e[n]||0,10);return t/r}onRecordUpdate({record:e,changes:t}){const r=this,{rowManager:n}=r.grid;r.field in t&&e.isLeaf&&e.bubble(e=>{const t=n.getRowFor(e);if(t){const n=t.getCell(r.field);n&&t.renderCell(n,e)}},!0)}getRawValue(e){let t=0;if(e.children){const r=this,n=r.function,s="string"==typeof n&&"function"==typeof Math[n],{handler:i,thisObj:o}=s?{handler:Math[n],thisObj:Math}:r.resolveCallback(n);for(let n=0,{length:s}=e.children;n<s;n++)t=i.call(o,t,r.getRawValue(e.children[n]));e.setData(r.field,t)}else t=e[this.field];return t}}Ea.registerColumnType(Ta,!0),Ta.exposeProperties(),Ta._$name="AggregateColumn";class Ra extends Da{static get type(){return"widget"}static get fields(){return["widgets"]}static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1}}construct(e,t){this.widgetMap={},this.internalCellCls="b-widget-cell",super.construct(...arguments)}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}renderer(e){const t=this,{cellElement:r,column:n,value:s,record:i,isExport:o}=e,a=n.widgets;if(!o&&a&&(r.widgets||t.clearCell(r),r.widgets=a.map((o,a)=>{let l,c;return r.widgets&&(l=r.widgets[a],c=l.element.nextElementSibling,o.recreate&&l&&(delete t.widgetMap[l.id],l.destroy(),r.widgets[a]=null)),l||(t.onBeforeWidgetCreate(o,e),l=J.append(o,c?{insertBefore:c}:r)[0],t.widgetMap[l.id]=l,t.onAfterWidgetCreate(l,e)),l.cellInfo={cellElement:r,value:s,record:i,column:n},t.grid&&(l.readOnly=t.grid.readOnly),!1!==t.onBeforeWidgetSetValue(l,e)&&(o.noValueOnRender||(o.valueProperty?l[o.valueProperty]=s:l.defaultBindProperty?l[l.defaultBindProperty]=s:l.text=l.value=s)),t.onAfterWidgetSetValue(l,e),l})),o)return null}onBeforeWidgetCreate(e,t){}onAfterWidgetCreate(e,t){}onBeforeWidgetSetValue(e,t){}onAfterWidgetSetValue(e,t){}clearCell(e){e.widgets&&(e.widgets.forEach(e=>{delete this.widgetMap[e.id],e.destroy()}),e.widgets=null),super.clearCell(e)}resizeToFitContent(){}}Ea.registerColumnType(Ra),Ra.exposeProperties(),Ra._$name="WidgetColumn";class Ma extends Ra{static get type(){return"check"}static get fields(){return["checkCls","showCheckAll"]}static get defaults(){return{align:"center",checkCls:null,showCheckAll:!1,widgets:[{type:"checkbox",valueProperty:"checked"}]}}constructor(e,t){super(...arguments),this.internalCellCls="b-check-cell",this.grid&&this.grid.on("destroy",()=>this.headerCheckbox&&this.headerCheckbox.destroy())}headerRenderer({headerElement:e,column:t}){const r=this;if(e.classList.add("b-check-header"),!t.showCheckAll)return t.text;e.classList.add("b-check-header-with-checkbox"),t.headerCheckbox&&t.headerCheckbox.destroy(),t.headerCheckbox=new Hn({appendTo:e,owner:r.grid,listeners:{change:({checked:e})=>{t.trigger("toggleAll",{checked:e})}}})}renderer({value:e,isExport:t}){if(t)return null==e?"":e;super.renderer(...arguments)}onBeforeWidgetCreate(e,t){e.cls=this.checkCls}onAfterWidgetCreate(e,t){t.cellElement.widget=e,e.on({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}onBeforeWidgetSetValue(e){e.record=e.cellInfo.record,this.isInitialSet=!0}onAfterWidgetSetValue(e){this.isInitialSet=!1}onBeforeCheckboxChange({source:e,checked:t}){if(!this.isInitialSet)return this.trigger("beforeToggle",{record:e.cellInfo.record,checked:t})}onCheckboxChange({source:e,checked:t}){if(!this.isInitialSet){const r=e.cellInfo.record,n=this.field;if(n){const e="set"+I.capitalizeFirstLetter(n);r[e]?r[e](t):r.set(n,t)}this.trigger("toggle",{record:r,checked:t})}}}Ea.registerColumnType(Ma,!0),Ma._$name="CheckColumn";class ka extends Da{static get type(){return"date"}static get fieldType(){return"date"}static get fields(){return["format","pickerFormat","step"]}static get defaults(){return{format:"L",step:1,minWidth:85,filterType:"date"}}constructor(e,t){super(...arguments),this.internalCellCls="b-date-cell"}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=je.parse(e,this.format||void 0)),je.format(e,this.format||void 0)}set format(e){const t=this,r=t.editor;t.set("format",e),r&&(r.format=t.format)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",weekStartDay:this.grid.weekStartDay,format:this.format,step:this.step}}}Ea.registerColumnType(ka,!0),ka.exposeProperties(),ka._$name="DateColumn";class Ia extends Da{static get type(){return"percent"}static get fieldType(){return"number"}static get fields(){return["lowThreshold"]}static get defaults(){return{editor:{type:"number",min:0,max:100},lowThreshold:20,filterType:"number",htmlEncode:!1,searchable:!1,summaryRenderer:e=>e+"%"}}constructor(e,t){super(...arguments),this.internalCellCls="b-percent-bar-cell"}renderer({value:e}){return{className:"b-percent-bar-outer",children:[{tag:"div",className:{"b-percent-bar":1,"b-zero":0===(e=e||0),"b-low":e<this.lowThreshold},style:{width:e+"%"},html:e+"%"}]}}clearCell(e){e.percentBarElement&&(e.percentBarElement=null),super.clearCell(e)}resizeToFitContent(){}}Ia.sum="average",Ea.registerColumnType(Ia,!0),Ia._$name="PercentColumn";class Fa extends Da{static get type(){return"number"}static get fieldType(){return"number"}static get fields(){return["min","max","step","unit"]}static get defaults(){return{filterType:"number"}}constructor(e,t){super(...arguments),this.internalCellCls="b-number-cell"}get defaultEditor(){return{name:this.field,type:"numberfield",max:this.max,min:this.min,step:this.step}}defaultRenderer({value:e=0}){return this.unit?`${e}${this.unit}`:e}}Ea.registerColumnType(Fa,!0),Fa.exposeProperties(),Fa._$name="NumberColumn";class Aa extends Fa{static get type(){return"rating"}static get fieldType(){return"number"}static get fields(){return["emptyIcon","filledIcon","editable"]}static get defaults(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,autoSyncHtml:!0,minWidth:"11.2em",editor:!1}}constructor(e,t){super(...arguments),this.internalCellCls="b-rating-cell"}renderer({value:e}){let t=`<div class="b-rating-cell-inner ${this.editable?"":"b-not-editable"}">`;for(let r=0;r<this.max;r++){t+=`<i class="b-rating-icon ${r<e?"b-filled "+this.filledIcon:"b-empty "+this.emptyIcon}"></i>`}return t+="</div>",t}onCellClick({grid:e,column:t,record:r,cellSelector:n,target:s,event:i}){if(s.classList.contains("b-rating-icon")&&!e.readOnly&&t.editable){let e=[].indexOf.call(s.parentNode.childNodes,s);s.classList.contains("b-filled")&&(i.metaKey||i.shiftKey)&&(e-=1),1===r.get(t.field)&&0===e&&(e=-1),r.set(t.field,e+1)}}}Ea.registerColumnType(Aa,!0),Aa.exposeProperties(),Aa._$name="RatingColumn";class Pa extends Da{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,minWidth:50,width:50,align:"right",text:"#",editor:!1}}construct(e,t){const r=this;super.construct(...arguments),r.grid&&(r.grid.store.on({change:r.resizeToFitContent,thisObj:r}),r.grid.store.count&&r.grid.on({render:r.resizeToFitContent,thisObj:r,once:!0})),r.internalCellCls="b-row-number-cell"}static get type(){return"rownumber"}renderer({record:e,grid:t}){return e.meta.specialRow?"":t.store.indexOf(e,!0)+1}resizeToFitContent(){const e=this.grid,t=e.store.count;if(t&&!this.hidden){const r=e.element.querySelector(`.b-grid-cell[data-column-id=${this.id}]`);if(r){const e=window.getComputedStyle(r),n=parseInt(e["padding-left"]),s=Et.measureText(t,r);this.width=s+2*n}}}set flex(e){}}Ea.registerColumnType(Pa,!0),Pa._$name="RowNumberColumn";class La extends Da{static get fields(){return["template"]}static get defaults(){return{htmlEncode:!1}}constructor(e,t){super(...arguments);if(!this.template)throw new Error("TemplateColumn needs a template");if("function"!=typeof this.template)throw new Error("TemplateColumn.template must be a function")}static get type(){return"template"}renderer(e){if(!e.record.meta.specialRow)return this.template({value:e.value,record:e.record,field:e.column.field})}}Ea.registerColumnType(La,!0),La.exposeProperties(),La._$name="TemplateColumn";class Oa extends Da{static get type(){return"time"}static get fieldType(){return"date"}static get fields(){return["format"]}static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}constructor(e,t){super(...arguments),this.internalCellCls="b-time-cell"}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){const t=this;return"string"==typeof e&&(e=je.parse(e,t.format)),je.format(e,t.format)}set format(e){const t=this,r=t.editor;t.set("format",e),r&&(r.format=t.format)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"time",format:this.format}}}Ea.registerColumnType(Oa,!0),Oa.exposeProperties(),Oa._$name="TimeColumn";let _a=!1;class $a extends Da{static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"indentSize",defaultValue:1.7},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"}]}static get type(){return"tree"}constructor(e,t){super(...arguments);const r=this;r.internalCellCls="b-tree-cell",r.shouldHtmlEncode=r.htmlEncode,r.tempDiv=document.createElement("div"),r.setData("htmlEncode",!1),r.renderer&&(r.originalRenderer=r.renderer),r.renderer=r.treeRenderer.bind(r)}treeRenderer(e){const t=this,{cellElement:r,row:n,record:s,isExport:i}=e,o=s.instanceMeta(e.grid.store),a=s.href?"a":"div";let l,{value:c}=e;if(t.originalRenderer){const n=t.originalRenderer(e);c=!1===n?r.innerHTML:n}if(i)l=null!=c?c:"";else{let i,d="";if(s.isLeaf)r.classList.add("b-tree-leaf-cell"),i=e.iconCls||s.iconCls||t.leafIconCls;else{const a=o.collapsed,l=a?t.expandIconCls:t.collapseIconCls,c=a?t.collapsedFolderIconCls:t.expandedFolderIconCls;if("Row"===n.$name){const e="b-loading-children",t="b-tree-collapsed",r="b-tree-expanded",s=["b-tree-parent-row"],i=[];o.isLoadingChildren?s.push(e):i.push(e),a?(s.push(t),i.push(r)):(s.push(r),i.push(t)),n.removeCls(...i),n.addCls(...s)}r.classList.add("b-tree-parent-cell"),d+=`<div class="b-tree-expander">${l?`<i class="${l}"></i>`:""}</div>`,_a=i=e.iconCls||s.iconCls||c}c=null!=c?c:"",t.shouldHtmlEncode&&(t.tempDiv.innerText=c,c=t.tempDiv.innerHTML),d+=`<div class="b-tree-cell-value">${i?`<i class="b-tree-icon ${i}"></i>`:""}${c}</div>`;const u=s.childLevel*t.indentSize+(s.isLeaf?_a?2:i?.5:.4:0);l=`<${a} ${s.href?`href="${s.href}"`:""} ${"a"===a&&s.target?`target="${s.target}"`:""} class="b-tree-cell-inner" style="padding-left:${u}em;">${d}</${a}>`}return l}}Ea.registerColumnType($a,!0),$a.exposeProperties(),$a._$name="TreeColumn";class ja extends Jn{static get fields(){return["iconCls","expanded","cls","rowHeight","href","target"]}}ja.exposeProperties(),ja._$name="GridRowModel";const Ha=new Map,Na=new Map,Ba={Grid:"GridBase",Scheduler:"SchedulerBase",Gantt:"GanttBase"},za=/\$\d+$/;class Va{static registerFeature(e,t=!1,r=null,n=null){n=(n=I.lowercaseFirstLetter(n||e.hasOwnProperty("$name")&&e.$name||e.name)).replace(za,""),Array.isArray(r)||(r=[r||"Grid"]),r.forEach(r=>{const s=Ba[r]||r,i=Ha.get(s)||new Map,o=Na.get(s)||new Map;i.set(n,e),o.set(e,t),Ha.set(s,i),Na.set(s,o)})}static getTypeNameFeatures(e="Grid"){const t=Ba[e]||e,r=Ha.get(t),n={};return r&&r.forEach((e,t)=>n[t]=e),n}static getTypeNameDefaultFeatures(e="Grid"){const t=Ba[e]||e,r=Ha.get(t),n=Na.get(t);let s={};return r&&n&&r.forEach((e,t)=>{n.get(e)&&(s[t]=e)}),s}static getInstanceFeatures(e){return e.classNameHierarchy().reduce((e,t)=>Object.assign(e,this.getTypeNameFeatures(t)),{})}static getInstanceDefaultFeatures(e){return e.classNameHierarchy().reduce((e,t)=>Object.entries(this.getTypeNameFeatures(t)).reduce((e,[r,n])=>(this.isDefaultFeatureForTypeName(n,t)?e[r]=n:delete e[r],e),e),{})}static isDefaultFeatureForTypeName(e,t="Grid"){const r=Ba[t]||t,n=Na.get(r);return n&&n.get(e)||!1}static isDefaultFeatureForInstance(e,t){const r=t.classNameHierarchy().reverse();let n=null;for(let t=0,s=r.length;t<s&&null===n;++t){const s=Na.get(r[t]);s&&s.has(e)&&(n=s.get(e))}return n||!1}static reset(){Ha.clear(),Na.clear()}}Va._$name="GridFeatureManager";class Wa extends Nn{static get $name(){return"CellTooltip"}static get defaultConfig(){return{tooltipRenderer:null}}construct(e,t){super.construct(e,this.processConfig(t))}initTip(){const e=this;e.tip=new Mn(ze.assign({forElement:e.client.element,forSelector:".b-grid-cell",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:e.getTooltipContent.bind(e),listeners:{pointerOver:"onPointerOver",thisObj:e}},e.initialConfig)),e.relayEvents(e.tip,["beforeshow","show"])}onPointerOver({target:e}){return!1!==this.client.getColumnFromElement(e).tooltipRenderer}processConfig(e){return"function"==typeof e?{tooltipRenderer:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.tip&&this.tip.destroy(),super.doDestroy()}doDisable(e){e?this.tip&&(this.tip.destroy(),this.tip=null):this.initTip(),super.doDisable(e)}getTooltipContent({tip:e,activeTarget:t,event:r}){const n=this,s=n.client.getRecordFromElement(t),i=n.client.getColumnFromElement(t);let o;return n.forSelector||s!==n.lastRecord||i!==n.lastColumn?(n.lastRecord=s,n.lastColumn=i,i.tooltipRenderer?(o=i.tooltipRenderer({cellElement:t,record:s,column:i,event:r,tip:e,cellTooltip:n}),!1===o&&A.deprecate("Grid","5.0.0","Returning false to indicate loading is deprecated. Please see https://bryntum.com/docs/grid/#guides/upgrades/3.0.1.md for more information")):n.tooltipRenderer&&!1!==i.tooltipRenderer&&(o=n.tooltipRenderer({cellElement:t,record:s,column:i,event:r,tip:e,cellTooltip:n}),!1===o&&A.deprecate("Grid","5.0.0","Returning false to indicate loading is deprecated. Please see https://bryntum.com/docs/grid/#guides/upgrades/3.0.1.md for more information")),o):n.tip._html}}Wa._$name="CellTooltip",Va.registerFeature(Wa);class Ga extends(br(Nn)){static get $name(){return"ColumnDragToolbar"}static get pluginConfig(){return{after:["render"]}}construct(e,t){e.features.columnReorder&&e.features.columnReorder.on("beforedestroy",this.onColumnReorderBeforeDestroy,this),this.grid=e,super.construct(e,t)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}doDisable(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),super.doDisable(e)}init(){const e=this,t=e.grid;t.features.columnReorder&&(e.reorderDetacher=t.features.columnReorder.on({gridheaderdragstart({context:r}){const n=t.columns.getById(r.element.dataset.columnId);e.showToolbar(n)},gridheaderdrag:({context:t})=>e.onDrag(t),gridheaderabort:()=>{e.hideToolbar()},gridheaderdrop:({context:t})=>{t.valid?e.hideToolbar():e.onDrop(t)},thisObj:e}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const t=this,r=t.grid.getColumnDragToolbarItems(e,[]),n=[];t.clearTimeout(t.buttonHideTimer),t.clearTimeout(t.toolbarHideTimer),r.forEach(e=>{e.text=e.localeClass.L(e.text);let t=n.find(t=>t.text===e.group);t||(t={text:e.localeClass.L(e.group),buttons:[]},n.push(t)),t.buttons.push(e)}),t.element=Et.append(t.grid.element,t.template(n)),t.groups=n,t.buttons=r,t.column=e}hideToolbar(){const e=this;return new Promise(t=>{e.element&&!e.toolbarHideTimer&&(e.element.classList.add("b-remove"),e.toolbarHideTimer=e.setTimeout(()=>{e.toolbarHideTimer=null,e.element&&e.element.remove(),e.element=null,t()},200))})}onDrag(e){const t=this;if(e.dragProxy.getBoundingClientRect().top-t.grid.element.getBoundingClientRect().top>100?t.element.classList.add("b-closer"):t.element.classList.remove("b-closer"),t.hoveringButton&&(t.hoveringButton.classList.remove("b-hover"),t.hoveringButton=null),e.targetElement&&e.targetElement.closest(".b-columndragtoolbar")){t.element.classList.add("b-hover");const r=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");r&&(r.classList.add("b-hover"),t.hoveringButton=r)}else t.element.classList.remove("b-hover")}onDrop(e){const t=this;if(e.targetElement&&e.targetElement.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const r=e.targetElement,n=t.buttons.find(e=>e.name===r.dataset.name);n&&(r.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout(()=>{t.hideToolbar(),n.onDrop({column:t.column})},100))}else t.hideToolbar()}template(e){return Cn.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            ${e.map(e=>Cn.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${e.buttons.map(e=>Cn.tpl`
                        <div class="b-target-button" data-name="${e.name}" data-disabled="${e.disabled}">
                            <i class="${e.icon}"></i>
                            ${e.text}
                        </div>
                    `)}
                    </div>
                    <div class="b-title">${e.text}</div>
                </div>
            `)}
            </div>`}}Ga.featureClass="b-hascolumndragtoolbar",Ga._$name="ColumnDragToolbar",Va.registerFeature(Ga,P.isTouchDevice);class Ua extends Nn{static get $name(){return"ColumnPicker"}static get defaultConfig(){return{groupByRegion:!1,groupByTag:!1}}static get pluginConfig(){return{chain:["getHeaderMenuItems","getColumnDragToolbarItems"]}}construct(e,t){this.grid=e,super.construct(e,t)}getColumnPickerItems(e){const t=this;if(t.groupByRegion)return t.grid.regions.map(e=>{const r=t.grid.getSubGrid(e).columns.topColumns;return{text:I.capitalizeFirstLetter(e),menu:t.buildColumnMenu(r),disabled:0===r.length,region:e}});if(t.groupByTag){const r={};return e.topColumns.forEach(e=>{e.tags&&e.hideable&&e.tags.forEach(e=>{r[e]||(r[e]=1)})}),Object.keys(r).sort().map(e=>({text:I.capitalizeFirstLetter(e),menu:t.buildColumnMenu(t.getColumnsForTag(e)),tag:e,onBeforeSubMenu:({item:e,itemEl:r})=>{t.refreshTagMenu(e,r)}}))}return t.buildColumnMenu(e.topColumns)}getColumnsForTag(e){return this.grid.columns.records.filter(t=>t.tags&&t.tags.includes(e)&&!1!==t.hideable)}refreshTagMenu(e,t){this.getColumnsForTag(e.tag).forEach(t=>{const r=e.items.find(e=>e.column===t);r&&(r.checked=!0!==t.hidden)})}buildColumnMenu(e){let t=e.length>0&&e[0].region;const{grid:r}=this;return e.reduce((e,n)=>{const s=this.grid.columns.visibleColumns.filter(e=>e.region===n.region);if(!1!==n.hideable){const i={grid:r,text:n.text,column:n,name:n.id,checked:!0!==n.hidden,disabled:!0!==n.hidden&&1===s.length,cls:n.region!==t?"b-separator":""};t=n.region,n.children&&(i.menu=this.buildColumnMenu(n.children)),e.push(i)}return e},[])}getHeaderMenuItems(e,t){const r=this,{grid:n,disabled:s}=r,{columns:i}=n;if(!1!==e.showColumnPicker&&i.some(e=>e.hideable)&&t.push({text:"L{columnsMenu}",localeClass:this,name:"columnPicker",icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:100,menu:r.getColumnPickerItems(i),onToggle:r.onColumnToggle,disabled:s}),!1!==e.hideable){const r=i.visibleColumns.filter(t=>t.region===e.region);t.push({text:"L{hideColumn}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,name:"hideColumn",disabled:1===r.length||s,onItem:()=>e.hide()})}}onColumnToggle({menu:e,item:t,checked:r}){if(!!t.column.hidden!=!r){t.column[r?"show":"hide"]();const{grid:n,column:s}=t,{columns:i}=n,o=e.items,a=i.visibleColumns.filter(e=>e.region===t.column.region),{currentMenu:l}=n.features.contextMenu,c=l.items.find(e=>"hideColumn"===e.name);if(1===a.length){const e=o.find(e=>e.name===a[0].id);e&&(e.disabled=!0),c&&s.region===t.column.region&&(c.disabled=!0)}else a.forEach(e=>{const t=o.find(t=>t.column===e);t&&(t.disabled=!1)}),c&&s.region===t.column.region&&(c.disabled=!1);t.menu&&t.menu.eachWidget(e=>{e.checked=r});const d=e.owner;d&&d.column===s.parent&&(d.checked=o.some(e=>!0===e.checked))}}getColumnDragToolbarItems(e,t){const r=this.grid.columns.visibleColumns.filter(t=>t.region===e.region);return!1!==e.hideable&&r.length>1&&t.push({text:"L{hideColumnShort}",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,name:"hideColumn",onDrop:({column:e})=>e.hide()}),t}}Ua._$name="ColumnPicker",Va.registerFeature(Ua,!0);class Ya extends(br(Nn)){static get $name(){return"ColumnReorder"}construct(e,t){this.ignoreSelectors=[".b-grid-header-resize-handle",".b-field"],this.grid=e,super.construct(e,t)}doDestroy(){this.dragHelper&&this.dragHelper.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e,r=t.element,n=Et.children(r,".b-grid-headers");n.push(...Et.children(r,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=n:(e.dragHelper=new Fo({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",outerElement:r.querySelector("header.b-grid-header-container"),containers:n,isElementDraggable(r){if(Boolean(Et.up(r,e.ignoreSelectors.join(",")))||e.disabled)return!1;const n=Et.up(r,this.targetSelector),s=n&&t.columns.getById(n.dataset.columnId),i=s&&0===s.childLevel&&1===t.subGrids[s.region].columns.count;return Boolean(s)&&!1!==s.draggable&&!i},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",listeners:{dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,thisObj:e}}),e.relayEvents(e.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"))}static get pluginConfig(){return{after:["render","renderContents"]}}onDrag({context:e,event:t}){const r=K.fromElement(t.target,"header");r&&r.subGrid.sealedColumns?e.valid=!1:this.grid.features.columnDragToolbar||(e.valid=Boolean(t.target.closest(".b-grid-headers")))}onDragStart(){const e=this;if(!e.grid.features.columnDragToolbar){const t=e.grid.element.querySelector(".b-grid-header-container").getBoundingClientRect();e.dragHelper.minY=t.top,e.dragHelper.maxY=t.bottom}this.grid.headerContainer.classList.add("b-dragging-header")}onDrop({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,r=t.grid,n=e.dragging,s=Et.up(e.target,".b-grid-header"),i=r.columns.get(s.dataset.column),o=e.draggedTo.dataset.region||i.region,a=e.insertBefore,l=r.columns.getById(n.dataset.columnId),c=a?r.columns.getById(a.dataset.columnId):r.subGrids[o].columns.last.nextSibling,d=c?c.parent:r.columns.rootNode;if(r.headerContainer.classList.remove("b-dragging-header"),o===l.region&&(i===l.previousSibling||c===l.nextSibling))return void t.dragHelper.abort();const u=l.parent&&1===l.parent.children.length&&l.parent;u&&u.parent.removeChild(u),n.remove(),l.region=o,d.insertChild(l,c)}onInvalidDrop(){this.grid.headerContainer.classList.remove("b-dragging-header")}renderContents(){this.init()}render(){this.init()}}Ya.featureClass="b-column-reorder",Ya._$name="ColumnReorder",Va.registerFeature(Ya,!0);class qa extends Nn{static get $name(){return"ColumnResize"}static get defaultConfig(){return{liveResize:"auto"}}construct(e,t){const r=this;r.grid=e,super.construct(e,t),r.resizer=new No({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,listeners:{beforeresizestart:r.onBeforeResizeStart,resizestart:r.onResizeStart,resizing:r.onResizing,resize:r.onResize,thisObj:r}})}static get pluginConfig(){return[]}set liveResize(e){"auto"===e&&(e=!P.isMobileSafari),this._liveResize=e}get liveResize(){return this._liveResize}doDestroy(){this.resizer&&this.resizer.destroy(),super.doDestroy()}onBeforeResizeStart(){return!this.disabled}onResizeStart({context:e}){const{grid:t,resizer:r}=this,n=e.column=t.columns.getById(e.element.dataset.columnId);r.minWidth=n.minWidth,e.element.style.minWidth="",t.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.dragResizing=!0,e.column.width=e.newWidth)}onResize({context:e}){const{grid:t}=this,{column:r}=e;if(t.element.classList.remove("b-column-resizing"),e.valid&&(this.liveResize?(t.dragResizing=!1,t.afterColumnsResized()):r.width=e.newWidth,P.isIE11&&r.parent&&r.parent.flex)){const e=r.parent;t.getHeaderElement(e.id).style.flexBasis=e.children.reduce((e,r)=>e+t.getHeaderElement(r.id).offsetWidth,0)+"px"}}}qa._$name="ColumnResize",Va.registerFeature(qa,!0);class Xa extends Nn{static get $name(){return"ContextMenu"}static get defaultConfig(){return{headerItems:[],processHeaderItems:null,cellItems:[],processCellItems:null,triggerEvent:null,disableCellContextMenu:null}}construct(e,t){this.grid=e,super.construct(e,t)}doDestroy(){this.currentMenu&&this.currentMenu.destroy(),super.doDestroy()}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick","onElementKeyDown"]}}onElementContextMenu(e){"contextmenu"===this.triggerEvent&&this.showContextMenu(e)}onElementClick(e){"click"===this.triggerEvent&&this.showContextMenu(e)}onElementDblClick(e){"dblclick"===this.triggerEvent&&this.showContextMenu(e)}onElementKeyDown(e){if(!e.handled&&e.target.matches(".b-grid-header.b-depth-0"))switch(e.key){case" ":case"ArrowDown":this.showContextMenu(e)}}showContextMenu(e){if(!this.disabled){const t=Et.up(e.target,".b-grid-header"),r=this.grid.getEventData(e);t?this.handleHeaderContextMenu(t,e):r&&!this.disableCellContextMenu&&this.handleCellContextMenu(r,e)}}handleHeaderContextMenu(e,t){if(e.dataset.column){const r=this,n=r.grid,s=n.columns.getById(e.dataset.columnId),i=e=>{e.column||(e.column=s);let t=e.menu;t&&(Array.isArray(t)||(t=t.items||t.widgets),t.forEach(i))};if(!1!==s.enableHeaderContextMenu){const o=[...r.headerItems,...s.headerMenuItems||[]],{processHeaderItems:a}=r,l={items:o,column:s,event:t,element:e};n.getHeaderMenuItems(s,o),(!a||!1!==a(l))&&o.length>0&&(t.preventDefault(),o.sort((e,t)=>(e.weight||150)-(t.weight||150)),o.forEach(i),!1!==n.trigger("headerContextMenuBeforeShow",l)&&(r.currentMenu=J.showContextMenu("keydown"===t.type?e:[t.clientX+1,t.clientY+1],{owner:r.client,constrainTo:document,cls:"b-context-menu",items:o,scrollAction:"hide",onItem({source:e,item:t,element:r}){n.trigger("contextMenuItem",{source:n,item:t,column:s,element:r})},onToggle({source:e,item:t,checked:r,element:i}){n.trigger("contextMenuToggleItem",{source:n,item:t,column:s,checked:r,element:i})},onDestroy(){r.currentMenu=null},listeners:{show({source:e}){l.menu=e,n.trigger("headerContextMenuShow",l)}}})))}}}handleCellContextMenu(e,t){const r=this,n=r.grid,s=e.cellElement,i=n.columns.getById(e.columnId);if(!1!==i.enableCellContextMenu){n.focusCell(e.cellSelector,{doSelect:!n.isSelected(e.id),event:t});const o=e.record,a=[...r.cellItems||[],...i.cellMenuItems||[]],{processCellItems:l}=r,c={items:a,column:i,event:t,record:o,element:s};n.getCellMenuItems(i,o,a),(!l||!1!==l(c))&&a.length>0&&(a.forEach(e=>{e.column=i,e.record=o}),t.preventDefault(),a.sort((e,t)=>(e.weight||150)-(t.weight||150)),!1!==n.trigger("cellContextMenuBeforeShow",c)&&(r.currentMenu=J.showContextMenu([t.clientX+1,t.clientY+1],{owner:r.client,items:a,onBeforeItem:e=>{Object.assign(e,c)},onItem({item:e}){n.trigger("contextMenuItem",{source:n,item:e,column:i,record:o,cell:s})},onClose({reason:e}){"outside"!==e&&n.focus()},onDestroy(){r.currentMenu=null},listeners:{show({source:e}){c.menu=e,n.trigger("cellContextMenuShow",c)}}})))}}hideContextMenu(e){this.currentMenu&&this.currentMenu.hide(e)}get triggerEvent(){return this._triggerEvent||this.client.contextMenuTriggerEvent}set triggerEvent(e){this._triggerEvent=e}}Xa.featureClass="",Xa._$name="ContextMenu",Va.registerFeature(Xa,!0);class Ka extends Nn{static get $name(){return"Filter"}static get pluginConfig(){return{chain:["renderHeader","getCellMenuItems","getHeaderMenuItems","onElementClick"]}}construct(e,t){if(e.features.filterBar)throw new Error("Grid.feature.Filter feature may not be used together with Grid.feature.FilterBar. These features are mutually exclusive.");const r=this;r.grid=e,r.store=e.store,r.closeFilterEditor=r.closeFilterEditor.bind(r),super.construct(e,t),r.store.on({filter:r.onStoreFilter},r),t&&"object"==typeof t&&r.store.filter(t,null,r.client.isConfiguring)}doDestroy(){const e=this;e.filterTip&&e.filterTip.destroy(),e.filterEditorPopup&&e.filterEditorPopup.destroy(),e.store.un({sort:e.onStoreFilter},e),super.doDestroy()}refreshHeaders(e){const t=this,r=t.grid,n=r.headerContainer;if(n){Et.children(n,".b-filter-icon.b-latest").forEach(e=>e.classList.remove("b-latest")),t.filterTip||(t.filterTip=new Mn({forElement:n,forSelector:".b-filter-icon",getHtml:({activeTarget:e})=>e.dataset.filterText}));for(const e of r.columns)if(!1!==e.filterable){const r=t.store.filters.getBy("property",e.field),n=e.element;if(n){const s=e.textWrapper;let i,o=s&&s.querySelector(".b-filter-icon");i=r?t.L("L{filter}")+": "+("string"==typeof r?r:`${r.operator} ${r.displayValue||r.value||""}`):t.L("L{applyFilter}"),o?o.dataset.filterText=i:(o=Et.createElement({parent:s,tag:"div",className:"b-filter-icon",dataset:{filterText:i}}),n.classList.add("b-filterable")),e.field===t.store.latestFilterField&&o.classList.add("b-latest"),n.classList[r?"add":"remove"]("b-filter")}e.meta.isFiltered=!!r}e&&r.refreshRows()}}applyFilter(e){const{store:t}=this,r=this.grid.columns.get(e.property);"function"==typeof r.filterable?t.filter({filterBy:t=>r.filterable(Object.assign({},e,{record:t})),value:e.value,property:e.property,operator:e.operator,displayValue:e.displayValue}):t.filter(e)}getPopupDateItems(e,t,r,n,s,i,o){const a=this,l=i,c=o;function d({source:e,value:t}){null==t?o():(a.applyFilter({property:n,operator:e.operator,value:t,displayValue:e._value}),i())}return[{type:"date",ref:"on",placeholder:"L{on}",clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t&&"="===t.operator?t.value:r,operator:"=",onChange:d,onClose:l,onClear:c},{type:"date",ref:"before",placeholder:"L{before}",clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:t&&"<"===t.operator?t.value:null,operator:"<",onChange:d,onClose:l,onClear:c},{type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:t&&">"===t.operator?t.value:null,operator:">",onChange:d,onClose:l,onClear:c}]}getPopupNumberItems(e,t,r,n,s,i,o){const a=this,l=i,c=o;function d({source:e,value:t}){null==t?o():(a.applyFilter({property:n,operator:e.operator,value:t}),i())}return[{type:"number",placeholder:"L{Filter.equals}",clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t&&"="===t.operator?t.value:r,operator:"=",onChange:d,onEsc:l,onClear:c},{type:"number",placeholder:"L{lessThan}",label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:t&&"<"===t.operator?t.value:null,operator:"<",onChange:d,onEsc:l,onClear:c},{type:"number",cls:"b-last-row",placeholder:"L{moreThan}",clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:t&&">"===t.operator?t.value:null,operator:">",onChange:d,onEsc:l,onClear:c}]}getPopupStringItems(e,t,r,n,s,i,o){const a=this;return[{type:e,cls:"b-last-row",placeholder:"L{filter}",clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t?t.value||t:r,onChange:({value:e})=>{""===e?o():(a.applyFilter({property:n,value:e}),i())},onClose:i,onClear:o}]}getPopupItems(e,t,r,n,s,i,o){switch(e){case"date":return this.getPopupDateItems(...arguments);case"number":return this.getPopupNumberItems(...arguments);default:return this.getPopupStringItems(...arguments)}}showFilterEditor(e,t){const r=this,{store:n}=r,s="string"==typeof e?r.grid.columns.getById(e):e,i=s.element,o=n.modelClass.fieldMap[s.field],a=n.filters.getBy("property",s.field),l={string:"text",number:"number",date:"date"}[o&&o.type||s.filterType||s.type||"string"]||"text";if(!1===s.filterable)return;r.closeFilterEditor();const c=r.getPopupItems(l,a,t,s.field,r.store,r.closeFilterEditor,()=>{r.store.removeFilter(s.field),r.closeFilterEditor()});c.forEach(e=>e.placeholder=this.L(e.placeholder)),r.filterEditorPopup=J.openPopup(i,{owner:this.grid,width:"16em",cls:"b-filter-popup",scrollAction:"realign",items:c})}closeFilterEditor(){this.filterEditorPopup&&this.filterEditorPopup.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getMenuDateItems(e,t){const r=this,n=t[e.field],s=t=>{r.applyFilter({property:e.field,operator:t,value:n,displayValue:e.formatValue?e.formatValue(n):n})};return[{text:"L{on}",localeClass:this,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterDateEquals",disabled:r.disabled,onItem:()=>s("=")},{text:"L{before}",localeClass:this,icon:"b-fw-icon b-icon-filter-before",name:"filterDateBefore",disabled:r.disabled,onItem:()=>s("<")},{text:"L{after}",localeClass:this,icon:"b-fw-icon b-icon-filter-after",name:"filterDateAfter",disabled:r.disabled,onItem:()=>s(">")}]}getMenuNumberItems(e,t){const r=this,n=n=>{r.applyFilter({property:e.field,operator:n,value:t[e.field]})};return[{text:"L{equals}",localeClass:this,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterNumberEquals",disabled:r.disabled,onItem:()=>n("=")},{text:"L{lessThan}",localeClass:this,icon:"b-fw-icon b-icon-filter-less",name:"filterNumberLess",disabled:r.disabled,onItem:()=>n("<")},{text:"L{moreThan}",localeClass:this,icon:"b-fw-icon b-icon-filter-more",name:"filterNumberMore",disabled:r.disabled,onItem:()=>n(">")}]}getMenuStringItems(e,t){return[{text:"L{equals}",localeClass:this,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterStringEquals",disabled:this.disabled,onItem:()=>{this.applyFilter({property:e.field,value:t[e.field]})}}]}getCellMenuItems(e,t,r){const n=this,s=t.getFieldDefinition(e.field);if(!1!==e.filterable){const t=[];switch(e.meta.isFiltered&&t.push({text:"L{removeFilter}",localeClass:this,icon:"b-fw-icon b-icon-clear",cls:"b-separator",name:"filterRemove",disabled:n.disabled,onItem(){n.store.removeFilter(e.field)}}),e.filterType||e.type||s&&s.type){case"date":t.push(...n.getMenuDateItems(...arguments));break;case"number":t.push(...n.getMenuNumberItems(...arguments));break;default:t.push(...n.getMenuStringItems(...arguments))}e.meta.isFiltered&&t.length>1&&(t[1].cls=""),r.push(...t)}}getHeaderMenuItems(e,t){const r=this;e.meta.isFiltered?(t.push({text:"L{editFilter}",localeClass:this,name:"editFilter",icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:r.disabled,onItem(){r.showFilterEditor(e)}}),t.push({text:"L{removeFilter}",localeClass:this,name:"removeFilter",icon:"b-fw-icon b-icon-remove",disabled:r.disabled,onItem(){r.store.removeFilter(e.field)}})):!1!==e.filterable&&t.push({text:"L{filter}",localeClass:this,name:"filter",icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:r.disabled,onItem(){r.showFilterEditor(e)}})}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick(e){const t=e.target;if(this.filterEditorPopup&&this.closeFilterEditor(),t.classList.contains("b-filter-icon")){const e=Et.up(t,".b-grid-header");return this.showFilterEditor(e.dataset.columnId),!1}}}Ka._$name="Filter",Va.registerFeature(Ka);class Za extends Nn{static get $name(){return"FilterBar"}static get defaultConfig(){return{keyStrokeFilterDelay:300,clearStoreFiltersOnHide:!0}}construct(e,t){if(e.features.filter)throw new Error("Grid.feature.FilterBar feature may not be used together with Grid.feature.Filter, These features are mutually exclusive.");const r=this;Object.assign(r,{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSupended:0,store:e.store,grid:e}),r.onColumnFilterFieldChange=r.onColumnFilterFieldChange.bind(r),super.construct(e,Array.isArray(t)?{filter:t}:t),r.store.on({filter:r.onStoreFilter,thisObj:r}),r.filter&&r.store.filter(r.filter),r.gridDetacher=e.on("beforeelementclick",r.onBeforeElementClick,r)}doDestroy(){this.destroyFilterBar(),this.gridDetacher&&this.gridDetacher(),super.doDestroy()}doDisable(e){const{columns:t}=this.grid;t&&t.forEach(t=>{const r=this.getColumnFilterField(t);r&&(r.disabled=e)}),super.doDisable(e)}static get pluginConfig(){return{before:["onElementKeyDown"],chain:["renderHeader","getHeaderMenuItems"]}}destroyFilterBar(){this.grid.columns&&this.grid.columns.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){const e=this,t=e.grid.columns;e.clearStoreFiltersOnHide&&e.suspendStoreTracking(),t&&t.forEach(t=>e.hideColumnFilterField(t,!0)),e.grid.store.filter(),e.clearStoreFiltersOnHide&&e.resumeStoreTracking(),e.hidden=!0}showFilterBar(){this.renderFilterBar(),this.hidden=!1}toggleFilterBar(){const e=this;e.hidden?e.showFilterBar():e.hideFilterBar()}renderFilterBar(){this.grid.columns.visibleColumns.forEach(e=>this.renderColumnFilterField(e)),this.rendered=!0}renderColumnFilterField(e){const t=this,r=t.grid,n=t.getColumnFilterable(e);if(n&&!e.hidden){const s=e.element;let i=t.getColumnFilterField(e);if(i)t.onColumnFilterFieldChange({source:i,value:i.value}),i.render(s),i.show();else{const o=r.store.filters.getBy("property",e.field),a=(e.filterType||"text")+"field";i=J.append(Object.assign({type:a,owner:t.grid,clearable:!0,column:e,name:e.field,value:o&&!o._filterBy&&t.buildFilterString(o),cls:t.filterFieldCls,inputCls:t.filterFieldInputCls,keyStrokeChangeDelay:t.keyStrokeFilterDelay,onChange:t.onColumnFilterFieldChange,onClear:t.onColumnFilterFieldChange,disabled:t.disabled},n.filterField),s)[0],t.setColumnFilterField(e,i)}s.classList.add(t.filterableColumnCls)}}updateColumnFilterFields(){const{columns:e,store:t}=this.grid;let r,n;for(const s of e)r=this.getColumnFilterField(s),r&&(n=t.filters.getBy("property",s.field),n?n._filterBy||(r.value=this.buildFilterString(n)):r.value="")}getColumnFilterable(e){if(!e.isRoot&&!1!==e.filterable&&e.field)return"function"==typeof e.filterable&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const t=this.getColumnFilterField(e);t&&(this.hideColumnFilterField(e),t.destroy(),this.setColumnFilterField(e,void 0))}hideColumnFilterField(e,t){const r=this,n=r.grid.store,s=e.element,i=r.getColumnFilterField(e);i&&(i.hide(),r.clearStoreFiltersOnHide&&e.field&&n.removeFilter(e.field,t),null==s||s.classList.remove(r.filterableColumnCls))}getColumnFilterField(e){return this._columnFilters&&this._columnFilters[e.data.id]}setColumnFilterField(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}parseFilterValue(e){const t=String(e).match(this.filterParseRegExp);return{operator:t[1]||"*",value:t[2]}}buildFilterString(e){return("*"===e.operator?"":e.operator)+e.value}onStoreFilter(){!this.storeTrackingSupended&&this.rendered&&this.updateColumnFilterFields()}suspendStoreTracking(){this.storeTrackingSupended++}resumeStoreTracking(){this.storeTrackingSupended--}renderHeader(){this.hidden||this.renderFilterBar()}onElementKeyDown(e){if(!e.handled&&e.target.matches(this.filterFieldInputSelector))switch(e.key){case"ArrowLeft":case"ArrowRight":e.handled=!0}}onBeforeElementClick({event:e}){if(e.target.closest("."+this.filterFieldCls))return!1}onColumnFilterFieldChange({source:e,value:t}){const r=this,n=r.grid.store,s=r.getColumnFilterable(e.column);r.suspendStoreTracking(),null==t||""===t||Array.isArray(t)&&0===t.length?n.removeFilter(e.name):s.filterFn?n.filter({filterBy:r=>s.filterFn({property:e.name,value:t,record:r}),property:e.name}):n.filter(Object.assign({property:e.name},r.parseFilterValue(t))),r.resumeStoreTracking()}getHeaderMenuItems(e,t){const r=this;t.push({text:r.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,name:"toggleFilterBar",icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>r.toggleFilterBar()})}}Za.featureClass="b-filter-bar",Za._$name="FilterBar",Va.registerFeature(Za);class Ja extends Nn{static get $name(){return"Group"}static get defaultConfig(){return{field:null,renderer:null}}construct(e,t){const r=this;e.features.tree||(r._thisIsAUsedExpression(e.features.groupSummary),t=r.processConfig(t),Object.assign(r,{grid:e,rowManager:e.rowManager,store:e.store}),super.construct(e,t),r.store.on({group:r.onStoreGroup,thisObj:r}),r.rowManager.on({beforerenderrow:r.onBeforeRenderRow,rendercell:r.renderCell,thisObj:r}))}processConfig(e){return"string"==typeof e?{field:e,ascending:null}:e}setConfig(e){null===e?this.store.clearGroupers():super.setConfig(this.processConfig(e))}set renderer(e){this.groupRenderer=e}set field(e){this._field=e,this.store.group(e,this.ascending)}get field(){return this._field}doDestroy(){super.doDestroy()}doDisable(e){const{store:t}=this;if(e&&t.isGrouped){const{sorters:e}=t;e.unshift(...t.groupers),t.clearGroupers(),t.sort(e)}super.doDisable(e)}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","getHeaderMenuItems","getColumnDragToolbarItems","onElementTouchStart","onElementClick","onElementKeyDown"],override:["onStoreDataChange"]}}toggleCollapse(e,t){this.internalToggleCollapse(e,t)}internalToggleCollapse(e,t,r=!1){const n=this,s=n.store,i=s.getById(e),o=i.meta;void 0!==o.groupRowFor&&((t=void 0===t?!o.collapsed:t)?s.excludeGroupRecords(i):s.includeGroupRecords(i),o.collapsed=t,n.grid.trigger("toggleGroup",{groupRecord:i,collapse:t}),r||n.rowManager.renderFromRecord(i))}collapseAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach(t=>e.internalToggleCollapse(t,!0,!0)),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach(t=>e.internalToggleCollapse(t,!1,!0)),e.grid.refreshRows())}onBeforeRenderRow({row:e,record:t}){const r=e.grid.store.getById(e.id);e.forceInnerHTML=e.forceInnerHTML||r&&"groupRowFor"in r.meta}renderCell(e){const t=this;if(!t.store.isGrouped||t.disabled)return;const{cellElement:r,rowElement:n,column:s}=e,i=t.grid,o=e.record.meta,a=i.columns.visibleColumns[0],l=i.subGrids[i.regions[0]].columns.visibleColumns;if("groupRowFor"in o){if("action"===s.type)return;s.clearCell(r),n.classList[o.collapsed?"add":"remove"]("b-grid-group-collapsed"),n.classList.add("b-group-row"),("rownumber"===a.type&&s===l[1]||"rownumber"!==a.type&&s===l[0])&&r.classList.add("b-group-title"),t.buildGroupHeader(e)}else r===n.firstElementChild&&(n.classList.remove("b-group-row"),n.classList.remove("b-grid-group-collapsed"),r.classList.remove("b-group-title"))}buildGroupHeader(e){const t=this,{record:r,cellElement:n,column:s,persist:i}=e,o=t.grid,a=r.meta,l=a.childCount-(o.features.groupSummary?1:0),c=o.columns.visibleColumns[0],d=s&&o.subGrids[o.regions[0]].columns.visibleColumns,u="rownumber"===c.type&&s===d[1]||"rownumber"!==c.type&&s===d[0];let h=null,g=!0;if(i||s){const n=o.columns.get(a.groupField);n&&n.groupRenderer?u&&(h=n.groupRenderer(Object.assign({},e,{groupRowFor:a.groupRowFor,groupRecords:r.groupChildren,groupColumn:n,count:l})),g=!1):t.groupRenderer&&(h=t.groupRenderer(Object.assign({},e,{groupRowFor:a.groupRowFor,groupRecords:r.groupChildren,groupColumn:n,count:l,isFirstColumn:u}))),u&&null==h&&g&&(h=`${"__novalue__"===a.groupRowFor?"":a.groupRowFor} (${l})`)}else t.groupRenderer&&(h=t.groupRenderer(e));return"string"==typeof h&&(n.innerHTML=h),n.childElementCount>0&&(n._hasHtml=!0),n.innerHTML}renderHeader(e){const{store:t,grid:r}=this;if(t.isGrouped)for(const e of t.groupers){const t=r.columns.get(e.field),n=t&&r.getHeaderElement(t.id);n&&(n.classList.add("b-group"),n.classList.add(e.ascending?"b-asc":"b-desc"))}}getHeaderMenuItems(e,t){const r=this,n=r.store;!1!==e.groupable&&t.push({text:"L{groupAscending}",localeClass:this,icon:"b-fw-icon b-icon-group-asc",name:"groupAsc",cls:"b-separator",weight:110,disabled:r.disabled,onItem:({item:{column:e}})=>n.group(e.field,!0)},{text:"L{groupDescending}",localeClass:this,icon:"b-fw-icon b-icon-group-desc",name:"groupDesc",weight:110,disabled:r.disabled,onItem:({item:{column:e}})=>n.group(e.field,!1)}),n.isGrouped&&t.push({text:"L{stopGrouping}",localeClass:this,icon:"b-fw-icon b-icon-clear",name:"groupRemove",cls:e.groupable?"":"b-separator",weight:110,disabled:r.disabled,onItem:({item:{column:e}})=>n.clearGroupers()})}getColumnDragToolbarItems(e,t){const r=this.store;t.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:this,icon:"b-icon b-icon-group-asc",name:"groupAsc",cls:"b-separator",weight:110,disabled:this.disabled,onDrop:({column:e})=>r.group(e.field,!0)}),t.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:this,icon:"b-icon b-icon-group-desc",name:"groupDesc",weight:110,disabled:this.disabled,onDrop:({column:e})=>r.group(e.field,!1)});const n=r.groupers&&r.groupers.some(t=>t.field===e.field)&&!this.disabled;return t.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:this,icon:"b-icon b-icon-clear",name:"groupRemove",disabled:!n,weight:110,onDrop:({column:e})=>r.removeGrouper(e.field)}),t}onStoreGroup({groupers:e}){const{grid:t}=this,{element:r}=t,n=r&&Et.children(r,".b-grid-header.b-group");if(r){for(const e of n)Et.removeClasses(e,["b-group","b-asc","b-desc"]);if(e)for(const r of e){const e=t.getHeaderElementByField(r.field);e&&Et.addClasses(e,["b-group",r.ascending?"b-asc":"b-desc"])}}}onElementTouchStart(e){const t=this,r=e.target,n=Et.up(r,".b-grid-header"),s=n&&t.grid.getColumnFromElement(n);e.touches.length>1&&s&&!1!==s.groupable&&!t.disabled&&t.store.group(s.field)}onElementClick(e){const t=this,r=t.store,n=e.target,s=Et.up(n,".b-group-row"),i=Et.up(n,".b-grid-header"),o=i&&i.dataset.column;if(!(n.classList.contains("b-resizer")||t.disabled||n.classList.contains("b-action-item"))){if(i&&o){const n=r.groupers&&r.groupers.find(e=>e.field===o);if(n&&!e.shiftKey)return r.group(o,!n.ascending),!1;if(e.shiftKey){!1!==t.grid.columns.get(o).groupable&&(e.altKey?r.removeGrouper(o):r.group(o))}e.preventDefault()}return s?(t.internalToggleCollapse(ei.get(s).id),!1):void 0}}onElementKeyDown(e){const t=this;!t.disabled&&t.store.isGrouped&&e.target===t.client.focusElement&&" "===e.key&&t.grid.focusedCell&&(e.preventDefault(),t.internalToggleCollapse(t.grid.focusedCell.id))}onStoreDataChange(e){const t=e.source;t.isGrouped&&t.count>0||this.overridden.onStoreDataChange(e)}}Ja._$name="Group",Va.registerFeature(Ja,!0,["Grid","Scheduler"]);var Qa=e=>class extends(e||B){generateHtml(e,t,r){const n=this.store,s=e.summaries||(e.sum?[{sum:e.sum,renderer:e.summaryRenderer}]:[]);let i=`<table class="${r}">`;return s.forEach(r=>{let s=r.sum,o=null;switch(!0===s&&(s="sum"),s){case"sum":case"add":o=n.sum(e.field,t);break;case"max":o=n.max(e.field,t);break;case"min":o=n.min(e.field,t);break;case"average":case"avg":o=n.average(e.field,t);break;case"count":o=t.length;break;case"countNotEmpty":o=t.reduce((t,r)=>{const n=r[e.field];return t+(null!=n?1:0)},0)}if("function"==typeof s&&(o=t.reduce(s,"seed"in r?r.seed:0)),null!==o){const e="b-grid-summary-value",t=r.label?`<td class="b-grid-summary-label">${r.label}</td>`:"";let n,s=r.renderer?r.renderer({config:r,sum:o}):o;null==s&&(s=""),n=String(s).includes("<td>")?s:t?`${t}<td class="${e}">${s}</td>`:`<td colspan="2" class="${e}">${s}</td>`,i+=`<tr>${n}</tr>`}}),i+"</table>"}};class el extends(Qa(Nn)){static get $name(){return"GroupSummary"}construct(e,t){const r=this;if(Object.assign(r,{grid:e,store:e.store}),super.construct(e,t),!e.features.group)throw new Error("Requires Group feature to work, please enable");r.store.on({update:r.onStoreUpdate,prio:1,thisObj:r}),r.grid.rowManager.on({beforerenderrow:r.onBeforeRenderRow,rendercell:r.renderCell,thisObj:r})}doDisable(e){this.store.useGroupFooters=!e,this.isConfiguring||this.store.group(),super.doDisable(e)}onBeforeRenderRow({row:e,record:t}){e.isGroupFooter&&!("groupFooterFor"in t.meta)&&(e.isGroupFooter=!1,e.removeCls("b-group-footer"),e.forceInnerHTML=!0)}renderCell({column:e,cellElement:t,rowElement:r,row:n,record:s,size:i}){const o=this;if(o.store.isGrouped&&"groupFooterFor"in s.meta){r.classList.add("b-group-footer"),n.isGroupFooter=!0;const a=o.updateSummaryHtml(t,e,s.meta.groupRecord.groupChildren),l="number"==typeof a?a:a.count;l>1&&(i.height=o.grid.rowHeight+l*o.grid.rowHeight*.1),a.height&&(i.height+=a.height)}}updateSummaryHtml(e,t,r){(r=r.slice()).pop();const n=this.generateHtml(t,r,"b-grid-group-summary");return e.children.length?Et.sync(n,e.firstElementChild):e.innerHTML=n,t.summaries?t.summaries.length:t.sum?1:0}onStoreUpdate({source:e,changes:t}){if(!this.disabled&&e.isGrouped){if(t&&e.groupers.find(e=>e.field in t))return;Object.keys(t).some(e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))})&&(this.grid.forceFullRefresh=!0)}}}el.featureClass="b-group-summary",el._$name="GroupSummary",Va.registerFeature(el);class tl extends Nn{static get $name(){return"QuickFind"}static get defaultConfig(){return{mode:"header",find:""}}static get pluginConfig(){return{chain:["onElementKeyDown","onElementKeyPress","onCellNavigate"]}}construct(e,t){this.grid=e,this.store=e.store,super.construct(e,t)}doDisable(e){e&&this.clear(),super.doDisable(e)}showQuickFind(){const e=this,t=e.grid.getHeaderElement(e.columnId);if(t){if(!e.headerField){const[r,n,s]=Et.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},!0);"header"===e.mode?t.appendChild(r):(r.className+=" b-quick-hit-mode-grid",e.grid.element.appendChild(r)),e.headerField={header:r,field:n,badge:s,colHeader:t}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,t.classList.add("b-quick-find-header"),e.renderListenerInitialized||(e.grid.rowManager.on({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}}hideQuickFind(){const e=this;for(let t of e.prevFound||e.found){let r=e.grid.getRowById(t.id);r&&r.renderCell(r.getCell(e.columnId),t.data)}e.headerField&&(e.headerField.header.parentNode.removeChild(e.headerField.header),e.headerField.colHeader.classList.remove("b-quick-find-header"),e.headerField=null),e.renderListenerInitialized&&(e.grid.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),e.grid.trigger("hideQuickFind")}search(e,t=this.columnId){let r=this,n=r.grid.columns.getById(t)||r.grid.columns.get(t),s=r.store.findByField(n.field,e),i=1,o=r.grid;Object.assign(r,{foundMap:{},prevFound:r.found,found:s,find:e,columnId:n.id}),e?r.showQuickFind():r.hideQuickFind(),r.currentColumn&&r.currentColumn!==n&&(r.currentColumn.disableHtmlEncode=!1);for(let e of Et.children(o.element,".b-quick-hit")){e.classList.remove("b-quick-hit"),e.classList.remove("b-quick-hit-cell"),ei.get(e).row.renderCell(e)}if(n.disableHtmlEncode=!0,r.currentColumn=n,s){s.length>0&&r.gotoClosestHit(o.focusedCell,s);for(let e of s){r.foundMap[e.id]=i++;let t=o.getRowById(e.data.id);if(t&&t.renderCell(t.getCell(n.id)),i>1e3)break}r.grid.trigger("quickFind",{find:e,found:s})}}clear(){this.found&&this.found.length&&this.search("")}get foundCount(){return this.found?this.found.length:0}gotoHit(e){let t=this,r=t.grid,n=t.found[e];return n&&r.focusCell({columnId:t.columnId,id:n.id}),!!n}gotoClosestHit(e,t){let r=e?this.grid.store.indexOf(e.id):0,n=t.slice().sort((e,t)=>Math.abs(e.index-r)-Math.abs(t.index-r));this.gotoHit(t.indexOf(n[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){let e=this,t=e.grid,r=t._focusedCell?t._focusedCell.id:t.lastFocusedCell.id,n=t.store.indexOf(r)||0,s=e.found.find(e=>e.index>n);s?t.focusCell({columnId:e.columnId,id:s.id}):e.gotoFirstHit()}gotoPrevHit(){let e,t=this,r=t.grid,n=r._focusedCell?r._focusedCell.id:r.lastFocusedCell.id,s=r.store.indexOf(n)||0,i=t.found;if(i.length){for(let t=i.length-1;t--;t>=0)if(i[t].index<s){e=i[t];break}e?r.focusCell({columnId:t.columnId,id:e.id}):t.gotoLastHit()}}renderCell(e){const t=this,r=e.cellElement,n=t.foundMap&&t.columnId===e.column.id&&t.foundMap[e.record.id];if(n){const s=e.column.htmlEncode||e.column.shouldHtmlEncode;if(r.classList.add("b-quick-hit"),s){let e=Et.down(r,".b-grid-cell-value,.b-tree-cell-value")||r,s=e.innerText,i=s&&s.toLowerCase().indexOf(t.find.toLowerCase());if(i>-1){let r=i+t.find.length,o=s.slice(i,r),a="";" "===s[i-1]&&(a="&nbsp;"),s=s.slice(0,i)+`<span class="b-quick-hit-text">${a}${o}</span>`+s.slice(r),e.innerHTML=s+`<div class="b-quick-hit-cell-badge">${n}</div>`}else r.classList.add("b-quick-hit-cell")}else r.classList.add("b-quick-hit-cell")}}onElementKeyDown(e){const t=this,r=this.grid.features.filter;t.disabled||Et.up(e.target,P.isIE11?".b-widget:not(.b-grid-subgrid):not(.b-grid)":".b-widget:not(.b-grid)")||t.find.length>0&&("Backspace"===e.key?(e.preventDefault(),t.find=t.find.substr(0,t.find.length-1),t.search(t.find)):"Escape"===e.key?(e.preventDefault(),t.find="",t.search(t.find)):"F3"===e.key||"g"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),e.shiftKey?t.gotoPrevHit():t.gotoNextHit()):r&&t.columnId&&t.foundCount&&e.ctrlKey&&e.shiftKey&&"F"===e.key&&r.showFilterEditor(t.grid.columns.getById(t.columnId),t.find))}onElementKeyPress(e){const t=this;if(!t.disabled&&!Et.up(e.target,P.isIE11?".b-widget:not(.b-grid-subgrid):not(.b-grid)":".b-widget:not(.b-grid)")&&"Enter"!==e.key&&t.grid._focusedCell){const r=t.grid.columns.getById(t.grid._focusedCell.columnId);r&&!1!==r.searchable&&(t.columnId=t.grid._focusedCell.columnId,e.key&&1===e.key.length&&(t.find+=e.key,t.search(t.find)))}}onCellNavigate(e,t,r,n){const s=this;!(s.prevFound||s.found)||r&&r.columnId===s.columnId||s.clear()}}tl._$name="QuickFind",Va.registerFeature(tl);class rl extends Nn{static get $name(){return"RegionResize"}construct(e,t){this.grid=e,super.construct(e,t)}doDestroy(){super.doDestroy()}static get pluginConfig(){return{chain:["onElementTouchStart","onElementTouchMove","onElementTouchEnd","onElementMouseDown","onElementMouseMove","onElementDblClick","onElementMouseUp","onSubGridCollapse","onSubGridExpand","render"]}}onElementDblClick(e){const t=this,r=t.grid,n=Et.up(e.target,".b-grid-splitter-collapsed");if(n&&!t.expanding){t.expanding=!0;let e=n.dataset.region,s=r.getSubGrid(e);s.collapsed||(e=r.getLastRegions()[1],s=r.getSubGrid(e)),s.expand().then(()=>t.expanding=!1)}}startMove(e,t){const{grid:r}=this,n=e.dataset.region,s=r.element,i=r.regions[r.regions.indexOf(n)+1],o=r.getSubGrid(i),a=r.getSubGrid(n);let l=a,c=1;if(null!=l.flex&&null==o.flex&&(l=o,c=-1),e.classList.contains("b-grid-splitter-collapsed"))return;const d=l.element.offsetWidth+o.element.offsetWidth;this.dragContext={element:e,headerEl:l.header.element,subGridEl:l.element,subGrid:l,splitterSubGrid:a,originalWidth:l.element.offsetWidth,originalX:t,minWidth:l.minWidth||0,maxWidth:Math.min(d,l.maxWidth||d),flip:c},s.classList.add("b-moving-splitter"),a.toggleSplitterCls("b-moving")}endMove(){const e=this.dragContext;e&&(this.grid.element.classList.remove("b-moving-splitter"),e.splitterSubGrid.toggleSplitterCls("b-moving",!1),this.dragContext=null)}onCollapseClick(e,t){const r=this.grid,n=t.dataset.region,s=r.getLastRegions();if(s[0]===n){const e=r.getSubGrid(s[1]);if(e.collapsed)return void e.expand()}e.collapse()}onExpandClick(e,t){const r=this.grid,n=t.dataset.region,s=r.getLastRegions();if(s[0]!==n||e.collapsed)e.expand();else{r.getSubGrid(s[1]).collapse()}}updateMove(e){const{dragContext:t}=this;if(t){const r=e-t.originalX,n=Math.min(t.maxWidth,t.originalWidth+r*t.flip);t.subGrid.width=Math.max(n,t.minWidth)}}onElementTouchStart(e){const t=e.target.closest(".b-grid-splitter");t&&this.startMove(t,e.touches[0].clientX)}onElementTouchMove(e){this.dragContext&&(this.updateMove(e.touches[0].clientX),e.preventDefault())}onElementTouchEnd(e){this.dragContext&&(this.endMove(),e.preventDefault())}onElementMouseDown(e){const t=this,r=e.target,n=r.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),s=n&&t.grid.getSubGrid(n.dataset.region);0===e.button&&(r.classList.contains("b-grid-splitter")||r.classList.contains("b-grid-splitter-inner")?t.startMove(n,e.clientX):r.classList.contains("b-icon-collapse-gridregion")?t.onCollapseClick(s,n):r.classList.contains("b-icon-expand-gridregion")&&t.onExpandClick(s,n))}onElementMouseMove(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}onElementMouseUp(e){this.dragContext&&(this.endMove(),e.preventDefault())}onSubGridCollapse(e){const t=this.grid.resolveSplitter(e);this.grid.getLastRegions()[1]===e.region&&t.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand(e){this.grid.resolveSplitter(e).classList.remove("b-grid-splitter-allow-collapse")}render(){const{regions:e,subGrids:t}=this.grid;e.length>2&&(t[e[0]].splitterElement.classList.add("b-left-only"),t[e[1]].splitterElement.classList.add("b-right-only"))}}rl.featureClass="b-split",rl._$name="RegionResize",Va.registerFeature(rl);class nl extends(br(Nn)){static get $name(){return"RowReorder"}static get defaultConfig(){return{hoverExpandTimeout:1e3,finalizeDelay:300}}construct(e,t){this.grid=e,super.construct(...arguments)}doDestroy(){this.dragHelper&&this.dragHelper.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e;e.dragHelper=new Fo({name:"rowReorder",mode:"translateXY",cloneTarget:!0,dragThreshold:10,targetSelector:".b-grid-row",lockX:!0,transitionDuration:t.transitionDuration,scrollManager:t.scrollManager,dragWithin:t.verticalScroller,outerElement:t.verticalScroller,ignoreSamePositionDrop:!1,createProxy(e){const t=e.cloneNode(!0),r=document.createElement("div");return t.removeAttribute("id"),t.style.transform="",r.appendChild(t),r},listeners:{beforedragstart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,reset:e.onReset,prio:1e4,thisObj:e}}),e.dropIndicator=Et.createElement({parent:t.bodyContainer,className:"b-row-drop-indicator"}),e.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow")}static get pluginConfig(){return{after:["render"]}}onBeforeDragStart({context:e}){const t=this.grid,r=t.regions[0],n=t.subGrids[r].element;if(this.disabled||t.readOnly||!n.contains(e.element))return!1;return!(e.record=this.grid.getRecordFromElement(e.element)).meta.specialRow}onDragStart({context:e}){const t=this,r=t.grid.features.cellEdit,n=t.grid.getRecordFromElement(e.grabbed);if(!n)throw new Error("Failed to find record for dragged element");r&&(t.cellEditDisabledState=r.disabled,r.disabled=!0),t.grid.features.contextMenu&&t.grid.features.contextMenu.hideContextMenu(!1),t.grid.element.classList.add("b-row-reordering");const s=e.element.querySelector(".b-focused");s&&s.classList.remove("b-focused"),Et.removeClasses(e.element.firstElementChild,["b-selected","b-hover"]),t.record=n}onDrag({context:e,event:t}){const r=this,{store:n,rowManager:s}=r.grid;if(!r.dragHelper.outerElement.contains(t.target)||!t.target.closest(".b-grid-subgrid"))return void(e.valid=!1);let i,o,a,l,c=e.valid,d=r.grid.rowManager.getRowAt(t.clientY);if(d){const e=d.top+r.grid._bodyRectangle.y-r.grid.scrollable.y+d.height/2;o=d.dataIndex,i=d&&n.getAt(o),a=t.clientY>e}else o=n.count-1,i=n.last,d=r.grid.rowManager.getRow(o),a=!0;if(i===r.record&&(c=!1),n.tree){if(Et.removeClsGlobally(r.grid.element,"b-row-reordering-target-parent"),l=a?i.nextSibling:i,r.record.contains(i)&&(c=!1),e.parent=i.parent,!e.parent.isRoot){const t=s.getRowById(e.parent);t&&t.addCls("b-row-reordering-target-parent")}r.clearTimeout(r.hoverTimer),i&&i.isParent&&!i.isExpanded(n)&&(r.hoverTimer=r.setTimeout(()=>r.grid.expand(i),r.hoverExpandTimeout))}else l=a?n.getAt(o+1):i;Et.setTranslateY(r.dropIndicator,d.top+(a?d.height:0)),e.insertBefore=l,e.valid=c}async onDrop(e){const t=this,r=e.context;t.trigger("gridRowBeforeDropFinalize",e),r.valid?(r.asyncCleanup=r.async=!0,r.element.classList.add("b-dropping"),t.setTimeout(()=>t.finalizeReorder(r).then(()=>t.trigger("gridRowDrop",e)),t.finalizeDelay)):t.trigger("gridRowDrop",e)}async finalizeReorder(e){const t=this,r=t.grid,n=r.store;if(e.valid=e.valid&&n.includes(t.record),e.valid){let r;n.tree?(e.valid=n.includes(t.record),e.valid&&(r=await e.parent.tryInsertChild(t.record,e.insertBefore),e.valid=!1!==r)):n.insert(e.insertBefore?n.indexOf(e.insertBefore):n.count,t.record),n.clearSorters()}e.finalize(e.valid),r.element.classList.remove("b-row-reordering")}onReset(){const e=this,t=e.grid.features.cellEdit;e.grid.element.classList.remove("b-row-reordering"),t&&(t.disabled=e.cellEditDisabledState),Et.removeClsGlobally(e.grid.element,"b-row-reordering-target-parent")}render(){this.init()}}nl.featureClass="",nl._$name="RowReorder",Va.registerFeature(nl,!1),Va.registerFeature(nl,!0,"Gantt");class sl extends Nn{static get $name(){return"Search"}construct(e,t){super.construct(e,t),Object.assign(this,{store:e.store,grid:e,find:"",hitEls:[]})}doDestroy(){this.clear(!0),super.doDestroy()}doDisable(e){e&&this.clear(),super.doDisable(e)}static get pluginConfig(){return{chain:["getCellMenuItems","onElementKeyDown"]}}search(e,t=!0,r=!1){const n=this;if(!e)return n.clear();if(!r&&e===n.find||n.disabled)return;const s=n.grid,i=s.columns.visibleColumns.filter(e=>!1!==e.searchable).map(e=>e.field),o=n.store.search(e,i);let a=1;Object.assign(n,{foundMap:{},prevFound:n.found,found:o,find:e});for(const e of Et.children(s.element,".b-search-hit")){e.classList.remove("b-search-hit"),e.classList.remove("b-search-hit-cell");ei.get(e).row.renderCell(e)}if(o){n.hitColumns&&n.hitColumns.forEach(e=>e.disableHtmlEncode=!1),n.hitColumns=[];for(const e of o){n.foundMap[e.field+"-"+e.id]=a++;const t=n.grid.columns.get(e.field);if(t&&(t.disableHtmlEncode=!0,n.hitColumns.push(t)),a>1e3)break}return n.listenersInitialized||(n.grid.rowManager.on({rendercell:n.renderCell},n),n.store.on({refresh:n.onStoreRefresh},n),n.listenersInitialized=!0),s.refreshRows(),n.grid.trigger("search",{grid:s,find:e,found:o}),t&&!n.isHitFocused&&n.gotoNextHit(!0),o}}clear(e=!1){const t=this,r=t.grid;t.foundMap&&delete t.foundMap,delete t.find,Et.forEachSelector(r.element,".b-search-hit",e=>Et.removeClasses(e,["b-search-hit","b-search-hit-cell"])),Et.removeEachSelector(r.element,".b-search-hit-cell-badge,.b-search-hit-text"),t.listenersInitialized&&(r.rowManager.un({rendercell:t.renderCell},t),t.store.un({refresh:t.onStoreRefresh},t),t.listenersInitialized=!1),e||(r.refreshRows(),t.grid.trigger("clearSearch",{grid:r}))}get foundCount(){return this.found&&this.found.length||0}get isHitFocused(){const e=this.grid,t=e.focusedCell?e.store.indexOf(e.focusedCell.id):-1,r=e.focusedCell?e.columns.getById(e.focusedCell.columnId):null;return-1!==t&&this.found.some(e=>e.index===t&&r&&e.field===r.field)}gotoNextHit(e=!1){const t=this;if(!t.found||!t.found.length)return;const r=t.grid,n=r.focusedCell||r.lastFocusedCell,s=n&&!e?r.store.indexOf(n.id):-1,i=t.found.findIndex(e=>e.index>s);-1!==i&&t.gotoHit(i)}gotoPrevHit(){const e=this;if(!e.found||!e.found.length)return;const t=e.grid,r=t.focusedCell||t.lastFocusedCell,n=r?t.store.indexOf(r.id):0,s=e.found;for(let t=s.length-1;t--;t>=0){if(s[t].index<n){e.gotoHit(t);break}}}gotoHit(e){const t=this.grid,r=this.found[e];return r&&t.focusCell({field:r.field,id:r.id}),!!r}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:e,column:t,record:r,value:n,cellContent:s}){const i=this,o=i.foundMap&&i.foundMap[t.field+"-"+r.id];if(o){e.classList.add("b-search-hit");const t=Et.down(e,".b-grid-cell-value")||e,r=String(i.find).toLowerCase();if(String(n).toLowerCase()===r)t.innerHTML=`<span class="b-search-hit-text">${s}</span><div class="b-search-hit-cell-badge">${o}</div>`;else{const r=String(i.find).toLowerCase(),n=s&&s.toLowerCase().indexOf(r);if(n>-1){const e=n+r.length,i=s.slice(n,e);t.innerHTML=`${s.slice(0,n)}<span class="b-search-hit-text">${i}</span>${s.slice(e)}<div class="b-search-hit-cell-badge">${o}</div>`}else e.classList.add("b-search-hit-cell")}i.hitEls.push(e)}}getCellMenuItems(e,t,r){const n=this;return e.searchable&&r.push({text:"L{searchForValue}",localeClass:this,icon:"b-fw-icon b-icon-search",cls:"b-separator",name:"search",disabled:n.disabled,onItem:({item:e})=>{const{column:t,record:r}=e;let s=window.getSelection().toString();s||(s=r[t.field]),n.search(s)}}),r}onElementKeyDown(e){const t=this;t.find&&""!==t.find&&("F3"===e.key||"g"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))&&(e.preventDefault(),e.shiftKey?t.gotoPrevHit():t.gotoNextHit())}onStoreRefresh(){this.search(this.find,!1,!0)}}sl.featureClass="b-search",sl._$name="Search",Va.registerFeature(sl);class il extends Nn{static get $name(){return"Sort"}static get defaultConfig(){return{multiSort:!0,ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,t){const r=this;t=r.processConfig(t),r.store=e.store,r.grid=e,r.store.on({sort:r.syncHeaderSortState,thisObj:r}),super.construct(e,t)}processConfig(e){return"string"==typeof e||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}set field(e){const t=this.grid.columns.get(e);t&&"object"==typeof t.sortable&&(t.sortable.field=t.sortable.property||e,e=t.sortable),this.store.sort(e,this.ascending)}doDestroy(){super.doDestroy()}static get pluginConfig(){return{chain:["onElementClick","getHeaderMenuItems","getColumnDragToolbarItems","renderHeader"]}}syncHeaderSortState(){const e=this,t={};if(!e.grid.isConfiguring){const r=e.store.sorters,n=r.length,s=new Ve;let i;for(let e=0;e<n;e++){const n=r[e];n.field&&(t[n.field]={ascending:n.ascending,sortIndex:e+1})}for(const r of e.grid.columns.bottomColumns){const o=r.element;if(o){const a=r.textWrapper&&r.textWrapper.dataset;a&&a.sortIndex&&delete a.sortIndex,s.value=o.classList,!1!==r.sortable?(s.add(e.sortableCls),i=t[r.field],i?(n>1&&a&&(a.sortIndex=i.sortIndex),s.add(e.sortedCls),i.ascending?(s.add(e.sortedAscCls),s.remove(e.sortedDescCls)):(s.add(e.sortedDescCls),s.remove(e.sortedAscCls))):(s.remove(e.sortedCls),s["b-group"]||(s.remove(e.sortedAscCls),s.remove(e.sortedDescCls)))):s.remove(e.sortableCls),Et.syncClassList(o,s)}}}}getHeaderMenuItems(e,t){const r=this,{disabled:n}=r;if(!1!==e.sortable&&(t.push({text:"L{sortAscending}",localeClass:this,icon:"b-fw-icon b-icon-sort-asc",name:"sortAsc",cls:"b-separator",weight:105,disabled:n,onItem:({item:{column:e}})=>r.store.sort(e.field,!0)}),t.push({text:"L{sortDescending}",localeClass:this,icon:"b-fw-icon b-icon-sort-desc",name:"sortDesc",weight:105,disabled:n,onItem:({item:{column:e}})=>r.store.sort(e.field,!1)}),r.multiSort&&r.grid.columns.records.filter(e=>e.sortable).length>1)){const s=this.grid.store.sorters.find(t=>t.field===e.field);t.push({text:"L{multiSort}",localeClass:this,icon:"b-fw-icon b-icon-sort",name:"multiSort",weight:105,disabled:n,menu:[{text:s?r.L("L{toggleSortAscending}"):r.L("L{addSortAscending}"),icon:"b-fw-icon b-icon-sort-asc",name:"addSortAsc",disabled:s&&s.ascending,weight:105,onItem:({item:{column:e}})=>r.store.addSorter(e.field,!0)},{text:s?r.L("L{toggleSortDescending}"):r.L("L{addSortDescending}"),icon:"b-fw-icon b-icon-sort-desc",name:"addSortDesc",disabled:s&&!s.ascending,weight:105,onItem:({item:{column:e}})=>r.store.addSorter(e.field,!1)},{text:"L{removeSorter}",localeClass:this,icon:"b-fw-icon b-icon-remove",name:"remove-sorter",weight:105,disabled:!s,onItem:({item:{column:e}})=>r.store.removeSorter(e.field)}]})}return t}getColumnDragToolbarItems(e,t){const{store:r,disabled:n}=this;if(!1!==e.sortable){t.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:this,icon:"b-icon b-icon-sort-asc",name:"sortAsc",cls:"b-separator",weight:105,disabled:n,onDrop:({column:e})=>r.sort(e.field,!0)}),t.push({text:"L{sortDescendingShort}",group:"L{sort}",localeClass:this,icon:"b-icon b-icon-sort-desc",name:"sortDesc",weight:105,disabled:n,onDrop:({column:e})=>r.sort(e.field,!1)});const s=r.sorters.find(t=>t.field===e.field);Array.prototype.push.apply(t,[{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:this,icon:"b-icon b-icon-sort-asc",name:"multisortAddAsc",disabled:n||s&&s.ascending,weight:105,onDrop:({column:e})=>r.addSorter(e.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:this,icon:"b-icon b-icon-sort-desc",name:"multisortAddDesc",disabled:n||s&&!s.ascending,weight:105,onDrop:({column:e})=>r.addSorter(e.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:this,icon:"b-icon b-icon-remove",name:"multisortRemove",weight:105,disabled:n||!s,onDrop:({column:e})=>r.removeSorter(e.field)}])}return t}onElementClick(e){const t=this,r=t.store,n=e.target,s=Et.up(n,".b-grid-header.b-sortable"),i=s&&s.dataset.column;if(!t.ignoreRe.test(n.className)&&!t.disabled&&s&&i){const n=t.grid.columns.getById(s.dataset.columnId);if(r.isGrouped&&r.groupers.find(e=>e.field===i)&&!e.shiftKey)return;if(n.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)r.removeSorter(n.field);else{let t=n.field;"function"==typeof n.sortable?t={field:n.field,fn:n.sortable}:"object"==typeof n.sortable&&(t=n.sortable,t.field||(t.field=t.property||n.field)),r.sort(t,null,e.ctrlKey)}}}renderHeader(){this.syncHeaderSortState()}}il.featureClass="b-sort",il._$name="Sort",Va.registerFeature(il,!0);class ol extends Nn{static get $name(){return"Stripe"}construct(e,t){super.construct(e,t),e.rowManager.on({renderrow:"onRenderRow",thisObj:this})}doDisable(e){this.client.refreshRows(),super.doDisable(e)}onRenderRow({row:e}){this.disabled||e.addCls(e.dataIndex%2==0?"b-even":"b-odd")}}ol._$name="Stripe",Va.registerFeature(ol);class al extends Vr{static get $name(){return"Bar"}static get defaultConfig(){return{scrollable:{}}}get columns(){return this._columns||this.subGrid.columns}set columns(e){this._columns=e}fixCellWidths(){const e=this;let t,r=!1;e.columns.traverse(n=>{const s=e.getBarCellElement(n.id),i=Et.setLength(n.width),o=Et.setLength(n.minWidth);if(s){if(t=P.isIE11?`calc(${i} - ${e.getLrPadding(s)}px)`:i,r=r||Boolean(n.flex),n.isParent&&null==n.width&&null==n.flex){const e=n.children.reduce((e,t)=>e+(!t.hidden&&t.flex||0),0);s.style.flex=e>0?e+" 0 auto":"",e>0&&n.traverse(e=>e.data.minWidth=null)}else if(parseInt(n.minWidth)>=0&&(s.style.minWidth=o),s.style.flex=s.style.flexBasis=s.style.width="",n.flex)!isNaN(parseInt(n.flex))&&n.children?s.style.flex=n.flex+" 0 auto":s.style.flex=n.flex;else if(parseInt(n.width)>=0){const r=n.parent;!e.isHeader||r.isRoot||r.width?s.style.flexBasis=t:s.style.width=i}n.height>=0&&(s.style.height=Et.setLength(n.height))}}),e.element.classList[r?"add":"remove"]("b-has-flex")}getLrPadding(e){if(!this.cellLrPadding){const t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}}al._$name="Bar";class ll extends al{static get $name(){return"Footer"}static get defaultConfig(){return{isFooter:!0}}startConfigure(e){e.scrollable.overflowX="hidden-scroll",super.startConfigure(e)}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onPaint({firstPaint:e}){e&&this.refreshContent()}template(){const e=this.subGrid.region;return Cn.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}">
                <div reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map(e=>e.hidden?"":Cn.tpl`
                <div
                    class="b-grid-footer ${e.align?"b-grid-footer-align-"+e.align:""} ${e.cls||""}"
                    data-column="${e.field||""}" data-column-id="${e.id}" data-all-index="${e.allIndex}"
                    >
                    ${e.footerText||""}
                </div>`).join("")}fixFooterWidths(){this.fixCellWidths()}}ll._$name="Footer";class cl extends(Qa(Nn)){static get $name(){return"Summary"}construct(e,t){const r=this;Object.assign(r,{grid:e,store:e.store}),super.construct(e,t),r.store.on({change:r.onStoreChanged,thisObj:r}),r.grid.eachSubGrid(e=>{e.footer||(e.footer=new ll({subGrid:e,parent:e}))})}doDestroy(){super.doDestroy()}doDisable(e){super.doDisable(e),e?this.grid.element.classList.add("b-summary-disabled"):(this.updateSummaries(),this.grid.element.classList.remove("b-summary-disabled"))}static get pluginConfig(){return{chain:["renderRows"]}}renderRows(){this.updateSummaries()}updateSummaries(){const e=this,{grid:t,store:r}=e,n=Et.children(t.element,".b-grid-footer"),s=r.storage.values.filter(e=>!e.meta.specialRow);t.columns.forEach(e=>{e.summaries&&e.summaries.forEach(e=>{"seed"in e&&("initialSeed"in e||(e.initialSeed=e.seed),["number","string","date"].includes(typeof e.initialSeed)?e.seed=e.initialSeed:e.seed=Object.assign({},e.initialSeed))})}),n.forEach(r=>{if(!r.dataset.column)return;const n=t.columns.get(r.dataset.column),i=e.generateHtml(n,s,"b-grid-footer-summary");(n.summaries?n.summaries.length:!!n.sum)&&(r.children.length?Et.sync(i,r.firstElementChild):r.innerHTML=i)})}onStoreChanged({action:e,changes:t}){let r=!0;this.disabled||("update"===e&&(r=Object.keys(t).some(e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))})),r&&this.updateSummaries())}}cl.featureClass="b-summary",cl._$name="Summary",Va.registerFeature(cl);const dl=new Promise(e=>e());class ul extends(br(Nn)){static get $name(){return"Tree"}static get defaultConfig(){return{expandOnCellClick:!1}}static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],before:["navigateRight","navigateLeft"],chain:["onElementClick","onElementKeyDown"]}}construct(e,t){super.construct(e,t);const r=e.columns.find(e=>e instanceof $a);Object.assign(this,{grid:e,store:e.store,rowManager:e.rowManager,treeColumn:r}),this.store.on({beforeLoadChildren:"onBeforeLoadChildren",loadChildren:"onLoadChildren",loadChildrenException:"onLoadChildrenException",beforeToggleNode:"onBeforeToggleNode",thisObj:this})}doDisable(e){}async toggleCollapse(e,t,r=!1){const n=this,{store:s,grid:i}=n,{rowManager:o}=i,a=s.getById(e),l=a.instanceMeta(s);if(await s.toggleCollapse(a,t)){const e=o.getRowFor(a);if(e){const t=e.getCell(n.treeColumn.id);t&&e.renderCell(t,a)}n.isTogglingNode||(i.element.classList.add("b-toggling-node"),n.isTogglingNode=!0,n.requestAnimationFrame(()=>{i.element.classList.remove("b-toggling-node"),n.isTogglingNode=!1})),i.trigger(l.collapsed?"collapseNode":"expandNode",{source:i,record:a}),i.trigger("toggleNode",{source:i,record:a,collapse:t})}}async collapse(e){return this.toggleCollapse(e,!0)}async expand(e){return this.toggleCollapse(e,!1)}onBeforeToggleNode({record:e,collapse:t}){this.grid.trigger("beforeToggleNode",{record:e,collapse:t})}onBeforeLoadChildren({source:e,params:t}){const r=e.getById(t[e.modelClass.idField]),n=this.grid.rowManager.getRowFor(r);n&&n.addCls("b-loading-children")}onLoadChildren({source:e,params:t}){const r=e.getById(t[e.modelClass.idField]),n=this.grid.rowManager.getRowFor(r);n&&n.removeCls("b-loading-children")}onLoadChildrenException({record:e}){const t=this.grid.rowManager.getRowFor(e);t&&t.removeCls("b-loading-children")}expandOrCollapseAll(e=!0,t=this.store.rootNode){const{grid:r,store:n}=this,s=[],i=[];return r.trigger("beforeToggleAllNodes",{source:r,collapse:e}),n.suspendEvents(),n.traverse(t=>{const r=t.instanceMeta(n);t.isLeaf||(e&&!r.collapsed?(this.toggleCollapse(t,!0,!0),i.push(...t.children)):!e&&r.collapsed&&(Array.isArray(t.children)&&i.push(...t.children),s.push(this.toggleCollapse(t,!1,!0))))},t,t===n.rootNode),n.resumeEvents(),(e?dl:Promise.all(s)).then(()=>{r.refreshRows(e),i.length&&(e?n.trigger("remove",{records:i,isCollapse:!0,isCollapseAll:!0}):n.trigger("add",{records:i,isExpand:!0,isExpandAll:!0})),r.trigger("toggleAllNodes",{source:r,collapse:e})})}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(e){const t=this,r=t.store.getById(e);if(!1===r.instanceMeta(t.store).hiddenByCollapse)return;let n=!1,s=r.parent;const i=[];for(;s&&!s.isRoot;)i.push(s),s=s.parent;await i.reverse().forEach(async e=>{e.instanceMeta(t.store).collapsed&&(n=!0),await t.toggleCollapse(e,!1,!0)}),n&&t.grid.refreshRows(),await t.grid.scrollRowIntoView(r)}onElementClick(e){const t=this,r=e.target,n=t.grid.getEventData(e),s=r.closest(".b-tree-expander");(s||t.expandOnCellClick&&n&&n.record.isParent)&&(s&&e.preventDefault(),t.toggleCollapse(n.record))}onElementKeyDown(e){e.target===this.client.focusElement&&" "===e.key&&(e.preventDefault(),this.toggleCollapse(this.grid.focusedCell.id))}navigateRight(e){const t=this,r=t.grid,n=r.focusedCell;if(n){const s=r.store.getById(n.id);if(r.columns.getById(n.columnId).tree&&(e.shiftKey||1===r.columns.count))return s.isParent&&s.instanceMeta(r.store).collapsed?t.expand(s):r.navigateDown(e),!1}}navigateLeft(e){const t=this,r=t.grid,n=r.focusedCell;if(n){const s=r.store.getById(n.id);if(r.columns.getById(n.columnId).tree&&(e.shiftKey||1===r.columns.count))return s.isParent&&!s.instanceMeta(r.store).collapsed?t.collapse(s):s.parent&&r.focusCell({id:s.parent.id,columnId:n.columnId}),!1}}}ul.featureClass="b-tree",ul._$name="Tree",Va.registerFeature(ul,!1,"Grid"),Va.registerFeature(ul,!0,"TreeGrid");const hl={all:"all",visible:"visible"},gl={A6:{width:4.13,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69},A3:{width:11.69,height:16.49},Legal:{width:8.5,height:14},Letter:{width:8.5,height:11}},ml={portrait:"portrait",landscape:"landscape"},pl={pdf:"pdf",png:"png"};var fl=e=>class extends(e||As){static get $name(){return"LocalizableComboItems"}static get defaultConfig(){return{items:!0}}set items(e){!0===e&&(e=this.buildLocalizedItems()),super.items=e}get items(){return super.items}construct(...e){this.inConstruct=!0,super.construct(...e),this.inConstruct=!1}buildLocalizedItems(){return[]}updateLocalizedItems(){const e=this;if(e.store&&!e.inConstruct){const{value:t}=e;e.store.data=e.buildLocalizedItems(),e.value=null,e.value=t,e.syncInputFieldValue(!0)}}updateLocalization(){this.updateLocalizedItems(),super.updateLocalization()}};class vl extends(fl(As)){}vl._$name="LocalizableCombo",U.register("localizablecombo",vl);class yl extends vl{static get $name(){return"ExportRowsCombo"}static get defaultConfig(){return{editable:!1}}buildLocalizedItems(){return[{id:hl.all,text:this.L("L{all}")},{id:hl.visible,text:this.L("L{visible}")}]}}yl._$name="ExportRowsCombo",U.register(yl.$name,yl);class bl extends vl{static get $name(){return"ExportOrientationCombo"}static get defaultConfig(){return{editable:!1}}buildLocalizedItems(){return[{id:ml.portrait,text:this.L("L{portrait}")},{id:ml.landscape,text:this.L("L{landscape}")}]}}bl._$name="ExportOrientationCombo",U.register(bl.$name,bl);class Cl extends vn{static get $name(){return"ExportDialog"}static get defaultConfig(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,hidePNGMultipageOption:!0,exporterType:"singlepage",orientation:"portrait",paperFormat:"A4",fileFormat:"pdf",alignRows:!1,rowsRange:"all",title:"L{exportSettings}",bbar:[{type:"button",ref:"exportButton",color:"b-green",text:"L{ExportDialog.export}",localeClass:this},{type:"button",ref:"cancelButton",color:"b-gray",text:"L{ExportDialog.cancel}",localeClass:this}]}}construct(e={}){const t=this,{client:r}=e;if(!r)throw new Error("`client` config is required");const n=t.buildDialogItems(e);e.items?Array.isArray(e.items)?e.items.push(...n):n.forEach(t=>{e.items[t.ref]=t,delete t.ref}):e.items=n,e.width=e.width||t.L("L{width}"),super.construct(e),t.widgetMap.exportButton.on("click",t.onExportClick,t),t.widgetMap.cancelButton.on("click",t.onCancelClick,t),ne.on({locale:"onLocaleChange",prio:-1,thisObj:t})}get fieldProperties(){return["exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader"]}getDefaultFieldValues(e){const t=ze.copyProperties({},e,this.fieldProperties);return ze.copyPropertiesIf(t,this.getDefaultConfiguration(),this.fieldProperties)}buildDialogItems(e){const t=this,{exporters:r,client:n}=e,{exporterType:s,orientation:i,paperFormat:o,fileFormat:a,alignRows:l,rowsRange:c,repeatHeader:d}=t.getDefaultFieldValues(e),u=t.L("L{ExportDialog.labelWidth}");function h(e,t=(e=>e)){return Object.keys(e).map(e=>({id:e,text:t(e)}))}return t.columnsStore=n.columns.chain(e=>e.isLeaf),[{labelWidth:u,type:"combo",ref:"columnsField",label:"L{ExportDialog.columns}",localeClass:this,store:t.columnsStore,value:t.columnsStore.allRecords,valueField:"id",displayField:"text",multiSelect:!0},{labelWidth:u,type:"exportrowscombo",ref:"rowsRangeField",label:"L{ExportDialog.rows}",localeClass:this,value:c},{labelWidth:u,type:"localizablecombo",ref:"exporterTypeField",label:"L{ExportDialog.exporterType}",localeClass:this,editable:!1,value:s,buildLocalizedItems:()=>r.map(e=>({id:e.type,text:t.L(e.title,this)})),onChange({value:e}){this.owner.widgetMap.alignRowsField.hidden="singlepage"===e,this.owner.widgetMap.repeatHeaderField.hidden="multipagevertical"!==e}},{labelWidth:u,type:"checkbox",ref:"alignRowsField",label:"L{ExportDialog.alignRows}",localeClass:this,checked:l,hidden:"singlepage"===s},{labelWidth:u,type:"checkbox",ref:"repeatHeaderField",label:"L{ExportDialog.repeatHeader}",localeClass:this,value:d,hidden:"multipagevertical"!==s},{labelWidth:u,type:"combo",ref:"fileFormatField",label:"L{ExportDialog.fileFormat}",localeClass:this,editable:!1,value:a,items:h(pl,e=>e.toUpperCase()),onChange({value:e,oldValue:r}){if(t.hidePNGMultipageOption){const n=t.widgetMap.exporterTypeField,s=n.store.find(e=>"singlepage"===e.id);e===pl.png&&s?(this._previousDisabled=n.disabled,n.disabled=!0,this._previousValue=n.value,n.value="singlepage"):r===pl.png&&this._previousValue&&(n.disabled=this._previousDisabled,n.value=this._previousValue)}}},{labelWidth:u,type:"combo",ref:"paperFormatField",label:"L{ExportDialog.paperFormat}",localeClass:this,editable:!1,value:o,items:h(gl)},{labelWidth:u,type:"exportorientationcombo",ref:"orientationField",label:"L{ExportDialog.orientation}",localeClass:this,value:i}]}onLocaleChange(){const e=this.L("labelWidth");this.width=this.L("L{width}"),this.eachWidget(t=>{t instanceof jn&&(t.labelWidth=e)})}onExportClick(){const e=this.values;this.trigger("export",{values:e})}onCancelClick(){this.trigger("cancel"),this.hide()}get values(){const e=/field/i,t={};return this.eachWidget(r=>{e.test(r.ref)&&(t[r.ref.replace(e,"")]=r instanceof Hn?r.checked:r.value)}),t}}function wl(e){this.wrapped=e}function Sl(e){var t,r;function n(t,r){try{var i=e[t](r),o=i.value,a=o instanceof wl;Promise.resolve(a?o.wrapped:o).then((function(e){a?n("return"===t?"return":"next",e):s(i.done?"return":"normal",e)}),(function(e){n("throw",e)}))}catch(e){s("throw",e)}}function s(e,s){switch(e){case"return":t.resolve({value:s,done:!0});break;case"throw":t.reject(s);break;default:t.resolve({value:s,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,s){return new Promise((function(i,o){var a={key:e,arg:s,resolve:i,reject:o,next:null};r?r=r.next=a:(t=r=a,n(e,s))}))},"function"!=typeof e.return&&(this.return=void 0)}function Dl(e){return function(){return new Sl(e.apply(this,arguments))}}function El(e){return new wl(e)}Cl._$name="ExportDialog","function"==typeof Symbol&&Symbol.asyncIterator&&(Sl.prototype[Symbol.asyncIterator]=function(){return this}),Sl.prototype.next=function(e){return this._invoke("next",e)},Sl.prototype.throw=function(e){return this._invoke("throw",e)},Sl.prototype.return=function(e){return this._invoke("return",e)};class xl extends(br(G(ae(B)))){static get defaultConfig(){return{translateURLsToAbsolute:!0,keepPathName:!0}}pageTpl(e){const{title:t,header:r,footer:n,styles:s,htmlClasses:i,bodyStyle:o,bodyClasses:a=[],paperHeight:l,paperWidth:c,html:d}=e;return a.push("b-"+this.constructor.type),Cn.tpl`
            <!DOCTYPE html>
            <html class="${i}" style="width: ${c}in; height: ${l}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${t}</title>
                    ${s.join("")}
                </head>
                <body class="b-export ${a.join(" ")}" style="width: ${c}in; height: ${l}in; ${o}">
                    <div class="b-export-content">
                        ${r&&`<div class="b-export-header" style="width: 100%">${r}</div>`}
                        <div class="b-export-body"><div class="b-export-viewport">${d}</div></div>
                        ${n&&`<div class="b-export-footer" style="width: 100%">${n}</div>`}
                    </div>
                </body>
            </html>`}get stylesheets(){const e=this;if(e._stylesheets)return e._stylesheets;const t=e.translateURLsToAbsolute,r=window.origin,n=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),s=[];return n.forEach(n=>{if(n=n.cloneNode(!0),t&&n.href){let e;e=!0===t?n.href:this.keepPathName?n.href.replace(r,t):new URL(n.getAttribute("href"),t),n.setAttribute("href",e)}let i;if(i=P.isIE11&&n.styleSheet&&/style/i.test(n.tagName)?`<style type="text/css">${n.styleSheet.cssText}</style>`:n.outerHTML,t&&/style/i.test(n.tagName)){const r=e.getStyleTagURLConverter(t);i=i.replace(/url\(['"]?(.+?)['"]?\)/g,r)}s.push(i)}),s.push("<style>\n                body, html {\n                    overflow: auto;\n                }\n                \n                body {\n                    position: relative;\n                    margin: 0;\n                }\n            </style>"),e._stylesheets=s}set stylesheets(e){this._stylesheets=e}getStyleTagURLConverter(e){return function(t,r){let n;try{let s;/^#/.test(r)?n=t:(s=!0===e?window.location.href:this.keepPathName?window.location.href.replace(window.location.origin,e):e,n=`url('${new URL(r,s).href}')`)}catch(e){n=t}return n}.bind(this)}saveState({client:e}){this.state=e.state}async restoreState({client:e}){let t=!1;e.scrollable.y!==this.state.scroll.scrollTop&&(t=!0),e.state=this.state,t&&await e.scrollable.await("scrollEnd",{checkLock:!1})}beforeExport(){this.element=document.createElement("div")}cloneElement(e,t=this.element,r=!0){r&&(t.innerHTML=""),P.isChrome?t.appendChild(e.cloneNode(!0)):t.innerHTML=e.outerHTML,Et.removeEachSelector(t,".b-grid-row");const n=t.querySelector(".b-gridbase > .b-mask");n&&n.remove()}measureElement(e=""){e instanceof HTMLElement&&(e=e.outerHTML);const t=Et.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:`<div style="height: 1px"></div>${e}<div style="height: 1px"></div>`}),r=t.offsetHeight-2;return t.remove(),r}prepareHTML(e){e instanceof HTMLElement&&(e=e.outerHTML);const t=Et.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:e}),r=t.querySelectorAll("img");for(let e=0,t=r.length;e<t;e++)r[e].setAttribute("src",r[e].src);const n=t.innerHTML;return t.remove(),n}createPlaceholder(e,t=!0){return t&&(e.innerHTML=""),Et.createElement({parent:e,id:K.generateId("export")})}getVirtualScrollerHeight(e){let t=0;return e.eachSubGrid(e=>{e.overflowingHorizontally&&(t=Et.scrollBarWidth)}),0===t?t:t+1}inchToPx(e){return 96*e}getScaleValue(e,t){return Math.floor(1e4*e/t)/1e4}getFirstVisibleRowIndex(e){const{rows:t}=e.rowManager;return t.findIndex(t=>t.bottom>e.scrollable.y)}getLastVisibleRowIndex(e){const{rows:t}=e.rowManager;return t.findIndex(t=>t.bottom>=e.scrollable.y+e.bodyHeight)}getVisibleRowsCount(e){const t=this.getFirstVisibleRowIndex(e),r=this.getLastVisibleRowIndex(e);let n;return n=-1!==t?-1===r?e.store.count-t:r-t+1:e.store.count,n}async export(e){const t=this;let r;t.beforeExport(),t.saveState(e),await t.prepareComponent(e);try{r=await t.getPages(e)}finally{await t.restoreComponent(e),t.stylesheets=null,await new Promise(e=>t.requestAnimationFrame(e)),await t.restoreState(e)}return r}async getPages(e){const t=this.pagesExtractor(e),r=[];let n;for(;(n=await t.next())&&!n.done;)r.push(n.value);return r}adjustRowBuffer(e){const{contentHeight:t}=this.exportMeta,{rowManager:r}=e;this.oldRowManagerConfig={prependRowBuffer:r.prependRowBuffer,appendRowBuffer:r.appendRowBuffer};const n=Math.ceil(t/r.rowOffsetHeight);r.prependRowBuffer=n,r.appendRowBuffer=n,e.renderRows(!1),e.rowManager.jumpToPosition(e.scrollable.y)}restoreRowBuffer(e){e.rowManager.prependRowBuffer=this.oldRowManagerConfig.prependRowBuffer,e.rowManager.appendRowBuffer=this.oldRowManagerConfig.appendRowBuffer}async prepareComponent(e){const t=this,{client:r,columns:n,rowsRange:s,keepRegionSizes:i}=e,o=t.exportMeta={totalWidth:0,totalHeight:0-t.getVirtualScrollerHeight(r),subGrids:{}};if(r.columns.forEach(e=>{n.includes(e.id)?e.show():e.hide()}),r.rowManager.rowCount>0)if(s===hl.all)o.firstVisibleDataIndex=r.rowManager.rows[0].dataIndex,await r.scrollRowIntoView(r.store.first,{block:"start"});else{const t=o.firstVisibleDataIndex=r.rowManager.rows.find(e=>e.bottom>r.scrollable.y).dataIndex;await r.scrollRowIntoView(r.store.getAt(t),{block:"start"}),e.alignRows=!0}this.cloneElement(r.element);const{element:a}=t;r.eachSubGrid(e=>{const n=t.createPlaceholder(a.querySelector(`[id="${e.id}"]`),!1);let s;s=(null==i?void 0:i[e.region])?e.element.offsetWidth:e.columns.visibleColumns.reduce((e,t)=>("number"==typeof t.width?e+=t.width:e+=r.getHeaderElement(t.id).offsetWidth,e),0),o.totalWidth+=s;const l=e.splitterElement;l&&(o.totalWidth+=l.offsetWidth),o.subGrids[e.region]={id:e.id,headerId:e.header&&e.header.id||null,footerId:e.footer&&e.footer.id||null,rows:[],placeHolder:n,width:s}})}prepareExportElement(){const{element:e,exportMeta:t}=this;return Object.values(t.subGrids).forEach(({width:t,id:r,headerId:n,footerId:s})=>{[r,n,s].forEach(r=>{r&&(e.querySelector(`[id="${r}"]`).style.width=t+"px")})}),e.innerHTML}async restoreComponent(){}async scrollRowIntoView(e,t){await e.scrollRowIntoView(e.store.getAt(t),{block:"start"}),await new Promise(e=>this.requestAnimationFrame(e))}}xl.prototype.pagesExtractor=function(){var e=Dl((function*(){yield""}));return function(){return e.apply(this,arguments)}}(),xl._$name="Exporter";class Tl extends xl{static get type(){return"multipage"}static get title(){return this.L("L{multipage}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e}){const{exportMeta:t}=this;++t.currentPage,++t.verticalPosition,delete t.lastExportedRowBottom,t.verticalPosition>=t.verticalPages&&(t.verticalPosition=t.currentPageTopMargin=0,++t.horizontalPosition,await this.scrollRowIntoView(e,t.firstVisibleDataIndex,{block:"start"}))}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:r}=t,{client:n,headerTpl:s,footerTpl:i,alignRows:o,rowsRange:a}=e,l=gl[e.paperFormat],c=e.orientation===ml.portrait,d=c?l.width:l.height,u=c?l.height:l.width,h=t.inchToPx(d),g=t.inchToPx(u),m=Math.ceil(r.totalWidth/h);let p=r.totalHeight+n.height-n.bodyHeight+n.scrollable.scrollHeight,f=g;s&&(f-=t.measureElement(s({totalWidth:r.totalWidth,totalPages:-1,currentPage:-1}))),i&&(f-=t.measureElement(i({totalWidth:r.totalWidth,totalPages:-1,currentPage:-1})));let v,y=n.store.count;if(a===hl.visible){y=t.getVisibleRowsCount(n);const e=n.rowManager.rows[y-1].bottom;p=p-n.scrollable.scrollHeight+e}if(o&&a!==hl.visible){const e=n.rowManager.rowOffsetHeight,t=Math.floor((f-n.headerHeight)/e),r=Math.floor(f/e),s=y-t;v=1+Math.ceil(s/r)}else v=Math.ceil(p/f);Object.assign(r,{paperWidth:d,paperHeight:u,pageWidth:h,pageHeight:g,horizontalPages:m,verticalPages:v,totalHeight:p,contentHeight:f,totalRows:y,totalPages:m*v,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0}),this.adjustRowBuffer(n)}async restoreComponent(e){await super.restoreComponent(e),this.restoreRowBuffer(e.client)}async buildPage(e){const t=this,{exportMeta:r}=t,{client:n,headerTpl:s,footerTpl:i,alignRows:o}=e,{totalWidth:a,totalPages:l,currentPage:c,subGrids:d,currentPageTopMargin:u,verticalPosition:h,totalRows:g}=r,{rowManager:m}=n,{rows:p}=m;Object.values(d).forEach(e=>e.rows=[]),e.rowsRange===hl.all&&(r.totalHeight=n.height-n.bodyHeight+n.scrollable.scrollHeight-t.getVirtualScrollerHeight(n));let f,v,y,b=0,C=0,w=e.rowsRange===hl.visible?p.findIndex(e=>e.bottom>n.scrollable.y):p.findIndex(e=>e.bottom+u+n.headerHeight>0);const S=w,D=0===h?0:p[w].top+u+n.headerHeight;s&&(v=t.prepareHTML(s({totalWidth:a,totalPages:l,currentPage:c})),b=t.measureElement(v)),i&&(y=t.prepareHTML(i({totalWidth:a,totalPages:l,currentPage:c})),C=t.measureElement(y)),f=r.pageHeight-b-C-D,0===h&&(f-=n.headerHeight);let E,x=0;for(;f>0;){const r=p[w];o&&f<r.offsetHeight?(x=-f,f=0,t.exportMeta.lastExportedRowBottom=p[w-1].bottom):(t.collectRow(r),f-=r.offsetHeight,E=r.dataIndex,(++w===p.length&&f>0||e.rowsRange===hl.visible&&w-S===g)&&(f=0))}const T=p[w-1];if(T&&(r.exactGridHeight=T.bottom+n.footerContainer.offsetHeight+n.headerContainer.offsetHeight),await t.onRowsCollected(p.slice(S,w),e),e.rowsRange===hl.visible)r.exactGridHeight-=r.scrollableTopMargin=n.scrollable.y;else{const e=m.on("offsetrows",({offset:e})=>x+=e);await t.scrollRowIntoView(n,E+1),e()}return{html:t.buildPageHtml(),header:v,footer:y,offset:x}}async onRowsCollected(){}collectRow(e){const t=this.exportMeta.subGrids;Object.entries(e.elements).forEach(([e,r])=>{t[e].rows.push(r.outerHTML)})}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach(({placeHolder:e,rows:r})=>{const n=e.outerHTML;t=t.replace(n,r.join(""))}),t}prepareExportElement(){const{element:e,exportMeta:t}=this;return t.scrollableTopMargin&&(e.querySelector(".b-grid-vertical-scroller").style.marginTop=`-${t.scrollableTopMargin}px`),super.prepareExportElement()}}Tl.prototype.pagesExtractor=function(){var e=Dl((function*(e){const t=this,{exportMeta:r,stylesheets:n}=t,{totalWidth:s,totalPages:i,paperWidth:o,paperHeight:a,contentHeight:l}=r;let c;for(;(c=r.currentPage)<i;){t.trigger("exportStep",{text:t.L(Tl.exportingPageText,{currentPage:c,totalPages:i}),progress:Math.round((c+1)/i*90)});const{html:d,header:u,footer:h,offset:g}=yield El(t.buildPage(e)),m=[...n,`\n                <style>\n                    #${e.client.id} {\n                        height: ${r.exactGridHeight}px !important;\n                        width: ${s}px !important;\n                    }\n                    \n                    .b-export-body .b-export-viewport {\n                        margin-left : ${-o*r.horizontalPosition}in;\n                        margin-top  : ${r.currentPageTopMargin}px;\n                    }\n                </style>\n            `];r.currentPageTopMargin-=l+g,yield El(t.stateNextPage(e)),yield{html:t.pageTpl({html:d,header:u,footer:h,styles:m,paperWidth:o,paperHeight:a})}}}));return function(t){return e.apply(this,arguments)}}(),Tl._$name="MultiPageExporter";class Rl extends xl{static get type(){return"multipagevertical"}static get title(){return this.L("L{multipagevertical}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e}){const{exportMeta:t}=this,{totalRows:r,processedRows:n,totalPages:s}=t;++t.currentPage,++t.verticalPosition,t.currentPage===s&&n.size!==r&&(++t.totalPages,++t.verticalPages)}estimateTotalPages(e){const t=this,{exportMeta:r}=t,{client:n,headerTpl:s,footerTpl:i,alignRows:o,rowsRange:a,repeatHeader:l}=e,{pageWidth:c,pageHeight:d,totalWidth:u}=r,h=t.getScaleValue(c,u);let g,m=0-t.getVirtualScrollerHeight(n)+n.height-n.bodyHeight+n.scrollable.scrollHeight,p=d/h,f=n.store.count,v=0;if(s&&(p-=t.measureElement(s({totalWidth:u,totalPages:-1,currentPage:-1}))),i&&(p-=t.measureElement(i({totalWidth:u,totalPages:-1,currentPage:-1}))),l&&(p-=n.headerHeight,m-=n.headerHeight),a===hl.visible){const e=n.rowManager.rows[t.getFirstVisibleRowIndex(n)],r=n.rowManager.rows[t.getLastVisibleRowIndex(n)];v=e.top,f=t.getVisibleRowsCount(n),m=m-n.scrollable.scrollHeight+r.bottom-e.top}if(o&&!l&&a!==hl.visible){const e=n.rowManager.rowOffsetHeight,t=Math.floor((p-n.headerHeight)/e),r=Math.floor(p/e),s=f-t;g=1+Math.ceil(s/r)}else g=Math.ceil(m/p);Object.assign(r,{scale:h,contentHeight:p,totalRows:f,totalHeight:m,verticalPages:g,initialScroll:v,horizontalPages:1,totalPages:g})}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:r}=t,{client:n}=e,s=gl[e.paperFormat],i=e.orientation===ml.portrait,o=i?s.width:s.height,a=i?s.height:s.width,l=t.inchToPx(o),c=t.inchToPx(a);Object.assign(r,{paperWidth:o,paperHeight:a,pageWidth:l,pageHeight:c,horizontalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,processedRows:new Set}),t.estimateTotalPages(e),t.adjustRowBuffer(n)}async restoreComponent(e){await super.restoreComponent(e),this.restoreRowBuffer(e.client)}async buildPage(e){const t=this,{exportMeta:r}=t,{client:n,headerTpl:s,footerTpl:i,alignRows:o,repeatHeader:a}=e,{totalWidth:l,totalPages:c,currentPage:d,subGrids:u,currentPageTopMargin:h,verticalPosition:g,totalRows:m,contentHeight:p}=r,f=a?0:n.headerHeight,{rowManager:v}=n,{rows:y}=v;Object.values(u).forEach(e=>e.rows=[]),e.rowsRange===hl.all&&(r.totalHeight=n.height-n.bodyHeight+n.scrollable.scrollHeight-t.getVirtualScrollerHeight(n));let b,C,w,S=e.rowsRange===hl.visible?y.findIndex(e=>e.bottom>n.scrollable.y):y.findIndex(e=>e.bottom+h+f>0);const D=S,E=0===g?0:y[S].top+h+f;s&&(C=t.prepareHTML(s({totalWidth:l,totalPages:c,currentPage:d}))),i&&(w=t.prepareHTML(i({totalWidth:l,totalPages:c,currentPage:d}))),b=p-E,0===g&&(b-=f);let x,T=0;for(;b>0;){const n=y[S];o&&b<n.offsetHeight?(T=-b,b=0):(t.collectRow(n),b-=n.offsetHeight,b>0&&r.processedRows.add(n.dataIndex),x=n.dataIndex,(++S===y.length&&b>0||e.rowsRange===hl.visible&&S-D===m)&&(b=0))}const R=y[S-1];if(R&&(r.exactGridHeight=R.bottom+n.footerContainer.offsetHeight+n.headerContainer.offsetHeight),await t.onRowsCollected(y.slice(D,S),e),e.rowsRange===hl.visible)r.scrollableTopMargin=n.scrollable.y;else{const e=v.on("offsetrows",({offset:e})=>T+=e);await t.scrollRowIntoView(n,x+1),e()}return{html:t.buildPageHtml(),header:C,footer:w,offset:T}}async onRowsCollected(){}collectRow(e){const t=this.exportMeta.subGrids;Object.entries(e.elements).forEach(([e,r])=>{t[e].rows.push(r.outerHTML)})}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach(({placeHolder:e,rows:r})=>{const n=e.outerHTML;t=t.replace(n,r.join(""))}),t}}Rl.prototype.pagesExtractor=function(){var e=Dl((function*(e){const t=this,{exportMeta:r,stylesheets:n}=t,{totalWidth:s,paperWidth:i,paperHeight:o,contentHeight:a,scale:l,initialScroll:c}=r;let d,{totalPages:u}=r;for(;(d=r.currentPage)<u;){t.trigger("exportStep",{text:t.L(Rl.exportingPageText,{currentPage:d,totalPages:u}),progress:Math.round((d+1)/u*90)});const{html:h,header:g,footer:m,offset:p}=yield El(t.buildPage(e)),f=[...n,`\n                <style>\n                    #${e.client.id} {\n                        width: ${s}px !important;\n                    }\n                    \n                    .b-export .b-export-content {\n                        transform: scale(${l});\n                        transform-origin: top left;\n                        height: auto;\n                    }\n                </style>\n            `];if(e.repeatHeader){const t=r.exactGridHeight?r.exactGridHeight+r.currentPageTopMargin+"px":"100%";f.push(`\n                <style>\n                    #${e.client.id} {\n                        height: ${t} !important;\n                    }\n                    \n                    .b-export .b-export-content {\n                        height: ${100/l}%;\n                    }\n                    \n                    .b-export-body {\n                        height: 100%;\n                        display: flex;\n                    }\n                \n                    .b-export-viewport {\n                        height: 100%;\n                    }\n                    \n                    .b-grid-vertical-scroller {\n                        margin-top: ${r.currentPageTopMargin-c}px;\n                    }\n                </style>\n                `)}else{const t=r.exactGridHeight||a-r.currentPageTopMargin;f.push(`\n                <style>\n                    #${e.client.id} {\n                        height: ${t}px !important;\n                    }\n                    \n                    .b-export-body {\n                        overflow: hidden;\n                    }\n                    \n                    .b-export .b-export-content {\n                        height: ${100/l}%;\n                    }\n                    \n                    .b-export-body .b-export-viewport {\n                        margin-top: ${r.currentPageTopMargin}px;\n                    }\n                    \n                    .b-grid-vertical-scroller {\n                        margin-top: -${c}px;\n                    }\n                </style>\n                `)}r.currentPageTopMargin-=a+p,yield El(t.stateNextPage(e)),({totalPages:u}=r),yield{html:t.pageTpl({html:h,header:g,footer:m,styles:f,paperWidth:i,paperHeight:o})}}}));return function(t){return e.apply(this,arguments)}}(),Rl._$name="MultiPageVerticalExporter";class Ml extends xl{static get type(){return"singlepage"}static get title(){return this.localize("L{singlepage}")}static get defaultConfig(){return{centerContentHorizontally:!1}}async prepareComponent(e){await super.prepareComponent(e),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async onRowsCollected(){}positionRows(e){let t=0;return e.map(([e,r])=>{const n=e.replace(/translate\(\d+px, \d+px\)/,`translate(0px, ${t}px)`);return t+=r,n})}collectRow(e){const t=this.exportMeta.subGrids;Object.entries(e.elements).forEach(([r,n])=>{t[r].rows.push([n.outerHTML,e.offsetHeight])})}buildPageHtml(){const e=this,{subGrids:t}=e.exportMeta;let r=e.prepareExportElement();return Object.values(t).forEach(({placeHolder:t,rows:n})=>{const s=t.outerHTML;r=r.replace(s,e.positionRows(n).join(""))}),r}}Ml.prototype.pagesExtractor=function(){var e=Dl((function*(e){const t=this,{client:r}=e,{rowManager:n,store:s}=r,i=t.stylesheets,o=e.orientation===ml.portrait,a=gl[e.paperFormat],l=o?a.width:a.height,c=o?a.height:a.width,d=e.rowsRange===hl.visible&&s.count?Math.min(s.count,n.visibleRowCount):s.count;let u,h,{totalHeight:g,totalWidth:m}=t.exportMeta,p=0,f=-1;if(n.rows.length>0)for(e.rowsRange===hl.visible&&(f=n.rows.find(e=>e.bottom>r.scrollable.y).dataIndex-1);p<d;){const s=n.rows,i=s[s.length-1],o=p;s.forEach(e=>{e.dataIndex>f&&p<d&&(++p,g+=e.offsetHeight,t.collectRow(e))});const a=s.findIndex(e=>e.dataIndex===f+1),l=a+(p-o);yield El(t.onRowsCollected(s.slice(a,l),e)),p<d&&(f=i.dataIndex,yield El(t.scrollRowIntoView(r,f+1)))}const v=t.buildPageHtml();g+=r.height-r.bodyHeight;const y=g;if(e.headerTpl){u=t.prepareHTML(e.headerTpl({totalWidth:m}));const r=t.measureElement(u);g+=r}if(e.footerTpl){h=t.prepareHTML(e.footerTpl({totalWidth:m}));const r=t.measureElement(h);g+=r}const b=Math.min(1,t.getScaleValue(t.inchToPx(l),m)),C=Math.min(1,t.getScaleValue(t.inchToPx(c),g)),w=Math.min(b,C);i.push(`<style>\n                #${r.id} {\n                    height: ${y}px !important;\n                    width: ${m}px !important;\n                }\n                \n                .b-export-content {\n                    ${t.centerContentHorizontally?"left: 50%;":""}\n                    transform: scale(${w}) ${t.centerContentHorizontally?"translateX(-50%)":""};\n                    transform-origin: top left;\n                    height: ${1===w?"inherit":"auto !important"};\n                }\n            </style>`),yield{html:t.pageTpl({html:v,header:u,footer:h,styles:i,paperWidth:l,paperHeight:c})}}));return function(t){return e.apply(this,arguments)}}(),Ml._$name="SinglePageExporter";class kl extends(ae(Nn)){static get $name(){return"PdfExport"}static get defaultConfig(){return{exportServer:void 0,fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[Ml,Tl,Rl],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",localizableProperties:["exportMask","exportProgressMask"]}}doDestroy(){this.exportDialog&&this.exportDialog.destroy(),super.doDestroy()}get currentExportPromise(){return this._currentExportPromise}set currentExportPromise(e){this._currentExportPromise=e}get exportersMap(){return this._exportersMap||(this._exportersMap=new Map)}getExporter(e={}){const t=this,{exportersMap:r}=t,{type:n}=e;let s;if(r.has(n))s=r.get(n);else{const i=this.exporters.find(e=>e.type===n);if(!i)throw new Error(`Exporter type ${n} is not found. Make sure you've configured it`);delete(e=ze.clone(e)).type,s=new i(e),s.relayAll(t),r.set(n,s)}return s}buildRequest(e,t){return{html:JSON.stringify(e),fileFormat:t.fileFormat,format:t.paperFormat,orientation:t.orientation}}buildExportConfig(e={}){const{client:t,exportServer:r,clientURL:n,fileFormat:s,fileName:i,paperFormat:o,rowsRange:a,alignRows:l,repeatHeader:c,keepRegionSizes:d,orientation:u,exporters:h,translateURLsToAbsolute:g,keepPathName:m,headerTpl:p,footerTpl:f}=this;e.columns||(e.columns=t.columns.visibleColumns.map(e=>e.id));const v=ze.assign({client:t,exportServer:r,clientURL:n,fileFormat:s,paperFormat:o,rowsRange:a,alignRows:l,repeatHeader:c,keepRegionSizes:d,orientation:u,translateURLsToAbsolute:g,keepPathName:m,headerTpl:p,footerTpl:f,exporterType:h[0].type,fileName:i||t.$name},e);if("multipagevertical"!==v.exporterType&&(v.repeatHeader=!1),!("alignRows"in e)&&e.repeatHeader&&(v.alignRows=!0),!("keepRegionSizes"in e)&&!v.keepRegionSizes){const e=[],r={};t.eachSubGrid(t=>t.collapsed&&e.push(t.region)),e.length&&(t.eachSubGrid(t=>{e.includes(t.region)||(r[t.region]=!0)}),v.keepRegionSizes=r)}return v}async export(e={}){const t=this,{client:r,pagesPerRequest:n}=t;let s;if((e=t.buildExportConfig(e)).exporterConfig=ze.assign({type:e.exporterType,translateURLsToAbsolute:e.translateURLsToAbsolute,keepPathName:e.keepPathName},e.exporterConfig||{}),!1!==r.trigger("beforeExport",e)){r.ignoreViewBox=!0,r.mask(t.exportMask);try{const i=t.getExporter(e.exporterConfig);if(0===n){const r=await i.export(e);t.trigger("exportStep",{progress:90,text:t.exportProgressMask});const n=await ee.post(e.exportServer,{html:r,orientation:e.orientation,format:e.paperFormat,fileFormat:e.fileFormat,fileName:e.fileName,clientURL:e.clientURL},Object.assign({credentials:"omit",parseJson:!0},t.fetchOptions));if(s={response:n},n.ok){const r=n.parsedJson;if(t.openAfterExport)if(r.success)if(P.isIE11)window.open(r.url,"ExportedPanel");else{const n=document.createElement("a");n.download=e.fileName,n.href=r.url,t.openInNewTab&&(n.target="_blank"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}else J.toast(r.msg)}}}catch(e){throw s=e instanceof Response?{response:e}:{error:e},e}finally{t.exportDialog&&t.exportDialog.close(),r.unmask(),r.ignoreViewBox=!1,t.trigger("export",s),s.error?J.toast(t.L("L{Export failed}")):s.response.ok||J.toast(t.L("L{Server error}")),r.trigger("export",s)}}return s}get defaultExportDialogConfig(){return ze.copyProperties({},this,["client","exporters","exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader"])}showExportDialog(){const e=this;return e.exportDialog||(e.exportDialog=new Cl(Object.assign({},e.defaultExportDialogConfig,{listeners:{export:e.onExportDialogExport,thisObj:e}}))),e.exportDialog.show()}onExportDialogExport({values:e}){const t=this;t.mask=new Qr({progress:0,maxProgress:100,text:t.exportMask,element:t.exportDialog.element});const r=t.on({export(){t.mask.close(),r()},exportstep({progress:e,text:r}){t.mask.progress=e,null!=r&&(t.mask.text=r)}});t.currentExportPromise=t.export(e),t.currentExportPromise.then(()=>t.currentExportPromise=null)}}kl._$name="PdfExport",Va.registerFeature(kl,!1,"Grid");class Il extends B{static get defaultConfig(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"Â Â Â Â "}}export(e={}){return e=ze.assign({},this.config,e),this.normalizeColumns(e),this.generateExportData(e)}generateExportData(e){const t=this.generateColumns(e);return{rows:this.generateRows(e),columns:t}}normalizeColumns(e){const t=e.columns||this.target.columns.visibleColumns.filter(e=>!1!==e.exportable);e.columns=t.map(e=>"string"==typeof e?this.target.columns.find(t=>t.field===e)||{field:e}:e)}generateColumns(e){return e.columns.map(t=>this.processColumn(t,e))}generateRows(e){const{columns:t}=e;if(!t.length)return[];const r=this,{target:n}=r;return n.store.map(n=>r.processRecord(n,t,e)).filter(e=>e.length)}getColumnType(e,t=this.target.store){let r=e.exportedType||"object";if(void 0===e.exportedType&&e.field){const n=t.modelClass.getFieldDefinition(e.field);n&&n.type&&(r=n.type)}return r}processColumn(e,t){const{target:r}=this,{defaultColumnWidth:n}=t;let{field:s,text:i,width:o,minWidth:a}=e;if(s in r.store.modelClass.fieldMap||(s=""),!i||!o){const e=r.columns.find(e=>e.field===s);i||(i=e&&e.text||s),null==o&&(o=e&&e.width||n)}return o=Math.max(o||n,a||n),{field:s,value:i,width:o,type:this.getColumnType(e)}}processRecord(e,t,r){const{target:n}=this,{showGroupHeader:s,indent:i,indentationSymbol:o}=r;let a;return e?e.meta.specialRow?s&&e.meta.groupRowFor&&(a=t.map(t=>n.features.group.buildGroupHeader({cellElement:Et.createElement(),grid:n,record:e,column:t}))):a=t.map(t=>{let s=e[t.field],a=t.renderer||t.defaultRenderer;return!a||s&&t instanceof ka&&r.exportDateAsInstance||(s=a.call(t,{value:s,record:e,column:t,grid:n,isExport:!0})),i&&t.tree&&(s=`${o.repeat(e.childLevel)}${s}`),s}):a=t.map(()=>""),a}}Il._$name="TableExporter";class Fl{constructor(e){this._value=e}get value(){return this._value}toString(){return Boolean(this.value)?"âœ“":""}}Fl._$name="BooleanUnicodeSymbol";class Al extends Nn{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{filename:null,dateFormat:"YYYY-MM-DD",exporterClass:Il,exporterConfig:null,zipcelx:null,convertEmptyValueToEmptyString:!0}}processValue(e){return null==e||Number.isNaN(e)||"function"==typeof e||"object"==typeof e&&"[object Object]"===String(e)?"":e}generateExportData(e){const t=this,{rows:r,columns:n}=t.exporter.export(e.exporterConfig);return{rows:r.map(r=>r.map((r,n)=>{r instanceof Date?r=je.format(r,e.dateFormat):"boolean"==typeof r&&(r=new Fl(r)),t.convertEmptyValueToEmptyString&&(r=t.processValue(r));return{value:r,type:"string"}})),columns:n.map(e=>{let{field:t,value:r,width:n,type:s}=e;return s="string",{field:t,value:r,width:n,type:s}})}}export(e={}){const t=this;if(!t.zipcelx)throw new Error('ExcelExporter: "zipcelx" library is required');if(t.disabled)return;(e=ze.assign({},t.config,e)).filename||(e.filename=t.client.$name);const{filename:r}=e,{rows:n,columns:s}=t.generateExportData(e);t.zipcelx({filename:r,sheet:{data:[s].concat(n),cols:s}})}construct(e,t){super.construct(e,t),this.zipcelx||"undefined"!=typeof zipcelx&&(this.zipcelx=zipcelx)}get exporter(){return this._exporter||(this._exporter=new this.exporterClass(Object.assign({target:this.client},this.exporterConfig)))}}Al._$name="ExcelExporter",Va.registerFeature(Al,!1,"Grid");class Pl extends(br(B)){static get defaultConfig(){return{zoneWidth:50,scrollSpeed:5,verticalElement:null,direction:"both",monitoring:[],startScrollDelay:500,testConfig:{scrollSpeed:2,startScrollDelay:0}}}startMonitoring(e){const t=this,r=e instanceof HTMLElement?{element:e}:e,n=r.element,s=r.verticalElement||t.verticalElement||n;if(n&&(n.scrollWidth>n.offsetWidth||s.scrollHeight>s.offsetHeight)){if(t.monitoring.find(e=>e.element===n))return;r.direction=r.direction||t.direction,Object.assign(r,{verticalElement:s,scrollManager:t,startScrollLeft:n.scrollLeft,startScrollTop:s.scrollTop,scrollLeft:n.scrollLeft,scrollTop:s.scrollTop,scrollRelativeLeft:0,scrollRelativeTop:0});const e=t.onMouseMove.bind(r);t.mouseMoveDetacher=gr.on({mousemove:e,touchmove:e,mouseleave:()=>t.clearTimeout(t.scrollTimeout),element:n}),r.scrollWidth=n.scrollWidth,t.monitoring.push(r)}}stopMonitoring(e){const t=this,r=t.monitoring.find(t=>t.element===e);r&&(t.stopScroll(r),t.mouseMoveDetacher&&t.mouseMoveDetacher(),t.monitoring.splice(t.monitoring.indexOf(r),1))}startScroll(e){e.scrolling=!0,this.performScroll(e)}stopScroll(e){const t=this;e.scrolling=!1,e.scrollRequested&&(t.cancelAnimationFrame(e.frameId),e.scrollRequested=!1),t.clearTimeout(t.scrollTimeout),t.scrollTimeout=null}performScroll(e){if(e.scrolling&&!e.scrollRequested){const t=e.element,r=e.verticalElement;0!==e.scrollDeltaX&&(e.scrollLeft+=e.scrollDeltaX,e.scrollLeft=Math.max(Math.min(e.scrollLeft,e.scrollWidth-t.clientWidth),0),e.scrollRelativeLeft=e.scrollLeft-e.startScrollLeft,t.scrollLeft=e.scrollLeft),0!==e.scrollDeltaY&&(e.scrollTop+=e.scrollDeltaY,e.scrollTop=Math.max(Math.min(e.scrollTop,r.scrollHeight-r.clientHeight),0),e.scrollRelativeTop=e.scrollTop-e.startScrollTop,r.scrollTop=e.scrollTop),0===e.scrollRelativeLeft&&0===e.scrollRelativeTop||!e.callback||e.callback.call(e.thisObj||this,e),e.scrollRequested=!0,e.frameId=this.requestAnimationFrame(()=>{e.scrollRequested=!1,this.performScroll(e)})}}onMouseMove(e){const t=this,r=t.scrollManager,n=t.element,s=t.verticalElement,i=n.getBoundingClientRect(),o=s.getBoundingClientRect(),a=r.zoneWidth,l=r.scrollSpeed;t.scrollDeltaX=0,"vertical"!==t.direction&&(e.clientX>i.right-a?t.scrollDeltaX=Math.round((a-(i.right-e.clientX))/l)+1:e.clientX<i.left+a&&(t.scrollDeltaX=-Math.round((a+(i.left-e.clientX))/l)-1)),t.scrollDeltaY=0,"horizontal"!==t.direction&&(e.clientY>o.bottom-a?t.scrollDeltaY=Math.round((a-(o.bottom-e.clientY))/l)+1:e.clientY<o.top+a&&(t.scrollDeltaY=-Math.round((a+(o.top-e.clientY))/l)-1)),0===t.scrollDeltaX&&0===t.scrollDeltaY?r.stopScroll(t):r.scrollTimeout||(r.scrollTimeout=r.setTimeout(()=>r.startScroll(t),r.startScrollDelay))}}Pl._$name="ScrollManager";class Ll extends(br(B)){static get defaultConfig(){return{cls:"b-grid-row"}}construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1},e),super.construct()}doDestroy(){const e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),super.doDestroy()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){if(this._dataIndex!==e){const t=this._elementsArray;this._dataIndex=e;for(let r=0;r<t.length;r++)t[r].dataset.index=e}}get id(){return this._id}set id(e){const t=this,r={id:e},n=t.rowManager.idMap,s=t._elementsArray,i=t._allCells;if(t._id!=e||n[e]!==t){n[t._id]===t&&delete n[t._id],n[e]=t,t._id=e;for(let e=0;e<s.length;e++)ei.assign(s[e],r);for(let e=0;e<i.length;e++)ei.assign(i[e],r);for(let t=0;t<s.length;t++)s[t].dataset.id=e}}addElement(e,t){const r=this;let n=t.firstElementChild;for(r._elements[e]=t,r._elementsArray.push(t),r._regions.push(e),ei.assign(t,{index:r.index}),r._cells[e]=[];n;)r._cells[e].push(n),r._allCells.push(n),ei.set(n,{column:n.dataset.column,columnId:n.dataset.columnId,rowElement:n.parentNode,row:r}),n=n.nextElementSibling;t.dataset.index=r.index}getElement(e){return this._elements[e]}eachElement(e){for(let t=0;t<this._elementsArray.length;t++)e(this._elementsArray[t],t)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e){return this._allCells.find(t=>{const r=ei.get(t);return r.columnId===e||r.column===e})}removeElements(e=!1){const t=this;t.rowManager.trigger("removeRow",{row:t}),e||t._elementsArray.forEach(e=>e.remove()),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(){const e=this;if(e.rowManager.storeKnownHeight(e.id,e.height),e.lastHeight!==e.height){const t=e._elementsArray;for(let r=0;r<t.length;r++)t[r].style.height=e.offsetHeight+"px";e.lastHeight=e.height}}addCls(...e){this.eachElement(t=>Et.addClasses(t,e))}removeCls(...e){this.eachElement(t=>Et.removeClasses(t,e))}get isFirst(){return 0===this.dataIndex}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e){this._top!==e&&(this._top=e,this.translateElements())}setBottom(e){this.setTop(e-this.offsetHeight)}translateElements(){const e=this,t=e.grid.positionMode;if(e.lastTop!==e.top){const r=e._elementsArray;for(let n=0;n<r.length;n++){const s=r[n].style;"translate"===t?s.transform=`translate(0,${e.top}px)`:"translate3d"===t?s.transform=`translate3d(0,${e.top}px,0)`:"position"===t&&(s.top=e.top+"px")}e.rowManager.trigger("translateRow",{row:e}),e.lastTop=e.top}}offset(e){let t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}render(e,t,r=!0,n=!1){var s;const i=this,{cells:o,grid:a,rowManager:l,height:c}=i,d=i._id,u=i._elementsArray,h=ei.get(u[0]),g=l._rowHeight,m=r&&a.transitionDuration?i.cls+" b-grid-row-updating":i.cls;let p,f,v,y=0;t||!1===t||(t=a.store.getById(h.id),e=a.store.indexOf(t));const b=t&&a.isSelected(t.id);for(l.trigger("beforeRenderRow",{row:i,record:t,recordIndex:e,oldId:d});y<u.length;y++)p=u[y],p.className=m,b&&p.classList.add("b-selected"),t.cls&&t.cls.split(" ").forEach(e=>p.classList.add(e));r&&a.transitionDuration&&i.setTimeout(()=>{u.forEach(e=>{e.classList.remove("b-grid-row-updating")})},a.transitionDuration),i.id=t.id,i.dataIndex=e;const C=!a.fixedRowHeight&&a.getRowHeight(t)||g;let w=null;for(y=0;y<o.length;y++)f=o[y],v=i.renderCell(f,t,y,r,C),l.fixedRowHeight||null!=v.height&&(w=Math.max(w,v.height));i.height=null!==(s=w)&&void 0!==s?s:C,i.updateElementsHeight(),r&&(c!==i.height&&l.translateFromRow(i,n),l.trigger("updateRow",{row:i,record:t,recordIndex:e,oldId:d}),l.trigger("renderDone")),l.trigger("renderRow",{row:i,record:t,recordIndex:e,oldId:d}),i.forceInnerHTML=!1}renderCell(e,t,r,n=!0,s){const i=this,{grid:o}=i,a=ei.get(e),l=o.columns.getById(a.columnId),c=a.rowElement,d=ei.get(c),{internalCellCls:u,cellCls:h,align:g,renderer:m,defaultRenderer:p,id:f}=l,v={columnId:f,id:d.id},y=m||p;if(!t){if(null===d.id)return void(e.className="b-grid-cell");if(!(t=o.store.getById(d.id)))return}let b=l.getRawValue(t),C=!0;const w={configuredHeight:s,height:null},S={cellElement:e,rowElement:c,value:b,record:t,column:l,size:w,grid:o,row:a.row,updatingSingleRow:n},D={"b-grid-cell":1,[u]:u,[h]:t.meta.specialRow&&"b-check-cell"===l.internalCellCls?void 0:h,"b-cell-dirty":t.isFieldModified(l.field),["b-grid-cell-align-"+g]:g,"b-selected":o.isSelected(v),"b-focused":o.isFocused(v)};Et.syncClassList(e,D),y&&(b=y.call(l,S),void 0===b&&(C=!1)),o.processCellContent&&(C=o.processCellContent({cellContent:b,cellElement:e,record:t,cellElementData:a,rendererData:S}));const E=S.cellContent=null==b?"":String(b);if(C)if(i.forceInnerHTML&&(e.innerHTML="",e.lastDomConfig=null),l.htmlEncode&&!l.disableHtmlEncode)P.isLinux||e._hasHtml?(e.innerText=E,e._hasHtml=!1):Et.setInnerText(e,E);else{const t="string"==typeof b,r="object"==typeof b;!l.autoSyncHtml||t&&!e.childElementCount?r?bo.sync({targetElement:e,domConfig:{onlyChildren:!0,children:[b]}}):e.innerHTML=E:t?Et.sync(E,e.firstElementChild):bo.sync({domConfig:b,targetElement:e})}return i.rowManager.trigger("renderCell",S),w}}Ll._$name="Row";class Ol extends Nn{static get pluginConfig(){return{chain:["getRowById","topRow","bottomRow","getRecordCoords","getRow","getRowFor","getRowFromElement","destroy"],assign:["rowHeight"]}}static get defaultConfig(){return{prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(e){e.grid._rowManager=this,super.construct(e.grid,e)}doDestroy(){this._rows.forEach(e=>e.destroy()),super.doDestroy()}initWithHeight(e,t=!1){const r=this;return r.autoHeight&&(e=r.store.allCount*r.preciseRowOffsetHeight),r.viewHeight=e,r.calculateRowCount(t),e}reinitialize(e=!1){const t=this;t.calculateRowCount(!1,!0,!0),t.topIndex+t.rowCount-1>t.store.count&&(e=!0);const r=t.topRow&&!e?t.topRow.top:0;t.scrollTargetRecordId=null,e&&(t.topIndex=t.lastScrollTop=0);const{topRow:n}=t;n&&(n.dataIndex=t.topIndex,n.setTop(r)),t.estimateTotalHeight(),t.renderFromRow(n)}matchRowCount(e=!1){const t=this,{rows:r,grid:n}=t,s=r.length,i=s-t.rowCount;if(i)if(i<0){const i=[];for(let e=s,o=s?r[s-1].dataIndex+1:0;e<t.rowCount;e++,o++)i.push(new Ll({rowManager:t,grid:n,index:e,dataIndex:o}));r.push.apply(r,i),t.trigger("addRows",{rows:i}),e||t.renderFromRow(r[Math.max(0,s-1)])}else{const e=r.splice(s-i,i);t.trigger("removeRows",{rows:e}),e.forEach(e=>e.destroy())}}calculateRowCount(e=!1,t=!0,r=!1){const n=this,{store:s}=n,i=Math.ceil(n.viewHeight/n.minRowOffsetHeight),o=i+n.prependRowBuffer+n.appendRowBuffer;return!n.grid.columns.count||isNaN(i)?(n.rowCount=0,0):(o<n.rowCount&&!t||(n.visibleRowCount=i,n.rowCount=Math.min(s.count,o),e||(n.rows&&n.rowCount!==n.rows.length?n.matchRowCount(r):n.rowCount||n.trigger("changeTotalHeight",{totalHeight:n.totalHeight}),n.grid.toggleEmptyText())),n.rowCount)}removeAllRows(){const e=this,{topRow:t}=e,r=t?e.refreshDetails={topRowIndex:t.dataIndex,topRowTop:t.top}:e.refreshDetails,n=e.rows.slice();return e.trigger("removeRows",{rows:n}),e.rows.forEach(e=>e.destroy()),e.rows.length=0,e.idMap={},r}setPosition(e){const{topRow:t}=this,{topRowIndex:r,topRowTop:n}=e;t.setTop(n),t.dataIndex=r}get store(){return this.client.store}get rows(){return this._rows}getRow(e){return this.rowCount&&this.rows[e-this.topIndex]}getRowById(e){return e.isModel&&(e=e.id),this.idMap[e]}getRowFromElement(e){return(e=e.closest(".b-grid-row"))&&this.getRow(e.dataset.index)}getRowAt(e,t=!1){return t||(e-=Xt.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=Et.roundPx(e),this.rows.find(t=>e>=t.top&&e<t.bottom)}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const t="number"==typeof e?e:e.index;return this.getRow((t+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}offsetRows(e){if(0!==e){const{rows:t}=this,{length:r}=t;for(let n=0;n<r;n++)t[n].offset(e)}this.trigger("offsetRows",{offset:e})}get rowHeight(){return this._rowHeight}set rowHeight(e){const t=this,{grid:r,fixedRowHeight:n}=t,s=t.rowHeight;if(ze.assertNumber(e,"rowHeight"),e<10&&(e=10),t.trigger("beforeRowHeight",{height:e}),t.minRowHeight=t._rowHeight=e,t.prependBufferHeight=t.prependRowBuffer*t.rowOffsetHeight,t.appendBufferHeight=t.appendRowBuffer*t.rowOffsetHeight,n&&(t.averageRowHeight=e),t.rows.length){const i=r.scrollable.y,o=t.getRowAt(i,!0),a=o?o.top-i:0;let l,c;n?(l=e,c=s):(c=l=t.averageRowHeight,t.clearKnownHeights(),l*=e/s),t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*(l+r._rowBorderHeight)),t.refresh();i*(l/c)!==i&&r.scrollRowIntoView(o.id,{block:"start",edgeOffset:a})}t.trigger("rowHeight",{height:e})}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.store.count}storeKnownHeight(e,t){const r=this,{heightMap:n}=r;r.fixedRowHeight||(n.has(e)&&(r.totalKnownHeight-=n.get(e)),n.set(e,t),r.totalKnownHeight+=t,t<r.minRowHeight&&(r.minRowHeight=t),r.averageRowHeight=r.totalKnownHeight/n.size)}invalidateKnownHeight(e){const t=this;if(!t.fixedRowHeight){const{heightMap:r}=t;Array.isArray(e)||(e=[e]),e.forEach(e=>{e&&r.has(e.id)&&(t.totalKnownHeight-=r.get(e.id),r.delete(e.id))}),t.averageRowHeight=t.totalKnownHeight/r.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;const{heightMap:t,averageRowHeight:r,store:n,grid:s}=this;let i=0;for(let o=0;o<e;o++){const e=n.getAt(o);t.has(e.id)?i+=t.get(e.id):i+=s.getRowHeight(e)||r,i+=s._rowBorderHeight}return Math.floor(i)}getRecordCoords(e,t=!1){const r=this,n="string"==typeof e||"number"==typeof e?e:e.id,s=r.getRowById(e);let i=r.client._bodyRectangle;return t||(i=r.client._bodyRectangle=Xt.client(r.client.bodyContainer)),s?new Xt(i.x,t?Math.round(s.top):Math.round(s.top+i.y-r.client.scrollable.y),i.width,s.offsetHeight):r.getRecordCoordsByIndex(r.store.indexOf(n),t)}getRecordCoordsByIndex(e,t=!1){const r=this,{topRow:n,bottomRow:s}=r,i=r.client._bodyRectangle,{id:o}=r.store.getAt(e),a=r.preciseRowOffsetHeight,l=n.dataIndex,c=s.dataIndex,d=e>c?{index:e-c-1,y:s.bottom,from:"bottomRow"}:e>l/2?{index:e-l,y:n.top,from:"topRow"}:{index:e,y:0,from:"top"},u=r.allHeightsKnown?r.calculateTop(e):Math.floor(d.y+d.index*a),h=new Xt(i.x,t?u:u+i.y-r.client.scrollable.y,i.width,Math.floor(r.heightMap.get(o)||a));return h.virtual=!0,h.block=h.bottom<i.y?"start":h.y>i.bottom?"end":"nearest",h}get totalHeight(){return this._totalHeight}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0)),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const t=this.getRowById(e.id);t&&this.renderFromRow(t)}renderFromRow(e=null){const t=this,{rows:r,store:n}=t,s=n.count;if(0===t.calculateRowCount(!1,s<r.length,!0))return;let i,o=e?r.indexOf(e):0,a=e?e.dataIndex:r[0].dataIndex,l=s-a-1,c=Math.min(r.length-1,o+l),d=r.length-c-1,u=o>0?r[o-1].bottom:r[o].top;for(let e=o;e<=c;e++)i=r[e],i.dataIndex=a,i.setTop(u),i.render(a,n.getAt(a++),!1),u+=i.offsetHeight;for(;d-- >0;)t.displayRecordAtTop();t.estimateTotalHeight(),t.trigger("renderDone")}renderRows(e){let t,r=!1;e=Array.from(e);for(const n of e)t=n.height,n.render(null,null,!1),r|=n.height!==t;r&&(this.translateFromRow(e[0],!0),this.estimateTotalHeight()),this.trigger("renderDone")}translateFromRow(e,t=!1){const r=this;let n,s,i=e.bottom;for(s=e.dataIndex+1,n=r.getRow(s);n;n=r.getRow(++s))n.setTop(i),i+=n.offsetHeight;t||r.estimateTotalHeight()}refresh(){const{topRow:e}=this;e&&(this.idMap={},this.renderFromRow(e),this.trigger("refresh"))}jumpToPosition(e,t){const r=this,{store:n,heightMap:s}=r,i=n.count;if(r.allHeightsKnown&&!r.fixedRowHeight){const t=e-r.prependBufferHeight,o=r.grid._rowBorderHeight;let a=0,l=0;for(;a<t;){const e=n.getAt(l);a+=s.get(e.id)+o,l++}const c=Math.max(Math.min(l,i-r.rowCount),0);r.lastScrollTop=e,r.topRow.dataIndex=r.topIndex=c,r.topRow.setTop(r.calculateTop(c),!1),r.refresh()}else{const n=r.preciseRowOffsetHeight,s=null==t?Math.floor(e/n)-r.prependRowBuffer:t-Math.floor(r.rowCount/2),o=Math.max(Math.min(s,i-r.rowCount),0),a=r.client.scrollable.y,l=Math.min(r.client._bodyRectangle.height+a+r.appendBufferHeight,r.totalHeight);if(r.lastScrollTop=e,r.topRow.dataIndex=r.topIndex=o,r.topRow.setTop(Math.floor(o*n),!1),r.refresh(),r.bottomRow.bottom<l)for(r.calculateRowCount(!1,!1,!1);r.bottomRow.bottom<l&&r._rows[r.prependRowBuffer].top<a&&r.bottomRow.dataIndex<i-1;)r.displayRecordAtBottom();r.estimateTotalHeight()}if(null!=t){const{scrollable:n}=r.grid,s=r.getRow(t),i=s&&Xt.from(s._elementsArray[0]).center.y,o=n.viewport.center.y;s&&(n.y=e=Math.floor(n.y+(i-o)))}return e}warpIfNeeded(e){const t=this,r={newScrollTop:e,deltaTop:e-t.lastScrollTop};if(Math.abs(r.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let n;t.scrollTargetRecordId&&(n=t.store.indexOf(t.scrollTargetRecordId)),r.newScrollTop=t.jumpToPosition(e,n),r.deltaTop=0}return r}updateRenderedRows(e,t,r=!1){const n=this,s=n.client._bodyRectangle;if(0===n.rowCount)return 0;let i=n.totalHeight;if(t||Math.abs(e-n.lastScrollTop)>n.rowOffsetHeight||n.topRow.top>e||n.bottomRow.bottom<e+s.height){const t=n.warpIfNeeded(e);n.scrollTargetRecordId=null,n.lastScrollTop=t.newScrollTop,t.deltaTop>0?n.fillBelow(t.newScrollTop):t.deltaTop<0&&n.fillAbove(t.newScrollTop),n.fixedRowHeight||r||n.correctError(t,s,e),i=n.estimateTotalHeight()}return i}correctError(e,t,r){const n=this;let s=0;(n.allHeightsKnown||e.deltaTop<0&&r<2*t.height||e.deltaTop>0&&r>n.totalHeight-2*t.height-3)&&(s=n.topRow.top-n.calculateTop(n.topRow.dataIndex)),s&&(n.offsetRows(-s),n.grid.scrollable.y=n.lastScrollTop=n.grid.scrollable.y-s)}fillAbove(e){const t=this,r=e-t.topRow.top-t.prependBufferHeight;let n=0;for(;n>r&&t.topIndex>0;)n-=t.displayRecordAtTop();t.trigger("renderDone")}fillBelow(e){const t=this,r=e-t.topRow.top-t.prependBufferHeight,n=t.store.count,s=t.rowCount;let i=0;for(;i<r&&t.topIndex+s<n&&t.topRow.top+t.topRow.offsetHeight<e;)i+=t.displayRecordAtBottom();t.trigger("renderDone")}estimateTotalHeight(e=!1){const t=this;if(t.grid.renderingRows)return;const r=t.store.count,n=r-t.heightMap.size,{bottomRow:s}=t;let i;if(t.fixedRowHeight)i=r*t.rowOffsetHeight;else{if(i=t.totalKnownHeight+t.heightMap.size*t.grid._rowBorderHeight+n*t.preciseRowOffsetHeight,s&&n){const e=s.bottom;(e>i||t.topIndex+t.rowCount>=r&&i>e)&&(i=e,s.dataIndex<r-1&&(i+=(r-1-s.dataIndex)*t.preciseRowOffsetHeight))}i=Math.floor(i)}return i!==t.totalHeight&&!1!==t.trigger("changeTotalHeight",{totalHeight:i,immediate:e})&&(t._totalHeight=i),i}displayRecordAtTop(){const e=this,t=e.topIndex-1,r=e.store.getAt(t),n=e.bottomRow,s=n.top;return e.trigger("beforeTranslateRow",{row:n,newRecord:r}),n._top=e.topRow.top-e.rowOffsetHeight,n.estimatedTop=!e.fixedRowHeight,n.render(t,r,!1),n._top=s,n.setBottom(e.topRow.top),n.estimatedTop=!1,e.topIndex--,e._rows.unshift(e._rows.pop()),n.offsetHeight}displayRecordAtBottom(){const e=this,t=e.topIndex+e.rowCount,r=e.store.getAt(t),n=e.topRow;return e.trigger("beforeTranslateRow",{row:n,newRecord:r}),n.dataIndex=t,n.setTop(e.bottomRow.bottom),n.render(t,r,!1),e.topIndex++,e._rows.push(e._rows.shift()),n.offsetHeight}}Ol._$name="RowManager";const _l={x:1};class $l extends _r{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,t=_l){if("string"==typeof t&&(t={[t]:1}),t.x)for(let t=0;t<this.xScrollers.length;t++)this.xScrollers[t].addPartner(e.xScrollers[t],"x");t.y&&super.addPartner(e,"y")}updateOverflowX(e){this.xScrollers&&this.xScrollers.forEach(t=>t.overflowX=e),this.widget.virtualScrollers.classList[!1===e?"add":"remove"]("b-hide-display")}scrollIntoView(e,t){if(1!==e.nodeType)return super.scrollIntoView(e,t);for(const r of this.xScrollers)if(r.element.contains(e))return r.scrollIntoView(e,t)}set x(e){this.xScrollers&&(this.xScrollers[0].x=e)}get x(){return this.xScrollers?this.xScrollers[0].x:0}}$l._$name="GridScroller";class jl extends al{static get $name(){return"Header"}static get defaultConfig(){return{isHeader:!0}}startConfigure(e){e.scrollable.overflowX="hidden-scroll",super.startConfigure(e)}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=e,this.id=e.id+"-header"}get region(){return this.subGrid&&this.subGrid.region}template(){const e=this.region;return Cn.tpl`
            <div class="b-grid-header-scroller b-grid-header-scroller-${e}">
                <div reference="headersElement" class="b-grid-headers b-grid-headers-${e}" data-region="${e}" data-max-depth="${this.maxDepth}" reference="headersElement"></div>
            </div>
        `}get overflowElement(){return this.headersElement}contentTemplate(e){const t=this;return e.hidden?"":Cn.tpl`
                <div class="b-grid-header" data-column="${e.field||""}" data-column-id="${e.id}" ${e.isFocusable?'tabindex="0"':""}>
                    <div class="b-grid-header-text">
                        <div class="b-grid-header-text-content"></div>
                    </div>
                    ${e.children?`\n                    <div class="b-grid-header-children">\n                            ${e.children.map(e=>t.contentTemplate(e)).join("")}\n                    </div>\n                    `:""}
                    <div class="b-grid-header-resize-handle"></div>
                </div>
            `}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach(t=>{e+=t.calculateMinWidth()}),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse(t=>{const r=e.getBarCellElement(t.id);if(r){const n=new Ve({"b-grid-header":1,"b-grid-header-parent":t.isParent,["b-level-"+t.childLevel]:1,["b-depth-"+t.meta.depth]:1,["b-grid-header-align-"+t.align]:t.align,"b-grid-header-resizable":t.resizable&&t.isLeaf,[t.cls]:t.cls,"b-last-parent":t.isParent&&t.isLastInSubGrid,"b-last-leaf":t.isLeaf&&t.isLastInSubGrid});let s=t.text;r.className=n,t.headerRenderer&&(s=t.headerRenderer.call(t.thisObj||e,{column:t,headerElement:r})),t.icon&&(s=`<i class="${t.icon}"></i>`+(s||""));const i=r.querySelector(".b-grid-header-text-content");i&&(i.innerHTML=s||"")}}),e.fixHeaderWidths()}get columns(){const e=this,t=super.columns;return e.columnsDetacher||(e.columnsDetacher=t.on({change(){e.initDepths()},thisObj:e}),e.initDepths()),t}set columns(e){super.columns=e}initDepths(e=this.columns.topColumns,t=null){let r=this,n=0;t&&t.meta&&t.meta.depth++;for(let s of e)s.meta.depth=0,s.children&&(r.initDepths(s.children.filter(r.columns.chainedFilterFn),s),s.meta.depth&&t&&(t.meta.depth+=s.meta.depth)),s.meta.depth>n&&(n=s.meta.depth);return t||(r.maxDepth=n),n}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;e.content=e.columns.topColumns.map(t=>e.contentTemplate(t)).join(""),e.refreshHeaders()}onPaint({firstPaint:e}){e&&this.refreshContent()}}jl._$name="Header";const Hl={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",mouseover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keydown:"onElementKeyDown",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",focus:"onGridElementFocus"};var Nl=e=>class extends(e||B){static get defaultConfig(){return{longPressTime:400}}initInternalEvents(){const e=Object.keys(Hl),t=e.length,r={element:this.element,thisObj:this};for(let n=0;n<t;n++)r[e[n]]="handleEvent";gr.on(r)}getEventData(e){const t=this,r=Et.up(e.target,".b-grid-cell");if(r){const e=ei.get(r),{id:n,columnId:s}=e,i=t.store.getById(n);return i?{cellElement:r,cellData:e,columnId:s,id:n,record:i,cellSelector:{id:n,columnId:s}}:null}}handleEvent(e){this.disabled||(this.event=e,Hl[e.type]&&this[Hl[e.type]](e))}onElementTouchStart(e){const t=this;Et.isTouchEvent=!0,1===e.touches.length&&(t.longPressTimeout=t.setTimeout(()=>{t.onElementLongPress(e),e.preventDefault(),t.longPressPerformed=!0},t.longPressTime))}onElementTouchMove(e){const t=this;t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementTouchEnd(e){const t=this;t.longPressPerformed&&(e.cancelable&&e.preventDefault(),t.longPressPerformed=!1),t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementLongPress(e){}triggerCellMouseEvent(e,t){const r=this,n=r.getEventData(t);if(n){const s=r.columns.getById(n.columnId);r.trigger("cell"+I.capitalizeFirstLetter(e),{grid:this,record:n.record,column:s,cellSelector:n.cellSelector,cellElement:n.cellElement,target:t.target,event:t})}}onElementMouseDown(e){const t=this,r=t.getEventData(e);t.skipFocusSelection=!0,t.triggerCellMouseEvent("mousedown",e),r&&!e.defaultPrevented&&t.onFocusGesture(r,e)}onElementMouseMove(e){this.mouseMoveEvent=e}onElementMouseUp(e){}onHandleElementClick(e){!1!==this.trigger("beforeElementClick",{event:e})&&this.onElementClick(e)}onElementClick(e){const t=this,r=t.getEventData(e);r&&(t.triggerCellMouseEvent("click",e),ei.get(r.cellElement).row.removeCls("b-hover"))}onFocusGesture(e,t){e&&this.focusCell(e.cellSelector,{scroll:!1,doSelect:!0,event:t})}onElementDblClick(e){const t=this,r=e.target;if(t.triggerCellMouseEvent("dblClick",e),r.classList.contains("b-grid-header-resize-handle")){const e=Et.up(r,".b-grid-header");t.columns.getById(e.dataset.columnId).resizeToFitContent()}}onElementMouseOver(e){if(!this.scrolling){const t=Et.up(e.target,".b-grid-cell");if(t){const r=ei.get(t).row;!r||"number"==typeof e.buttons&&0!==e.buttons||(this.hoveredRow=r),this.triggerCellMouseEvent("mouseOver",e)}this.trigger("mouseOver",{event:e})}}onElementMouseOut(e){if(this.hoveredRow=null,!this.scrolling){Et.up(e.target,".b-grid-cell")&&this.triggerCellMouseEvent("mouseOut",e),this.trigger("mouseOut",{event:e})}}set hoveredRow(e){const t=this;t._hoveredRow&&!t._hoveredRow.isDestroyed&&(t._hoveredRow.removeCls("b-hover"),t._hoveredRow=null),e&&!t.scrolling&&(t._hoveredRow=e,e.addCls("b-hover"))}onElementKeyDown(e){const t=this;if(!e.handled)if(e.target.matches(".b-grid-header.b-depth-0"))t.handleHeaderKeyDown(e);else if(e.target===t.focusElement||P.isIE11&&e.currentTarget===t.focusElement)t.handleViewKeyDown(e);else if("Escape"===e.key&&t.isActionableLocation){const e=ze.clone(t.focusedCell);e.element=null,t.focusCell(e),Et.focusWithoutScrolling(t.element)}}handleViewKeyDown(e){const t=this;switch(e.key){case"ArrowLeft":return e.preventDefault(),t.navigateLeft(e);case"ArrowRight":return e.preventDefault(),t.navigateRight(e);case"ArrowUp":return e.preventDefault(),t.navigateUp(e);case"ArrowDown":return e.preventDefault(),t.navigateDown(e)}}handleHeaderKeyDown(e){const t=this,r=t.columns.getById(e.target.dataset.columnId);switch(r.onKeyDown&&r.onKeyDown(e),e.key){case"ArrowLeft":const e=t.columns.getAdjacentVisibleLeafColumn(r,!1);if(e){t.getHeaderElement(e.id).focus()}break;case"ArrowRight":const n=t.columns.getAdjacentVisibleLeafColumn(r,!0);if(n){t.getHeaderElement(n.id).focus()}break;case"Enter":t.getHeaderElement(r.id).click()}}onElementKeyPress(e){}onElementKeyUp(e){}onElementContextMenu(e){const t=this,r=t.getEventData(e);r&&(t.triggerCellMouseEvent("contextMenu",e),Et.isTouchEvent&&t.onFocusGesture(r,e))}onInternalResize(e,t,r,n,s){const i=this;i._devicePixelRatio&&i._devicePixelRatio!==window.devicePixelRatio&&Et.resetScrollBarWidth(),i._devicePixelRatio=window.devicePixelRatio,i._bodyRectangle=Xt.client(i.bodyContainer),super.onInternalResize(...arguments),r!==s&&(i._bodyHeight=i.bodyContainer.offsetHeight,i.isPainted&&i.rowManager.initWithHeight(i._bodyHeight)),i.refreshVirtualScrollbars(),t!==n&&i.setTimeout(()=>{i.isDestroyed||i.updateResponsive(t,n)},0)}get widgetClass(){}};const Bl={string:1,object:1,function:1};var zl=e=>class extends(e||B){set features(e){const t=this,r=Va.getInstanceDefaultFeatures(this);let n,s,i;e=t._features=ze.assign({},e),r&&Object.keys(r).forEach(t=>{t in e||(e[t]=!0)});const o=Va.getInstanceFeatures(this);for(n of Object.keys(e))if(s=e[n],s){if(I.lowercaseFirstLetter(n)!==n)throw new Error(`Invalid feature name '${n}', must start with a lowercase letter`);if(i=o[n],!i)throw new Error(`Feature '${n}' not available, make sure you have imported it`);Reflect.defineProperty(e,n,t.createFeatureInitializer(e,n,i,s))}}get features(){return this._features}createFeatureInitializer(e,t,r,n){const s=[this],i=r.prototype.construct;return Bl[typeof n]&&(s[1]=n),{configurable:!0,get:()=>(delete e[t],r.prototype.construct=function(...n){e[t]=this,i.apply(this,n),r.prototype.construct=i},new r(...s))}}hasFeature(e){return!(!this.features||!this.features[e])}get widgetClass(){}};const Vl=Object.freeze({doSelect:!0}),Wl=Object.freeze({x:!1,y:!1});var Gl=e=>class extends(e||B){get focusedCell(){const e=this._focusedCell;if(e&&this.getCell(e))return e;this.clearFocus()}get isActionableLocation(){const e=this._focusedCell;return Boolean(e&&e.element&&this.getCell(e).contains(e.element))}set focusedCell(e){this.focusCell(e,{doSelect:!1})}get focusedRecord(){if(this._focusedCell)return this.store.getById(this._focusedCell.id)}get cellCSSSelector(){const e=this._focusedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.index}] [data-column-id=${e.columnId}]`:""}onGridElementFocus(e){const t=this,r={doSelect:!1,event:e};if(t._focusedCell)t.focusCell(t._focusedCell,r);else{const n=t.element.contains(e.relatedTarget)?null:t.lastFocusedCell;if(n){const e=t.getCell(n);if(!e||!Et.isVisible(e)||!t.store.getById(n.id))return void t.revertFocus();t.returningFocus=!0,t.focusCell(n,r),t.returningFocus=!1}else if(!t.scrolling&&!t.skipFocusSelection&&t.store.first){const{mouseMoveEvent:e,rowManager:n,_bodyRectangle:s}=t,i=e?Math.min(Math.max(e.clientY,s.y),s.bottom):s.center.y,o=n.getRowAt(i)||n.rows[Math.floor(n.rowCount/2)],a=e&&t.getEventData(e)||{id:o.id,columnId:t.columns.visibleColumns[0].id};t.getCell(a)&&t.focusCell(a,r)}}t.skipFocusSelection=!1}onFocusOut(e){super.onFocusOut(e),this.clearFocus()}isFocused(e){return Boolean(this._focusedCell)&&this.isLocationEqual(e,this._focusedCell)}focusCell(e,t=Vl){e=this.normalizeCellContext(e===Object?Object.assign({},e):e);const r=this,n=!1!==t.doSelect,{event:s,scroll:i}=t,o=r.lastFocusedCell=r._focusedCell,a=r.isLocationEqual(e,o),l=o&&r.getCell(o),c=r.getSubGridFromColumn(e.columnId);let d=r.getCell(e);if(s&&"mousedown"===s.type)for(let t=s.target;t!==d;t=t.parentElement)if(Et.isFocusable(t))return void(e.element=t);if(a)return s&&r.onCellNavigate&&r.onCellNavigate(r,null,r._focusedCell,s,n),e;l&&l.classList.remove("b-focused");const u=d||r.getCell({row:r.rowManager.topIndex,columnId:e.columnId}),h=Xt.from(c.element),g=Xt.from(r.bodyContainer),m=Xt.from(u).moveTo(null,h.y);return!1===i?t=Object.assign({},t,Wl):(t=Object.assign({},t,i),m.width>h.width||m.height>g.height?t.x=t.y=!1:t.column=e.columnId,r.scrollRowIntoView(e.id,t)),d=r.getCell(e),d&&(e.element=d,d.classList.add("b-focused")),r._focusedCell=e,r.onCellNavigate&&r.onCellNavigate(r,o,r._focusedCell,s,n),r.trigger("navigate",{lastFocusedCell:o,focusedCell:r._focusedCell,event:s}),e}isLocationEqual(e,t){return e&&t&&e.id===t.id&&e.columnId===t.columnId&&(!e.element||!t.element||e.element===t.element)}blurCell(e){const t=this.getCell(e);t&&t.classList.remove("b-focused")}clearFocus(){const e=this;e._focusedCell&&(e.lastFocusedCell=e._focusedCell,e.blurCell(e._focusedCell),e._focusedCell=null)}internalNextPrevCell(e=!0,t){const r=this,n=r._focusedCell;return n?r.focusCell({id:n.id,columnId:r.columns.getAdjacentVisibleLeafColumn(n.columnId,e,!0).id},{doSelect:!0,event:t}):null}navigateRight(e){return this.internalNextPrevCell(!0,e)}navigateLeft(e){return this.internalNextPrevCell(!1,e)}internalNextPrevRow(e,t=!0,r){const n=this._focusedCell;if(!n)return!1;const s=this.store["get"+(e?"Next":"Prev")](n.id,!1,t);return!!s&&this.focusCell({id:s.id,columnId:n.columnId,scroll:{x:!1}},{doSelect:!0,event:r})}navigateDown(e){return this.internalNextPrevRow(!0,!1,e)}navigateUp(e){return this.internalNextPrevRow(!1,!1,e)}get widgetClass(){}},Ul=e=>class extends(e||B){static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(e){let t=this,r=Object.keys(t.responsiveLevels),n=null,s=99995,i=null;return r.forEach(r=>{let o=t.responsiveLevels[r];if(["number","string"].includes(typeof o)||(o=o.levelWidth),"*"===o)i=r;else if(e<o){const t=o-e;t<s&&(s=t,n=r)}}),n||i}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(e,t){const r=this,n=r.getClosestBiggerLevel(t),s=r.getClosestBiggerLevel(e);if(n!==s){const i=r.responsiveLevels[s];["number","string"].includes(typeof i)||r.applyState(i),r.columns.forEach(e=>{const t=e.responsiveLevels;t&&(t[s]?e.applyState(t[s]):t["*"]&&e.applyState(t["*"]))}),r.element.classList.remove("b-responsive-"+n),r.element.classList.add("b-responsive-"+s),r.trigger("responsive",{level:s,width:e,oldLevel:n,oldWidth:t})}}get widgetClass(){}};const Yl={string:1,number:1},ql={dataset:1,batch:1};var Xl=e=>class extends(e||B){static get defaultConfig(){return{selectionMode:{row:!0,cell:!0,rowCheckboxSelection:!1,multiSelect:!0,checkbox:!1,showCheckAll:!1},selectedRecordCollection:{}}}afterConfigure(){const e=this;if(e.selectionMode.checkbox){const t=Ea.getColumnClass("check");if(!t)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const r=e.checkboxColumn=new t({id:e.id+"-selection-column",width:"4em",minWidth:"4em",field:null,cellCls:"b-checkbox-selection",region:Object.keys(e.subGridConfigs).sort()[0],showCheckAll:e.selectionMode.showCheckAll},e.columns);r.meta.depth=0,r._grid=e;const n=r.renderer;r.renderer=t=>{t.value=e.isSelected(t.record),n.call(r,t)},r.on({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:e});const s=e.columns.indexOf(e.columns.findRecord("type","rownumber"))+1;e.columns.insert(s,r)}super.afterConfigure()}onStoreRecordIdChange({record:e,oldValue:t}){super.onStoreRecordIdChange&&super.onStoreRecordIdChange(...arguments);this.selectedRecordCollection.get(t)===e&&this.selectedRecordCollection.rebuildIndices()}onSelectedRecordCollectionChange({source:e,action:t,added:r=[],removed:n}){const s=this;s._selectedCell&&!s.isSelectable(s._selectedCell)&&s.deselectCell(s._selectedCell),r=r.filter(e=>s.isSelectable(e)),s.triggerChangeEvent({mode:"row",action:r.length?"select":"deselect",selection:s.selectedRecords,selected:r,deselected:n},s.silent)}onCheckChange({source:e,checked:t,record:r}){t?(this.selectRow({record:r,column:e,addToSelection:!1!==this.selectionMode.multiSelect,scrollIntoView:!1}),e.headerCheckbox&&this.selectedRecords.length===this.store.count-(this.store.groupRecords?this.store.groupRecords.length:0)&&(e.suspendEvents(),e.headerCheckbox.checked=!0,e.resumeEvents())):(this.deselectRow(r),e.headerCheckbox&&(e.suspendEvents(),e.headerCheckbox.checked=!1,e.resumeEvents()))}onCheckAllChange({checked:e}){this[e?"selectAll":"deselectAll"]()}onElementKeyDown(e){const t=this,{focusedCell:r,checkboxColumn:n}=t;if(super.onElementKeyDown(e),r&&" "===e.key&&n&&t.columns.getById(r.columnId)===n){const e=t.getCell(r).widget;e&&e.toggle()}}set selectedRecordCollection(e){e instanceof Fr||(e=new Fr(e)),this._selectedRecordCollection=e,e.on({change:"onSelectedRecordCollectionChange",thisObj:this})}get selectedRecordCollection(){return this._selectedRecordCollection}spliceSelectedRecords(e,t,r){this._selectedRecordCollection.splice(e,t,r)}isSelected(e){const t=this;return e instanceof Jn&&(e=e.id),Yl[typeof e]?t.selectedRecordCollection.includes(e):t._selectedCell&&t._selectedCell.id==e.id&&t._selectedCell.columnId===e.columnId}isSelectable(e){if(!e)return!1;const t=this.store.getById(e.id||e);return t&&!(t.meta&&t.meta.specialRow)}get selectedCell(){return this._selectedCell}set selectedCell(e){this.selectCell(e)}set selectionMode(e){e&&e.rowCheckboxSelection&&(e.row=e.checkbox=!0,e.cell=!1),this._selectionMode=e}get selectionMode(){return this._selectionMode}get selectedRecord(){return this.selectedRecordCollection.last||null}set selectedRecord(e){this.selectRow({record:e})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(e){const{selectedRecordCollection:t,store:r}=this,n=[];if(e)for(let t of e)t=r.getById(t),t&&n.push(t);t.splice(0,t.count,n)}get selectedCellCSSSelector(){const e=this._selectedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.dataIndex}] [data-column-id=${e.columnId}]`:""}selectRow({record:e,column:t=this.columns.bottomColumns[0],scrollIntoView:r=!0,addToSelection:n=!1}){if("object"!=typeof arguments[0]){const t=arguments;e=t[0],r=!(t.length>1)||t[1],n=t[2]||!1}const s=this,i=s.store.getById(e);e?s.selectCell({id:i.id,column:t},r,n):s.deselectAll()}selectCell(e,t=!1,r=!1,n=!1){const s=this,{selectedRecordCollection:i,selectionMode:o}=s,a=s.normalizeCellContext(e),l=a.record||s.store.getById(a.id);if(s.isSelectable(l)){if(t&&s.scrollRowIntoView(a.id,{column:a.columnId}),o.row&&(n&&(s.silent=(s.silent||0)+1),r?i.add(l):i.splice(0,i.count,l),n&&s.silent--,1===s.selectedRecordCollection.count&&(s.startCell=a,s.lastRange=null)),o.cell&&(a.columnId||a.column)&&!s.isSelected(a)){const e=s._selectedCell?[s._selectedCell]:[];s._selectedCell=a,s.triggerChangeEvent({mode:"cell",action:"select",selected:[a],deselected:e,selection:[a]},n)}return a}this.deselectAll()}selectAll(){const e=this;e.store.isFiltered?e.selectedRecordCollection.add(...e.store.records.filter(e=>!e.meta.specialRow)):e.selectedRecords=e.store.records.filter(e=>!e.meta.specialRow)}deselectAll(){const e=this;e.store.isFiltered?e.selectedRecordCollection.remove(...e.store.records.filter(e=>!e.meta.specialRow)):e.selectedRecordCollection.clear(),e._selectedCell&&e.deselectCell(e._selectedCell)}deselectRow(e){const t=e instanceof Jn?e:this.store.getById(e);t&&this.selectedRecordCollection.remove(t)}deselectCell(e){const t=this,r=t.normalizeCellContext(e),n=t.selectionMode,s=r.record||t.store.getById(r.id),i=t._selectedCell;return n.row&&t.selectedRecordCollection.remove(s),n.cell&&r.columnId&&i&&i.id===r.id&&i.columnId===r.columnId&&(t._selectedCell=null,t.triggerChangeEvent({mode:"cell",action:"deselect",selected:[],deselected:[r],selection:[]})),r}selectRange(e,t){const{store:r,selectedRecordCollection:n}=this,s=r.indexOf(e),i=r.indexOf(t),o=Math.min(s,i),a=Math.max(s,i);if(-1===o||-1===a)throw new Error("Record not found in selectRange");n.splice(0,n.count,r.getRange(o,a+1,!1))}onStoreRemove(e){super.onStoreRemove&&super.onStoreRemove(e),this.selectedRecordCollection.remove(e.records)}onStoreDataChange({action:e,source:t}){if(super.onStoreDataChange&&super.onStoreDataChange(...arguments),ql[e]){const e=this.selectedRecordCollection,r=[];e.forEach(n=>{if(t.includes(n)){const r=e.indexOf(n);e.splice(r,1,t.getById(n.id))}else r.push(n)}),e.remove(r)}}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(),this.deselectAll()}handleMouseMultiSelect(e,t){const r=this,n=e.id;(t.metaKey||t.ctrlKey)&&r.isSelected(n)?r.deselectRow(n):r.selectionMode.multiSelect&&(t.shiftKey&&r.startCell?function(e,t){const{store:n,selectedRecordCollection:s}=r,i=n.indexOf(e),o=n.indexOf(t),a=Math.min(i,o),l=Math.max(i,o);if(-1===a||-1===l)throw new Error("Record not found in selectRange");const c=n.getRange(a,l+1,!1).filter(e=>r.isSelectable(e));s.splice(0,r.lastRange||0,c),r.lastRange=c}(r.startCell.id,n):(t.ctrlKey||t.metaKey)&&r.selectRow({record:n,scrollIntoView:!1,addToSelection:!0}))}onCellNavigate(e,t,r,n,s=!0){if(e.columns.getById(r.columnId)===e.checkboxColumn||e.selectionMode.rowCheckboxSelection)return;if(!s||e.returningFocus||n&&n.target.closest(".b-tree-expander"))return;const i=t&&r.id===t.id,o=n&&"mousedown"===n.type&&n.ctrlKey;!n||n.button&&2!==n.button||!n.shiftKey&&!o?e.selectCell(r,!1,i&&(!n||n.shiftKey||n.ctrlKey)||n&&(o||2===n.button&&e.isSelected(r.id))):e.handleMouseMultiSelect(r,n),e.startCell&&!o||(e.startCell=r,e.lastRange=null)}triggerChangeEvent(e,t){const r=this,{mode:n,selected:s,deselected:i}=e;let o,a,l,c;if("row"===n){for(o=0,a=s.length;o<a;o++)l=r.getRowFor(s[o]),l&&(l.addCls("b-selected"),!r.checkboxColumn||r.checkboxColumn.hidden||s[o].meta.specialRow||(l.getCell(r.checkboxColumn.id).widget.checked=!0));for(o=0,a=i.length;o<a;o++)l=r.getRowFor(i[o]),l&&(l.removeCls("b-selected"),!r.checkboxColumn||r.checkboxColumn.hidden||i[o].meta.specialRow||(l.getCell(r.checkboxColumn.id).widget.checked=!1))}else if("cell"===n){for(o=0,a=s.length;o<a;o++)c=r.getCell(s[o]),c&&c.classList.add("b-selected");for(o=0,a=i.length;o<a;o++)c=r.getCell(i[o]),c&&c.classList.remove("b-selected")}t||r.trigger("selectionChange",e)}get widgetClass(){}};const Kl=e=>e.columns.suspendEvents(),Zl=e=>e.columns.resumeEvents(),Jl=e=>{e.columns.clearCaches(),e.columns.fillFromMaster()},Ql=(e,t)=>e.stateSortIndex-t.stateSortIndex;var ec=e=>class extends(e||B){getState(){const e=this,t=e.element.style.cssText,r={rowHeight:e.rowHeight,readOnly:e.readOnly};if(t&&(r.style=t),e.selectedCell){const{id:t,columnId:n}=e.selectedCell;r.selectedCell={id:t,columnId:n}}return r.selectedRecords=e.selectedRecords.map(e=>e.id),r.columns=e.columns.map(e=>e.getState()),r.store=e.store.state,r.scroll=e.storeScroll(),r.width={},r.collapsed={},e.eachSubGrid(e=>{null==e.flex&&(r.width[e.region]=e.width),r.collapsed[e.region]=e.collapsed}),r}applyState(e){const t=this;if("readOnly"in e&&(t.readOnly=e.readOnly),"rowHeight"in e&&(t.rowHeight=e.rowHeight),"style"in e&&(t.style=e.style),"selectedCell"in e&&(t.selectedCell=e.selectedCell),"store"in e&&(t.store.state=e.store),"selectedRecords"in e&&(t.selectedRecords=e.selectedRecords),"columns"in e){let r=!1,n=!1;t.columns.suspendEvents(),t.eachSubGrid(Kl),e.columns.forEach((e,s)=>{const i=t.columns.getById(e.id);if(i){const t=i.generation;i.applyState(e),r=r||i.generation!==t,i.stateSortIndex=s,i.allIndex!==s&&(n=r=!0)}}),r&&t.eachSubGrid(Jl),n&&(t.eachSubGrid(e=>{e.columns.records.sort(Ql),e.columns.allRecords.sort(Ql)}),t.columns.sort({fn:Ql,ascending:!0})),t.isPainted&&r&&t.renderContents(),t.columns.resumeEvents(),t.eachSubGrid(Zl)}"width"in e&&t.eachSubGrid(t=>{t.region in e.width&&(t.width=e.width[t.region])}),"collapsed"in e&&t.eachSubGrid(t=>{t.collapsed=e.collapsed[t.region]}),"scroll"in e&&t.restoreScroll(e.scroll)}get widgetClass(){}};const tc=new Promise(e=>e()),rc={block:"nearest"};class nc extends _r{scrollIntoView(e,t=rc){const{xDelta:r,yDelta:n}=this.getDeltaTo(e,t),s=r||n?this.scrollBy(r,n,t):tc;return(t.highlight||t.focus)&&s.then(()=>{t.highlight&&(e instanceof Xt?e.translate(-r,-n).highlight():Et.highlight(e)),t.focus&&e.focus&&e.focus()}),s}scrollBy(e,t,r){const n=t&&this.yScroller.scrollBy(0,t,r),s=e&&super.scrollBy(e,0,r);if(s&&s.cancel&&n&&n.cancel){const e=s.cancel,t=n.cancel;return s.cancel=n.cancel=()=>{e(),t()},Promise.all([s,n])}return s||n}scrollTo(e,t,r){const n=null!=t&&this.yScroller.scrollTo(null,t,r),s=null!=e&&super.scrollTo(e,null,r);if(r&&r.animate||this.syncPartners(),s&&s.cancel&&n&&n.cancel){const e=s.cancel,t=n.cancel;return s.cancel=n.cancel=()=>{e(),t()},Promise.all([s,n])}return s||n}get viewport(){return Xt.from(this.element).intersect(Xt.from(this.yScroller.element))}set y(e){this.yScroller&&(this.yScroller.y=e)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}}nc._$name="SubGridScroller";class sc extends Vr{static get $name(){return"SubGrid"}static get defaultConfig(){return{localizableProperties:["emptyText"],insertRowsBefore:null,appendTo:null,hideHeaders:null,monitorResize:!0,collapsed:null,scrollable:{overflowX:!0},scrollerClass:nc,hasCalculatedWidth:null,sealedColumns:null,emptyText:null}}construct(e){super.construct(e),this.initHeader(),this.rowManager.on("addrows",this.onAddRow,this)}doDestroy(){const e=this;e.header&&e.header.destroy(),e.footer&&e.footer.destroy(),e.fakeScroller&&e.fakeScroller.destroy(),e.virtualScrollerElement&&e.virtualScrollerElement.remove(),e.splitterElement&&e.splitterElement.remove(),super.doDestroy()}initHeader(){const e=this,t=e.element.style,r=t.width,n=t.flex,s=Object.assign({subGrid:e,hidden:e.hideHeaders,parent:e},e.headerConfig);n?s.flex=n:r&&(s.width=r),e.header=new e.headerClass(s)}initElements(){this.footerElement=Et.down(this.grid.element,".b-grid-footer-scroller-"+this.region),this.updateHasFlex()}toggleSplitterCls(e,t=!0){[this.splitterElement,this.headerSplitter,this.footerSplitter,this.scrollerSplitter].forEach(r=>r&&r.classList[t?"add":"remove"](e))}template(){const{grid:e,region:t}=this,r=!e||t===e.regions[e.regions.length-1];return Cn.tpl`
            <div class="b-grid-subgrid b-grid-subgrid-${t} b-grid-horizontal-scroller ${this.collapsed?"b-grid-subgrid-collapsed":""}" data-region="${t}">
                <div reference="virtualScrollerElement" class="b-virtual-scroller" data-region="${t}">
                    <div reference="virtualScrollerWidth" class="b-virtual-width"></div>
                </div>
                ${r?"":Cn.tpl`
                <div reference="splitterElement" data-region="${t}" class="b-grid-splitter ${this.collapsed?"b-grid-splitter-collapsed":""}">
                    <div class="b-grid-splitter-inner b-grid-splitter-main">
                        <div class="b-grid-splitter-buttons" reference="splitterButtons">
                            <i class="b-icon b-icon-collapse-gridregion"></i>
                            <i class="b-icon b-icon-expand-gridregion"></i>
                        </div>
                    </div>
                </div>`}
            </div>
        `}rowTemplate(){return`<div class="b-grid-row">${this.columns.visibleColumns.map(this.cellTemplate).join("")}</div>`}cellTemplate(e){return`<div class="b-grid-cell" data-column="${e.field||""}" data-column-id="${e.id}"></div>`}render(){const e=this,{grid:t,region:r}=e,n=[{className:"b-grid-splitter-inner"}],s={region:r};if(t&&(t.virtualScrollers.appendChild(e.virtualScrollerElement),e.renderHeader(t.headerContainer),e.renderFooter(t.footerContainer),e.initElements()),super.render(...arguments),e.splitterElement){const t=e.splitterElement.className.trim();e.element.parentNode.insertBefore(e.splitterElement,e.element.nextElementSibling),e.header&&(e.headerSplitter=Et.createElement({className:t,children:n,dataset:s,parent:e.header.element.parentNode,nextSibling:e.header.element.nextSibling}),gr.on({element:e.headerSplitter,mouseenter:"onSplitterMouseOver",mouseleave:"onSplitterMouseOut",thisObj:e})),e.footer&&(e.footerSplitter=Et.createElement({className:t,children:n,dataset:s,parent:e.footer.element.parentNode,nextSibling:e.footer.element.nextSibling}),gr.on({element:e.footerSplitter,mouseenter:"onSplitterMouseOver",mouseleave:"onSplitterMouseOut",thisObj:e})),e.scrollerSplitter=Et.createElement({className:t+" b-splitter-scroller",children:n,dataset:s,parent:e.virtualScrollerElement.parentNode,nextSibling:e.virtualScrollerElement.nextSibling}),gr.on({element:e.splitterElement,mouseenter:"onSplitterMouseOver",mouseleave:"onSplitterMouseOut",thisObj:e})}e._collapsed&&e.collapse()}renderHeader(e){this.header&&this.header.render(e,!1)}renderFooter(e){this.footer&&(this.footer.render(e,!1),this.grid.footerContainer.classList.remove("b-hidden"))}refreshHeader(){this.header.refreshContent()}refreshFooter(){this.footer&&this.footer.refreshContent()}eachWidget(e,t=!0){const r=this,n=[];r.header&&n.unshift(r.header),r.footer&&n.push(r.footer);for(let r=0;r<n.length;r++){const s=n[r];if(!1===e(s))return;t&&s.eachWidget&&s.eachWidget(e,t)}}fixCellWidths(e,t=null){t||(t=this.columns.bottomColumns.filter(e=>!e.hidden));let r=e.firstElementChild,n=0;for(;r;){const e=t[n];e.minWidth&&Et.setLength(r,"minWidth",e.minWidth),e.flex?(r.style.flex=e.flex,r.style.width=""):e.width?(r.style.flex="",r.style.width=Et.setLength(e.width),P.isIE11&&(r.style.minWidth=r.style.width)):r.style.flex=r.style.width=r.style.minWidth="",r=r.nextElementSibling,n++}}get totalFixedWidth(){return this.columns.totalFixedWidth}fixWidths(){const e=this,{element:t,header:r,footer:n}=e;if(!e.collapsed){if(e.flex)r.flex=e.flex,n&&(n.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some(e=>!e.hidden&&e.flex)&&e.totalFixedWidth!==e.width)return e.width=e.totalFixedWidth,void(e.hasCalculatedWidth=!0);let s=e.width;if(!s){s=0;for(const t of e.columns)t.flex||t.hidden||(s+=t.width)}t.style.width=s+"px",r.width=s,n&&(n.width=s)}e.syncScrollingPartners(!1)}}fixRowWidthsInSafariEdge(){if(P.isSafari||P.isEdge){const e=this,{region:t,header:r}=e,n=r.calculateMinWidthForSafari();e.rowManager.forEach(e=>{const r=e.getElement(t);r&&(r.style.width=n+"px")}),r.headersElement.style.width=n+"px"}}set width(e){const t=this;t.hasCalculatedWidth=!1,super.width=e,t.header&&(t.header.width=e),t.footer&&(t.footer.width=e),t.isPainted&&t.onElementResize()}get width(){return super.width}set flex(e){const t=this;t.hasCalculatedWidth=!1,t.header&&(t.header.flex=e),t.footer&&(t.footer.flex=e),super.flex=e,t.isPainted&&t.onElementResize()}get flex(){return super.flex}onInternalResize(e,t,r,n,s){const i=this,{grid:o}=i;super.onInternalResize(e,t,r,n,s),i.splitterElement&&i.syncSplitterButtonPosition(),o&&(t!==n&&(o.trigger("horizontalScroll",{subGrid:i,grid:o,scrollLeft:i.scrollable.x}),i.refreshFakeScroll(),i.fixRowWidthsInSafariEdge()),i.trigger("afterInternalResize",i))}syncParallelSplitters(e){const t=this,{grid:r}=t;if(t.splitterElement)t.toggleSplitterCls("b-grid-splitter-collapsed",e);else{const n=r.getSubGrid(r.getPreviousRegion(t.region));n&&n.splitterElement&&n.syncParallelSplitters(e)}}onSplitterMouseOver(){const e=this,{nextSibling:t}=e;e.collapsed||t&&t.collapsed||e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}onSplitterMouseOut(){const e=this,{nextSibling:t}=e;e.toggleSplitterCls("b-hover",!1),e.collapsed||t&&t.collapsed||e.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.on({scroll:"syncSplitterButtonPosition",thisObj:e})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){this.splitterButtons.style.transform=`translateY(${this.grid.scrollable.y+this.grid.bodyHeight/2-(this.headerSplitter?this.grid.headerHeight:0)}px)`}get viewRectangle(){return new Xt(this.scrollable.x,this.scrollable.y,this._width||0,this.rowManager.viewHeight)}updateHasFlex(){const e=this.columns.visibleColumns.some(e=>e.flex);Et.toggleClasses(this.element,["b-has-flex"],e)}refreshFakeScroll(){const e=this,{element:t,virtualScrollerElement:r,virtualScrollerWidth:n,totalFixedWidth:s,store:i}=e,o=e.scrollable;o.scrollWidth=i&&i.count?null:s,r.style.width=t.offsetWidth+"px",s>o.clientWidth?t.classList.add("b-overflowing-horizontally"):t.classList.remove("b-overflowing-horizontally"),e.collapsed||(o.scrollWidth>o.clientWidth+(P.isEdge?1:0)?(n.style.width=o.scrollWidth+"px",e.header.element.classList.add("b-overflowing"),e.footer&&e.footer.element.classList.add("b-overflowing"),e.overflowingHorizontally=!0,e.grid.virtualScrollers.classList.remove("b-hide-display")):(n.style.width=0,e.header.element.classList.remove("b-overflowing"),e.footer&&e.footer.element.classList.remove("b-overflowing"),e.overflowingHorizontally=!1))}initScroll(){const e=this,t=e.scrollable,r=e.virtualScrollerElement;e.syncPartnersOnFrame=e.createOnFrame(e.syncScrollingPartners),P.isFirefox&&t.element.addEventListener("wheel",e=>{e.deltaX&&(t.x+=e.deltaX,e.preventDefault())}),t.yScroller=e.grid.scrollable,t.yScroller.addScroller(t),e.fakeScroller=new _r({element:r,overflowX:!0}),t.on({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),t.addPartner(e.fakeScroller,"x"),e.header&&t.addPartner(e.header.scrollable,"x"),e.footer&&t.addPartner(e.footer.scrollable,"x")}onSubGridScrollEnd(){this.forceScrollUpdate||this.syncScrollingPartners(),this.scrolling=!1}onSubGridScroll(){this.forceScrollUpdate?(this.syncScrollingPartners(),this.forceScrollUpdate=!1):this.syncPartnersOnFrame()}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}syncScrollingPartners(e=!0){const t=this,{grid:r}=t;!t.scrolling&&e&&(t.scrolling=!0),r.trigger("horizontalScroll",{subGrid:t,grid:r,scrollLeft:t.scrollable.x})}scrollColumnIntoView(e,t){const r=this,n=r.header.scrollable;if(e=e instanceof Da?e:r.columns.get(e)||r.columns.getById(e)||r.columns.getAt(e)){const s=r.header.getHeader(e.id);if(s)return n.scrollIntoView(Xt.from(s,null,!0),t)}}onAddRow({rows:e}){const t=this,r=t.rowTemplate(),n=t.columns.bottomColumns.filter(e=>!e.hidden),s=document.createDocumentFragment();e.forEach(e=>{const i=Et.createElementFromTemplate(r);s.appendChild(i),e.addElement(t.region,i),t.fixCellWidths(i,n)}),t.fixRowWidthsInSafariEdge(),t.element.insertBefore(s,t.insertRowsBefore)}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}addNewRowElement(){const e=Et.append(this.element,this.rowTemplate());return this.fixCellWidths(e),e}get emptyText(){return this._emptyText}set emptyText(e){this._emptyText=e,this.element.dataset.emptyText=e}toggleTransitionClasses(e=!1){const t=this.grid,r=t.getSubGrid(t.getNextRegion(this.region)),n=t.resolveSplitter(r);r.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),this.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),this.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),n.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){const e=this,t=e.grid,r=t.getSubGrid(t.getNextRegion(e.region)),n=e.splitterElement?e:e.previousSibling;let s=0;return t.eachSubGrid(t=>{t!==e&&!t._collapsed&&++s}),0===s&&await r.expand(),new Promise(t=>{if(!e._beforeCollapseState){e._beforeCollapseState={};let n=!1;e.width&&(n=!0,e.on({afterinternalresize:()=>{t(e)},thisObj:e,once:!0})),e._beforeCollapseState.width=e.width,e._beforeCollapseState.elementWidth=e.element.style.width,""===r.element.style.flex&&(e._beforeCollapseState.nextRegionWidth=r.width,r.width+=e._beforeCollapseState.width),""!==e.element.style.flex&&(e._beforeCollapseState.flex=e.element.style.flex,e.header.element.style.flex=e.element.style.flex=""),e.element.classList.add("b-grid-subgrid-collapsed"),e.virtualScrollerElement.classList.add("b-collapsed"),e.header.element.classList.add("b-collapsed"),e.footer&&e.footer.element.classList.add("b-collapsed"),e.width="",e._collapsed=!0,n||t(!1)}}).then(t=>{e.isDestroyed||!1===t||(e.syncParallelSplitters(!0),e.grid.trigger("subGridCollapse",e),n.startSplitterButtonSyncing&&n.startSplitterButtonSyncing())})}async expand(){const e=this,t=e.grid,r=t.getSubGrid(t.getNextRegion(e.region)),n=e.splitterElement?e:e.previousSibling;return new Promise(t=>{if(null!=e._beforeCollapseState){let n=!1;e.width!==e._beforeCollapseState.elementWidth&&(n=!0,e.on({afterinternalresize:()=>{e.setTimeout(()=>t(e),10)},thisObj:e,once:!0})),""===r.element.style.flex&&(r.width=e._beforeCollapseState.nextRegionWidth),e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,e.virtualScrollerElement.classList.remove("b-collapsed"),e.header.element.classList.remove("b-collapsed"),e.footer&&e.footer.element.classList.remove("b-collapsed"),e._beforeCollapseState.flex?(e.width=e._beforeCollapseState.width,e.header.flex=e.flex=e._beforeCollapseState.flex,e.footer&&(e.footer.flex=e._beforeCollapseState.flex),e._width=null):e.width=e._beforeCollapseState.elementWidth,e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,n||t(!1),delete e._beforeCollapseState}}).then(t=>{!1!==t&&(n.stopSplitterButtonSyncing(),e.syncParallelSplitters(!1),e.grid.trigger("subGridExpand",e))})}}sc._$name="SubGrid";var ic=e=>class extends(e||B){initSubGrids(){const e=this,t=e._regions,r=new Set;let n,s,i,o=!0;for(const t of e.columns.records)t.region&&!e.subGridConfigs[t.region]&&(e.subGridConfigs[t.region]={}),r.add(t.region);t&&t.forEach(t=>e.subGrids[t].destroy()),e.subGrids={},e._regions=Array.from(r),e._regions.sort(),e.subGridConfigs.normal&&0===Object.keys(e.subGridConfigs.normal).length&&(e.subGridConfigs.normal=dc.defaultConfig.subGridConfigs.normal);for(const t of e._regions)i=e.columns.makeChained(e=>e.region===t,["region"]),s=ze.assign({parent:e,grid:e,store:e.store,rowManager:e.rowManager,region:t,headerClass:e.subGridConfigs[t].headerClass||e.headerClass,columns:i,hideHeaders:e.hideHeaders},e.subGridConfigs[t]),n=!1,s.flex||s.width||(s.width=i.totalFixedWidth,n=!0),e.subGrids[t]=new sc(s),e.subGrids[t].hasCalculatedWidth=n,o&&(e.subGrids[t].isFirstRegion=!0,o=!1)}doDestroy(){this.eachSubGrid(e=>e.destroy()),super.doDestroy()}get items(){return this.regions.map(e=>this.subGrids[e])}eachSubGrid(e,t=null){const r=this;r.regions.forEach((n,s)=>{const i=r.subGrids[n];e.call(t||i,i,s++)})}eachWidget(e,t=!0){const r=this;r.regions.forEach(n=>{const s=r.subGrids[n];!1!==e(s)&&t&&s.eachWidget&&s.eachWidget(e,t)})}callEachSubGrid(e,...t){let r=this,n=null;return r.regions.forEach((s,i)=>{const o=r.subGrids[s];if(o[e]){const r=o[e](...t);0===i&&(n=r)}}),n}getLastRegions(){const e=this.regions.slice(-2);return 2===e.length?e:[e[0],e[0]]}getNextRegion(e){const t=this.regions;return t[t.indexOf(e)+1]||t[t.length-2]}getPreviousRegion(e){return this.regions[this.regions.indexOf(e)-1]}getSubGrid(e){return this.subGrids[e]}getSubGridFromColumn(e){return e=e instanceof Da?e:this.columns.get(e)||this.columns.getById(e),this.getSubGrid(e.region)}get regions(){return this._regions||this.initSubGrids(),this._regions}resolveSplitter(e){const t=this.getLastRegions();let r=e instanceof sc?e.region:e;return t[1]===r&&(r=t[0]),this.subGrids[r].splitterElement}get widgetClass(){}};const oc=te.mergeLocales($r,{ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",unknownFailure:"Unknown error",networkFailure:"Network error",parseFailure:"Failed to parse server response",loadMask:"Loading...",syncMask:"Saving changes, please wait...",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",removeRow:"Delete record",removeRows:"Delete records",moveColumnTo:e=>"Move column to "+e},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages..."},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`}});ne.registerLocale("En",{desc:"English",locale:oc});const ac=new Promise(e=>e()),lc={block:"nearest",inline:"nearest"},cc={dataset:1,filter:1};class dc extends(Qn(un).mixes(Bn,zn,Nl,zl,Gl,Ul,Xl,ec,ic)){static get $name(){return"GridBase"}static get defaultConfig(){return{rowHeight:null,fixedRowHeight:null,defaultRowHeight:45,emptyText:"L{noRows}",fullRowRefresh:!0,readOnly:null,hideHeaders:null,showRemoveRowInContextMenu:!0,autoHeight:null,store:{},data:null,columns:[],defaultRegion:"normal",destroyStore:null,enableTextSelection:null,loadMask:"L{loadMask}",syncMask:"L{syncMask}",columnLines:!0,fillLastColumn:!0,resizeToFitIncludesHeader:!0,animateRemovingRows:!P.isIE11,disableGridRowModelWarning:null,loadMaskErrorIcon:"b-icon b-icon-warning",headerClass:jl,testPerformance:!1,positionMode:"translate",rowScrollMode:"move",monitorResize:!0,features:!0,subGridConfigs:{normal:{flex:1}},scrollable:{overflowY:!0},scrollerClass:$l,scrollManager:null,showDirty:null,loadMaskHideTimeout:3e3,transitionDurationTimeout:500,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText","loadMask","syncMask"]}}static getLKey(){return"8fc784b3-3eb2-11ea-86f5-d094663d5c88"}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}finishConfigure(e){const t=this;super.finishConfigure(e),t.scrollManager=new Pl(ze.assign({grid:t,verticalElement:t.scrollable.element},t.scrollManager)),ne.on({locale:"onBeforeLocaleChange",prio:1,thisObj:t}),ne.on({locale:"onLocaleChange",prio:-1,thisObj:t}),Yr.on({theme:"onThemeChange",thisObj:t}),t.on({subGridExpand:"onSubGridExpand",prio:-1,thisObj:t}),t.bufferedFixElementHeights=t.buffer("fixElementHeights",350,t),t.setGridClassList(t.element.classList)}onSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}doDestroy(){const e=this;for(const t of Object.values(e.features))t.destroy&&t.destroy();e.columns&&(e.columns=null),e.store&&(e.store=null),super.doDestroy()}setGridClassList(e){const t=this;e.add("b-grid-"+t.positionMode),t.enableTextSelection||e.add("b-grid-notextselection"),t.autoHeight&&e.add("b-autoheight"),t.readOnly&&e.add("b-readonly"),t.fillLastColumn&&e.add("b-fill-last-column"),t.showDirty&&e.add("b-show-dirty");for(const r in t.features){const n=t.features[r];let s;s=Object.prototype.hasOwnProperty.call(n.constructor,"featureClass")?n.constructor.featureClass:"b-"+(n instanceof B?n.$name:n.constructor.name),s&&e.add(s.toLowerCase())}}template(e){const t=P.isFirefox?`style="height:${Et.scrollBarWidth}px"`:"";return Cn.tpl`
            <div>
                <header reference="headerContainer" class="b-grid-header-container ${this.hideHeaders?"b-hidden":""}"></header>
                <div reference="bodyContainer" class="b-grid-body-container" tabIndex="-1">
                    <div reference="verticalScroller" class="b-grid-vertical-scroller"></div>
                </div>
                <div reference="virtualScrollers" class="b-virtual-scrollers ${Et.scrollBarWidth?"":"b-overlay-scrollbar"}" ${t}></div>
                <footer reference="footerContainer" class="b-grid-footer-container b-hidden"></footer>
            </div>
        `}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}get focusElement(){return this.bodyContainer}set columns(e){const t=this;var r,n;t._columnStore?e?t._columnStore.data=e:t._columnStore.destroy():(e instanceof Ea?(e.grid||(e.grid=t),t._columnStore=e):Array.isArray(e)?t._columnStore=new Ea({grid:t,data:e}):e&&(t._columnStore=new Ea(Object.assign({grid:t},e))),t._columnStore.on("change",t.onColumnsChanged,t),t._columnStore.on((r=t.onColumnsResized,n=t,{update:({store:e,record:t,changes:s})=>{let i=!0;return("width"in s||"minWidth"in s||"flex"in s)&&(i=r.call(n,{store:e,record:t,changes:s})),i}})),P.isTouchDevice&&(t.touch=!0,t._columnStore.forEach(e=>{const t=e.touchConfig;t&&e.applyState(t)})))}get columns(){return this._columnStore}onColumnsChanged({action:e,changes:t,record:r}){const n=this;if(n.isPainted){if("update"===e){if("width"in t||"minWidth"in t||"flex"in t){if(n.isPainted){const e=r.region;n.columns.visibleColumns.forEach(t=>{t.region===e&&t.repaintOnResize&&n.refreshColumn(t)})}return}if("hidden"in t){const e=n.getSubGridFromColumn(r.id);e.header.fixHeaderWidths(),e.footer&&e.footer.fixFooterWidths(),e.updateHasFlex()}}("dataset"===e||t&&"region"in t&&!n.regions.includes(t.region.value))&&(n.initSubGrids(),n.eachSubGrid(e=>{e.render(n.verticalScroller),e.initScroll()})),n._suspendRenderContentsOnColumnsChanged||n.renderContents()}}onColumnsResized({changes:e,record:t}){const r=this,n=e.width&&null==t.flex,s=e.minWidth&&null==t.flex,i=e.flex&&null==t.width,o=Et.setLength(t.width),a=Et.setLength(t.minWidth),l=r.getSubGridFromColumn(t.id);l.header.fixHeaderWidths(),l.footer&&l.footer.fixFooterWidths(),l.updateHasFlex(),r.cellEls&&t===r.lastColumnResized||(r.cellEls=Et.children(r.element,`.b-grid-cell[data-column-id=${t.id}]`),r.lastColumnResized=t);for(const e of r.cellEls)n?(e.style.width=o,e.style.flex="",P.isIE11&&(e.style.minWidth=o)):s?e.style.minWidth=a:i?(e.style.flex=t.flex,e.style.width=""):e.style.flex=e.style.width=e.style.minWidth="";r.dragResizing||r.afterColumnsResized()}afterColumnsResized(){const e=this;e.refreshVirtualScrollbars(),e.eachSubGrid(e=>{e.collapsed||(e.fixWidths(),e.fixRowWidthsInSafariEdge(),e.refreshFakeScroll())}),e.onHeightChange(),e.lastColumnResized=e.cellEls=null}processCellEditor(e){}get rowManager(){const e=this;return e._isRowMeasured||e.measureRowHeight(),e._rowManager||(e._rowManager=new Ol({grid:e,rowHeight:e.rowHeight,rowScrollMode:e.rowScrollMode||"move",autoHeight:e.autoHeight,fixedRowHeight:e.fixedRowHeight,listeners:{changetotalheight:e.onRowManagerChangeTotalHeight,requestscrollchange:e.onRowManagerRequestScrollChange,thisObj:e}}))}getRowHeight(e){return e.rowHeight}bindStore(e){const t=this;e&&e.on({name:"store",refresh:t.onStoreDataChange,idChange:t.onStoreRecordIdChange,update:t.onStoreUpdateRecord,add:t.onStoreAdd,remove:t.onStoreRemove,move:t.onStoreMove,replace:t.onStoreReplace,removeall:t.onStoreRemoveAll,beforerequest:t.onStoreBeforeRequest,afterrequest:t.onStoreAfterRequest,clearchanges:t.onStoreDataChange,exception:t.onStoreException,commit:t.onStoreCommit,thisObj:t})}get store(){return this._store}set store(e){const t=this,{rowManager:r}=t,n=t.initialConfig.features;if(e!==t._store)if(t.detachListeners("store"),e){if(e instanceof Cs);else{const r={};t.data&&(r.data=t.data),n&&n.tree&&(r.tree=!0),e.modelClass||(r.modelClass=class extends ja{}),e=new(e.readUrl?Ds:Cs)(Object.assign(r,e))}t._store=e,t.bindStore(e),t.isPainted&&r.reinitialize()}else t.destroyStore&&t._store.destroy(),t._store=null}onStoreUpdateRecord({source:e,record:t,changes:r}){const n=this;if(n.forceFullRefresh)n.rowManager.refresh(),n.forceFullRefresh=!1;else{let s;if(t.isFieldModified("id")&&(s=n.getRowFor(t.meta.modified.id)),s=s||n.getRowFor(t),!s)return;if(n.fullRowRefresh||t.meta.specialRow){const r=e.indexOf(t);-1!==r&&s.render(r,t)}else n.columns.visibleColumns.forEach(e=>{const n=e.field;if(!(e.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(e.data,"renderer"))||r[n]){const e=s.getCell(n);e&&s.renderCell(e,t)}})}}refreshFromRowOnStoreAdd(e){const t=this,{rowManager:r}=t;r.renderFromRow(e),r.trigger("changeTotalHeight",{totalHeight:r.totalHeight}),1===t.store.count&&t.callEachSubGrid("refreshFakeScroll")}onStoreAdd({source:e,records:t,index:r,oldIndex:n,isChild:s,oldParent:i,isMove:o,isExpandAll:a}){if(!this.isPainted||a)return;if(s&&!t[0].ancestorsExpanded(e))return;this.rowManager.calculateRowCount(!1,!0,!0);const l=this,{rowManager:c}=l,{topIndex:d,rows:u,rowCount:h}=c,g=c.topIndex+c.rowCount-1,m=r,p=r+t.length-1,f=g>=e.count-t.length-1;i||n>-1||s&&o?c.refresh():m>=d&&m<d+h?l.refreshFromRowOnStoreAdd(u[m-d],...arguments):p>=d&&p<d+h?c.refresh():(f&&r>g&&c.fillBelow(l._scrollTop),c.trigger("changeTotalHeight",{totalHeight:c.totalHeight}))}onStoreException({action:e,type:t,response:r,exceptionType:n,error:s}){const i=this;if(i.activeMask){let o;switch(t){case"server":o=r.message||i.L("L{unspecifiedFailure}");break;case"exception":o="network"===n?i.L("L{networkFailure}"):s&&s.message||i.L("L{parseFailure}");break;default:o=r.status&&r.statusText?`${r.status} - ${r.statusText}`:i.L("L{unknownFailure}")}i.activeMask.icon=i.loadMaskErrorIcon,i.activeMask.text=`<div class="b-grid-load-failure">\n                <div class="b-grid-load-fail">${"read"===e?i.L("L{loadFailedMessage}"):i.L("L{syncFailedMessage}")}</div>\n                ${r&&r.url?`<div class="b-grid-load-fail">${r.url}</div>`:""}\n                ${o?`<div class="b-grid-load-fail">${o}</div>`:""}\n            </div>`,i.loadmaskHideTimer=i.setTimeout(()=>{i.unmaskBody()},i.loadMaskHideTimeout)}}onStoreDataChange({action:e,changes:t,source:r}){super.onStoreDataChange&&super.onStoreDataChange(...arguments);const n=this,s=r.isGrouped&&t&&r.groupers.some(e=>e.field in t);"dataset"===e&&n.rowManager.clearKnownHeights(),n.isPainted&&!s&&n.renderRows(null,cc[e]),n.toggleEmptyText()}onStoreRecordIdChange(){super.onStoreRecordIdChange&&super.onStoreRecordIdChange(...arguments)}onStoreBeforeRequest(){this.loadMask&&this.maskBody(this.loadMask)}onStoreAfterRequest(){this.activeMask&&!this.loadmaskHideTimer&&(this.unmaskBody(),this.toggleEmptyText())}onStoreRemove({records:e,isCollapse:t,isChild:r,isMove:n,isCollapseAll:s}){if(!this.isPainted||n||s)return;super.onStoreRemove&&super.onStoreRemove(...arguments);const i=this,{rowManager:o}=i,a=e.reduce((e,t)=>{const r=o.getRowById(t.id);return r&&e.push(r),e},[]);if(o.invalidateKnownHeight(e),i.animateRemovingRows&&a.length&&!t&&!r){const e=a[0];i.isAnimating=!0,gr.onTransitionEnd({element:e._elementsArray[0],property:"left",timeout:i.transitionDurationTimeout,thisObj:i,handler(){i.isAnimating=!1,a.forEach(e=>!e.isDestroyed&&e.removeCls("b-removing")),o.refresh(),i.trigger("rowRemove")}}),a.forEach(e=>e.addCls("b-removing"))}else o.refresh(),i.trigger("rowRemove",{isCollapse:t})}onStoreMove({from:e,to:t}){const{rowManager:r}=this,{topIndex:n,rowCount:s}=r,[i,o]=[e,t].sort();i>=n&&i<n+s?r.renderFromRow(r.rows[i-n]):o>=n&&o<n+s&&r.refresh()}onStoreReplace({records:e,all:t}){const{rowManager:r}=this;if(t)r.clearKnownHeights(),r.refresh();else{const t=e.reduce((e,[,t])=>{const r=this.getRowFor(t);return r&&e.push(r),e},[]);r.invalidateKnownHeight(e),r.renderRows(t)}}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(),this.toggleEmptyText())}onStoreCommit({changes:e}){if(this.showDirty&&e.modified.length){const t=[];e.modified.forEach(e=>{const r=this.rowManager.getRowFor(e);r&&t.push(r)}),this.rowManager.renderRows(t)}}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}get emptyText(){return this._emptyText}set emptyText(e){this._emptyText=e,this.eachSubGrid(t=>t.emptyText=e)}getHeaderMenuItems(e,t){const r=this,{subGrids:n,regions:s}=r;let i=!0;Object.entries(n).forEach(([o,a])=>{if(!a.sealedColumns&&e.draggable&&o!==e.region&&(!e.parent&&n[e.region].columns.count>1||e.parent&&e.parent.children.length>1)){const l=a.element.compareDocumentPosition(n[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,c=s.length>2?r.L("L{moveColumnTo}",r.L(o)):r.L(l?"L{moveColumnRight}":"L{moveColumnLeft}");t.push({targetSubGrid:o,text:c,icon:"b-fw-icon "+(l?"b-icon-column-move-right":"b-icon-column-move-left"),name:"moveColumn",cls:i?"b-separator":"",onItem:({item:e})=>{const{column:t}=e;t.traverse(e=>e.region=o),r.columns.insert(r.columns.indexOf(n[e.targetSubGrid].columns.last)+1,t),r.scrollColumnIntoView(t)}}),i=!1}})}getCellMenuItems(e,t,r){const n=this;n.showRemoveRowInContextMenu&&!n.readOnly&&t&&!t.meta.specialRow&&(n.selectedRecords.length>1?r.push({text:"L{removeRows}",localeClass:this,icon:"b-fw-icon b-icon-trash",name:"removeRows",onItem:()=>n.store.remove(n.selectedRecords)}):r.push({text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",name:"removeRow",onItem:()=>n.store.remove(t)}))}getColumnDragToolbarItems(e,t){return t}normalizeCellContext(e){const{columns:t,store:r}=this;if(e instanceof r.modelClass)return{record:e,id:e.id,columnId:t.bottomColumns[0].id};if(!("columnId"in e)){if("field"in e){const r=t.get(e.field);e.columnId=r&&r.id}else if("column"in e){const r="number"==typeof e.column?t.bottomColumns[e.column]:e.column;e.columnId=r&&r.id}"columnId"in e||(e.columnId=t.bottomColumns[0].id)}if("id"in e){if(e.element&&!r.getById(e.id)){const t=this.getRecordFromElement(e.element);t&&(e.id=t.id)}}else"row"in e?e.id=r.getAt(e.row).id:"record"in e&&(e.id=e.record.id);return e}getCell(e){let t,r=null;return"id"in(e=this.normalizeCellContext(e))&&(t=this.getRowById(e.id)),t&&"columnId"in e&&(r=t.getCell(e.columnId)),r}getHeaderElement(e){return"string"!=typeof e&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getHeaderElementByField(e){const t=this.columns.get(e);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}getRecordFromElement(e){const t=e.closest(".b-grid-row");return t?this.store.getAt(t.dataset.index):null}getColumnFromElement(e){const t=Et.up(e,".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const r=ei.get(t);return this.columns.getById(r.columnId)}get autoHeight(){return this._autoHeight}set autoHeight(e){ze.assertBoolean(e,"autoHeight"),this._autoHeight=e}get columnLines(){return this._columnLines}set columnLines(e){ze.assertBoolean(e,"columnLines"),Et.toggleClasses(this.element,"b-no-column-lines",!e),this._columnLines=e}set readOnly(e){const t=this;t._readOnly=e,t.isPainted&&(t.trigger("readOnly",{readOnly:e}),e?t.element.classList.add("b-readonly"):t.element.classList.remove("b-readonly"))}get readOnly(){return this._readOnly}fixSizes(){this.callEachSubGrid("fixWidths")}onRowManagerChangeTotalHeight({totalHeight:e,immediate:t}){return this.refreshTotalHeight(e,t)}refreshTotalHeight(e=this.rowManager.totalHeight,t=!1){const r=this;if(r.renderingRows||!r.isVisible)return!1;r.rowManager.bottomRow&&(e=Math.max(e,r.rowManager.bottomRow.bottom));const n=r.scrollable,s=Math.abs(r.virtualScrollHeight-e),i=r._bodyRectangle.height;if(s){const o=e-i-r._scrollTop<2*i||r._verticalScrollHeight&&r._verticalScrollHeight-i<r._scrollTop;n.scrollHeight=r.virtualScrollHeight=e,r.isPainted&&(r.scrolling&&!o||s<100)&&!t?r.bufferedFixElementHeights():(r.virtualScrollHeightDirty&&r.virtualScrollHeightDirty(),r.bufferedFixElementHeights.cancel(),r.fixElementHeights())}}fixElementHeights(){const e=this,t=e.virtualScrollHeight,r=t+"px";e._verticalScrollHeight=t,e.verticalScroller.style.height=r,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=r,e._bodyHeight=t,e._bodyRectangle=Xt.client(e.bodyContainer)),e.refreshVirtualScrollbars()}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(e){"string"==typeof e&&(e=this.subGrids[e]),this.scrollManager.startMonitoring({element:e.element})}disableScrollingCloseToEdges(e){"string"==typeof e&&(e=this.subGrids[e]),this.scrollManager.stopMonitoring(e.element)}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this;if(!e.scrollInitialized){let t;const r=e.createOnFrame(()=>{t=e.scrollable.y,t!==e._scrollTop&&(e._scrollTop=t,e.scrolling||(e.scrolling=!0,e.eachSubGrid(e=>e.suspendResizeMonitor=!0)),e.rowManager.updateRenderedRows(t),e.trigger("scroll",{scrollTop:t}))});e.scrollInitialized=!0,e.scrollable.on({scroll:r,scrollend(){e.scrolling=!1,e.eachSubGrid(e=>e.suspendResizeMonitor=!1)}}),e.callEachSubGrid("initScroll")}}scrollRowIntoView(e,t=lc){const r=this,n=t.block||"nearest",{rowManager:s}=r;if(e=r.store.getById(e)){if(-1===r.store.indexOf(e))return ac;let i=r.scrollable,o=r.getRecordCoords(e);const a=Xt.from(i.element);if(o.virtual){const l=o.block;if(i.scrollIntoView(o,{block:"center"}),s.scrollTargetRecordId=e,s.updateRenderedRows(i.y,!0),o=r.getRecordCoords(e),s.lastScrollTop=i.y,o.virtual)return ac;const c="nearest"!==n?t:{block:l};if(t.animate){i.suspendEvents(),"end"===n||"nearest"===n&&"end"===l?i.y-=a.bottom-o.bottom:("start"===n||"nearest"===n&&"start"===l)&&(i.y+=o.y-a.y),s.updateRenderedRows(i.y,!1,!0),"end"===l?i.y-=s.appendRowBuffer*s.rowHeight-1:i.y+=s.prependRowBuffer*s.rowHeight-1;return i.scrollIntoView(r.getRecordCoords(e),Object.assign({},t,c)).then(()=>i.resumeEvents())}return r.scrollRowIntoView(e,Object.assign({},t,c))}{let{column:n}=t;if(n){if("string"==typeof n&&(n=r.columns.getById(n)||r.columns.get(n)),n){i=r.getSubGridFromColumn(n).scrollable;const t=Xt.from(s.getRowFor(e).getCell(n.id));o.x=t.x,o.width=t.width}}else t.x=!1;return i.scrollIntoView(o,t)}}}scrollColumnIntoView(e,t){return e=e instanceof Da?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e),this.getSubGridFromColumn(e).scrollColumnIntoView(e,t)}scrollCellIntoView(e,t){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},"boolean"==typeof t?{animate:t}:t))}scrollToBottom(e){return this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this.storedScrollState={scrollTop:this.scrollable.y,scrollLeft:{}};return this.eachSubGrid(t=>{e.scrollLeft[t.region]=t.scrollable.x}),e}restoreScroll(e=this.storedScrollState){this.eachSubGrid(t=>{t.scrollable.x=e.scrollLeft[t.region]}),this.scrollable.y=e.scrollTop}measureRowHeight(){const e=this,t=Et.createElement({tag:"div",className:"b-grid "+(e.features.stripe?"b-stripe":""),style:"position: absolute; visibility: hidden",html:'<div class="b-grid-subgrid"><div class="b-grid-row"></div></div>',parent:document.getElementById(e.appendTo)||document.body}),r=t.firstElementChild.firstElementChild,n=parseInt(Et.getStyleValue(r,"height")),s=parseInt(Et.getStyleValue(r,"border-top-width")),i=parseInt(Et.getStyleValue(r,"border-bottom-width"));null!=e.rowHeight&&e.rowHeight!==e._rowHeightFromStyle||(e.rowHeight=!isNaN(n)&&n?n:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=s+i,e._isRowMeasured=!0,t.remove()}onThemeChange({theme:e}){this.measureRowHeight(),this.trigger("theme",{theme:e})}refreshRows(e=!1){this.element.classList.add("b-notransition"),e?this.rowManager.returnToTop():this.rowManager.refresh(),this.element.classList.remove("b-notransition")}refreshColumn(e){if(!e.hidden){const t=e.field;this.rowManager.forEach(e=>{const r=e.getCell(t);e.renderCell(r)})}}refreshVirtualScrollbars(){const{headerContainer:e,footerContainer:t,virtualScrollers:r,scrollable:n}=this,s=P.isEdge||P.isIE11?Math.abs(n.scrollHeight-n.clientHeight)>1:n.scrollHeight>n.clientHeight,i=s?"add":"remove";Object.values(this.subGrids).some(e=>e.overflowingHorizontally)?r.classList.remove("b-hide-display"):r.classList.add("b-hide-display"),e.classList[i]("b-grid-vertical-overflow"),t.classList[i]("b-grid-vertical-overflow"),r.classList[i]("b-grid-vertical-overflow"),this.onHeightChange(),Et.scrollBarWidth&&(e.style.marginRight=t.style.paddingRight=s?Et.scrollBarWidth-1+"px":0)}get contentHeight(){const e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}onContentChange(){const e=this,t=e.rowManager;e.isVisible?(t.estimateTotalHeight(),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.on({paint:"onContentChange",once:!0,thisObj:e}))}onHeightChange(){const e=this;e._bodyRectangle=Xt.client(e.bodyContainer),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}renderHeader(e,t){}renderFooter(e,t){}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&!--this.refreshSuspended&&e&&this.refreshRows()}renderRows(e=!0,t=!1){const r=this,n=e&&r.storeScroll();r.refreshSuspended||(r.trigger("beforeRenderRows"),r.renderingRows=!0,r.element.classList.add("b-grid-refreshing"),t&&(r.scrollable.y=r._scrollTop=0),r.rowManager.reinitialize(t),r.trigger("renderRows"),r.renderingRows=!1,r.onContentChange(),e&&r.restoreScroll(n),r.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,{element:t,headerContainer:r,footerContainer:n,rowManager:s}=e;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader",r),e.callEachSubGrid("refreshFooter",n),e.renderHeader(r,t),e.renderFooter(n,t),e.fixSizes();const i=s.removeAllRows();s.calculateRowCount(!1,!0,!0),s.rowCount&&(s.setPosition(i),e.renderRows())}}onPaint(){const e=this,{rowManager:t,store:r,element:n,headerContainer:s,bodyContainer:i,footerContainer:o}=e;if(e.isPainted)return;let a,l=0;e.columns.on({change:()=>a=!0,single:!0}),e._bodyRectangle=Xt.client(e.bodyContainer);const c=e.bodyContainer.offsetHeight;e.updateResponsive(e.width,0),a&&(e.callEachSubGrid("refreshHeader",s),e.callEachSubGrid("refreshFooter",o)),e.renderHeader(s,n),e.renderFooter(o,n),e.autoHeight?(e._bodyHeight=t.initWithHeight(n.offsetHeight-s.offsetHeight-o.offsetHeight,!0),i.style.height=e.bodyHeight+"px"):(e._bodyHeight=c,t.initWithHeight(e._bodyHeight,!0)),e.eachSubGrid(e=>{e.header.maxDepth>l&&(l=e.header.maxDepth)}),s.dataset.maxDepth=l,e.fixSizes(),!r.count&&r.isLoading||e.renderRows(!1,!1),e.initScroll(),e.initInternalEvents()}render(){const e=this;e.requireSize=Boolean(e.owner),super.render(...arguments),e.autoHeight||!e.headerContainer.offsetHeight||e.bodyContainer.offsetHeight||console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget")}maskBody(e){const t=this;if(!t.bodyContainer)return;t.unmaskBody();const{maskElement:r}=t.activeMask=Qr.mask(e,t.element);return r.style.marginTop=t.bodyContainer.offsetTop+"px",r.style.height=t.virtualScrollers.offsetTop+t.virtualScrollers.offsetHeight-t.bodyContainer.offsetTop+"px",t.activeMask}unmaskBody(){const e=this;e.loadmaskHideTimer&&e.clearTimeout(e.loadmaskHideTimer),e.loadmaskHideTimer=null,e.activeMask&&e.activeMask.destroy(),e.activeMask=null}toggleEmptyText(){this.bodyContainer&&Et.toggleClasses(this.bodyContainer,"b-grid-empty",!(this.rowManager.rowCount>0||this.store.isLoading||this.store.isCommitting))}}dc._$name="GridBase",U.register("gridbase",dc),A.setVersion("grid","3.1.9");const uc={Enter:1,F2:1},hc={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1};class gc extends(br(Nn)){static get $name(){return"CellEdit"}static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",addNewAtEnd:null,autoEdit:!1,editorClass:Bs,triggerEvent:"celldblclick",focusCellAnimationDuration:100}}static get pluginConfig(){return{assign:["startEditing"],before:["onElementKeyDown","onElementMouseDown"],chain:["onElementClick"]}}construct(e,t){const r=this;r.grid=e,super.construct(e,t),e.store.on({update:"onStoreUpdate",thisObj:r});const n={beforerenderrows:"onGridBeforeRenderRows",cellclick:"onCellClick",thisObj:r};"cellclick"!==r.triggerEvent&&(n[r.triggerEvent]="onTriggerEditEvent"),e.on(n)}async confirm(e){let t=!0;return this.editorContext&&(ba.owner=this.editorContext.editor.inputField,t=await ba.confirm(e),ba.owner=null),t===ba.yesButton}doDestroy(){this.cancelEditing(!0),this.grid.columns.allRecords.forEach(e=>{e._cellEditor&&e._cellEditor.destroy()}),super.doDestroy()}doDisable(e){e&&this.cancelEditing(!0),super.doDisable(e)}set disabled(e){super.disabled=e}get disabled(){const{grid:e}=this;return Boolean(super.disabled||e.disabled||e.readOnly)}get isEditing(){return Boolean(this.editorContext)}get activeRecord(){return this.editorContext&&this.editorContext.record||null}getEditorForCell({cell:e,column:t,selector:r,editor:n}){const s=this,i=s.grid;let o=t._cellEditor,a=0;if(t.editTargetSelector){a=e.querySelector(t.editTargetSelector).offsetLeft}return n.autoSelect=s.autoSelect,o?(o.inputField!==n&&(o.remove(o.items[0]),o.add(n)),o.align.offset[0]=a):o=t._cellEditor=new s.editorClass({cls:"b-cell-editor",inputField:n,blurAction:"none",invalidAction:t.invalidAction,completeKey:!1,cancelKey:!1,owner:i,align:{align:"t0-t0",offset:[a,0]},listeners:s.getEditorListeners()}),t.instantUpdate&&!n.cellEditValueSetter&&(ze.wrapProperty(n,"value",null,e=>{const{editorContext:t}=s;t&&t.editor.isValid&&!ze.isEqual(t.record[t.column.field],e)&&(t.record[t.column.field]=e)}),n.cellEditValueSetter=!0),Object.assign(o.element.dataset,{rowId:r.id,columnId:r.columnId,field:t.field}),o.inputField.revertOnEscape=t.revertOnEscape,s.editor=o}getEditorListeners(){return{focusout:"onEditorFocusOut",focusin:"onEditorFocusIn",start:"onEditorStart",beforecomplete:"onEditorBeforeComplete",complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:this}}onEditorStart({source:e}){const t=this,r=t.editorContext=e.cellEditorContext;if(r){const{grid:e}=t,{cell:n}=r;n.classList.add("b-editing"),t.grid.on({cellclick:"onCellClickWhileEditing"},t),t.removeEditingListeners=Yr.addListener({globaltap:"onTapOut",thisObj:t}),e.trigger("startCellEdit",{grid:e,editorContext:r})}}onEditorBeforeComplete(e){const{grid:t}=this,r=e.source.cellEditorContext;return e.grid=t,e.editorContext=r,t.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:t}=this,r=e.cellEditorContext;r.value=e.inputField.value,t.trigger("finishCellEdit",{grid:t,editorContext:r}),this.cleanupAfterEdit(r)}onEditorCancel(){const{editorContext:e,muteEvents:t,grid:r}=this;e&&this.cleanupAfterEdit(e),t||r.trigger("cancelCellEdit",{grid:r})}cleanupAfterEdit(e){const{editor:t}=e;e.cell.classList.remove("b-editing"),t.cellEditorContext=this.editorContext=null,this.grid.un({cellclick:"onCellClickWhileEditing",viewportResize:"onViewportResizeWhileEditing"},this),this.removeEditingListeners(),Yr.suspendFocusEvents(),t.element.remove(),Yr.resumeFocusEvents()}async getAdjacentEditableCell(e,t){const r=this.grid,n=r.store,s=r.columns;let i=e.id,o=e.columnId,a=s.getAdjacentLeaf(o,t);for(;i;){const r=n.getById(i);if(a){if(o=a.id,!a.hidden&&a.editor&&a.canEdit(r))return{id:i,columnId:a.id};a=s.getAdjacentLeaf(o,t)}else{const r=n.getAdjacent(e.id,t,!1,!0);i=r&&r.id,r&&(a=t?s.first:s.leaves[s.leaves.length-1])}}return null}async doAddNewAtEnd(e){const t=this.grid,r=t.store.add(e)[0];return t.rowManager.getRowFor(r)||t.rowManager.displayRecordAtBottom(),r}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{grid:t}=this,r=t.columns.getById(e.columnId),n=t.store.getById(e.id),s=t.getCell(e);if(s&&r&&!r.hidden&&r.editor&&n&&!n.meta.specialRow&&r.canEdit(n)){const t=n&&n[r.field];return{column:r,record:n,cell:s,value:void 0===t?null:t,selector:e,editor:r.editor}}return!1}startEditing(e={}){const t=this;if(!t.editorContext&&!t.disabled){const{grid:r}=t,n=r.normalizeCellContext(e);r.focusCell(e);const s=t.getEditingContext(n);if(!s||!1===r.trigger("beforeCellEditStart",{grid:r,editorContext:s}))return!1;if(s){Et.focusWithoutScrolling(r.focusElement);const e=s.editor=t.getEditorForCell(s),{cell:n,record:i,column:o}=s;return e.inputField.highlightExternalChange=!1,e.cellEditorContext=s,e.render(t.grid.getSubGridFromColumn(o).element),e.startEdit({target:n,record:i,field:e.inputField.name||s.column.field}),!0}}return!1}cancelEditing(e=!1){const t=this,{editorContext:r,editor:n,grid:s}=t;r&&(n.containsFocus&&(t.editorContext=null,n.inputField.owns(Et.activeElement)&&Et.focusWithoutScrolling(s.focusElement),t.editorContext=r),t.muteEvents=e,n.cancelEdit(),t.muteEvents=!1)}async finishEditing(){const{editorContext:e}=this;let t=!1;if(e){const{column:r}=e;t=await e.editor.completeEdit(r.bindCallback(r.finalizeCellEdit))}return t}onCellClickWhileEditing({event:e,cellSelector:t}){const r=this;r.editorContext&&!r.editorContext.editor.owns(e.target)&&(r.getEditingContext(t)?r.finishEditing()?r.startEditing(t):(r.grid.focusCell(r.editorContext.selector),r.editor.inputField.focus()):r.finishEditing())}onCellClick({source:e,record:t,cellSelector:r,cellElement:n,target:s,event:i}){const o=e.focusedCell||{},a=e.columns.getById(r.columnId);if(a.onCellClick)a.onCellClick({grid:e,column:a,record:t,cellSelector:r,cellElement:n,target:s,event:i});else{if(s.closest(".b-tree-expander"))return this.cancelEditing(),!1;Et.isTouchEvent&&r.id==o.id&&r.columnId==o.columnId?this.startEditing(r):"cellclick"===this.triggerEvent&&this.onTriggerEditEvent({cellSelector:r})}}onTriggerEditEvent({cellSelector:e}){this.editorContext&&!this.finishEditing()||this.startEditing(e)}onStoreUpdate({changes:e,record:t}){const{editorContext:r}=this;r&&r.editor.isVisible&&t===r.record&&r.editor.dataField in e&&r.editor.refreshEdit()}onGridBeforeRenderRows(){this.editorContext&&this.editorContext.editor.isVisible&&this.cancelEditing()}async onElementKeyDown(e){const t=this;if(!e.handled&&t.grid.focusElement.contains(e.target))if(t.editorContext){switch(e.key){case"Enter":t.onEnterKeyPress(e);break;case"F2":e.preventDefault(),t.finishEditing();break;case"Escape":e.stopPropagation(),e.preventDefault(),t.cancelEditing();break;case"Tab":t.onTabKeyPress(e)}hc[e.key]&&(e.handled=!0)}else{const r=e.key,n=t.autoEdit&&(1===r.length||"Backspace"===r);if((n||uc[r])&&t.grid.focusedCell){if(e.preventDefault(),!t.startEditing(t.grid.focusedCell))return;const s=t.editor.inputField,i=s.input;n&&i&&(i.value="Backspace"===r?"":r,s.internalOnInput(e),s.moveCaretToEnd())}}}async onEnterKeyPress(e){const t=this;e.preventDefault(),e.stopPropagation(),await t.finishEditing()&&(t.isEditing||e.ctrlKey||e.metaKey||e.altKey||t.grid.touch||(e.shiftKey?t.grid.navigateUp()&&t.startEditing(t.grid.focusedCell):t.grid.navigateDown()&&t.startEditing(t.grid.focusedCell)))}async onTabKeyPress(e){e.preventDefault();const t=this,{focusedCell:r}=t.grid;if(r){const n=!e.shiftKey;let s=await t.getAdjacentEditableCell(r,n);if(!s&&n&&t.addNewAtEnd){!0===await t.finishEditing()&&(await this.doAddNewAtEnd("object"==typeof t.addNewAtEnd?ze.clone(t.addNewAtEnd):{}),s=await t.getAdjacentEditableCell(r,n))}if(s){let e=!0;t.isEditing&&(e=await t.finishEditing()),e&&(t.grid.focusCell(s,{animate:t.focusCellAnimationDuration}),t.startEditing(s))}}}onElementMouseDown(e){2===e.button&&this.editorContext&&e.preventDefault()}onEditorFocusOut(e){const t=this,{grid:r}=t;t.editorContext&&!t.editor.isFinishing&&t.editor.inputField.owns(e.target)&&(e.toWidget!==r||r.isLocationEqual(t.grid.focusedCell,t.editorContext.selector))&&("cancel"===t.blurAction?t.cancelEditing():t.finishEditing())}onEditorFocusIn(e){const t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}onTapOut({event:e}){const t=this;t.grid.bodyContainer.contains(e.target)||t.editor.owns(e.target)||("cancel"===t.blurAction?t.cancelEditing():t.finishEditing())}onElementClick(e){const t=this;e.target.classList.contains("b-grid-body-container")&&t.editorContext&&t.finishEditing()}}gc._$name="CellEdit",Va.registerFeature(gc,!0);class mc extends dc{static get $name(){return"Grid"}}mc._$name="Grid",U.register("grid",mc);class pc extends mc{static get $name(){return"TreeGrid"}set store(e){if(e&&!e.tree){if(e instanceof Cs)throw new Error("TreeGrid requires a Store configured with tree : true");e.tree=!0}super.store=e}get store(){return super.store}}pc._$name="TreeGrid",U.register("treegrid",pc);var fc=e=>class t extends(e||B){static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(e){e.abort()}shouldUseBodyForRequestData(e,t,r){return!("HEAD"===t||"GET"===t||r)}sendRequest(e){const r=this,{data:n}=e,s=r.transport[e.type]||{},i=Object.assign({},s,s.requestConfig);i.method=i.method||t.defaultMethod[e.type],i.params=i.params||{};let{paramName:o}=i;if(r.shouldUseBodyForRequestData(s,i.method,o)?(i.body=n,i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json"):(o=o||"data",i.params[o]=n),!i.url)throw new Error("Trying to request without URL specified");delete i.requestConfig,delete i.paramName,r.trigger("beforeSend",{params:i.params,type:e.type,requestConfig:i,config:e}),i.queryParams=i.params,delete i.params;const a=Object.assign({},i,i.fetchOptions),l=ee.fetch(i.url,a);return l.catch(e=>{const t=a.abortController&&a.abortController.signal;t&&!t.aborted&&console.warn(e)}).then(t=>{t&&t.ok?e.success&&e.success.call(e.thisObj||r,t,a):e.failure&&e.failure.call(e.thisObj||r,t,a)}),l}};const vc=function(e,t,r){return e.store&&(e=e.store),t.store&&(t=t.store),(e=e[r]||0)<(t=t[r]||0)?-1:e>t?1:0},yc=function(e,t){return vc(e,t,"loadPriority")},bc=function(e,t){return vc(e,t,"syncPriority")},Cc=()=>{};var wc=e=>class extends(br(e)){static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,crudLoaded:!1,createMissingRecords:!1,autoSyncTimerId:null,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(e={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(e)}afterConstruct(){super.afterConstruct(),this.autoLoad&&this.load().catch(e=>{if(!this.isValidResponse(e.rawResponse,e.response))throw e})}getStoreDescriptor(e){return e?e instanceof Cs?this.crudStores.find(t=>t.store===e):"object"==typeof e?this.crudStoresIndex[e.storeId]:this.crudStoresIndex[e]||this.getStoreDescriptor(Cs.getStore(e)):null}fillStoreDescriptor(e){const{store:t}=e,{storeIdProperty:r=this.storeIdProperty,modelClass:n}=t;return e.storeId||(e.storeId=t[r]),e.idField||(e.idField=n.idField),e.phantomIdField||(e.phantomIdField=n.phantomIdField),e.phantomParentIdField||(e.phantomParentIdField=n.phantomParentIdField),"writeAllFields"in e||(e.writeAllFields=t.writeAllFields),e}updateCrudStoreIndex(){const e=this.crudStoresIndex={};this.crudStores.forEach(t=>t.storeId&&(e[t.storeId]=t))}getCrudStore(e){const t=this.getStoreDescriptor(e);return t&&t.store}forEachCrudStore(e,t=this){e&&this.crudStores.every(r=>!1!==e.call(t,r.store,r.storeId,r))}set crudStores(e){this._crudStores=[],this.addCrudStore(e);for(const e of this._crudStores)e.loadPriority=e.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(e){return this._orderedCrudStores=e}set syncApplySequence(e){this._syncApplySequence=[],this.addStoreToApplySequence(e)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(e){const t=this;let r;return e instanceof Cs?r={store:e}:"object"==typeof e?(e.stores&&(Array.isArray(e.stores)||(e.stores=[e.stores]),e.stores.forEach((t,r)=>{let n=t;"string"==typeof t&&(n={storeId:t}),n.masterStoreInfo=e,e.stores[r]=n})),r=e):r={store:Cs.getStore(e)},t.fillStoreDescriptor(r),(e=r.store).setCrudManager?e.setCrudManager(t):e.crudManager=t,e.pageSize=null,t.overrideCrudStoreLoad&&e.load&&(e.load=e.commit=()=>{}),t.bindCrudStoreListeners(e),r}addCrudStore(e,t,r){if(!e)return;if(Array.isArray(e)||(e=[e]),!e.length)return;const n=this,s=e.map(n.internalAddCrudStore,n);if(void 0===t)n.crudStores.push(...s);else{let e=t;r&&((r instanceof Cs||"object"!=typeof r)&&(r=n.getStoreDescriptor(r)),e+=n.crudStores.indexOf(r)),n.crudStores.splice(e,0,...s)}n.orderedCrudStores.push(...s),n.updateCrudStoreIndex()}addPrioritizedStore(e){const t=this;t.hasCrudStore(e)||this.addCrudStore(e,z.findInsertionIndex(e,t.crudStores,yc)),t.hasApplySequenceStore(e)||this.addStoreToApplySequence(e,z.findInsertionIndex(e,t.syncApplySequence,bc))}hasCrudStore(e){return this.crudStores.some(t=>t===e||t.store===e||t.storeId===e)}removeCrudStore(e){const t=this,r=t.crudStores;for(let n=0,s=r.length;n<s;n++){const s=r[n];if(s===e||s.store===e||s.storeId===e){t.unbindCrudStoreListeners(s.store),delete t.crudStoresIndex[s.storeId],r.splice(n,1),t.syncApplySequence&&t.removeStoreFromApplySequence(e);break}}}bindCrudStoreListeners(e){e.on({name:"store",change:"onCrudStoreChange",thisObj:this})}unbindCrudStoreListeners(){this.detachListeners("store")}addStoreToApplySequence(e,t,r){if(!e)return;Array.isArray(e)||(e=[e]);const n=this,s=e.reduce((e,t)=>{const r=n.getStoreDescriptor(t);return r&&e.push(r),e},[]);if(void 0===t)n.syncApplySequence.push(...s);else{let e=t;r&&((r instanceof Cs||"object"!=typeof r)&&(r=n.getStoreDescriptor(r)),e+=n.syncApplySequence.indexOf(r)),n.syncApplySequence.splice(e,0,...s)}const i=n.syncApplySequence.map(e=>e.storeId);n.orderedCrudStores=[...n.syncApplySequence],n.crudStores.forEach(e=>{i.includes(e.storeId)||n.orderedCrudStores.push(e)})}removeStoreFromApplySequence(e){const t=this.syncApplySequence.findIndex(t=>t===e||t.store===e||t.storeId===e);t>-1&&(this.syncApplySequence.splice(t,1),this.orderedCrudStores.splice(t,1))}hasApplySequenceStore(e){return this.syncApplySequence.some(t=>t===e||t.store===e||t.storeId===e)}onCrudStoreChange(){const e=this;e.crudIgnoreUpdates||(e.crudStoreHasChanges()?(e.trigger("hasChanges"),e.autoSync&&(e.autoSyncTimerId||(e.autoSyncTimerId=e.setTimeout(()=>{e.autoSyncTimerId=null,e.sync().catch(t=>{if(!e.isValidResponse(t.rawResponse,t.response))throw t})},e.autoSyncTimeout)))):e.trigger("noChanges"))}async internalOnResponse(e,t,r,n){const s=this;s.activeRequests[e]=null;const i=t?s.decode(t):null;return i&&i.success?(!1!==s.trigger("beforeResponseApply",{requestType:e,response:i})&&!1!==s.trigger("before"+I.capitalizeFirstLetter(e)+"Apply",{response:i,options:n})&&(s.crudRevision=i.revision,await s.applyResponse(e,i,n),s.trigger("requestDone",{requestType:e,response:i,responseOptions:r}),s.trigger(e,{response:i,responseOptions:r,options:n}),"load"!==e&&s.crudStoreHasChanges()||s.trigger("noChanges")),i):(s.trigger("requestFail",{requestType:e,response:i,responseText:t,responseOptions:r}),s.trigger(e+"Fail",{response:i,responseOptions:r,responseText:t,options:n}),i)}async internalOnLoad(e,t,r){return this.crudLoaded=!0,this.internalOnResponse("load",e,t,r)}async internalOnSync(e,t,r){return this.internalOnResponse("sync",e,t,r)}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(e){this.crudIgnoreUpdates&&!--this.crudIgnoreUpdates&&e&&this.onCrudStoreChange()}crudStoreHasChanges(e){if(e){const t=this.getCrudStore(e);return t&&this.isCrudStoreDirty(t)}return this.crudStores.some(this.isCrudStoreDirty)}isCrudStoreDirty(e){return null!=e.store.changes}emitCrudStoreEvents(e,t){const r={action:"read"+t};for(const n of this.crudStores)e.includes(n.storeId)&&n.store.trigger(t,r)}getLoadPackage(e){const t={type:"load",requestId:this.requestId},r=this.crudStores,n=Object.assign({},e);return t.stores=r.map(e=>{const t=n&&n[e.storeId],r=e.pageSize||e.store&&e.store.pageSize;if(t||r){const s=Object.assign({storeId:e.storeId,page:1},t);return r&&(s.pageSize=r),e.currentPage=s.page,t&&delete n[e.storeId],s}return e.storeId}),Object.assign(t,n),t}loadCrudStore(e,t,r){const n=t&&t.rows;r&&r.append||t.append?e.add(n):e.data=n,e.trigger("load",{source:e,data:n})}loadDataToCrudStore(e,t,r){const n=this,s=e.store,i=e.stores,o=e.idField||"id",a=s.tree,l=t&&t.rows;if(s.__loading=!0,l){let c;i&&(c=n.getSubStoresData(l,i,o,a)),n.loadCrudStore(s,t,r,e),c&&c.forEach(e=>{n.loadDataToCrudStore(Object.assign({store:s.getById(e.id).get(e.storeDesc.storeId)},e.storeDesc),e.data)})}s.__loading=!1}loadCrudManagerData(e,t={}){this.suspendChangesTracking(),this.crudStores.forEach(r=>{const n=r.storeId,s=e[n];s&&this.loadDataToCrudStore(r,s,t[n])}),this.resumeChangesTracking()}get isCrudManagerLoading(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)}get isLoadingOrSyncing(){return Boolean(this.activeRequests.load||this.activeRequests.sync)}load(e){const t=this,r=t.getLoadPackage(e);return new Promise((n,s)=>{!1!==t.trigger("beforeLoad",{pack:r})?(t.activeRequests.load&&(t.cancelRequest(t.activeRequests.load.desc),t.trigger("loadCanceled",{pack:r})),t.activeRequests.load={options:e,pack:r,resolve:n,reject:s,id:r.requestId,desc:t.sendRequest({data:t.encode(r),type:"load",success:t.onLoadSuccess,failure:t.onLoadFailure,thisObj:t})},t.emitCrudStoreEvents(r.stores,"loadStart"),t.trigger("loadStart",{pack:r})):(t.trigger("loadCanceled",{pack:r}),t.processPromise(s,null,{action:"load",cancelled:!0}))})}async onLoadSuccess(e,t){let r="";const n=this.activeRequests.load,{options:s}=n;await e.text().then(e=>r=e).catch(Cc);const i=await this.internalOnLoad(r,t,s);this.emitCrudStoreEvents(n.pack.stores,"afterRequest"),i&&i.success?n.resolve({response:i,rawResponse:e,responseText:r,options:s}):this.processPromise(n.reject,n.resolve,{action:"load",cancelled:!1,response:i,rawResponse:e,responseText:r,options:s})}async onLoadFailure(e,t={}){const r=this.activeRequests.load,{options:n}=r,s=t.abortController&&t.abortController.signal,i=Boolean(s&&s.aborted);if(!i){let s="";e&&await e.text().then(e=>s=e).catch(Cc);const o=await this.internalOnLoad(s,t,n);this.emitCrudStoreEvents(r.pack.stores,"afterRequest"),this.processPromise(r.reject,null,{action:"load",cancelled:i,response:o,rawResponse:e,responseText:s,options:n,request:r})}}getSubStoresData(e,t,r,n){if(!e)return;const s=[];function i(e,t){t.forEach(t=>{const n=t.storeId;e[n]&&(s.push({id:e[r],storeDesc:t,data:e[n]}),delete e[n])})}return n?e.forEach(e=>{i(e,t);const n=this.getSubStoresData(e.children,t,r,!0);n&&s.push(...n)}):e.forEach(e=>i(e,t)),s}prepareAdded(e,t){const{store:r,stores:n}=t,{isTree:s}=r,i=t.phantomIdField||this.phantomIdField,o=t.phantomParentIdField||this.phantomParentIdField;return e.filter(e=>e.isValid).map(e=>{const t=e.constructor,r=Object.assign(e.persistableData,{[i]:e.id});if(s){const{parent:t}=e;t&&!t.isRoot&&t.isPhantom&&(r[o]=t.id)}return this.resetIdsBeforeSync&&ze.deletePath(r,t.getFieldDataSource(t.idField)),n&&this.processSubStores(e,r,n),r})}prepareUpdated(e,t){const{store:r,stores:n}=t,{isTree:s}=r,i=t.writeAllFields||!1!==t.writeAllFields&&this.writeAllFields,o=t.phantomParentIdField||this.phantomParentIdField;if(t.store.tree){const r=t.store.rootNode;e=e.filter(e=>e!==r)}return e.filter(e=>e.isValid).reduce((e,t)=>{let r;if(r=i?t.persistableData:t.modificationData,s){const{parent:e}=t;e&&!e.isRoot&&e.isPhantom&&(r[o]=e.id)}return n&&this.processSubStores(t,r,n),ze.isEmpty(r)||e.push(r),e},[])}prepareRemoved(e){return e.map(e=>{const t=e.constructor;return ze.setPath({},t.getFieldDataSource(t.idField),e.id)})}processSubStores(e,t,r){r.forEach(r=>{const n=r.storeId,s=e.get(n);if(s){const e=this.getCrudStoreChanges(Object.assign({store:s},r));e?t[n]=Object.assign(e,{$store:!0}):delete t[n]}else delete t[n]})}getCrudStoreChanges(e){const{store:t}=e;let r,n=t.added.values,s=t.modified.values,i=t.removed.values;return n.length&&(n=this.prepareAdded(n,e)),s.length&&(s=this.prepareUpdated(s,e)),i.length&&(i=this.prepareRemoved(i)),(n.length||s.length||i.length)&&(r={},n.length&&(r.added=n),s.length&&(r.updated=s),i.length&&(r.removed=i)),r}getChangeSetPackage(){const e={type:"sync",requestId:this.requestId,revision:this.crudRevision};let t=0;return this.crudStores.forEach(r=>{const n=this.getCrudStoreChanges(r);n&&(t++,e[r.storeId]=n)}),t?e:null}applyChangesToRecord(e,t,r){const n=this,s=e.constructor,{fieldDataSourceMap:i}=s,o=s.prototype,a={},l=e.data,c={[n.phantomIdField]:!0};let d;r&&r.forEach(r=>{const s=r.storeId;if(Object.prototype.hasOwnProperty.call(t,s)){c[s]=!0;const i=e.get(s);i?n.applyChangesToStore(Object.assign({store:i},r),t[s]):console.log("Can't find store for the response sub-package")}});const u={};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&!c[e]&&(u[e]=t[e]);const h=ze.pathifyKeys(u);for(const t in h){const r=i[t],n=r?r.name:t,c=s.processField(n,h[t]),u=t in o?e[n]:ze.getPath(l,t);ze.isEqual(u,c)||(d=!0,a[n]=c)}if(d){n.suspendChangesTracking();for(const t in a)e[t]=a[t];n.resumeChangesTracking()}e.clearChanges(!0,!1)}applyRemovals(e,t,r){const{removed:n,modelClass:s}=e,i=r.findByIdFn,o=r.removeRecordFn,a=s.getFieldDataSource(s.idField);let l=0;return t.forEach(e=>{const t=e[a];let r=!1;if(n.includes(t)&&(n.remove(t),r=!0,l++),!r){const e=i(t);e?(this.suspendChangesTracking(),o(e),n.remove(e),l++,this.resumeChangesTracking()):console.log("Can't find record to remove from the response package")}}),l}getApplyChangesToStoreHelpers(e){return e.tree?{findByPhantomFn:t=>e.getById(t),findByIdFn:t=>e.getById(t),addRecordFn:t=>(t.parentId&&e.getById(t.parentId)||e.rootNode).appendChild(t),removeRecordFn:e=>e.remove()}:{findByPhantomFn:t=>e.getById(t),findByIdFn:t=>e.getById(t),addRecordFn:t=>e.add(t)[0],removeRecordFn:t=>e.remove(t)}}applyChangesToStore(e,t){const r=this,n=e.phantomIdField||r.phantomIdField,s=e.store,{modelClass:i}=s,o=i.getFieldDataSource(i.idField),{findByPhantomFn:a,findByIdFn:l,addRecordFn:c,removeRecordFn:d}=r.getApplyChangesToStoreHelpers(s),{rows:u,removed:h}=t;if(u){const t=e.stores;u.forEach(e=>{const i=e[n],d=ze.getPath(e,o);let u=null;null!=i?u=a(i):null!=d&&(u=l(d)),u?r.applyChangesToRecord(u,e,t,s):(r.suspendChangesTracking(),u=c(e),r.resumeChangesTracking(),u.clearChanges())})}h&&r.applyRemovals(s,h,{findByIdFn:l,removeRecordFn:d})&&s.trigger("dataChanged",{source:s})}applySyncResponse(e){const t=this,r=t.orderedCrudStores;t.applyingSyncResponse=!0;for(const n of r){const r=e[n.storeId];r&&t.applyChangesToStore(n,r)}t.applyingSyncResponse=!1}applyLoadResponse(e,t){this.applyingLoadResponse=!0,this.loadCrudManagerData(e,t),this.applyingLoadResponse=!1}async applyResponse(e,t,r){switch(this.trackResponseType&&(e=t.type||e),e){case"load":this.applyLoadResponse(t,r);break;case"sync":this.applySyncResponse(t)}}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const e=this;return e.activeRequests.sync?(e.trigger("syncDelayed"),e.activeSyncPromise=e.activeSyncPromise.then(()=>e.sync(),()=>e.sync())):e.activeSyncPromise=new Promise((t,r)=>{const n=e.getChangeSetPackage();n?!1!==e.trigger("beforeSync",{pack:n})?(e.trigger("syncStart",{pack:n}),e.activeRequests.sync={pack:n,resolve:t,reject:r,id:n.requestId,desc:e.sendRequest({data:e.encode(n),type:"sync",success:e.onSyncSuccess,failure:e.onSyncFailure,thisObj:e})}):(e.trigger("syncCanceled",{pack:n}),this.processPromise(r,null,{action:"sync",cancelled:!0})):t(null)})}async onSyncSuccess(e,t){let r="";await e.text().then(e=>r=e).catch(Cc);const n=this.activeRequests.sync,s=await this.internalOnSync(r,t);s&&s.success?n.resolve({response:s,rawResponse:e,responseText:r,request:n}):this.processPromise(n.reject,n.resolve,{action:"sync",cancelled:!1,response:s,rawResponse:e,responseText:r,request:n})}async onSyncFailure(e,t={}){const r=this.activeRequests.sync,{options:n}=r,s=t.abortController&&t.abortController.signal,i=Boolean(s&&s.aborted);if(!i){let s="";e&&await e.text().then(e=>s=e).catch(Cc);const o=await this.internalOnSync(s,t,n);this.processPromise(r.reject,null,{action:"sync",cancelled:i,response:o,rawResponse:e,responseText:s,options:n,request:r})}}commitCrudStores(){this.crudStores.forEach(e=>e.store.commit())}rejectCrudStores(){this.orderedCrudStores.forEach(e=>e.store.clearChanges())}doDestroy(){const e=this;for(e.activeRequests.load&&e.cancelRequest(e.activeRequests.load.desc),e.activeRequests.sync&&e.cancelRequest(e.activeRequests.sync.desc);e.crudStores.length>0;)e.removeCrudStore(e.crudStores[0]);clearTimeout(e.autoSyncTimerId),e.destroyed=!0,super.doDestroy&&super.doDestroy()}isValidResponse(e,t){return e&&(e.ok&&t||[500,404].includes(e.status))}processPromise(e,t,r){const{cancelled:n,action:s,rawResponse:i,response:o}=r;if(t&&this.isValidResponse(i,o))t(r);else{const t=`${I.capitalizeFirstLetter(s)} ${n?"canceled":"failed"}`,i=new Error(t);Object.assign(i,r),e(i)}}};class Sc extends(wc(G(B))){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}static get defaultConfig(){return Object.assign({},this.crudManagerDefaultConfig,{overrideCrudStoreLoad:!0,stores:null})}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}commit(){this.commitCrudStores()}reject(){this.rejectCrudStores()}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}}Sc._$name="AbstractCrudManager";var Dc=e=>class extends e{static get $name(){return"CrudManagerView"}static get defaultConfig(){return{crudManagerClass:null,crudManager:null}}afterConstruct(){const e=this;e.crudManager&&e.loadMask&&e.crudManager.isCrudManagerLoading&&e.maskBody(e.loadMask)}bindCrudManager(e){this.detachListeners("crudManager"),e&&e.on({name:"crudManager",loadStart:"onCrudManagerLoadStart",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",thisObj:this})}onCrudManagerLoadStart(){this.loadMask&&this.maskBody(this.loadMask),this.toggleEmptyText()}onCrudManagerSyncStart(){this.syncMask&&this.maskBody(this.syncMask)}onCrudManagerRequestFinalize(e=!0,t,r){var n=this;n.activeMask&&(e?(n.unmaskBody(),n.toggleEmptyText()):(n.activeMask.icon=n.loadMaskErrorIcon,n.activeMask.text=`<div class="b-grid-load-failure">\n                <div class="b-grid-load-fail">${n.L(`L{GridBase.${t}FailedMessage}`)}</div>\n                ${r&&r.message?`<div class="b-grid-load-fail">${n.L("L{serverResponseLabel}")} ${r.message}</div>`:""}\n            </div>`,n.loadmaskHideTimer=n.setTimeout(()=>{n.onCrudManagerRequestFinalize()},n.loadMaskHideTimeout)))}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize()}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize()}onCrudManagerLoad(){this.onCrudManagerRequestFinalize()}onCrudManagerSync(){this.onCrudManagerRequestFinalize()}onCrudManagerRequestFail({requestType:e,response:t}){this.onCrudManagerRequestFinalize(!1,e,t)}get crudManager(){return this._crudManager}set crudManager(e){const t=this;e&&e.isCrudManager?t._crudManager=e:e&&t.crudManagerClass?e=new t.crudManagerClass(Object.assign({scheduler:t},e)):t._crudManager=null,t.bindCrudManager(t._crudManager)}};class Ec extends B{set eventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,e&&e.autoCommit&&(t.eventStoreDetacher=e.on({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,e&&e.autoCommit&&(t.resourceStoreDetacher=e.on({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&e.autoSync&&(t.assignmentStoreDetacher=e.on({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=e,e&&e.autoSync&&(t.dependencyStoreDetacher=e.on({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){let t,r,n=e.added||[];for(r=n.length-1;r>=0;--r)t=n[r],t.isPersistable||n.splice(n.indexOf(t),1);0===n.length&&(e.added.length=0)}shallContinueSync(e){return Boolean(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}}Ec._$name="ModelPersistencyManager";class xc extends Jn{static get fields(){return[{name:"resourceId"},{name:"eventId"}]}static get relationConfig(){return[{relationName:"resource",fieldName:"resourceId",store:"resourceStore",collectionName:"assignments"},{relationName:"event",fieldName:"eventId",store:"eventStore",collectionName:"assignments"}]}get eventResourceKey(){return`${this.event?this.eventId:this.data.eventId||this.internalId}-${this.resource?this.resourceId:this.data.resourceId||this.internalId}`}get assignmentStore(){return this.stores&&this.stores[0]}get eventStore(){const{assignmentStore:e}=this;return e&&e.eventStore}get resourceStore(){const{eventStore:e}=this;return e&&e.resourceStore}get eventName(){return this.event&&this.event.name}get resourceName(){return this.resource&&this.resource.name}getResource(e=this.resourceStore){return e&&e.getById(this.resourceId)}get isAssignment(){return!0}get isPersistable(){const{event:e,resource:t,stores:r,unjoinedStores:n}=this,s=r[0];let i;return i=s?this.isValid&&(s.crudManager||!e.hasGeneratedId&&!t.hasGeneratedId):n[0],Boolean(i)}get isValid(){return null!=this.resource&&null!=this.event}fullCopy(){throw new Error("Not implemented")}get eventResourceCompositeKey(){return xc.makeAssignmentEventResourceCompositeKey(this.eventId,this.resourceId)}static makeAssignmentEventResourceCompositeKey(e,t){return`event(${e})-resource(${t})`}}xc.exposeProperties(),xc._$name="AssignmentModel";var Tc=e=>class extends(e||B){get resourceStore(){return this._resourceStore}set resourceStore(e){const t=this,r=t._resourceStore;r&&(r.eventStore=null,t.modelPersistencyManager&&(t.modelPersistencyManager.resourceStore=null)),t._resourceStore=e||null,e&&(t.modelPersistencyManager&&(t.modelPersistencyManager.resourceStore=t._resourceStore),e.eventStore=t),t.isConfiguring||t.initRelations(!0),(r||e)&&r!==e&&t.trigger("resourceStoreChange",{newResourceStore:e,oldResourceStore:r})}get assignmentStore(){return this._assignmentStore}set assignmentStore(e){const t=this,r=t._assignmentStore;r&&(r.eventStore=null,t.modelPersistencyManager&&(t.modelPersistencyManager.assignmentStore=null)),t._assignmentStore=e||null,e&&(t.modelPersistencyManager&&(t.modelPersistencyManager.assignmentStore=t._assignmentStore),e.eventStore=t),t.isConfiguring||t.initRelations(!0),(r||e)&&r!==e&&t.trigger("assignmentStoreChange",{newAssignmentStore:e,oldAssignmentStore:r})}get dependencyStore(){return this._dependencyStore}set dependencyStore(e){const t=this,r=t._dependencyStore;r&&(r.eventStore=null,t.modelPersistencyManager&&(t.modelPersistencyManager.dependencyStore=null)),t._dependencyStore=e||null,t._dependencyStore&&(t.modelPersistencyManager&&(t.modelPersistencyManager.dependencyStore=t._dependencyStore),t._dependencyStore.eventStore=t),(r||e)&&r!==e&&t.trigger("dependencyStoreChange",{newDependencyStore:e,oldDependencyStore:r})}construct(e){super.construct(e),Object.assign(this,{isEventStore:!0,autoTree:!0,modelPersistencyManager:this.createModelPersistencyManager()})}createModelPersistencyManager(){return new Ec({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}getEventsInTimeSpan(e,t,r=!0,n=!1){const s=[];return this.forEachScheduledEvent((i,o,a)=>{(r&&je.intersectSpans(o,a,e,t)||!r&&o-e>=0&&t-a>=0)&&(!n||i.resources.length>0)&&s.push(i)}),s}getEventsByStartDate(e){const t=[];return this.forEachScheduledEvent((r,n,s)=>{je.isEqual(n,e,"day")&&t.push(r)}),t}forEachScheduledEvent(e,t=this){this.forEach(r=>{const n=r.startDate,s=r.endDate;if(n&&s)return e.call(t,r,n,s)})}getTotalTimeSpan(){let e=new Date(9999,0,1),t=new Date(0);return this.forEach(r=>{r.startDate&&(e=je.min(r.startDate,e)),r.endDate&&(t=je.max(r.endDate,t))}),e=e<new Date(9999,0,1)?e:null,t=t>new Date(0)?t:null,this.lastTotalTimeSpan={startDate:e||null,endDate:t||e||null}}isEventPersistable(e){let t=!0;if(!this.assignmentStore){const r=e.stores[0],n=r&&r.crudManager;t=!r||(n||!e.resource||!e.resource.hasGeneratedId)}return t}isDateRangeAvailable(e,t,r,n){if(r instanceof xc){const s=r.event,i=s.resources,o=new Set(n.events);return i.forEach(e=>{e.events.forEach(e=>o.add(e))}),o.delete(s),!Array.from(o).some(r=>je.intersectSpans(e,t,r.startDate,r.endDate))}return!this.getEventsForResource(n).some(n=>!(r===n||!je.intersectSpans(e,t,n.startDate,n.endDate)))}filterEventsForResource(e,t,r=this){return e.getEvents(this).filter(t.bind(r))}getResourcesForEvent(e){return this.assignmentStore?this.assignmentStore.getResourcesForEvent(e):(e=this.getById(e)).resource&&!e.resource.placeHolder?[e.resource]:[]}getEventsForResource(e){if(this.assignmentStore)return this.assignmentStore.getEventsForResource(e);e=Jn.asId(e);const t=this.relationCache.resource&&this.relationCache.resource[e];return t?t.slice():[]}getAssignmentsForEvent(e){return this.assignmentStore&&this.assignmentStore.getAssignmentsForEvent(e)||[]}getAssignmentsForResource(e){return this.assignmentStore&&this.assignmentStore.getAssignmentsForResource(e)||[]}assignEventToResource(e,t,r=!1){this.assignmentStore?this.assignmentStore.assignEventToResource(e,t,void 0,r):(e=this.getById(e),Array.isArray(t)&&(t=t[0]),e&&(e.resourceId=Jn.asId(t)))}unassignEventFromResource(e,t){this.assignmentStore?this.assignmentStore.unassignEventFromResource(e,t):(e=this.getById(e),t=Jn.asId(t),e&&e.resourceId==t&&(e.resourceId=null))}reassignEventFromResourceToResource(e,t,r){const n=this,{assignmentStore:s}=n,i=Jn.asId(r),o=Jn.asId(t);if(s){const n=s.getAssignmentForEventAndResource(e,t);n?n.resourceId=i:s.assignEventToResource(e,r)}else(e=n.getById(e)).resourceId==o&&(e.resourceId=i)}isEventAssignedToResource(e,t){return this.assignmentStore?this.assignmentStore.isEventAssignedToResource(e,t):(e=this.getById(e),t=Jn.asId(t),e&&e.resourceId==t||!1)}removeAssignmentsForEvent(e){this.assignmentStore?this.assignmentStore.removeAssignmentsForEvent(e):(e=this.getById(e))&&(e.resourceId=null)}removeAssignmentsForResource(e){const{assignmentStore:t,resourceStore:r}=this;t?t.removeAssignmentsForResource(e):r?e=r.getById(e):(e=Jn.asId(e),this.forEach(t=>t.resourceId==e&&(t.resourceId=null)))}};class Rc extends(br(G())){get delayedCallTimeout(){return isNaN(this._delayedCallTimeout)?100:this._delayedCallTimeout}set delayedCallTimeout(e){this._delayedCallTimeout=e}cancel(...e){const{delayedCalls:t}=this;if(t){const r=e.length?e:Object.keys(t);for(let e=r.length-1;e>=0;e--){const n=t[r[e]];n&&n.timer&&(this.clearTimeout(n.timer),n.timer=null)}}}invoke(e){const{id:t,scope:r,beforeFn:n}=e,s=I.capitalizeFirstLetter(t);this.trigger(`delayed${s}Start`,e),n&&n.call(r,e);const{afterFn:i,fn:o,entries:a}=e;let l,c=[];for(;l=a.shift();)c.push(o.call(r,e,...l));return i&&i.call(r,e),this.trigger(`delayed${s}End`,e),e.delete(),c}execute(e={}){return new Promise((t,r)=>{const n=this;n.delayedCalls=n.delayedCalls||{};const{id:s,args:i,timeout:o}=e;n.delayedCalls[s]||(n.delayedCalls[s]=Object.assign({delete:()=>delete n.delayedCalls[s],entries:[],scope:this,id:s},e),delete n.delayedCalls[s].args);const a=n.delayedCalls[s];n.cancel(s),a.entries.push(i||[]),a.timer=n.setTimeout(()=>{a.results=n.invoke(a),t(a)},o||n.delayedCallTimeout)})}}Rc._$name="DelayedCallsManager";class Mc extends B{static get frequency(){return"NONE"}static get MAX_OCCURRENCES_COUNT(){return 1e6}static getNthDayInPeriod(e,t,r,n){let s,i,o;if(n){const a=864e5,l=6048e5;n>0?(i=1,o=e):(i=-1,o=t);const c=r-o.getDay();i*c<0&&(n+=i),s=new Date(o.getTime()+(n-i)*l+c*a),(s<e||s>t)&&(s=null)}return s}static buildDate(e,t,r){const n=new Date(e,t,r);if(n.getFullYear()==e&&n.getMonth()==t&&n.getDate()==r)return n}static isValidPosition(e){return Boolean(e)}static forEachDateAtPositions(e,t,r,n){const s=e.length,i={};for(let o=0;o<t.length;o++){const a=t[o];if(this.isValidPosition(a)){const t=a>0?e[a-1]:e[s+a];if(t&&!i[t.getTime()]&&(i[t.getTime()]=!0,!1===r.call(n,t)))return!1}}}}Mc._$name="AbstractRecurrenceIterator";class kc extends Mc{static get frequency(){return"DAILY"}static forEachDate(e){const t=this,{recurrence:r,fn:n,scope:s=t}=e,{timeSpan:i,endDate:o,interval:a}=r,l=i.startDate;let c=e.startDate||l,d=e.endDate||o,u=r.count,h=0;o&&d&&d>o&&(d=o),l>c&&(c=l);const g=c-l,m=864e5*a,p=Math.floor(g/m);d||u||(u=t.MAX_OCCURRENCES_COUNT);let f=je.add(l,p,"day");for(;(!d||f<=d)&&(h++,!(f>=c&&(d&&f>d||!1===n.call(s,f,h)||u&&h>=u)));)f=je.add(f,a,"day")}}kc._$name="DailyRecurrenceIterator";const Ic=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,Fc=["SU","MO","TU","WE","TH","FR","SA"];class Ac extends B{static decodeDay(e){let t,r;return(t=Ic.exec(e))&&(r=[Fc.indexOf(t[2])],t[1]&&(t[1]=parseInt(t[1],10),r.push(t[1]))),r}static encodeDay(e){let t;return Array.isArray(e)&&([e,t]=e),(t?t.toString():"")+Fc[e]}static decode(e){let t,r=[];if(e)for(let n=0;n<e.length;n++)(t=this.decodeDay(e[n]))&&r.push(t);return r}static encode(e){let t,r=[];if(e)for(let n=0;n<e.length;n++)(t=this.encodeDay(e[n]))&&r.push(t);return r}}Ac._$name="RecurrenceDayRuleEncoder";class Pc extends Mc{static get frequency(){return"WEEKLY"}static forEachDate(e){const t=this,{fn:r,recurrence:n,scope:s=t}=e,{timeSpan:i,interval:o,days:a,endDate:l}=n,c=i.startDate;let d,u,h=0,g=e.startDate||c,m=e.endDate||l,{count:p}=n,f=Ac.decode(a);for(l&&m&&m>l&&(m=l),f&&f.length?f.sort((e,t)=>e[0]-t[0]):f=[[c.getDay()]],c>g&&(g=c),d=je.getNext(p?c:g,"week",0,0),m||p||(p=t.MAX_OCCURRENCES_COUNT);!m||d<=m;){for(let e=0;e<f.length;e++)if(u=je.copyTimeValues(je.add(d,f[e][0],"day"),c),u>=c&&(h++,u>=g&&(m&&u>m||!1===r.call(s,u,h)||p&&h>=p)))return;d=je.getNext(d,"week",o,0)}}}Pc._$name="WeeklyRecurrenceIterator";class Lc extends Mc{static get frequency(){return"MONTHLY"}static getNthDayOfMonth(e,t){const r=je.daysInMonth(e);let n=null;return t&&Math.abs(t)<=r&&(n=new Date(e.getFullYear(),e.getMonth(),t<0?r+t+1:t)),n}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(e){const t=this,{fn:r,recurrence:n,scope:s=t}=e,{timeSpan:i,interval:o,days:a,endDate:l,count:c,positions:d}=n,u=i.startDate,h=Ac.decode(a),g=d&&d.length,m={};let p,f,v,y,b,C,w=e.startDate||u,S=e.endDate||l,{monthDays:D}=n,E=0;for(l&&S&&S>l&&(S=l),u>w&&(w=u),f=je.startOf(c?u:w,"month"),v=new Date(je.getNext(f,"month",1)-1),D&&D.length||h&&h.length||(D=[u.getDate()]),h&&h.length&&h.forEach(e=>{e[1]&&(p=p||{},p[e[0]]=e[1])});(!S||S>=f)&&(!c||E<c);){if(y=[],h&&h.length){if(h.forEach(e=>{const r=e[0];let n=1,s=53;for(e[1]&&(n=s=e[1]),C=n;C<=s;C++)(b=t.getNthDayInPeriod(f,v,r,C))&&(b=je.copyTimeValues(b,u),m[b.getTime()]||(m[b.getTime()]=!0,y.push(b)))}),y.sort((e,t)=>e-t),!g)for(C=0;C<y.length;C++)if(b=y[C],b>=u&&(E++,b>=w&&(S&&b>S||!1===r.call(s,b,E)||c&&E>=c)))return!1}else{const e=[];for(C=0;C<D.length;C++)(b=t.getNthDayOfMonth(f,D[C]))&&!m[b.getTime()]&&(m[b.getTime()]=!0,e.push(b));for(e.sort((e,t)=>e-t),C=0;C<e.length;C++)if(b=je.copyTimeValues(e[C],u),g)y.push(b);else if(b>=u&&(E++,b>=w&&(S&&b>S||!1===r.call(s,b,E)||c&&E>=c)))return}g&&y.length&&t.forEachDateAtPositions(y,d,e=>{if(e>=u&&(E++,e>=w&&(!S||e<=S)&&(!1===r.call(s,e,E)||c&&E>=c)))return!1}),f=je.getNext(f,"month",o),v=new Date(je.getNext(f,"month",1)-1)}}}Lc._$name="MonthlyRecurrenceIterator";class Oc extends Mc{static get frequency(){return"YEARLY"}static forEachDate(e){const t=this,{fn:r,recurrence:n,scope:s=t}=e,{timeSpan:i,interval:o,days:a,count:l,positions:c,endDate:d}=n,u=i.startDate,h=Ac.decode(a),g=c&&c.length,m={};let p,f,v,y,b,C,w=e.startDate||u,S=e.endDate||d,{months:D}=n,E=0;for(d&&S&&S>d&&(S=d),u>w&&(w=u),y=je.startOf(l?u:w,"year"),b=new Date(je.getNext(y,"year",1)-1),D&&D.sort((e,t)=>e-t),D&&D.length||h&&h.length||(D=[u.getMonth()+1]),h&&h.length&&h.forEach(e=>{e[1]&&(C=C||{},C[e[0]]=e[1])});(!S||S>=y)&&(!l||E<l);){if(v=[],h&&h.length){if(h.forEach(e=>{let r=e[0],n=1,s=53;for(e[1]&&(n=s=e[1]),p=n;p<=s;p++)(f=t.getNthDayInPeriod(y,b,r,p))&&(f=je.copyTimeValues(f,u),m[f.getTime()]||(m[f.getTime()]=!0,v.push(f)))}),v.sort((e,t)=>e-t),!g)for(p=0;p<v.length;p++)if(f=v[p],f>=u&&(E++,f>=w&&(S&&f>S||!1===r.call(s,f,E)||l&&E>=l)))return}else for(p=0;p<D.length;p++)if((f=t.buildDate(y.getFullYear(),D[p]-1,u.getDate()))&&(f=je.copyTimeValues(f,u),!m[f.getTime()]))if(m[f.getTime()]=!0,g)v.push(f);else if(f>=u&&(E++,f>=w&&(S&&f>S||!1===r.call(s,f,E)||l&&E>=l)))return;g&&v.length&&t.forEachDateAtPositions(v,c,e=>{if(e>=u&&(E++,e>=w&&(!S||e<=S)&&(!1===r.call(s,e,E)||l&&E>=l)))return!1}),y=je.getNext(y,"year",o),b=new Date(je.getNext(y,"year",1)-1)}}}Oc._$name="YearlyRecurrenceIterator";var _c=e=>class extends(e||B){static get $name(){return"RecurringTimeSpansMixin"}get supportsRecurringTimeSpans(){return!0}get delayedCallTimeout(){return isNaN(this._delayedCallTimeout)?100:this._delayedCallTimeout}set delayedCallTimeout(e){this._delayedCallTimeout=e}get delayedCallsManager(){return this._delayedCallsManager=this._delayedCallsManager||new Rc({delayedCallTimeout:this.delayedCallTimeout}),this._delayedCallsManager}setupRecurringTimeSpans(){const e=this;e.recurrenceIterators=e.recurrenceIterators||[],e.addRecurrenceIterators(kc,Pc,Lc,Oc),e.relayEvents(e.delayedCallsManager,["delayedRegenerateOccurrencesStart","delayedRegenerateOccurrencesEnd","delayedGenerateOccurrencesStart","delayedGenerateOccurrencesEnd"]),e.delayedCallsManager.on({delayedRegenerateOccurrencesEnd:e.onDelayedRegenerateOccurrencesFinish,delayedGenerateOccurrencesEnd:e.onDelayedGenerateOccurrencesFinish,thisObj:e})}doDestroy(){this.delayedCallsManager.destroy()}addRecurrenceIterators(...e){e.forEach(e=>this.recurrenceIterators[e.frequency]=e)}getRecurrenceIteratorForTimeSpan(e){return this.recurrenceIterators[e.recurrence.frequency]}buildOccurrencesForTimeSpan(e,t,r,n){const s=[];if(e.isRecurring&&e.startDate){const i=this,o=e.recurrence,a=i.getRecurrenceIteratorForTimeSpan(e),l=e.exceptionDates?e.exceptionDates.reduce((e,t)=>(e[t.getTime()]=!0,e),{}):{};a.forEachDate({recurrence:o,startDate:t,endDate:r,fn(t){l[t.getTime()]||n&&e.getOccurrenceByStartDate(t)||s.push(e.buildOccurrence(t))}})}return s}mergeDelayedCallEntries(e){let t,r,n,s,i,o=e.entries,a={};for(let e=0;e<o.length;e++){i=o[e],[n,t,r]=i;for(let e=0;e<n.length;e++){s=n[e];const o=a[s.id];o?(o[1]>t&&(o[1]=t),o[2]<r&&(o[2]=r)):a[s.id]=[[s],...i.slice(1)]}}o=Object.values(a);const l={};for(let e=0;e<o.length;e++){i=o[e],[s,t,r]=i;const n=(t?t.getTime():"")+"-"+(r?r.getTime():"");l[n]?l[n][0]=l[n][0].concat(s):l[n]=i}e.entries=Object.values(l)}regenerateOccurrencesForTimeSpansBuffered(e,t,r){const n=this;return Array.isArray(e)||(e=[e]),(e=e.filter(e=>e.isRecurring)).length?new Promise(async(s,i)=>{const o=await n.delayedCallsManager.execute({id:"regenerateOccurrences",beforeFn:n.mergeDelayedCallEntries,args:[e,t,r],fn(e,t,r,s){(e.toRemove=e.toRemove||[]).push(...n.getOccurrencesForTimeSpans(t)),e.added=n.generateOccurrencesForTimeSpans(t,r,s,!1)},afterFn(e){const{toRemove:t}=e;t.length&&(e.removed=n.remove(t))}});s({added:o.added,removed:o.removed})}):Promise.resolve()}generateOccurrencesForTimeSpansBuffered(e,t,r,n=!0){const s=this;return Array.isArray(e)||(e=[e]),(e=e.filter(e=>e.isRecurring)).length?new Promise(async i=>{i({added:(await s.delayedCallsManager.execute({id:"generateOccurrences",beforeFn:s.mergeDelayedCallEntries,args:[e,t,r,n],fn(e,...t){e.added=s.generateOccurrencesForTimeSpans(...t)}})).added})}):Promise.resolve()}generateOccurrencesForTimeSpans(e,t,r,n=!0){const s=[];if(e){const i=this;let o=[];if(Array.isArray(e)||(e=[e]),e.length){for(let a=0;a<e.length;a++){let l,c,d,u=e[a];(o=i.buildOccurrencesForTimeSpan(u,t,r,n))&&(d=u.startDate,t<=d&&(c=o.shift())&&(l=c.startDate,l-d&&(u.setStartEndDate(l,c.endDate),u.recurrence.sanitize())),s.push(...o))}s.length&&i.add(s)}}return s}generateOccurrencesForAll(e,t,r=!1){const n=this,s=n.getRecurringTimeSpans();let i=[];return s.length&&(n.trigger("generateOccurrencesAllStart",{timeSpans:s,startDate:e,endDate:t,preserveExisting:r}),i=n.generateOccurrencesForTimeSpans(s,e,t,r),n.trigger("generateOccurrencesAllEnd",{timeSpans:s,startDate:e,endDate:t,preserveExisting:r})),i}getRecurringTimeSpans(){return this.query(e=>e.supportsRecurring&&e.isRecurring)}getOccurrencesForTimeSpans(e){const t=[];if(Array.isArray(e)||(e=[e]),e.length)for(let r=0;r<e.length;r++){const n=e[r].id;t.push(...this.query(e=>e.supportsRecurring&&e.recurringTimeSpanId==n))}return t}getOccurrencesForAll(){return this.query(e=>e.supportsRecurring&&e.isOccurrence)}removeOccurrencesForTimeSpans(e){return this.remove(this.getOccurrencesForTimeSpans(e))}removeOccurrencesForAll(){return this.remove(this.getOccurrencesForAll())}onDelayedRegenerateOccurrencesFinish(){this.trigger("occurrencesReady")}onDelayedGenerateOccurrencesFinish(){this.trigger("occurrencesReady")}},$c=e=>class extends(_c(e||B)){static get $name(){return"RecurringEventsMixin"}get supportsRecurringEvents(){return!0}setupRecurringEvents(...e){return this.setupRecurringTimeSpans(...e)}generateOccurrencesForEvents(...e){return this.generateOccurrencesForTimeSpans(...e)}generateOccurrencesForEventsBuffered(...e){return this.generateOccurrencesForTimeSpansBuffered(...e)}regenerateOccurrencesForEvents(...e){return this.regenerateOccurrencesForTimeSpans(...e)}regenerateOccurrencesForEventsBuffered(...e){return this.regenerateOccurrencesForTimeSpansBuffered(...e)}getRecurringEvents(){return this.getRecurringTimeSpans()}getOccurrencesForEvents(e){return this.getOccurrencesForTimeSpans(e)}removeOccurrencesForEvents(e){return this.removeOccurrencesForTimeSpans(e)}isEventPersistable(e){return super.isEventPersistable(e)&&(!e.supportsRecurring||!e.isOccurrence)}};class jc extends Jn{static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0},{name:"durationUnit",type:"string",defaultValue:"d"},{name:"fullDuration",persist:!1},{name:"cls",defaultValue:""},"iconCls",{name:"style",type:"object"},{name:"name",type:"string"}]}afterConstruct(){super.afterConstruct(),this.normalize()}normalize(){const e=this,{startDate:t,endDate:r,duration:n,durationUnit:s}=e,i=null!=n;t&&r&&!i?e.setData("duration",je.diff(t,r,s,!0)):t&&!r&&i?e.setData("endDate",je.add(t,n,s)):!t&&r&&i&&e.setData("startDate",je.add(r,-n,s)),this.clearCachedValues()}get cls(){return this._cls||(this._cls=new Ve(super.get("cls"))),this._cls}set cls(e){const t=this;t._cls?t._cls.value=e:t._cls=new Ve(e),t.set("cls",t._cls.value)}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,t=this.durationUnit){const r={duration:e=parseFloat(e),durationUnit:t};this.startDate?r.endDate=je.add(this.startDate,e,t):this.endDate&&(r.startDate=je.add(this.endDate,-e,t)),this.set(r)}get fullDuration(){return new ti({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(e){"string"==typeof e&&(e=je.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)}setStartDate(e,t=!0){const r=this,n={startDate:e};if(e){let s;if(t)s=null!=r.duration;else if(r.endDate){if(n.duration=je.diff(e,r.endDate,r.durationUnit,!0),n.duration<0)throw new Error("Negative duration")}else s=null!=this.duration;s&&(n.endDate=je.add(e,r.duration,r.durationUnit))}else n.duration=null;r.set(n)}setEndDate(e,t=!1){const r=this,n={endDate:e};if(e){let s;if(!0===t)s=null!=r.duration;else if(r.startDate){if(n.duration=je.diff(r.startDate,e,r.durationUnit,!0),n.duration<0)throw new Error("Negative duration")}else s=null!=this.duration;s&&(n.startDate=je.add(e,-r.duration,r.durationUnit))}r.set(n)}setStartEndDate(e,t){this.set({startDate:e,endDate:t})}get dates(){const e=[],t=je.startOf(this.startDate,"day"),r=this.endDate;for(let n=t;n<r;n=je.add(n,1,"day"))e.push(n);return e}get durationMS(){return this.endDate&&this.startDate?this.endDateMS-this.startDateMS:je.asMilliseconds(this.duration||0,this.durationUnit)}clearCachedValues(){this._startDateMS=null,this._endDateMS=null,this._isMilestone=null}get endDateMS(){const e=this;return null==e._endDateMS&&(e._endDateMS=e.endDate&&e.endDate.getTime()),e._endDateMS}get startDateMS(){const e=this;return null==e._startDateMS&&(e._startDateMS=e.startDate&&e.startDate.getTime()),e._startDateMS}get isMilestone(){const e=this;return null==e._isMilestone&&(e._isMilestone=0===e.durationMS),e._isMilestone}inSetNormalize(e){if("string"!=typeof e){let{startDate:t,endDate:r,duration:n,durationUnit:s}=e;return"string"==typeof t&&(t=this.getFieldDefinition("startDate").convert(t)),"string"==typeof r&&(r=this.getFieldDefinition("endDate").convert(r)),"duration"in e?(t&&!r&&(r=je.add(t,n,s||this.durationUnit,!0,!0)),!t&&r&&(t=je.add(r,-n,s||this.durationUnit,!0,!0))):t&&r&&(n=je.diff(t,r,s||this.durationUnit,!0)),t&&(e.startDate=t),r&&(e.endDate=r),null!=n&&(e.duration=n),e}}inSet(e,t,r,n){return this.clearCachedValues(),e=this.inSetNormalize(e)||e,super.inSet(e,t,r,n)}beginBatch(){this.clearCachedValues(),super.beginBatch()}forEachDate(e,t){return this.dates.forEach(e.bind(t))}get isScheduled(){return Boolean(this.startDate&&this.endDate&&this.hasValidDates)}get isValid(){const e=this;let t=!0;if(t){const r=e.startDate,n=e.endDate;t=!r||!n||n-r>=0}return t}get hasValidDates(){const e=this.startDateMS,t=this.endDateMS;return!e||!t||t-e>=0}shift(e,t=this.durationUnit){if("string"==typeof e){const r=e;e=t,t=r}this.setStartDate(je.add(this.startDate,e,t,!0),!0)}get wbsCode(){return this.indexPath.join(".")}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,t){const r=this.startDate,n=this.endDate;return r&&n&&je.intersectSpans(r,n,e,t)}split(e=.5){const t=this,r=this.copy(),n=t.firstStore,s=n&&n.assignmentStore,i=t.duration*e,o=t.duration-i;if(e<=0||e>=1)throw new Error("Split point must be > 0 and < 1");return t.duration=i,r.startDate=t.endDate,r.duration=o,n&&n.add(r),s&&s.add(t.assignments.map(e=>{const t=Object.assign({},e.data,{eventId:r.id});return delete t.id,t})),r}}function Hc(e){return e?"string"==typeof e&&(e=e.split(",").map(e=>parseInt(e,10))):e=null,e}function Nc(e){return e?"string"==typeof e&&(e=e.split(",")):e=null,e}function Bc(e,t){return String(e)===String(t)}function zc(e){return this.defaultValue&&void 0===e?this.defaultValue:this.allowNull&&null==e?null:(e=parseInt(e),isNaN(e)&&(e=void 0),e)}jc._$name="TimeSpan";class Vc extends Jn{get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:zc},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:zc},{name:"days",convert:Nc,isEqual:Bc},{name:"monthDays",convert:Hc,isEqual:Bc},{name:"months",convert:Hc,isEqual:Bc},{name:"positions",convert:Hc,isEqual:Bc}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get rule(){const e=this,t=[];return e.frequency&&(t.push("FREQ="+e.frequency),e.interval>1&&t.push("INTERVAL="+e.interval),e.days&&e.days.length&&t.push("BYDAY="+e.days.join(",")),e.monthDays&&e.monthDays.length&&t.push("BYMONTHDAY="+e.monthDays.join(",")),e.months&&e.months.length&&t.push("BYMONTH="+e.months.join(",")),e.count&&t.push("COUNT="+e.count),e.endDate&&t.push("UNTIL="+je.format(e.endDate,e.dateFormat)),e.positions&&e.positions.length&&t.push("BYSETPOS="+e.positions.join(","))),t.join(";")}set rule(e){const t=this;if(t.beginBatch(),e){const r=e.split(";");for(let e=0,n=r.length;e<n;e++){const n=r[e].split("="),s=n[1];switch(n[0]){case"FREQ":t.frequency=s;break;case"INTERVAL":t.interval=s;break;case"COUNT":t.count=s,t.until=null;break;case"UNTIL":t.endDate=s?je.parse(s,t.dateFormat):null,t.count=null;break;case"BYDAY":t.days=s;break;case"BYMONTHDAY":t.monthDays=s;break;case"BYMONTH":t.months=s;break;case"BYSETPOS":t.positions=s}}t.sanitize()}else t.set({frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null});t.endBatch()}construct(e={}){const t=this,{rule:r,timeSpan:n}=e;t._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,super.construct(...arguments),r&&(t.suspendTimeSpanNotifying(),t.rule=r,t.resumeTimeSpanNotifying()),t.timeSpan=n}sanitize(){const e=this,t=e.timeSpan,r=t&&t.startDate;switch(e.beginBatch(),e.isSanitizing=!0,e.frequency){case"DAILY":e.positions=null,e.days=null,e.monthDays=null,e.months=null;break;case"WEEKLY":e.positions=null,e.monthDays=null,e.months=null;const t=e.days;r&&t&&1==t.length&&t[0]==Ac.encodeDay(r.getDay())&&(e.days=null);break;case"MONTHLY":e.monthDays&&e.monthDays.length&&(e.positions=null,e.days=null),e.months=null;const n=e.monthDays;r&&n&&1==n.length&&n[0]==r.getDate()&&(e.monthDays=null);break;case"YEARLY":e.monthDays=null;const s=e.months;r&&s&&1==s.length&&s[0]==r.getMonth()+1&&(e.months=null)}e.isSanitizing=!1,e.endBatch()}copy(...e){const t=super.copy(...e);return t.dateFormat=this.dateFormat,t.timeSpan=this.timeSpan,t}afterChange(e,t,r){const n=super.afterChange(e,t,r);this.isSanitizing||this.sanitize();const{timeSpan:s}=this;return s&&!this.isTimeSpanNotifyingSuspended&&s.onRecurrenceChanged(),n}get count(){return this.get("count")}set count(e){e&&(this.endDate=null),this.set("count",e)}get endDate(){return this.get("endDate")}set endDate(e){e&&(this.count=null),this.set("endDate",e)}get isTimeSpanNotifyingSuspended(){return Boolean(this._suspendedTimeSpanNotifying)}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}}function Wc(e){if(e){const t=this.dateFormat;e=(e="string"==typeof e?e.split(","):e).map(e=>("string"==typeof e&&(e=je.parse(e,t)),e))}return e}Vc._$name="RecurrenceModel";var Gc=e=>class extends(e||jc){get supportsRecurring(){return!0}static get fields(){return[{name:"recurringTimeSpanId"},{name:"recurrenceRule"},{name:"exceptionDates",convert:Wc}]}get recurrenceModel(){return this._recurrenceModel||Vc}set recurrenceModel(e){this._recurrenceModel=e}setRecurrence(e,t,r){const n=this;let s,i;e&&(e.isRecurrenceModel?s=e:"string"==typeof e?(s=new this.recurrenceModel,s.frequency=e,t&&(s.interval=t),r&&(r instanceof Date?s.endDate=r:s.count=r)):s=new this.recurrenceModel(e),s.timeSpan=n,i=s.rule),n.recurrence=s,n.recurrenceRule=i}get recurrence(){const e=this,t=e.recurrenceRule;return!e._recurrence&&t&&(e._recurrence=new e.recurrenceModel({rule:t,timeSpan:e})),e._recurrence}set recurrence(e){const t=this;let r;if(t.isOccurrence){const e=t.recurringTimeSpan;r=e&&e.recurrence,t.recurringTimeSpanId=null}e&&r&&(r.endDate=new Date(t.startDate-1)),t._recurrence=e,e?(e.timeSpan=t,t.recurrenceRule=e.rule):t.recurrenceRule=null}get isRecurring(){return this.recurrence&&!this.isOccurrence}get isOccurrence(){return Boolean(this.recurringTimeSpanId)}get recurringTimeSpan(){const e=this.recurringTimeSpanId,t=this.stores[0];return e&&t&&t.getById(e)}getOccurrenceByStartDate(e){let t,r;if(e){r=this.occurrences;for(let n=0;n<r.length;n++)if(r[n].startDate-e==0){t=r[n];break}}return t}get occurrences(){const e=this.stores[0];return e&&e.getOccurrencesForTimeSpans&&e.getOccurrencesForTimeSpans(this)}removeOccurrences(){const e=this.stores[0];return e&&e.removeOccurrencesForTimeSpans&&e.removeOccurrencesForTimeSpans(this)}onRecurrenceChanged(){this.recurrenceRule=this.recurrence&&this.recurrence.rule||null}buildOccurrence(e){const t=this.copy(null);return t.beginBatch(),t.setStartDate(e),t.recurringTimeSpanId=this.id,t.endBatch(),t}afterChange(e,t,r,...n){return"recurrenceRule"in t&&(this._recurrence=null),super.afterChange(e,t,r,...n)}addExceptionDate(e){const t=this,r=t.exceptionDates||[];e&&(t.exceptionDates=r.concat(e))}beforeStartDateChange(){this._startDateValue=this.startDate}afterStartDateChange(){this._startDateValue-this.startDate&&this.exceptionDates&&(this.exceptionDates=null)}};class Uc extends(Gc()){static get fields(){return[{name:"resourceId"},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0},"eventStyle","eventColor","milestoneWidth"]}static get relationConfig(){return[{relationName:"resource",fieldName:"resourceId",store:"resourceStore",collectionName:"events"}]}get eventStore(){const e=this;return e._eventStore||(e._eventStore=e.stores&&e.stores.find(e=>e.isEventStore)),e._eventStore}get resourceStore(){const e=this.eventStore;return e&&e.resourceStore}get assignmentStore(){const e=this.eventStore;return e&&e.assignmentStore}get resources(){return this.eventStore&&this.eventStore.getResourcesForEvent(this)||[]}forEachResource(e,t=this){for(let r of this.resources)if(!1===e.call(t,r))return}getResource(e=this.resourceId){let t=this,r=t.eventStore,n=r&&r.resourceStore;if(r&&e){let e=r.getResourcesForEvent(t);if(1==e.length)return e[0];if(e.length>1)throw new Error("Event::getResource() is not applicable for events with multiple assignments, please use Event::resources instead.");return null}if(n)return n?n.getById(e):null}get isEvent(){return!0}get isDraggable(){return this.draggable}get isResizable(){return!this.isMilestone&&this.resizable}get isPersistable(){const e=this.eventStore;return e&&e.isEventPersistable(this)}assign(e){const t=this,r=t.eventStore;e=Jn.asId(e),r?r.assignEventToResource(t,e):t.resourceId=e}unassign(e,t){const r=this,n=r.eventStore;e=Jn.asId(e),r.meta.removingResource=t,n?n.unassignEventFromResource(r,e):r.resourceId==e&&(r.resourceId=null),r.meta.removingResource=null}reassign(e,t){const r=this,n=r.eventStore;e=Jn.asId(e),t=Jn.asId(t),n?n.reassignEventFromResourceToResource(r,e,t):r.resourceId=t}isAssignedTo(e){let t=this.eventStore;return e=Jn.asId(e),t?t.isEventAssignedToResource(this,e):this.resourceId==e}get recurringEvent(){return this.recurringTimeSpan}}Uc.exposeProperties(),Uc._$name="EventModel";class Yc extends($c(Tc(Ds))){static get defaultConfig(){return{loadPriority:100,syncPriority:200,modelClass:Uc,storeId:"events"}}construct(e){if(super.construct(e,!0),this.setupRecurringEvents(),this.modelClass!==Uc&&!(this.modelClass.prototype instanceof Uc))throw new Error("The model for the EventStore must subclass EventModel")}append(e){this.add(e)}}Yc._$name="EventStore";class qc extends Jn{static get fields(){return[{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(e){super.construct(...arguments),this.normalizeUnits()}static processData(e,...t){return e.headerConfig&&(A.deprecate("Scheduler","4.0.0","ViewPreset headerConfig config replaced by headers config. See https://www.bryntum.com/docs/scheduler/#guides/upgrades/3.0.md"),e=ze.assign({},e),this.normalizeHeaderConfig(e)),super.processData(e,...t)}generateId(e){const t=this,{headers:r}=t,n=[];let s=Object.getPrototypeOf(t.data).id;if(!s){for(let{length:e}=r,t=e-1;t>=0;t--)n.push(t?r[t].unit:I.capitalizeFirstLetter(r[t].unit));s=n.join("And")}return e.includes(s)&&(s+=`-${t.tickWidth}by${t.tickHeight||t.tickWidth}`,e.includes(s)&&(s+="-"+t.bottomHeader.increment,e.includes(s)&&(s=K.generateId(s+"-")))),s}normalizeUnits(){const e=this,{timeResolution:t,headers:r}=e;for(let e=0,{length:t}=r;e<t;e++){const t=r[e];t.unit=je.normalizeUnit(t.unit),t.splitUnit&&(t.splitUnit=je.normalizeUnit(t.splitUnit)),"increment"in t||(r[e]=Object.assign({increment:1},t))}t&&(t.unit=je.normalizeUnit(t.unit)),e.shiftUnit&&(e.shiftUnit=je.normalizeUnit(e.shiftUnit))}static normalizeHeaderConfig(e){const{headerConfig:t,columnLinesFor:r,mainHeaderLevel:n}=e,s=e.headers=[];if(t.top&&("top"==r&&(e.columnLinesFor=0),"top"==n&&(e.mainHeaderLevel=0),s[0]=t.top),!t.middle)throw new Error("ViewPreset.headerConfig must be configured with a middle");"middle"==r&&(e.columnLinesFor=s.length),"middle"==n&&(e.mainHeaderLevel=s.length),s.push(t.middle),t.bottom&&(e.mainHeaderLevel=s.length-1,null==r?e.columnLinesFor=s.length-1:"bottom"==r&&(e.columnLinesFor=s.length),null==n&&(e.mainHeaderLevel=s.length-1),"bottom"==n&&(e.mainHeaderLevel=s.length),s.push(t.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const e={},{headers:t}=this,{length:r}=t;switch(r){case 1:e.middle=t[0];break;case 2:0===this.mainHeaderLevel?(e.middle=t[0],e.bottom=t[1]):(e.top=t[0],e.middle=t[1]);break;case 3:e.top=t[0],e.middle=t[1],e.bottom=t[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return e}set mainHeaderLevel(e){this.data.mainHeaderLevel=e}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:3===this.data.headers.length?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get mainUnit(){return this.mainHeader}get msPerPixel(){const{bottomHeader:e}=this;return Math.round(je.asMilliseconds(e.increment||1,e.unit)/this.tickWidth)}get isValid(){const e=this;let t=!0;for(const r of e.headers)t=t&&Boolean(je.normalizeUnit(r.unit));return e.timeResolution&&(t=t&&je.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(t=t&&je.normalizeUnit(e.shiftUnit)),t}}qc._$name="ViewPreset";class Xc extends(ae(Cs)){static get defaultConfig(){return{useRawData:!0,modelClass:qc,zoomOrder:1}}set storage(e){super.storage=e,this.storage.addSorter((e,t)=>{const r=e.bottomHeader,n=t.bottomHeader;return(t.msPerPixel-e.msPerPixel||$e[r.unit]-$e[n.unit]||r.increment-n.increment)*this.zoomOrder})}get storage(){return super.storage}createRecord(e){if(e.preset&&!e.base&&(A.deprecate("Scheduler","4.0.0","ViewPreset preset config replaced by base config. See https://www.bryntum.com/docs/scheduler/#guides/upgrades/3.0.md"),e.base=e.preset),e.base){const t=this.getById(e.base)||Kc.getById(e.base);e=Object.setPrototypeOf(e,t.data)}return super.createRecord(...arguments)}updateLocalization(){super.updateLocalization(),this.forEach(e=>{const t=this.L(e.id);t&&(t.displayDateFormat&&(e.displayDateFormat=t.displayDateFormat),t.middleDateFormat&&e.headerConfig.middle&&(e.headerConfig.middle.dateFormat=t.middleDateFormat),t.topDateFormat&&e.headerConfig.top&&(e.headerConfig.top.dateFormat=t.topDateFormat),t.bottomDateFormat&&e.headerConfig.bottom&&(e.headerConfig.bottom.dateFormat=t.bottomDateFormat))})}}Xc._$name="PresetStore";const Kc=new class extends Xc{static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"llll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Hours",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Hours 2",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer:e=>`\n                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${je.format(e,"HH")}</span>\n                                    <span class="b-sch-calendarcolumn-minutes">${je.format(e,"mm")}</span></div>\n                                `}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer:e=>`\n                                    <div class="sch-calendarcolumn-ct">\n                                    <span class="sch-calendarcolumn-hours">${je.format(e,"HH")}</span>\n                                    <span class="sch-calendarcolumn-minutes">${je.format(e,"mm")}</span>\n                                    </div>\n                                `}]},dayAndWeek:{name:"Days 2",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer:e=>je.getShortNameOfUnit("week")+"."+je.format(e,"WW MMM YYYY")},{unit:"day",dateFormat:"dd DD"}]},weekAndDay:{name:"Days",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks 2",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Weeks 3",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer:(e,t,r)=>je.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)}]},manyYears:{name:"Years 2",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",dateFormat:"YYYY",increment:5},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","weekAndDay",{width:54,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:30,increment:15,resolution:5,preset:"minuteAndHour"},{width:130,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:5,resolution:5,preset:"minuteAndHour"},{width:100,increment:5,resolution:5,preset:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,preset:"secondAndMinute"},{width:130,increment:5,resolution:5,preset:"secondAndMinute"}],listeners:{locale:"updateLocalization"}}}set basePresets(e){const t=this._basePresets={};for(const r in e)e[r].id=r,t[r]=this.createRecord(e[r])}get basePresets(){return this._basePresets}set defaultPresets(e){for(let t=0,{length:r}=e;t<r;t++){const r=e[t],n="string"==typeof r,s=n?r:r.preset;let i;if(n)i=this.basePresets[s];else{const e=Object.setPrototypeOf(ze.clone(this.basePresets[s].data),{id:s}),{timeResolution:t}=e,n=e.headers[e.headers.length-1];e.id=void 0,"width"in r&&(e.tickWidth=r.width),"height"in r&&(e.tickHeight=r.height),"increment"in r&&(n.increment=r.increment),"resolution"in r&&(t.increment=r.resolution),"resolutionUnit"in r&&(t.unit=je.getUnitByName(r.resolutionUnit)),i=this.createRecord(e)}this.add(i)}}getById(e){return super.getById(e)||this.basePresets[e]}registerPreset(e,t){const r=this.createRecord(Object.assign({id:e},t)),n=this.find(e=>e.equals(r));if(n)return n;if(!r.isValid)throw new Error("Invalid preset, please check your configuration");return this.add(r),r}getPreset(e){return"number"==typeof e&&(e=this.getAt(e)),"string"==typeof e?e=this.getById(e):e instanceof qc||(e=this.createRecord(e)),e}normalizePreset(e){let t=this;if(!(e instanceof qc))if("string"==typeof e){if(!(e=t.getPreset(e)))throw new Error("You must define a valid view preset. See PresetManager for reference")}else if("object"==typeof e){if(e.base){const t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=ze.merge(ze.clone(t.data),e)}e.id?e=t.createRecord(e):(e=t.createRecord(ze.assign({},e))).id=e.generateId(e)}return e}deletePreset(e){"string"==typeof e?e=this.getById(e):"number"==typeof e&&(e=this.getAt(e)),e&&(this.remove(e),delete this.basePresets[e.id])}};class Zc extends Cs{static get defaultConfig(){return{modelClass:jc,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,weekStartDay:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,defaultSpan:1,tickCache:{},viewPreset:null}}construct(e){const t=this;if(t.generateTicksValidatorFn=()=>!0,super.construct(e),t.originalContinuous=t.continuous,t.on({change:({action:e})=>{"filter"!==e&&t.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>t.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:e=>t.trigger("reconfigure",e)}),t.startDate)t.internalOnReconfigure(),t.trigger("reconfigure");else if(t.viewPreset){const e=t.getAdjustedDates(new Date);t.startDate=e.startDate,t.endDate=e.endDate}}get isTimeAxis(){return!0}reconfigure(e,t=!1,r=!1){const n=this,s=n.getAdjustedDates(e.startDate,e.endDate);if(!1!==n.trigger("beforeReconfigure",{startDate:s.startDate,endDate:s.endDate,config:e})){if(n.trigger("beginReconfigure"),n._configuredStartDate=e.startDate,n._configuredEndDate=e.endDate,Object.assign(n,e),!1===n.internalOnReconfigure(r))return!1;n.trigger("endReconfigure",{suppressRefresh:t,config:e})}}internalOnReconfigure(e=!1){const t=this;t.isConfigured=!0;const r=t.getAdjustedDates(t.startDate,t.endDate,!0),n=t.getAdjustedDates(t.startDate,t.endDate),s=n.startDate,i=n.endDate;if(s>=i)throw new Error(`Invalid start/end dates. Start date must less than end date. Start date: ${s}. End date: ${i}.`);const o=t.unit,a=t.increment||1,l=t.generateTicks(s,i,o,a);t.suspendEvents(),t.data=l;const{count:c}=t;if(0===c){if(e)return t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.resumeEvents();let d=t.last.endDate;t.isContinuous?(t.adjustedStart=r.startDate,t.adjustedEnd=je.getNext(c>1?l[c-1].startDate:r.startDate,o,a,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=d);do{t.visibleTickStart=(t.startDate-t.adjustedStart)/(je.asMilliseconds(o)*a),t.autoAdjust&&(t.visibleTickStart=Math.floor(t.visibleTickStart)),t.visibleTickStart>=1&&(t.adjustedStart=je.getNext(t.adjustedStart,o,a,t.weekStartDay))}while(t.visibleTickStart>=1);do{t.visibleTickEnd=c-(t.adjustedEnd-d)/(je.asMilliseconds(o)*a),c-t.visibleTickEnd>=1&&(t.adjustedEnd=je.getNext(t.adjustedEnd,o,-1,t.weekStartDay))}while(c-t.visibleTickEnd>=1);t.updateTickCache(!0)}get viewPreset(){return this._viewPreset}set viewPreset(e){if(!((e=Kc.getPreset(e))instanceof qc))throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");this._viewPreset=e,Object.assign(this,{unit:e.bottomHeader.unit,increment:e.bottomHeader.increment||1,resolutionUnit:e.timeResolution.unit,resolutionIncrement:e.timeResolution.increment,mainUnit:e.mainHeader.unit,shiftUnit:e.shiftUnit,shiftIncrement:e.shiftIncrement||1,defaultSpan:e.defaultSpan||1,presetName:e.id,headers:e.headers})}set weekStartDay(e){this._weekStartDay=e}get weekStartDay(){return null==this._weekStartDay?je.weekStartDay:this._weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this._resolutionUnit}set resolutionUnit(e){this._resolutionUnit=e}get resolutionIncrement(){return this._resolutionIncrement}set resolutionIncrement(e){this._resolutionIncrement=e||1}set mainUnit(e){this._mainUnit=e}get mainUnit(){return this._mainUnit}set shiftUnit(e){this._shiftUnit=e}get shiftUnit(){return this._shiftUnit||this._mainUnit}set shiftIncrement(e){this._shiftIncrement=e}get shiftIncrement(){return this._shiftIncrement||1}set unit(e){this._unit=e}get unit(){return this._unit}set increment(e){this._increment=e}get increment(){return this._increment}get defaultSpan(){return this._defaultSpan}set defaultSpan(e){this._defaultSpan=e}setTimeSpan(e,t,r=!1){const n=this,{startDate:s,endDate:i}=n.getAdjustedDates(e,t);if(n.startDate-s!=0||n.endDate-i!=0)return n.reconfigure({startDate:s,endDate:i},!1,r)}shift(e,t=this.shiftUnit){const r=this;let{startDate:n,endDate:s}=r;r.isFiltered&&(n=r.allRecords[0].startDate,s=r.allRecords[r.allCount-1].endDate);let i=0;do{n=je.add(n,e,t),s=je.add(s,e,t)}while(i++<100&&!1===r.setTimeSpan(n,s,!0))}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,t=this){const r=this;r.filters.clear(),super.filterBy((r,n)=>e.call(t,r.data,n)),0===r.count&&(r.trigger("invalidFilter"),r.clearFilters())}triggerFilterEvent(e){const t=this;e.filters.count?t.continuous=!1:t.continuous=t.originalContinuous,t.updateTickCache(),super.triggerFilterEvent(e)}get isContinuous(){return!1!==this.continuous&&!this.filtered}getAdjustedDates(e,t,r=!1){const n=this;return e=e||n.startDate,t=t||je.add(e,n.defaultSpan,n.mainUnit),n.autoAdjust||r?{startDate:n.floorDate(e,!1,n.autoAdjust?n.mainUnit:n.unit,1),endDate:n.ceilDate(t,!1,n.autoAdjust?n.mainUnit:n.unit,1)}:{startDate:e,endDate:t}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=je.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=je.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,t,r,n){const s=this,i=(t=!1!==t)?je.clone(s.startDate):null,o=n||s.resolutionIncrement,a=r||(t?s.resolutionUnit:s.mainUnit),l=(e,t)=>Math.floor(e/t)*t;if(t){const t=l(je.diff(i,e,a),o);return je.add(i,t,a)}let c=je.clone(e);if("week"===a){let e=c.getDay()||7,t=s.weekStartDay||7;c=je.add(je.startOf(c,"day"),e>=t?t-e:-(7-t+e),"day"),c.getDay()!==t&&23===c.getHours()&&(c=je.add(c,1,"hour"))}else{c=je.startOf(c,a);let e=["day","year"].includes(a)?1:0,t="day"===a?"date":a,r=l(je.get(c,t)-e,o)+e;c=je.set(c,t,r)}return c}roundDate(e,t){const r=this,n=je.clone(e),s=r.resolutionIncrement||1;switch(t=je.clone(t||r.startDate),r.resolutionUnit){case"week":je.startOf(n,"day");let e,i=n.getDay()-r.weekStartDay;return i<0&&(i=7+i),e=1===Math.round(i/7)?7-i:-i,je.add(n,e,"day");case"month":const o=je.diff(t,n,"month")+je.as("month",n.getDay()/je.daysInMonth(n)),a=Math.round(o/s)*s;return je.add(t,a,"month");case"quarter":return je.startOf(n,"month"),je.add(n,"month",3-n.getMonth()%3);default:const l=je.as(r.resolutionUnit,je.diff(t,n)),c=je.as(r.resolutionUnit,t.getTimezoneOffset()-n.getTimezoneOffset(),"minute"),d=Math.round((l+c)/s)*s;return je.add(t,d-c,r.resolutionUnit)}}ceilDate(e,t,r,n){const s=this;t=!1!==t,n=n||(t?this.resolutionIncrement:1);let i=je.clone(e),o=!1,a=r||(t?s.resolutionUnit:s.mainUnit);switch(a){case"minute":o=!je.isStartOf(i,"minute");break;case"hour":o=!je.isStartOf(i,"hour");break;case"day":case"date":o=!je.isStartOf(i,"day");break;case"week":i=je.startOf(i,"day"),o=i.getDay()!==s.weekStartDay||!je.isEqual(i,e);break;case"month":i=je.startOf(i,"day"),o=1!==i.getDate()||!je.isEqual(i,e);break;case"quarter":i=je.startOf(i,"day"),o=i.getMonth()%3!=0||1!==i.getDate()||!je.isEqual(i,e);break;case"year":i=je.startOf(i,"day"),o=0!==i.getMonth()||1!==i.getDate()||!je.isEqual(i,e)}return o?je.getNext(i,a,n,s.weekStartDay):i}get include(){return this._include}set include(e){const t=this;t._include=e,t.continuous=!e,t.isConfiguring||(t.startDate=t._configuredStartDate,t.endDate=t._configuredEndDate,t.internalOnReconfigure(),t.trigger("includeChange"))}processExclusion(e,t,r){const{include:n}=this;return!!n&&Object.entries(n).some(([n,s])=>{if(!s)return!1;const{from:i,to:o}=s;if(je.compareUnits("day",r)>=0&&je.getLargerUnit(n)===r&&(i&&je.set(e,n,i),o)){let e=r;"day"===r&&(e="date"),je.set(t,{[e]:je.get(t,e)-1,[n]:o})}if(je.compareUnits(n,r)>=0){const t="day"===n?e.getDay():je.get(e,n);if(i&&t<i||o&&t>=o)return!0}})}initExclusion(){Object.entries(this.include).forEach(([e,t])=>{if(t){const{from:r,to:n}=t;t.lengthFactor=je.getUnitToBaseUnitRatio(e,je.getLargerUnit(e))/(n-r),t.lengthFactorExcl=je.getUnitToBaseUnitRatio(e,je.getLargerUnit(e))/(n-r-1),t.center=r+r/(t.lengthFactor-1)}})}generateTicks(e,t,r=this.unit,n=this.increment){const s=this,i=[],o=Boolean(s.include);let a,l,c,d=0,{startDate:u,endDate:h}=s.getAdjustedDates(e,t);for(s.tickCache={},o&&s.initExclusion();u<h;){if(a=je.getNext(u,r,n,s.weekStartDay),!s.autoAdjust&&a>h&&(a=h),"hour"===r&&n>1&&i.length>0&&0===d){const e=i[i.length-1];d=(e.startDate.getHours()+n)%24-e.endDate.getHours(),0!==d&&(a=je.add(a,d,"hour"))}c=!1,o?(l=new Date(a.getTime()),c=s.processExclusion(u,a,r)):l=a,s.generateTicksValidatorFn(u)&&!c&&(i.push({id:i.length+1,startDate:u,endDate:a}),s.tickCache[u.getTime()]=i.length-1),u=l}return i}get visibleTickTimeSpan(){return this.isContinuous?this.visibleTickEnd-this.visibleTickStart:this.count}getTickFromDate(e){const t=this,r=t.records;let n,s,i,o,a=0,l=r.length-1;if(!r.length||e<r[0].startDate||e>r[l].endDate)return-1;if(t.isContinuous){for(;a<l;)n=a+l+1>>1,e>r[n].endDate?a=n+1:e<r[n].startDate?l=n-1:a=n;return s=r[a],i=s.startDate,o=s.endDate,e>i&&(a+=(e-i)/(o-i)),Math.min(Math.max(a,t.visibleTickStart),t.visibleTickEnd)}for(let t=0;t<=l;t++)if(o=r[t].endDate,e<=o)return i=r[t].startDate,s=t+(e>i?(e-i)/(o-i):0),s}getDateFromTick(e,t){const r=this;if(e===r.visibleTickEnd)return r.endDate;const n=Math.floor(e),s=e-n,i=r.getAt(n);if(!i)return null;let o=0===n?r.adjustedStart:i.startDate,a=n===r.count-1&&r.isContinuous?r.adjustedEnd:i.endDate,l=je.add(o,s*(a-o),"millisecond");return t&&(l=r[t+"Date"](l)),l}get ticks(){return this.records}updateTickCache(e=!1){const t=this;t.count?(t._start=t.first.startDate,t._end=t.last.endDate,t._startMS=t.startDate.getTime(),t._endMS=t.endDate.getTime()):t._start=t._end=t._startMs=t._endMS=null,e||(t.tickCache={},t.forEach((e,r)=>t.tickCache[e.startDate.getTime()]=r))}dateInAxis(e,t=!1){const r=this,n=r.startDate,s=r.endDate;if(r.isContinuous)return t?je.betweenLesserEqual(e,n,s):je.betweenLesser(e,n,s);{let n,s,i,o=r.getCount();for(let a=0;a<o;a++)if(i=r.getAt(a),n=i.startDate,s=i.endDate,t&&e<=s||!t&&e<s)return e>=n}return!1}timeSpanInAxis(e,t){const r=this;return t&&t.getTime()!==e.getTime()?r.isContinuous?je.intersectSpans(e,t,r.startDate,r.endDate):e<r.startDate&&t>r.endDate||r.getTickFromDate(e)!==r.getTickFromDate(t):this.dateInAxis(e,!0)}isTimeSpanInAxis(e){const t=this,r=e.startDateMS,n=e.endDateMS;return!(!r||!n)&&(n===r?this.dateInAxis(e.startDate,!0):t.isContinuous?n>t.startMS&&r<t.endMS:r<t.startMS&&n>t.endMS||t.getTickFromDate(e.startDate)!==t.getTickFromDate(e.endDate))}forEachAuxInterval(e,t=1,r,n=this){let s,i=this.endDate,o=this.startDate,a=0;if(o>i)throw new Error("Invalid time axis configuration");for(;o<i;)s=je.min(je.getNext(o,e,t,this.weekStartDay),i),r.call(n,o,s,a),o=s,a++}}Zc._$name="TimeAxis";class Jc extends Ds{static get defaultConfig(){return{loadPriority:300,syncPriority:300,modelClass:xc}}add(e){Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;t++){let r=e[t];if(r instanceof Jn||(e[t]=r=this.createRecord(r)),-1!==this.storage.findIndex("eventResourceKey",r.eventResourceKey,!0))throw new Error(`Duplicate assignment Event: ${r.eventId} to resource: ${r.resourceId}`)}return super.add(e)}set storage(e){super.storage=e,this.storage.addIndex("eventResourceKey")}get storage(){return super.storage}doDestroy(){this.eventStoreDetacher&&this.eventStoreDetacher(),this.resourceStoreDetacher&&this.resourceStoreDetacher(),super.doDestroy()}get eventStore(){return this._eventStore}set eventStore(e){const t=this,r=t._eventStore;t._eventStore=e||null,t.attachToEventStore(t._eventStore),(r||e)&&r!==e&&t.trigger("eventStoreChange",{newEventStore:e,oldEventStore:r})}attachToEventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),e&&(t.eventStoreDetacher=e.on({remove:t.onEventRemove,resourcestorechange:t.onEventStoreResourceStoreChange,thisObj:t,prio:200})),t.isConfiguring||t.initRelations(!0),t.attachToResourceStore(e&&e.resourceStore)}attachToResourceStore(e){const t=this;t.resourceStore=e,t.resourceStoreDetacher&&t.resourceStoreDetacher(),e&&(t.resourceStoreDetacher=e.on({remove:t.onResourceRemove,removeAll:t.onResourceRemoveAll,thisObj:t,prio:200}),t.isConfiguring||t.initRelations(!0))}onEventStoreResourceStoreChange({newResourceStore:e}){this.attachToResourceStore(e)}onEventRemove({records:e,isMove:t,isCollapse:r}){if(!t&&!r){const t=[];e.forEach(e=>{e.traverse(e=>{t.push(...e.assignments)})}),this.isRemovingEvent=!0,t.length&&this.remove(t),this.isRemovingEvent=!1}}onResourceRemove({records:e,isMove:t,isCollapse:r}){if(!t&&!r){const t=[];e.forEach(e=>{e.traverse(e=>{t.push(...e.assignments)})}),t.length&&this.remove(t)}}onResourceRemoveAll(){this.removeAll()}mapAssignmentsForEvent(e,t,r){const n=Boolean(t),s=Boolean(r),i=Jn.asId(e),o=this.relationCache.event&&this.relationCache.event[i];return o?(t=t||(e=>e),r=r||(()=>!0),n||s?o.reduce((e,n)=>{const s=t(n);return r(s)&&e.push(s),e},[]):o):[]}mapAssignmentsForResource(e,t,r){const n=Boolean(t),s=Boolean(r),i=Jn.asId(e),o=this.relationCache.resource&&this.relationCache.resource[i];return o?(t=t||(e=>e),r=r||(()=>!0),n||s?o.reduce((e,n)=>{const s=t(n);return r(s)&&e.push(s),e},[]):o):[]}getAssignmentsForEvent(e){return e.assignments}removeAssignmentsForEvent(e){return this.remove(e.assignments)}getAssignmentsForResource(e){return this.mapAssignmentsForResource(e)}removeAssignmentsForResource(e){this.remove(this.getAssignmentsForResource(e))}getResourcesForEvent(e){return this.mapAssignmentsForEvent(e,e=>e.resource,e=>Boolean(e))}getEventsForResource(e){return this.mapAssignmentsForResource(e,e=>e.event,e=>!!e)}assignEventToResource(e,t,r=(e=>e),n=!1){const s=this,i=s.autoCommit;t=Array.isArray(t)?t:[t];let o=[];return s.autoCommit=!1,n&&e.resources&&e.resources.forEach(r=>{t.includes(r)||s.unassignEventFromResource(e,r)}),t.forEach(t=>{if(!s.isEventAssignedToResource(e,t)){let n=new s.modelClass({eventId:Jn.asId(e),resourceId:Jn.asId(t)});n=r(n),o.push(n)}}),o=s.add(o),s.autoCommit=i,o}unassignEventFromResource(e,t){const r=this,n=[];if(!t)return r.removeAssignmentsForEvent(e);Array.isArray(t)||(t=[t]);for(let s=0;s<t.length;s++)r.isEventAssignedToResource(e,t[s])&&n.push(r.getAssignmentForEventAndResource(e,t[s]));return r.remove(n)}isEventAssignedToResource(e,t){const r=this.getResourcesForEvent(e),n=Jn.asId(t);return r.some(e=>e.id==n)}getAssignmentForEventAndResource(e,t){return e=this.eventStore.getById(e),t=this.resourceStore.getById(t),this.records.find(r=>r.event==e&&r.resource==t)}}Jc._$name="AssignmentStore";class Qc extends Jn{static get fields(){return[{name:"date",type:"date",format:"YYYY-MM-DD",persist:!0},{name:"weekday",type:"int"},{name:"overrideStartDate",type:"date",dateFormat:"YYYY-MM-DD"},{name:"overrideEndDate",type:"date",dateFormat:"YYYY-MM-DD"},{name:"type",defaultValue:"DAY"},{name:"isWorkingDay",type:"boolean",defaultValue:!1},{name:"cls"},{name:"name"},{name:"availability",persist:!0}]}set date(e){e&&(e=je.startOf(e,"day")),this.set("date",e)}get date(){return this.get("date")}clearDate(){this.set("date",null)}get availability(){return this.get("availability")}set availability(e){this.availabilityCache=null,this.set("availability",this.stringifyIntervals(e)),this.getAvailability()}getAvailability(e){const t=this;if(e)return t.get("availability");if(t.availabilityCache)return t.availabilityCache;const r=t.get("availability").map(e=>"string"==typeof e?t.parseInterval(e):e);return t.verifyAvailability(r),t.availabilityCache=r}verifyAvailability(e){const t=this;e.sort((e,t)=>e.startTime-t.startTime),e.forEach((r,n)=>{if(r.startTime>r.endTime)throw new Error(`Start time ${je.format(r.startTime,"HH:mm")} is greater than end time ${je.format(r.endTime,"HH:mm")}`);if(n>0&&e[n-1].endTime>r.startTime)throw new Error(`Availability intervals should not intersect: [${t.stringifyInterval(e[n-1])}] and [${t.stringifyInterval(r)}]`)})}stringifyInterval(e){const t=e.startTime,r=e.endTime;return je.format(t,"HH:mm")+"-"+je.format(r,"HH:mm")}stringifyIntervals(e){const t=this;return e.map(e=>"string"==typeof e?e:t.stringifyInterval(e))}parseInterval(e){const t=/(\d\d):(\d\d)-(\d\d):(\d\d)/.exec(e);if(!t)throw new Error(`Invalid format for availability string: ${String}. It should have exact format: hh:mm-hh:mm`);return{startTime:new Date(0,0,0,t[1],t[2]),endTime:new Date(0,0,0,t[3],t[4])}}get totalHours(){return this.getTotalMS()/1e3/60/60}get totalMS(){return this.getAvailability().reduce((e,t)=>e+(t.endTime-t.startTime),0)}addAvailabilityInterval(e,t){let r;r=e instanceof Date?{startTime:e,endTime:t}:this.parseInterval(e+(t?"-"+t:""));const n=this.getAvailability().concat(r);this.verifyAvailability(n),this.setAvailability(n)}removeAvailabilityInterval(e){const t=this.getAvailability();t.splice(e,1),this.setAvailability(t)}getAvailabilityIntervalsFor(e){const t=(e="number"==typeof e?new Date(e):e).getFullYear(),r=e.getMonth(),n=e.getDate();return this.getAvailability().map(e=>{const s=e.endTime.getDate();return{startDate:new Date(t,r,n,e.startTime.getHours(),e.startTime.getMinutes()),endDate:new Date(t,r,n+(1==s?1:0),e.endTime.getHours(),e.endTime.getMinutes())}})}getAvailabilityStartFor(e){const t=this.getAvailabilityIntervalsFor(e);return t.length?t[0].startDate:null}getAvailabilityEndFor(e){const t=this.getAvailabilityIntervalsFor(e);return t.length?t[t.length-1].endDate:null}}Qc._$name="CalendarDayModel";class ed extends Ds{static get defaultConfig(){return{modelClass:Qc,daysPerMonth:30,daysPerWeek:7,hoursPerDay:24,unitsInMs:null,defaultNonWorkingTimeCssCls:"b-nonworkingtime",weekendsAreWorkdays:!1,weekendFirstDay:6,weekendSecondDay:0,holidaysCache:null,availabilityIntervalsCache:null,daysIndex:null,weekAvailability:null,defaultWeekAvailability:null,nonStandardWeeksByStartDate:null,nonStandardWeeksStartDates:null,calendarId:null,parent:null,defaultAvailability:["00:00-24:00"],name:null,suspendCacheUpdate:0,availabilitySearchLimit:1825}}static get allCalendars(){return(Cs.stores||[]).filter(e=>e instanceof ed)}get calendarId(){return this._calendarId}set parent(e){const t=this,r=ed.getCalendar(e);if(e&&!r)throw new Error("Invalid parent specified for the calendar");if(t.parent!=r){const e={calendarchange:t.clearCache,destroy:t.onParentDestroy,thisObj:t},n=t.parent;n&&n.un(e),t._parent=r,r&&r.on(e),t.params=Object.assign(t.params||{},{parentId:r?r.calendarId:null}),t.clearCache(),t.trigger("parentChange",{newParent:r,oldParent:n})}}construct(e){const t=this;super.construct(e),t.unitsInMs={MILLI:1,SECOND:1e3,MINUTE:6e4,HOUR:36e5,DAY:60*t.hoursPerDay*60*1e3,WEEK:t.daysPerWeek*t.hoursPerDay*60*60*1e3,MONTH:t.daysPerMonth*t.hoursPerDay*60*60*1e3,QUARTER:3*t.daysPerMonth*24*60*60*1e3,YEAR:12*t.daysPerMonth*24*60*60*1e3},t.defaultWeekAvailability=t.getDefaultWeekAvailability(),t.on({change:t.clearCache,thisObj:t}),t.clearCache()}static getCalendar(e){return e instanceof ed?e:Cs.getStore(e)}set calendarId(e){const t=this;t._calendarId=e,t.storeId=null!=e?"GNT_CALENDAR:"+e:null,t.params=Object.assign(t.params||{},{calendarId:e})}getDefaultWeekAvailability(){let e=this.defaultAvailability,t=this.weekendFirstDay,r=this.weekendSecondDay,n=[];for(let s=0;s<7;s++)n.push(this.weekendsAreWorkdays||s!=t&&s!=r?new this.modelClass({type:"WEEKDAY",weekday:s,availability:e&&e.slice()||[],isWorkingDay:!0}):new this.modelClass({type:"WEEKDAY",weekday:s,availability:[]}));return n}removeAll(){ed.allCalendars.forEach(e=>{e.storeId=null,e.destroy()})}intersectsWithCurrentWeeks(e,t){let r=!1;return this.forEachNonStandardWeek(n=>{const s=n.startDate,i=n.endDate;if(s<=e&&e<i||s<t&&t<=i)return r=!0,!1}),r}clearCache(){const e=this;if(e.suspendCacheUpdate>0)return;e.holidaysCache={},e.availabilityIntervalsCache={};const t=e.daysIndex={},r=e.weekAvailability=[],n=e.nonStandardWeeksStartDates=[],s=e.nonStandardWeeksByStartDate={};e.forEach((function(e){let i=e.id,o=/^(\d)-(\d\d\d\d\/\d\d\/\d\d)-(\d\d\d\d\/\d\d\/\d\d)$/.exec(i),a=/^WEEKDAY:(\d+)$/.exec(i),l=e.type,c=e.weekday;if("WEEKDAYOVERRIDE"==l||o){let t,r;if("WEEKDAYOVERRIDE"==l&&(t=e.overrideStartDate,r=e.overrideEndDate),o&&(t=je.parse(o[2],"YYYY/MM/DD"),r=je.parse(o[3],"YYYY/MM/DD"),c=o[1]),t&&r&&null!=c){const i=t-0;s[i]||(s[i]={startDate:new Date(t),endDate:new Date(r),name:e.getName(),weekAvailability:[],mainDay:null},n.push(i)),c>=0?s[i].weekAvailability[c]=e:s[i].mainDay=e}}else if("WEEKDAY"==l||a){if(a&&(c=a[1]),null!=c){if(c<0||c>6)throw new Error("Incorrect week day index");r[c]=e}}else{const r=e.date;r&&(t[r-0]=e)}})),n.sort((e,t)=>e-t),e.trigger("calendarChange")}addNonStandardWeek(e,t,r,n){if(e=je.clearTime(e),t=je.clearTime(t),this.intersectsWithCurrentWeeks(e,t))throw new Error("Can not add intersecting week");const s=this.modelClass,i=[];r.forEach((r,o)=>{if(r instanceof Qc)r.type="WEEKDAYOVERRIDE",r.overrideStartDate=e,r.overrideEndDate=t,r.weekday=o,r.name=n||"Week override",i.push(r);else if(Array.isArray(r)){const a=new s;a.type="WEEKDAYOVERRIDE",a.overrideStartDate=e,a.overrideEndDate=t,a.weekday=o,a.name=n||"Week override",a.setAvailability(r),i.push(a)}});const o=new s;o.type="WEEKDAYOVERRIDE",o.overrideStartDate=e,o.overrideEndDate=t,o.weekday=-1,o.name=n||"Week override",i.push(o),this.add(i)}getNonStandardWeekByStartDate(e){return this.nonStandardWeeksByStartDate[je.clearTime(e)-0]||null}removeNonStandardWeek(e){e=je.clearTime(e)-0;const t=this.getNonStandardWeekByStartDate(e);t&&this.remove(z.clean(t.weekAvailability).concat(t.mainDay))}getNonStandardWeekByDate(e){e=je.clearTime(e)-0;const t=this.nonStandardWeeksStartDates,r=this.nonStandardWeeksByStartDate;for(let n=0;n<t.length;n++){const s=r[t[n]];if(s.startDate>e)break;if(s.startDate<=e&&e<=s.endDate)return s}return null}setWeekendsAreWorkDays(e){const t=this;e!==t.weekendsAreWorkdays&&(t.weekendsAreWorkdays=e,t.defaultWeekAvailability=t.getDefaultWeekAvailability(),t.clearCache())}areWeekendsWorkDays(){return this.weekendsAreWorkdays}forEachNonStandardWeek(e,t){const r=this,n=this.nonStandardWeeksStartDates,s=this.nonStandardWeeksByStartDate;for(let i=0;i<n.length;i++)if(!1===e.call(t||r,s[n[i]]))return!1}getCalendarDay(e){return e="number"==typeof e?new Date(e):e,this.getOverrideDay(e)||this.getWeekDay(e.getDay(),e)||this.getDefaultCalendarDay(e.getDay())}getOverrideDay(e){return this.getOwnCalendarDay(e)||this.parent&&this.parent.getOverrideDay(e)||null}getOwnCalendarDay(e){return e="number"==typeof e?new Date(e):e,this.daysIndex[je.clearTime(e)-0]}getWeekDay(e,t){if(t){const r=this.getNonStandardWeekByDate(t);if(r&&r.weekAvailability[e])return r.weekAvailability[e]}return this.weekAvailability[e]||this.parent&&this.parent.getWeekDay(e,t)||null}isHoliday(e){const t=e-0,r=this.holidaysCache;if(null!=r[t])return r[t];e="number"==typeof e?new Date(e):e;const n=this.getCalendarDay(e);if(!n)throw new Error("Can't find day for "+e);return r[t]=!n.isWorkingDay}getDefaultCalendarDay(e){return this.hasOwnProperty("defaultAvailability")||this.hasOwnProperty("weekendsAreWorkdays")||!this.parent?this.defaultWeekAvailability[e]:this.parent.getDefaultCalendarDay(e)}isWorkingDay(e){return!this.isHoliday(e)}isWeekend(e){const t=e.getDay();return t===this.weekendFirstDay||t===this.weekendSecondDay}convertMSDurationToUnit(e,t){return e/this.unitsInMs[je.getUnitByName(t)]}convertDurationToMs(e,t){return e*this.unitsInMs[je.getUnitByName(t)]}forEachAvailabilityInterval(e,t,r){r=r||this;let n=this,s=e.startDate,i=e.endDate,o=!1!==e.isForward;if(o?!s:!i)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");let a=new Date(o?s:i),l=je;o?i||(i=l.add(s,e.availabilitySearchLimit||n.availabilitySearchLimit||1825,"day")):s||(s=l.add(i,-(e.availabilitySearchLimit||n.availabilitySearchLimit||1825),"day"));let c=!1;for(;o?a<i:a>s;){let e=n.getAvailabilityIntervalsFor(a-(o?0:1),!!o&&c);for(let n=o?0:e.length-1;o?n<e.length:n>=0;o?n++:n--){let o=e[n],a=o.startDate,l=o.endDate;if(a>=i||l<=s)continue;let c=a<s?s:a,d=l>i?i:l;if(!1===t.call(r,c,d))return!1}a=o?l.getStartOfNextDay(a,!1,c):l.getEndOfPreviousDay(a,c),c=!0}}calculateDuration(e,t,r){let n=0;return this.forEachAvailabilityInterval({startDate:e,endDate:t},(e,t)=>{let r=e.getTimezoneOffset()-t.getTimezoneOffset();n+=t-e+60*r*1e3}),this.convertMSDurationToUnit(n,r)}getHolidaysRanges(e,t,r){if(e>t)throw new Error("startDate can't be bigger than endDate");e=je.clearTime(e),t=je.clearTime(t);let n,s,i=[];for(s=e;s<t;s=je.getNext(s,"day",1))if(this.isHoliday(s)||this.weekendsAreWorkdays&&r&&this.isWeekend(s)){const e=this.getCalendarDay(s),t=e&&e.cls||this.defaultNonWorkingTimeCssCls,r=je.getNext(s,"day",1);n?n.cls.isEqual(t)?n.endDate=r:(i.push(n),n=new jc({startDate:s,endDate:r,cls:t})):n=new jc({startDate:s,endDate:r,cls:t})}else n&&(i.push(n),n=null);return n&&i.push(n),i}calculateEndDate(e,t,r){if(!t)return new Date(e);let n,s=je,i=0===(t=this.convertDurationToMs(t,r))&&s.clearTime(e,!0)-e==0?s.add(e,-1,"day"):e;return this.forEachAvailabilityInterval({startDate:i},(function(e,r){let s=r-e,i=e.getTimezoneOffset()-r.getTimezoneOffset();if(s>=t)return n=new Date(e-0+t),!1;t-=s+60*i*1e3})),n}skipNonWorkingTime(e,t){let r=!1;if(this.forEachAvailabilityInterval(t?{startDate:e}:{endDate:e,isForward:!1},(n,s)=>(e=t?n:s,r=!0,!1)),!r)throw new Error("skipNonWorkingTime: Cannot skip non-working time, please ensure that this calendar has any working period of time specified");return new Date(e)}calculateStartDate(e,t,r){if(!t)return new Date(e);let n;return t=this.convertDurationToMs(t,r),this.forEachAvailabilityInterval({endDate:e,isForward:!1},(e,r)=>{const s=r-e;if(s>=t)return n=new Date(r-t),!1;t-=s}),n}skipWorkingTime(e,t,r){return t>=0?this.calculateEndDate(e,t,r):this.calculateStartDate(e,-t,r)}isChildOf(e){let t=this,r=!1;for(;t&&!r;)r=t===e,t=t.parent;return r}getParentableCalendars(){const e=this;return ed.getAllCalendars().reduce((t,r)=>(r===e||r.isChildOf(e)||t.push({id:r.calendarId,name:r.name||r.calendarId}),t),[])}get parent(){return this._parent}getAvailabilityIntervalsFor(e,t){return e=t?e.valueOf():e instanceof Date?new Date(e.getFullYear(),e.getMonth(),e.getDate()).valueOf():je.clearTime(new Date(e)).valueOf(),this.availabilityIntervalsCache[e]=this.availabilityIntervalsCache[e]||this.getCalendarDay(e).getAvailabilityIntervalsFor(e)}onParentDestroy(){this.parent=null}isAvailabilityIntersected(e,t,r){let n,s,i,o;for(let t=0;t<7;t++)if(n=this.getWeekDay(t)||this.getDefaultCalendarDay(t),i=e.getWeekDay(t)||e.getDefaultCalendarDay(t),n&&i){s=n.getAvailability(),o=i.getAvailability();for(let e=0,t=s.length;e<t;e++)for(let t=0,r=o.length;t<r;t++)if(o[t].startTime<s[e].endTime&&o[t].endTime>s[e].startTime)return!0}let a=!1;return this.forEachNonStandardWeek(e=>!(e.startDate>=r)&&(t<e.endDate?(a=!0,!1):void 0)),a}}ed._$name="Calendar";var td=e=>class extends(e||B){encode(e){return I.safeJsonStringify(e)}decode(e){return I.safeJsonParse(e)}},rd=e=>class extends(e||B){get eventStore(){return this._eventStore}set eventStore(e){const t=this;if(t._eventStore!==e){const r=t._eventStore;t._eventStore=e||null,e&&!e.resourceStore&&(e.resourceStore=t),t.trigger("eventStoreChange",{newEventStore:e,oldEventStore:r})}}getScheduledEventsInTimeSpan(e,t,r=this.eventStore){return this.reduce((n,s)=>{n.concat(r.getEventsForResource(s).reduce((r,n)=>{n.intersectsRange(e,t)&&r.push(n)}))})}};class nd extends ja{static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image"]}get resourceStore(){return this.stores&&this.stores[0]}get eventStore(){const e=this.resourceStore;return e&&e.eventStore||this.parentNode&&this.parentNode.eventStore}get assignmentStore(){const e=this.eventStore;return e&&e.assignmentStore}get events(){return this.eventStore&&this.eventStore.getEventsForResource(this)}getEvents(e=this.eventStore){return e&&e.getEventsForResource(this)||[]}get isPersistable(){const e=this.parentNode;return!e||!e.phantom||e.isRoot&&e.isRoot()}isAbove(e){let t,r,n,s,i,o=this,a=o.resourceStore;if(o===e)return!1;if(a.tree){for(t=o,r=[];t;)r.push(t),t=t.parentNode;for(t=e,n=[];t;)n.push(t),t=t.parentNode;for(s=0;s<r.length-1&&s<n.length-1&&r[s]==n[s];)++s;return i=r[s],o=r[s+1],e=n[s+1],i.indexOf(o)<i.indexOf(e)}return a.indexOf(o)<a.indexOf(e)}unassignAll(e){this.events&&this.events.slice().forEach(t=>t.unassign(this,e))}}nd.exposeProperties(),nd._$name="ResourceModel";class sd extends(rd(Ds)){static get defaultConfig(){return{loadPriority:200,syncPriority:100,modelClass:nd,storeId:"resources",autoTree:!0}}construct(e){if(super.construct(e),this.modelClass!==nd&&!(this.modelClass.prototype instanceof nd))throw new Error("Model for ResourceStore must subclass ResourceModel")}remove(e){e=Array.isArray(e)?e:[e];for(let t of e){this.getById(t).unassignAll(!0)}super.remove(e)}removeAll(){this.traverse(e=>e.unassignAll(!0)),super.removeAll()}}sd._$name="ResourceStore";const id=["SS","SF","FS","FF"];class od extends Jn{static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"}]}static get relationConfig(){return[{relationName:"sourceEvent",fieldName:"from",store:"eventStore",collectionName:"successors"},{relationName:"targetEvent",fieldName:"to",store:"eventStore",collectionName:"predecessors"}]}construct(e){super.construct(...arguments),e&&(e.from&&e.from instanceof jc&&(this.sourceEvent=e.from,delete e.from),e.to&&e.to instanceof jc&&(this.targetEvent=e.to,delete e.to))}get eventStore(){const{stores:e,unjoinedStores:t}=this;return e[0]&&e[0].eventStore||t[0]&&t[0].eventStore}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let t;return e!==this.getHardType()&&(t=this.set({type:e,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(e){"number"==typeof e?this.set({lag:e}):this.setLag(e)}setLag(e,t){1!==arguments.length?(e=parseFloat(e),this.set({lag:e,lagUnit:t})):"number"==typeof e?this.lag=e:(e=je.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}))}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${je.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return{unit:this.lagUnit,magnitude:this.lag}}set fullLag(e){"string"==typeof e?this.setLag(e):this.setLag(e.magnitude,e.unit)}set sourceEvent(e){this.from=e.id}set targetEvent(e){this.to=e.id}get isPersistable(){const e=this,{stores:t,unjoinedStores:r}=e;let n,s=t[0];if(s){const t=e.getSourceEvent(),r=e.getTargetEvent(),i=s.crudManager;n=t&&(i||!t.hasGeneratedId)&&r&&(i||!r.hasGeneratedId)}else n=Boolean(r[0]);return n}getSourceEvent(e=this.eventStore){return!e&&this.unjoinedStores.length&&(e=this.leftProjectEventStore),e&&e.getById(this.from)}getTargetEvent(e=this.eventStore){return!e&&this.unjoinedStores.length&&(e=this.leftProjectEventStore),e&&e.getById(this.to)}getDateRange(e=!1){const t=this.sourceEvent,r=this.targetEvent;if(t&&r&&t.isScheduled&&r.isScheduled){let n,s,i=od.Type;switch(this.type){case i.StartToStart:n=t.startDate,s=r.startDate;break;case i.StartToEnd:n=t.startDate,s=r.endDate;break;case i.EndToEnd:n=t.endDate,s=r.endDate;break;case i.EndToStart:n=t.endDate,s=r.startDate}return{start:e?n:je.min(n,s),end:e?s:je.max(n,s)}}return null}highlight(e){const t=this.highlighted?this.highlighted.split(" "):[];t.includes(e)||(this.highlighted=t.concat(e).join(" "))}unhighlight(e){const t=this,r=t.highlighted;if(r){const n=r.split(" "),s=n.findIndex(t=>t===e);s>=0&&(n.splice(s,1),t.highlighted=n.join(" "))}}isHighlightedWith(e){const t=this.highlighted;return t&&t.split(" ").includes(e)}getConnectorString(e){const t=id[this.type];if(e)return t;if(this.type===od.Type.EndToStart)return"";const r=ne.locale;if(r){const e=r.Scheduler&&r.Scheduler[t];if(e)return e}return t}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}isValid(e){const{from:t,to:r,type:n}=this;return"number"==typeof n&&t&&""!==t&&null!=r&&""!==r&&t!==r}}od.exposeProperties(),od._$name="DependencyBaseModel";class ad extends od{getTypeFromSides(e,t,r){const n=od.Type,s=r?"right":"left",i=r?"left":"right";return e===s?t===s?n.StartToStart:n.StartToEnd:t===i?n.EndToEnd:n.EndToStart}}ad.exposeProperties(),ad._$name="DependencyModel";class ld extends Ds{static get defaultConfig(){return{loadPriority:400,syncPriority:400,modelClass:ad,storeId:"dependencies"}}doDestroy(){this.eventStoreDetacher&&this.eventStoreDetacher(),super.doDestroy()}get eventStore(){return this._eventStore}set eventStore(e){const t=this,r=t._eventStore;t._eventStore=e,e&&(t.attachToEventStore(e),t.isConfiguring||t.initRelations(!0)),(r||e)&&r!==e&&t.trigger("eventStoreChange",{newEventStore:e,oldEventStore:r})}attachToEventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t.eventStoreDetacher=e.on({remove:t.onEventRemove,thisObj:t,detachable:!0})}onEventRemove({records:e,isMove:t=!1,isCollapse:r=!1}){t||r||e.forEach(e=>{e.traverse(e=>this.removeEventDependencies(e,!1))})}reduceEventDependencies(e,t,r,n=!0,s){return s=s||(e=>this.getEventDependencies(e)),(e=Array.isArray(e)?e:[e]).reduce((e,r)=>{r.children&&!n?r.traverse(r=>{e=s(r).reduce(t,e)}):e=s(r).reduce(t,e)},r),r}reduceEventPredecessors(e,t,r,n){return this.reduceEventDependencies(e,t,r,n,e=>{})}reduceEventSuccessors(e,t,r,n){return this.reduceEventDependencies(e,t,r,n,e=>{})}mapEventDependencies(e,t,r,n,s){return this.reduceEventDependencies(e,(e,t)=>(r(t)&&e.push(t),e),[],n,s)}mapEventPredecessors(e,t,r,n){return this.reduceEventPredecessors(e,(e,t)=>(r(t)&&e.push(t),e),[],n)}mapEventSuccessors(e,t,r,n){return this.reduceEventSuccessors(e,(e,t)=>(r(t)&&e.push(t),e),[],n)}getEventDependencies(e,t=!1){return[].concat(e.predecessors||[],e.successors||[])}getEventPredecessors(e,t=!1){return e.predecessors}getEventSuccessors(e,t=!1){return e.successors}getUnique(e){return[...new Set(e)]}removeEventDependencies(e,t){const r=this.getEventDependencies(e,t);r.length&&this.remove(this.getUnique(r))}removeEventPredecessors(e,t){const r=this.getEventPredecessors(e,t);r.length&&this.remove(this.getUnique(r))}removeEventSuccessors(e,t){const r=this.getEventSuccessors(e,t);r.length&&this.remove(this.getUnique(r))}getBySourceTargetId(e){return this.records.find(t=>e==ld.makeDependencySourceTargetCompositeKey(t.from,t.to))}getDependencyForSourceAndTargetEvents(e,t){return e=Jn.asId(e),t=Jn.asId(t),this.getBySourceTargetId(ld.makeDependencySourceTargetCompositeKey(e,t))}getEventsLinkingDependency(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)||this.getDependencyForSourceAndTargetEvents(t,e)}isValidDependency(e,t,r){return 1===arguments.length&&(r=e.type,t=e.to,e=e.from),null!=e&&null!=t&&e!==t}isValidDependencyToCreate(e,t,r){return this.isValidDependency(e,t,r)}getHighlightedDependencies(e){return this.records.reduce((t,r)=>(r.isHighlightedWith(e)&&t.push(r),t),[])}static makeDependencySourceTargetCompositeKey(e,t){return`source(${e})-target(${t})`}getTimeSpanDependencies(e){return this.getEventDependencies(e)}}ld._$name="DependencyStore";class cd extends(td(fc(Sc))){static get defaultConfig(){return{resourceStoreClass:sd,eventStoreClass:Yc,assignmentStoreClass:Jc,dependencyStoreClass:ld,resourceStore:{},eventStore:{},assignmentStore:null,dependencyStore:null,addRelatedStores:!0}}construct(e={}){e.scheduler&&(this.scheduler=e.scheduler,this.scheduler._crudManager=this),super.construct(e)}afterConstruct(){const e=this,t=e.scheduler;if(t){(t.isVertical||t.isHorizontal&&!t.store)&&(t.resourceStore=e.resourceStore,t.eventStore=e.eventStore);const{dependencies:r,timeRanges:n,resourceTimeRanges:s}=t.features;r&&(e.dependencyStore=r.dependencyStore),n&&(e.addCrudStore(n.store),e._timeRangesStore=n.store),s&&(e.addCrudStore(s.store),e._resourceTimeRangesStore=s.store)}super.afterConstruct()}get timeRangesStore(){return this._timeRangesStore}addFeaturedStore(e){this.addPrioritizedStore(e)}static getEventStoreInfo(e,t){e instanceof Yc||(e="string"==typeof e?Cs.getStore(e):e.store);let r={},n=t.assignmentStore,s=t.resourceStore,i=t.dependencyStore;return!n&&(r.assignmentStore=e.assignmentStore),!s&&(r.resourceStore=e.resourceStore),!i&&(r.dependencyStore=e.dependencyStore),r}get resourceStore(){return this._resourceStore&&this._resourceStore.store}set resourceStore(e){const t=this;t.setFeaturedStore("_resourceStore",e,t.resourceStoreClass),t.eventStore.resourceStore=t._resourceStore&&t._resourceStore.store}get eventStore(){return this._eventStore&&this._eventStore.store}set eventStore(e){const t=this;if(t.setFeaturedStore("_eventStore",e,t.eventStoreClass),e=t._eventStore&&t._eventStore.store,t.isConfiguring&&e&&!1!==t.addRelatedStores){let r=cd.getEventStoreInfo(e,t.initialConfig),n=r.assignmentStore,s=r.resourceStore,i=r.dependencyStore;n&&(t.assignmentStore=n),s&&(t.resourceStore=s),i&&(t.dependencyStore=i)}}get assignmentStore(){return this._assignmentStore&&this._assignmentStore.store}set assignmentStore(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}get dependencyStore(){return this._dependencyStore&&this._dependencyStore.store}set dependencyStore(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}setFeaturedStore(e,t,r){const n=this,s=n[e];return t=Cs.getStore(t,t&&t.storeClass||r),s&&n.removeStore(s),n[e]=t&&{store:t}||null,n.addFeaturedStore(n[e]),n[e]}}cd._$name="CrudManager";class dd extends Nn{static get $name(){return"ColumnLines"}static get properties(){return{tickColor:"#e6e6e6",majorTickColor:"#999",tickStyle:"solid",majorTickStyle:"solid"}}static get pluginConfig(){return{after:["render","updateCanvasSize"]}}construct(e,t){e.useBackgroundCanvas=!0,super.construct(e,t),this.timeAxisViewModel=e.timeAxisViewModel,e.on({theme:"onThemeChange",thisObj:this})}doDestroy(){this.timeAxisViewModelDetatcher&&this.timeAxisViewModelDetatcher(),super.doDestroy()}doDisable(e){this.isConfiguring||(e?(Et.removeEachSelector(this.client.backgroundCanvas,".b-column-line-major"),this.client.backgroundCanvas.style.backgroundImage="none"):this.drawLines()),super.doDisable(e)}getColorsFromCSS(){const e=this;if(!e.GotColors){const t=Et.createElement({style:"position: absolute; visibility: hidden",html:'<div class="b-column-line"></div><div class="b-column-line-major"></div>',parent:document.body}),r=Et.getStyleValue(t.firstElementChild,"border-left-color"),n=Et.getStyleValue(t.lastElementChild,"border-left-color"),s=Et.getStyleValue(t.firstElementChild,"border-left-style"),i=Et.getStyleValue(t.lastElementChild,"border-left-style");r&&(e.tickColor=r),n&&(e.majorTickColor=n),s&&(e.tickStyle=s),i&&(e.majorTickStyle=i),t.remove(),e.GotColors=!0}}onThemeChange(){this.GotColors=!1,this.render()}render(){this.getColorsFromCSS(),this.drawLines()}drawLines(){if(!this.client.timeAxis.startDate)return;const e=this,{client:t}=e,{timeAxis:r}=t,n=r.startDate,s=t.timeAxisViewModel,i=s.tickSize,o=t.backgroundCanvas,a=document.createElement("canvas"),l=a.getContext("2d"),c=s.columnLinesFor,d=s.headers[c],u=s.headers,h=u[u.indexOf(d)-1]||u[0],g=u[u.length-1],m=r.floorDate(n,!1,h.unit,"year"===h.unit?1:h.increment||1),p=je.getNext(m,h.unit,h.increment||1,r.weekStartDay),f=Math.round(je.getDurationInUnit(m,p,g.unit))/(g.increment||1),v=Math.round(je.getDurationInUnit(m,p,d.unit))/(d.increment||1),y=f/v;if(t.isHorizontal){if(n){const t=u.length>1&&je.doesUnitsAlign(h.unit,d.unit),c=t?m:r.floorDate(n,!1,d.unit,d.increment),p=r.isContinuous?je.getDurationInUnit(c,n,g.unit,!0)/r.increment*i:0,b=10,C=20;Et.removeEachSelector(o,".b-column-line-major");let w=!1,S=!0;d!==h&&t&&"day"===g.unit&&-1!==je.compareUnits(h.unit,"month")&&(S=!1,r.forEachAuxInterval(h.unit,h.increment,(e,t)=>{Et.append(o,{tag:"div",className:"b-column-line-major",style:`left:${s.getPositionFromDate(t)-1}px;`})})),a.width=Math.min(2*f*i,32767),a.height=C,l.translate(-.5,-.5),l.lineWidth=2;for(let n=0;n<v;n++){w=0===n&&(h!==d&&t&&S&&r.isContinuous);const s=w&&e.majorTickStyle||!w&&e.tickStyle;if("solid"!==s)switch(s){case"dashed":l.setLineDash([6,4]);break;case"dotted":l.setLineDash([2,3])}l.beginPath(),l.strokeStyle=w?e.majorTickColor:e.tickColor,l.moveTo(n*y*i*2+b-1,0),l.lineTo(n*y*i*2+b-1,C+2),l.stroke()}o.style.backgroundImage=`url(${a.toDataURL()})`,o.style.backgroundSize=a.width/2+"px",o.style.backgroundPositionX=-(b/2+p)+"px"}}else{if(a.width=2*t.timeAxisColumn.resourceColumns.columnWidth,a.height=2,l.translate(-.5,-.5),l.lineWidth=2,n){if(Et.removeEachSelector(o,".b-column-line-major"),d!==h&&r.forEachAuxInterval(h.unit,h.increment,(e,t)=>{Et.append(o,{tag:"div",className:"b-column-line-major",style:`top:${s.getPositionFromDate(t)-1}px;`})}),"solid"!==e.tickStyle)switch(e.tickStyle){case"dashed":l.setLineDash([6,4]);break;case"dotted":l.setLineDash([2,3])}const t=y*i*2;a.height=t,l.beginPath(),l.strokeStyle=e.tickColor,l.lineWidth=2,l.moveTo(0,t-1),l.lineTo(a.width+2,t-1),l.stroke()}l.beginPath(),l.strokeStyle=e.tickColor,l.moveTo(a.width-1,0),l.lineTo(a.width-1,a.height+2),l.stroke(),o.style.backgroundImage=`url(${a.toDataURL()})`,o.style.backgroundSize=a.width/2+"px",o.style.backgroundPositionX="0"}}updateCanvasSize(){this.disabled||this.drawLines()}}dd._$name="ColumnLines",Va.registerFeature(dd,!0,["Scheduler","Gantt"]);class ud extends B{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template:function(e){return`<div class="b-sch-clockwrap b-sch-clock-${this.mode} ${e.cls||""}">\n                    <div class="b-sch-clock">\n                        <div class="b-sch-hour-indicator">${je.format(e.date,"MMM")}</div>\n                        <div class="b-sch-minute-indicator">${je.format(e.date,"D")}</div>\n                        <div class="b-sch-clock-dot"></div>\n                    </div>\n                    <span class="b-sch-clock-text">${e.text}</span>\n                </div>`}}}construct(e){super.construct(e)}generateContent(e){const t=e.date,r=this.template(e),n=this.div;return n.innerHTML=r,this.updateDateIndicator(n,t),n.innerHTML}updateDateIndicator(e,t){const r=e.querySelector(".b-sch-hour-indicator"),n=e.querySelector(".b-sch-minute-indicator");t&&r&&n&&("hour"===this.mode?(r.style.transform=`rotate(${t.getHours()%12*30}deg)`,n.style.transform=`rotate(${6*t.getMinutes()}deg)`):(r.style.transform="none",n.style.transform="none"))}get mode(){const e=je.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,t=je.formatContainsHourInfo(this.scheduler.displayDateFormat);return e&&t?"hour":"day"}set template(e){this._template=e}get template(){return this._template}}ud._$name="ClockTemplate";class hd extends Nn{static get defaultConfig(){return{dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,constrainDragToResource:!0,showTooltip:!0,showExactDropPosition:!1,constrainDragToTimeline:!0,store:null,dragHelperConfig:null,tooltipCls:null}}static get pluginConfig(){return{chain:["render"]}}render(){const e=this,t=e.client;e.drag&&e.drag.destroy(),e.drag=new Fo(Object.assign({name:e.constructor.name,mode:"translateXY",[this.client.isHorizontal?"lockY":"lockX"]:e.constrainDragToResource,[this.client.isHorizontal?"lockX":"lockY"]:e.constrainDragToTimeSlot,minX:!0,maxX:!0,constrain:!1,cloneTarget:!e.constrainDragToTimeline,dragWithin:e.constrainDragToTimeline?null:document.body,hideOriginalElement:!0,outerElement:t.timeAxisSubGridElement,targetSelector:t.eventSelector,isElementDraggable:(r,n)=>!t.readOnly&&e.isElementDraggable(r,n),scrollManager:e.constrainDragToTimeline?t.scrollManager:null,transitionDuration:t.transitionDuration,listeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",reset:"onDragReset",thisObj:e}},e.dragHelperConfig)),t.rowManager.on({changeTotalHeight:"updateYConstraint",thisObj:e}),e.showTooltip&&(e.clockTemplate=new ud({scheduler:t}))}doDestroy(){const e=this;e.drag&&e.drag.destroy(),e.clockTemplate&&e.clockTemplate.destroy(),e.tip&&e.tip.destroy(),super.doDestroy()}onBeforeDragStart({context:e}){const t=this,r=t.client,n=r.scheduledEventName,s=r.resolveEventRecord(e.element);if(t.disabled||!s||!s.isDraggable)return!1;e.pointerStartDate=r.getDateFromXY([e.startClientX,e.startPageY],null,!1);const i=!1!==r.trigger(`before${n}Drag`,{eventRecord:s,context:t.dragData});return!1!==i&&t.updateYConstraint(s),i}set constrainDragToTimeSlot(e){const t=this.client.isHorizontal?"lockX":"lockY";this._constrainDragToTimeSlot=e,this.drag&&(this.drag[t]=e)}get constrainDragToTimeSlot(){return this._constrainDragToTimeSlot}set constrainDragToResource(e){const t=this.client.isHorizontal?"lockY":"lockX";this._constrainDragToResource=e,this.drag&&(this.drag[t]=e)}get constrainDragToResource(){return this._constrainDragToResource}onDragStart({context:e,event:t}){const r=this,n=r.client,s=n.scheduledEventName;r.currentOverClient=n,r.scrollClients={},r.onMouseOverNewTimeline(n);const i=r.dragData=r.getDragData(e,t);if(r.showTooltip){const t=i.context.dragProxy?i.context.dragProxy.firstChild:e.element;r.tip?r.tip.showBy(t):(r.tip=new Mn({id:n.id+"-event-drag-tip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,clippedBy:r.constrainDragToTimeline?[n.timeAxisSubGridElement,n.bodyContainer]:null,forElement:t,getHtml:r.getTipHtml.bind(r),style:"pointer-events:none",cls:r.tooltipCls}),r.tip.on("innerhtmlupdate",r.updateDateIndicator,r))}n.trigger(s+"DragStart",{[s+"Records"]:i.draggedRecords,context:i})}updateDateIndicator(){const{startDate:e,endDate:t}=this.dragData,r=this.tip,n=r.element.querySelector(".b-sch-tooltip-enddate");this.clockTemplate.updateDateIndicator(r.element,e),n&&this.clockTemplate.updateDateIndicator(n,t)}onDrag({context:e,event:t}){const r=this,n=r.dragData,s=n.startDate;let i;if(r.constrainDragToTimeline)i=r.client;else{let e=t.target;if(/^touch/.test(t.type)){const t=Xt.from(n.context.element,null,!0).center;e=Et.elementFromPoint(t.x,t.y)}i=K.fromElement(e,"timelinebase")}const o=r.client.features.dependencies,a=e.newX,l=e.newY;if(!i)return void(o&&o.updateDependenciesForTimeSpan(n.draggedRecords[0],n.context.element));if(i!==r.currentOverClient&&r.onMouseOverNewTimeline(i),r.updateDragContext(e,t),r.constrainDragToTimeline&&(r.showExactDropPosition||r.client.timeAxisViewModel.snap)){const t=i.getDateFromCoordinate(r.getCoordinate(n.draggedRecords[0],e.element,[a,l]))-n.sourceDate,s=new Date(n.origStart-0+t),o=i.timeAxisViewModel.getDistanceBetweenDates(s,n.startDate);n.startDate>=i.timeAxis.startDate&&null!=o&&Et.addTranslateX(e.element,o)}r.triggerEventDrag(n,s);let c=r.checkDragValidity(n,t);c&&"boolean"!=typeof c&&(e.message=c.message||"",c=c.valid),e.valid=!1!==c,r.showTooltip&&r.tip.realign(),o&&o.updateDependenciesForTimeSpan(n.draggedRecords[0],n.context.element.querySelector(i.eventInnerSelector))}onMouseOverNewTimeline(e){const t=this.scrollClients||{};if(this.currentOverClient.element.classList.remove("b-dragging-"+this.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),!(e.id in t)){e.scrollManager.startMonitoring({element:e.timeAxisSubGridElement}),t[e.id]=e}this.currentOverClient=e}onDrop({context:e,event:t}){const r=this,{currentOverClient:n,dragData:s}=r;let i=!1;r.updateDragContext(e,t),r.tip&&r.tip.hide(),e.valid&&s.startDate&&s.endDate&&(s.finalize=(...t)=>{r.finalize(...t),e.finalize(...t)},n.trigger(`before${n.capitalizedEventName}DropFinalize`,{context:s,event:t}),e.async=s.async,!e.async&&r.isValidDrop(s)&&(i=s.startDate-s.origStart!=0||s.newResource!==s.resourceRecord)),e.async||r.finalize(s.valid&&e.valid&&i)}onDragAbort({context:e}){const t=this,{dragData:r,client:n}=t,{draggedRecords:s}=r;n.currentOrientation.onDragAbort(e),t.dragData.record.instanceMeta(n).retainElement=!1,t.tip&&t.tip.hide(),n.trigger(n.capitalizedEventName+"DragAbort",{[n.scheduledEventName+"Records"]:s,context:r})}onDragReset({source:e}){const t=this,r=t.scrollClients||{};for(const e in r)r[e].scrollManager.stopMonitoring(r[e].timeAxisSubGridElement);if(e.context&&e.context.started){const{eventBarEls:e}=t.dragData;e[0].classList.remove("b-drag-main")}if(t.scrollClients=null,t.currentOverClient&&t.currentOverClient.element.classList.remove("b-dragging-"+t.currentOverClient.scheduledEventName),t.dragData&&!t.dragData.context.valid){const e=t.currentOverClient.features.dependencies;e&&e.scheduleDraw(!0)}}onInternalInvalidDrop(){const e=this,{currentOverClient:t}=e;e.tip&&e.tip.hide(),e.drag.abort(),t.trigger(`after${t.capitalizedEventName}Drop`,{[t.scheduledEventName+"Records"]:e.dragData.draggedRecords,valid:!1,context:e.dragData})}async finalize(e){const t=this,{currentOverClient:r,dragData:n}=t,{context:s,draggedRecords:i}=n;let o;return i.forEach((e,r)=>{t.resumeElementRedrawing(e),n.eventBarEls[r].classList.remove(t.drag.draggingCls)}),e?(o=t.updateRecords(n),ze.isPromise(o)&&(s.async=!0,await o),n.valid?(t.drag.reset(),r.trigger(`after${r.capitalizedEventName}Drop`,{[r.scheduledEventName+"Records"]:i,valid:!0,context:n})):t.onInternalInvalidDrop()):t.onInternalInvalidDrop(),o}updateDragContext(e,t){const r=this,{drag:n}=r,s=r.dragData,i=r.currentOverClient,{isHorizontal:o}=i,a=e.element,l=Xt.from(a,i.timeAxisSubGridElement),c=s.draggedRecords[0],d=c.isAssignment?c.event:c,u=r.constrainDragToTimeSlot||(o?n.lockX:n.lockY);if(s.browserEvent=t,u)s.timeDiff=0;else{if(i.timeAxis.isContinuous){const{dateConstraints:t}=s,{timeAxisSubGrid:n}=i,{scrollable:o}=n,a=o.viewport,l=i.isHorizontal?e.clientX-a.x+o.x:e.clientY-a.y+o.y,c=i.timeAxisViewModel.getDateFromPosition(l,null,!0),u=s.timeDiff=c-e.pointerStartDate;s.startDate=r.adjustStartDate(s.origStart,u),t&&(s.startDate=je.constrain(s.startDate,t.start,new Date(t.end-d.durationMS))),s.endDate=new Date(s.startDate-0+s.duration)}else{const e=r.resolveStartEndDates(l);s.valid=Boolean(e.startDate&&e.endDate),s.valid&&(s.startDate=e.startDate,s.endDate=e.endDate)}s.valid&&(s.timeDiff=s.startDate-s.origStart)}if(Object.assign(s,r.getProductDragContext(s)),s.valid)if(s.endDate<=i.timeAxis.startDate||s.startDate>=i.timeAxis.endDate)s.context.valid=!1,s.context.message=r.L("L{EventDrag.noDropOutsideTimeline}");else{const e=!t||r.checkDragValidity(s,t);e&&"boolean"!=typeof e?(s.context.valid=!1!==e.valid,s.context.message=e.message):(s.context.valid=!1!==e,s.context.message="")}else s.context.valid=!1}suspendElementRedrawing(e,t=!0){e.instanceMeta(this.client).retainElement=t}resumeElementRedrawing(e){this.suspendElementRedrawing(e,!1)}getDragData(e,t){const r=this,n=r.client,{record:s,dateConstraints:i,eventBarEls:o,draggedRecords:a}=r.setupProductDragData(e),l=s.startDate,c=s.endDate,d=n.timeAxis,u=l<d.startDate,h=c>d.endDate,g=r.getCoordinate(s,e.element,[e.elementStartX,e.elementStartY]),m=r.getCoordinate(s,e.element,[e.startClientX,e.startClientY]);a.forEach(e=>r.suspendElementRedrawing(e)),r.drag.startEvent.ctrlKey&&r.client.selectEvent(a[0],!0);const p={context:e,dateConstraints:i,eventBarEls:o,record:s,draggedRecords:a,sourceDate:u?l:n.getDateFromCoordinate(g),screenSourceDate:n.getDateFromCoordinate(m,null,!1),origStart:l,origEnd:c,startDate:l,endDate:c,timeDiff:0,startsOutsideView:u,endsOutsideView:h,duration:c-l,browserEvent:t};if(o.forEach(e=>{e.classList.add(r.drag.draggingCls),e.classList.remove("b-sch-event-hover"),e.classList.remove("b-active"),e.classList.remove("b-first-render")}),o.length>1)if(e.relatedElements=o.slice(1),e.relatedElStartPos=[],e.relatedElDragFromPos=[],r.unifiedDrag){r.client.isAnimating=!0,gr.on({element:o[1],transitionend(){r.client.isAnimating=!1},once:!0}),o[0].classList.add("b-drag-main");let[t,n]=Et.getTranslateXY(e.element);e.relatedElements.forEach((r,s)=>{e.relatedElStartPos[s]=Et.getTranslateXY(r),t+=10,n+=10,Et.setTranslateXY(r,t,n),e.relatedElDragFromPos[s]=[t,n]})}else e.relatedElements.forEach((t,r)=>{e.relatedElStartPos[r]=e.relatedElDragFromPos[r]=Et.getTranslateXY(t)});return p}getRelatedRecords(e){return[]}setupConstraints(e,t,r,n){const s=this,i=!s.showExactDropPosition&&r>1?r:0;n?s.setXConstraint(e.left,e.right-t.width,i):s.setXConstraint(!0,!0,i),s.setYConstraint(e.top,e.bottom-t.height,0)}updateYConstraint(e){const t=this,{client:r}=t,{context:n}=t.drag,s=r.timeAxisViewModel.snapPixelAmount;if(n&&!t.drag.lockY){let i;if(!t.constrainDragToTimeline)return void t.setYConstraint(null,null,s);i=r.getScheduleRegion(null,e),t.setYConstraint(i.top,i.bottom-n.element.offsetHeight,s)}else t.setYConstraint(null,null,s)}setXConstraint(e,t,r){const n=this.drag;n.leftConstraint=e,n.rightConstraint=t,n.minX=e,n.maxX=t}setYConstraint(e,t,r){const n=this.drag;n.topConstraint=e,n.bottomConstraint=t,n.minY=e,n.maxY=t}adjustStartDate(e,t){return this.client.timeAxis.roundDate(new Date(e-0+t),!!this.client.snapRelativeToEventStartDate&&e)}resolveStartEndDates(e){const{start:t,end:r}=this.client.getStartEndDatesFromRectangle(e,"round",this.dragData.duration);return{startDate:t,endDate:r}}getTipHtml(){const e=this,{startDate:t,endDate:r,draggedRecords:n}=e.dragData,s=e.client.getFormattedDate(t),i=e.client.getFormattedEndDate(r,t),{valid:o,message:a}=e.dragData.context;return e.dragTipTemplate({valid:o,startDate:t,endDate:r,startText:s,endText:i,message:a||"",[e.client.scheduledEventName+"Record"]:n[0],dragData:e.dragData,startClockHtml:e.clockTemplate.template({date:t,text:s,cls:"b-sch-tooltip-startdate"}),endClockHtml:n[0].isMilestone?"":e.clockTemplate.template({date:r,text:i,cls:"b-sch-tooltip-enddate"})})}get disabled(){return this._disabled}set disabled(e){this._disabled=e}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,t){throw new Error("Implement in subclass")}getCoordinate(e,t,r){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}}hd._$name="DragBase";const gd=function(e,t){for(const r in e){let n=e[r];if(n){r in t&&(n=e[r]="object"==typeof n?ze.merge(ze.clone(t[r]),n):t[r]);const s=n.menu;s&&gd("items"in s?s.items:s,t)}}};class md extends Nn{static get defaultConfig(){return{defaultItems:null,items:null,processItems:null,triggerEvent:null}}static get pluginConfig(){return{assign:["showEventContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick","onEventSpaceKey"]}}doDestroy(){this.menu&&this.menu.destroy()}onElementContextMenu(e){"contextmenu"===this.triggerEvent&&this.showEventContextMenu(e)}onElementClick(e){"click"===this.triggerEvent&&this.showEventContextMenu(e)}onElementDblClick(e){"dblclick"===this.triggerEvent&&this.showEventContextMenu(e)}onEventSpaceKey(e){const t=Xt.from(e.target).center,r=new MouseEvent("contextmenu",Object.assign({clientX:t.x,clientY:t.y},e));Object.defineProperty(r,"target",{get:()=>e.target}),this.showEventContextMenu(r)}showEventContextMenu(e){const t=this,r=t.client,n=e.target,s=Et.up(n,r.eventSelector),i=s||n;if(i){const r=t.resolveRecord(i);r&&(e.preventDefault(),t.showContextMenuFor(r,{targetElement:i,eventElement:s,event:e}))}}showContextMenuFor(e,t){}beforeContextMenuShow(){}showContextMenu(e){if(this.disabled)return;const t=this,r=e.event,n=e.menuType.toLowerCase(),s=I.lowercaseFirstLetter(n),i=`get${I.capitalizeFirstLetter(n)}MenuItems`,{client:o,processItems:a,defaultItems:l,namedItems:c}=t,d=r?[r.clientX+1,r.clientY+1]:Xt.from(e.targetElement).center;let u=e.items=ze.isEmpty(t.items)?ze.clone(l):ze.merge(ze.clone(l),t.items);e.namedItems=c,e.selection=o.selectedRecords;const h=o.getColumnFromElement(e.targetElement),g=[];if(h){o.getCellMenuItems(h,e.taskRecord,g);const t=g.reduce((e,t)=>(e[t.name]=t,e),{});u=e.items=ze.copyPropertiesIf(u,t,Object.keys(t))}gd(u,c),o[i]&&o[i](e,u),a&&!1===a(e)||ze.isEmpty(e.items)||!1!==t.beforeContextMenuShow(e)&&!1!==o.trigger(s+"ContextMenuBeforeShow",e)&&(t.menu=J.showContextMenu(d,{owner:o,scrollAction:"hide",clippedBy:[o.timeAxisSubGridElement,o.bodyContainer],constrainTo:window,items:u,onDestroy(){t.menu=null},onBeforeItem:t=>{Object.assign(t,e)},onItem:e=>o.trigger(s+"ContextMenuItem",e),listeners:{show({source:t}){e.menu=t,o.trigger(s+"ContextMenuShow",e)}}}))}hideContextMenu(e){this.menu&&this.menu.hide(e)}set defaultItems(e){this._defaultItems=e}get defaultItems(){const e=ze.clone(this._defaultItems);if(this.client.readOnly)for(const t in e)e[t]=!1;return e}get triggerEvent(){return this._triggerEvent||this.client.contextMenuTriggerEvent}set triggerEvent(e){this._triggerEvent=e}}md._$name="TimeSpanRecordContextMenuBase";class pd extends md{static get $name(){return"EventContextMenu"}static get defaultConfig(){return{items:null,processItems:null,defaultItems:{deleteEvent:!0,unassignEvent:!0}}}resolveRecord(e){return this.client.resolveEventRecord(e)}showContextMenuFor(e,{targetElement:t,event:r}={}){const{client:n}=this;(t||(t=n.getElementsFromEventRecord(e)[0]))&&this.showContextMenu({menuType:"event",eventElement:t,targetElement:t,eventRecord:e,resourceRecord:n.resolveResourceRecord(t),assignmentRecord:n.resolveAssignmentRecord(t),event:r})}set defaultItems(e){this._defaultItems=e}get defaultItems(){const e=super.defaultItems;return this.client.assignmentStore||(e.unassignEvent=!1),e}get namedItems(){const e=this,{client:t}=e;return e._namedItems||(e._namedItems={deleteEvent:{text:"L{Scheduler.Delete event}",localeClass:this,icon:"b-icon b-icon-trash",weight:-160,onItem:({menu:e,eventRecord:r})=>{const n=e.focusInEvent&&e.focusInEvent.relatedTarget;n&&(n.focus(),t.navigator.activeItem=n),t.removeRecords([r])}},unassignEvent:{text:"L{Scheduler.Unassign event}",localeClass:this,icon:"b-icon b-icon-unassign",weight:-150,name:"unassignEvent",onItem:({menu:e,eventRecord:r,resourceRecord:n})=>{const s=e.focusInEvent&&e.focusInEvent.relatedTarget;s&&(s.focus(),t.navigator.activeItem=s),r.unassign(n)}}}),e._namedItems}}pd.featureClass="",pd._$name="EventContextMenu",Va.registerFeature(pd,!0,"Scheduler");var fd=e=>class extends(e||B){static get defaultConfig(){return{dataLayerStores:["store"]}}startConfigure(e){this.configDataLayer(this.client,e),super.startConfigure(e)}doDestroy(){return(this.dataLayerStores||[]).forEach(e=>{"columns"===e&&(e="columnStore"),this[e]=null}),super.doDestroy()}configDataLayer(e,t){return(t.dataLayerStores||[]).reduce((t,r)=>{if("columnStore"===r||"columns"===r)r="columnStore",t.columnStore=t.columnStore||t.columns||this.obtainColumnStore(e,t);else{const n=this["obtain"+I.capitalizeFirstLetter(r)];t[r]=t[r]||n&&n.call(this,e,t)}return Reflect.has(this,r)||!Object.isExtensible(this)||Object.isSealed(this)||Object.isFrozen(this)||Object.defineProperty(this,r,{get:function(){return this["_"+r]},set:function(e){this.setDataLayerStore(r,e)}}),t},t)}attachToDataLayer(e=!1){(this.dataLayerStores||[]).forEach(t=>{"columns"===t&&(t="columnStore");const r=this["obtain"+I.capitalizeFirstLetter(t)];this[t]&&!e||!r||(this[t]=r.call(this,this.client))})}setDataLayerStore(e,t){const r="_"+e,n=`_${e}Detacher`,s=`on${I.capitalizeFirstLetter(e)}Change`,i=`get${I.capitalizeFirstLetter(e)}ListenersConfig`;if(this[r]!==t&&(this[n]&&(this[n](),this[n]=null),this[s]&&this[s](t,this[r]),this[r]=t,t&&this[i])){const e=this[i]();e&&(this[n]=t.on(Object.assign({thisObj:this,detachable:!0},e)))}}obtainStore(e,t){return e.store}obtainColumnStore(e,t){return e.columns}},vd=e=>class extends(fd(e||B)){static get defaultConfig(){return{dataLayerStores:["resourceStore","dependencyStore","assignmentStore","eventStore"]}}obtainResourceStore(e,t){return e.store}obtainDependencyStore(e,t){return e.dependencyStore}obtainAssignmentStore(e,t){return e.assignmentStore}obtainEventStore(e,t){return e.eventStore}},yd=e=>class extends(e||B){addEventToResource({event:e,resource:t,eventStore:r,assignmentStore:n}){e=r.add(e)[0];const{assignment:s}=this.addAssignment({event:e,resource:t,assignmentStore:n});return{event:e,assignment:s!==e?s:null}}getEventDependencies({event:e,dependencyStore:t}){return t.getEventDependencies(e)}getEventAssignments({event:e,assignmentStore:t}){return e.assignments||[]}getEventResource({event:e,resourceStore:t}){return e.resource}isEventAssignedToResource({event:e,resource:t,resourceStore:r,assignmentStore:n}){let s=!1;return s=n?this.getEventAssignments({event:e,assignmentStore:n}).some(e=>this.isAssignmentForResource({assignment:e,resource:t,resourceStore:r})):e.resource===t,s}assignEventToResource({event:e,resource:t,assignmentStore:r}){let n;return r?n=r.add({eventId:e.id,resourceId:t.id})[0]:e.resourceId=t.id,n||e}},bd=e=>class extends(e||B){isAssignmentEventAssigned({assignment:e}){return!!e.event}isAssignmentResourceAssigned({assignment:e}){return!!e.resource}isAssignmentAssigned({assignment:e}){return!!e.event&&!!e.resource}isAssignmentForResource({assignment:e,resource:t,resourceStore:r}){return e.resource===t}getAssignmentResource({assignment:e,resourceStore:t}){return e.resource}getAssignmentEvent({assignment:e,eventStore:t}){return e.event}getAssignmentDependencies({assignment:e,dependencyStore:t}){const r=e.event;return r?this.getEventDependencies({event:r,dependencyStore:t}):[]}addAssignment({event:e,resource:t,assignmentStore:r,assignmentConfig:n}){return{assignment:r.add(Object.assign({},n,{eventId:e.id,resourceId:t.id}))[0]}}},Cd=e=>class extends(e||B){getDependencySourceEvent({dependency:e,eventStore:t}){return e.sourceEvent}getDependencyTargetEvent({dependency:e,eventStore:t}){return e.targetEvent}getDependencySourceAssignments({dependency:e,assignmentStore:t}){const r=e.sourceEvent;return r?this.getEventAssignments({event:r,assignmentStore:t}):[]}getDependencyTargetAssignments({dependency:e,assignmentStore:t}){const r=e.targetEvent;return r?this.getEventAssignments({event:r,assignmentStore:t}):[]}getDependencyAssignments({dependency:e,assignmentStore:t}){[].concat(this.getDependencySourceAssignments({dependency:e,assignmentStore:t}),this.getDependencyTargetAssignments({dependency:e,assignmentStore:t}))}getDependencyAssignmentsAsFromToArray({dependency:e,assignmentStore:t}){const r=this.getDependencySourceAssignments({dependency:e,assignmentStore:t}),n=this.getDependencyTargetAssignments({dependency:e,assignmentStore:t});return r.reduce((e,t)=>n.reduce((e,r)=>(e.push({from:t,to:r}),e),e),[])}isDependencySourceAssignment({dependency:e,assignment:t}){return e.from===t.eventId}isDependnecyTargetAssignment({dependency:e,assignment:t}){return e.to===t.eventId}isValidDependency({sourceEvent:e,targetEvent:t,type:r,dependencyStore:n}){return n.isValidDependency(e.id,t.id,r)}isValidDependencyToCreate({sourceEvent:e,targetEvent:t,type:r,dependencyStore:n}){return n.isValidDependencyToCreate(e.id,t.id,r)}createDependency({sourceEvent:e,targetEvent:t,type:r,fromSide:n,toSide:s,dependencyStore:i}){return i.add({from:e.id,to:t.id,type:r,fromSide:n,toSide:s})[0]}},wd=e=>class extends(e||B){},Sd=e=>{const t=[bd,Cd,yd,wd],r=Qn(B).mixes(...t);return class extends(e||B){get dataApi(){return this._dataApi||(this._dataApi=new r({host:this.dataApiHost||this})),this._dataApi}}};const Dd=[null];class Ed extends(Qn(hd).mixes(vd,Sd)){static get $name(){return"EventDrag"}static get defaultConfig(){return{constrainDragToResource:!1,constrainDragToTimeSlot:!1,validatorFn:()=>{},validatorFnThisObj:null,unifiedDrag:null}}get scheduler(){return this.client}get store(){return this.eventStore}isElementDraggable(e,t){const{scheduler:r}=this,n=Et.up(e,r.eventSelector),{eventResize:s}=r.features;if(!n||this.disabled)return!1;if(e.matches('[class$="-handle"]'))return!1;const i=r.resolveEventRecord(n);return!(s&&!i.isMilestone&&s.resize.overAnyHandle(t,n))}triggerEventDrag(e,t){e.startDate-t==0&&e.newResource===e.resourceRecord||this.scheduler.trigger("eventDrag",{eventRecords:e.draggedRecords,startDate:e.startDate,endDate:e.endDate,newResource:e.newResource,context:e})}onDragStart({context:e,event:t}){const r=this.client.features.eventContextMenu;super.onDragStart({context:e,event:t}),r&&r.hideContextMenu(!1)}isValidDrop(e){const{newResource:t,resourceRecord:r}=e;let n=e.draggedRecords[0];return!(!t||t.meta.specialRow)&&(r===t||(n instanceof xc?(n=this.dataApi.getAssignmentEvent({assignment:n,eventStore:this.eventStore}),!this.dataApi.isAssignmentForResource({assignment:n,resource:t,resourceStore:this.resourceStore})):!this.dataApi.isEventAssignedToResource({event:n,resource:t,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore})))}checkDragValidity(e,t){const r=this,n=this.currentOverClient;let s=r.dragData.context.valid;return s&&(s=n.allowOverlap||n.isDateRangeAvailable(e.startDate,e.endDate,e.draggedRecords[0],e.newResource)?r.validatorFn.call(r.validatorFnThisObj||r,e,t):{valid:!1,message:r.L("L{eventOverlapsExisting}")}),s}updateRecords(e){const t=this,r=t.scheduler,n=t.currentOverClient,{assignmentStore:s,eventStore:i}=r,{draggedRecords:o}=e;let a;if(i.suspendAutoCommit(),n.eventStore.suspendAutoCommit(),i!==n.eventStore&&(i.remove(o),n.eventStore.add(o)),s){if(n!==r)throw new Error("Assignments cannot be dragged cross-scheduler");a=t.updateRecordsMultipleAssignmentMode(r,n,e,!1)}else a=t.updateRecordsSingleAssignmentMode(r,n,e,!1);return i.resumeAutoCommit(),n.eventStore.resumeAutoCommit(),n.trigger("eventDrop",{eventRecords:o,isCopy:!1,event:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,context:e}),a}updateRecordsSingleAssignmentMode(e,t,r,n){const s=this,i=e!==t,o="vertical"===t.mode,{eventStore:a,resourceStore:l}=e,{draggedRecords:c,timeDiff:d,resourceRecord:u,newResource:h}=r,g=s.unifiedDrag||i&&c.length>1,m=[],p=s.constrainDragToResource?0:l.indexOf(u)-l.indexOf(h),f=s.adjustStartDate(c[0].startDate,d);let v;if(o&&c.forEach((t,n)=>{const s=r.eventBarEls[n];delete t.instanceMeta(e).hasTemporaryDragElement,s.dataset.transient&&s.remove()}),c.forEach((u,y)=>{const b=r.eventBarEls[y],C=u.generation,w=i?Dd:u.resources;b.querySelector(e.eventInnerSelector).classList.add(e.committingCls),n?(u=u.fullCopy(null),m.push(u)):a!==t.eventStore&&(a.remove(c),t.eventStore.add(c),u.instanceMeta(t).fromDragProxy=!0),u.beginBatch();const S=g?f:s.adjustStartDate(u.startDate,d);(0!==p||g||i)&&w.length&&w.forEach(e=>{let n=h;if(!g&&!i){let t=l.indexOf(e)-p;t<0?t=0:t>=l.getCount()&&(t=l.getCount()-1),n=l.getAt(t)}if(e?u.reassign(e,n):u.assign(n),!o){const e=t.rowManager.getRowFor(n)&&t.isInTimeAxis(u)?t.getEventRenderId(u,n):null;if(e)if(i){const e=Xt.from(r.context.element,t.foregroundCanvas,!0),s=r.context.element.cloneNode(!0);Et.setTranslateXY(s,e.x,e.y),s.classList.remove("b-first-render"),s.classList.remove("b-active"),s.classList.remove("b-drag-proxy"),s.classList.remove("b-dragging"),t.currentOrientation.cacheTimeSpanElement(u,n,s)}else t.currentOrientation.releaseTimeSpanDiv(b,!0),t.currentOrientation.updateElementId(b,e);else b.remove()}}),u.setStartDate(S,!0,a.skipWeekendsDuringDragDrop),u.endBatch(),u.generation!==C&&(v=!0)}),m.length){const e=a.count;a.add(m),a.count!==e&&(v=!0)}v||(r.valid=!1)}updateRecordsMultipleAssignmentMode(e,t,r,n){const s=this,i=e!==t,{eventStore:o}=e,{draggedRecords:a,timeDiff:l,resourceRecord:c,newResource:d}=r,u={};let h;a.forEach((a,g)=>{const m=a.event,p=r.eventBarEls[g],f=m.generation,v=e.getEventRenderId(a.event,d);u[m.id]||(u[m.id]=!0,"vertical"===t.mode?p.dataset.transient&&(p.retainElement=!1):v&&(i?t.currentOrientation.cacheTimeSpanElement(m,p):t.currentOrientation.updateElementId(p,v)),m.setStartDate(s.adjustStartDate(m.startDate,l),!0,o.skipWeekendsDuringDragDrop),c!==d&&(n?m.assign(d):m.isAssignedTo(d)?m.unassign(a.resource):m.reassign(a.resource,d)),h=h||a.resource!==c||m.generation!==f)}),h||(r.valid=!1)}getProductDragContext(e){const t=this.scheduler.resolveEventRecord(e.browserEvent.target);let r;return r=this.constrainDragToResource?e.resourceRecord:this.constrainDragToTimeline?this.resolveResource()||e.newResource||e.resourceRecord:this.resolveResource(),{valid:Boolean(r),newResource:r,targetEventRecord:t}}setupProductDragData(e){const t=this,r=t.scheduler,n=e.grabbed,s=r.resolveEventRecord(n),i=r.resolveResourceRecord(n),o=r.resolveAssignmentRecord(n),a=Xt.from(n),l=[o||s],c=[];if(t.constrainDragToResource&&!i)throw new Error("Resource could not be resolved for event: "+s.id);const d=r.getDateConstraints(t.constrainDragToResource?i:null,s);return t.constrainDragToTimeline&&t.setupConstraints(r.getScheduleRegion(t.constrainDragToResource?i:null,s),a,r.timeAxisViewModel.snapPixelAmount,Boolean(d)),r.multiEventSelect&&(r.isEventSelected(l[0])||t.drag.startEvent.ctrlKey)&&l.push.apply(l,t.getRelatedRecords(o||s)),l.forEach(e=>{let t;t=e instanceof xc?r.getElementFromEventRecord(e.event,e.resource):r.getElementFromEventRecord(e,e.resource),t||(t=r.currentOrientation.addTemporaryDragElement(e),t=t.innerElement),c.push(t)}),c.forEach((e,t)=>c[t]=e.parentNode),{record:s,dateConstraints:d,eventBarEls:c,draggedRecords:l}}getDragData(e,t){return Object.assign(super.getDragData(e,t),{resourceRecord:this.scheduler.resolveResourceRecord(e.grabbed)})}getRelatedRecords(e){return this.scheduler.selectedEvents.filter(t=>t!==e&&t.isDraggable)}getCoordinate(e,t,r){const n=this.currentOverClient;if(n.isHorizontal){let s=r[0];if("default"!==n.milestoneLayoutMode&&e.isMilestone)switch(n.milestoneAlign){case"center":s+=t.offsetWidth/2;break;case"end":s+=t.offsetWidth}return s}{let s=r[1];if("default"!==n.milestoneLayoutMode&&e.isMilestone)switch(n.milestoneAlign){case"center":s+=t.offsetHeight/2;break;case"end":s+=t.offsetHeight}return s}}resolveResource(){const e=this.currentOverClient,{isHorizontal:t}=e,{context:r}=this.dragData,n=r.dragProxy||r.element,s=Xt.from(n,null,!0),i=e.isVertical||this.unifiedDrag?r.clientY:s.center.y,o=Xt.from(n,this.currentOverClient.timeAxisSubGridElement,!0),{x:a,y:l}=o.center;if(t){const t=e.rowManager.getRowAt(i);return t&&e.resourceStore.getAt(t.dataIndex)}return e.resolveResourceRecord(e.timeAxisSubGridElement.querySelector(".b-sch-timeaxis-cell"),[a,l])}adjustStartDate(e,t){const r=this.currentOverClient;return r.timeAxis.roundDate(new Date(e-0+t),!!r.snapRelativeToEventStartDate&&e)}resolveStartEndDates(e){const t=this.currentOverClient,r=this.dragData;let{start:n,end:s}=t.getStartEndDatesFromRectangle(e,"round",r.duration);if(n&&s)if(r.startsOutsideView)r.endsOutsideView||(n=je.add(s,-r.duration,"ms"));else{if(n&&!t.timeAxis.dateInAxis(n,!1)){const e=t.timeAxis.getTickFromDate(n);e>=0&&(n=t.timeAxis.getDateFromTick(e))}s=je.add(n,r.duration,"ms")}return{startDate:n,endDate:s}}}Ed._$name="EventDrag",Va.registerFeature(Ed,!0,"Scheduler");class xd extends Nn{static get defaultConfig(){return{showTooltip:!0,dragTolerance:2,preventMultiple:!1,validatorFn:()=>{},validatorFnThisObj:null,proxyCls:"b-sch-dragcreator-proxy",tipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `}}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"],before:["onElementContextMenu"]}}doDestroy(){this.tip&&this.tip.destroy(),this.resize&&this.resize.destroy(),super.doDestroy()}addProxy(e){const t=this,{client:r}=t,{barMargin:n}=r,s=r.currentOrientation.getRowRegion(e.rowRecord);let i,o,a,l;return r.isHorizontal?(a="currentX"in e?Math.min(e.startX,e.currentX+1):e.startX,l=s.y+n,i=e.width||t.dragTolerance,o=s.height-2*n):(a=s.x+n,l="currentY"in e?Math.min(e.startY,e.currentY+1):e.startY,i=s.width-2*n,o=e.height||t.dragTolerance),r.element.classList.add("b-dragcreating"),r.element.classList.add("b-dragcreating-proxy-sizing"),t.proxy=Et.createElement({parent:r.foregroundCanvas,className:t.proxyCls,style:`transform:translate(${a}px, ${l}px);width:${i}px;height:${o}px`,retainElement:!0})}removeProxy(){const e=this;e.proxy&&(e.proxy.remove(),e.resize.destroy(),e.proxy=e.resize=null,e.client.element.classList.remove("b-dragcreating"),e.client.element.classList.remove("b-dragcreating-proxy-sizing"),e.tip&&e.tip.hide())}initResizer(e,t){const r=this;let n;n=r.client.isHorizontal?t.currentX>t.startX?"right":"left":t.currentY>t.startY?"bottom":"top",r.resize&&r.resize.destroy(),r.resize=new No({name:r.constructor.name,direction:r.client.isVertical?"vertical":"horizontal",isTouch:e.type.startsWith("touch"),grab:{element:r.proxy,edge:n,event:t.startEvent},allowEdgeSwitch:!0,outerElement:r.client.timeAxisSubGridElement,scrollManager:r.client.scrollManager,scroller:r.client.timeAxisSubGrid.scrollable,listeners:{resizing:r.onResizing,resize:r.onResize,cancel:r.onCancel,thisObj:r}}),r.resize.context.resource=t.resource}initTooltip(){const e=this,t=e.client;e.showTooltip&&(e.tip?e.tip.showBy(e.getTooltipTarget()):(e.clockTemplate=new ud({scheduler:t}),e.tip=new Mn({id:t.id+"-drag-create-tip",autoShow:!0,trackMouse:!1,updateContentOnMouseMove:!0,getHtml:e.getTipHtml.bind(e),align:t.isVertical?"t-b":"b100-t100",hideDelay:0,axisLock:!0}),e.tip.on("innerhtmlupdate",e.updateDateIndicator,e)))}updateDateIndicator(){const e=this,{startDate:t,endDate:r}=e.createContext,n=e.tip,s=n.element.querySelector(".b-sch-tooltip-enddate");t&&r&&(e.clockTemplate.updateDateIndicator(n.element,t),s&&e.clockTemplate.updateDateIndicator(s,r))}getTipHtml(){if(!this.resize.context)return;const e=this,t=e.client,{edge:r,newX:n,newY:s,elementStartX:i,elementStartY:o,elementWidth:a,elementHeight:l,newWidth:c,newHeight:d,valid:u,message:h}=e.resize.context;let g,m;if(t.isHorizontal){const e="left"===r?n:i,s=Math.min(Math.max(e+(c||a)-1,0),t.timeAxisViewModel.totalSize-1);g=t.getDateFromCoordinate(e,"round",!0),m=t.getDateFromCoordinate(s,"round",!0)}else{const e="top"===r?s:o,n=Math.min(Math.max(e+(d||l)-1,0),t.timeAxisViewModel.totalSize-1);g=t.getDateFromCoordinate(e,"round",!0),m=t.getDateFromCoordinate(n,"round",!0)}const p=je.min(g,m),f=je.max(g,m),v=p&&t.getFormattedDate(p),y=f&&m&&t.getFormattedEndDate(f,p);return e.tipTemplate({valid:u,startDate:p,endDate:f,startText:v,endText:y,message:h,startClockHtml:e.clockTemplate.template({date:p,text:v,cls:"b-sch-tooltip-startdate"}),endClockHtml:e.clockTemplate.template({date:t.getDisplayEndDate(f,p),text:y,cls:"b-sch-tooltip-enddate"})})}finalize(e){const t=this,r=()=>{t.proxy.retainElement=!1,t.reset()},n=()=>{t.client.trigger("afterDragCreate",{proxyElement:t.proxy}),r()};if(e){const e=t.finalizeDragCreate(t.createContext);ze.isPromise(e)?e.then(n,r):n()}else n()}onElementMouseDown(e){const t=this,{client:r}=t;if(0===e.button&&e.target.matches(".b-sch-timeaxis-cell")&&!t.disabled&&!r.readOnly){const n=r.isVertical?r.resolveResourceRecord(e):r.getRecordFromElement(e.target);if(n.meta.specialRow)return;if(t.preventMultiple&&!t.isRowEmpty(n))return;t.monitorMove=!0,t.createContext={startEvent:e,startScreenX:e.screenX,startScreenY:e.screenY,startX:e.offsetX,startY:e.offsetY,cellElement:e.target,rowRecord:n},t.mouseUpDetacher=gr.on({element:document.body,mouseup:"onMouseUp",once:!0,thisObj:this})}}onElementMouseMove(e){const t=this;if(t.monitorMove){const{createContext:r,client:n}=t,s=t.client.isVertical?r.startScreenY-e.screenY:r.startScreenX-e.screenX;if(Math.abs(s)>t.dragTolerance){const s=n.getDateFromDomEvent(e),i=Xt.from(n.timeAxisSubGridElement,null,!0);if(!1===t.handleBeforeDragCreate(s,e))return void(t.monitorMove=!1);r.currentX=Math.max(e.clientX-i.x+n.timeAxisSubGrid.scrollable.x,0),r.currentY=Math.max(e.clientY-i.y+n.timeAxisSubGrid.scrollable.y,0),t.addProxy(t.createContext),t.initResizer(e,t.createContext),t.initTooltip(),t.monitorMove=!1,n.trigger("dragCreateStart",{proxyElement:t.proxy})}}t.proxy&&t.showTooltip&&t.resize.context&&t.tip.alignTo(t.getTooltipTarget())}getTooltipTarget(){const e=this,t=Xt.from(e.proxy,null,!0);return e.client.isVertical?("bottom"===e.resize.context.edge&&(t.y=t.bottom-1),t.height=e.tip.anchorSize[1]/2):("right"===e.resize.context.edge&&(t.x=t.right-1),t.width=e.tip.anchorSize[0]/2),{target:t}}onMouseUp(){this.client.element.classList.remove("b-dragcreating-proxy-sizing"),this.monitorMove=!1}onElementContextMenu(){if(this.proxy)return!1}onResizing({context:e,event:t}){const r=this,n=r.client,s="left"===e.edge?e.newX:e.elementStartX,i="top"===e.edge?e.newY:e.elementStartY,o=Math.min(s+Math.max((e.newWidth||e.elementWidth)-1,0),n.timeAxisViewModel.totalSize-1),a=Math.min(i+Math.max((e.newHeight||e.elementHeight)-1,0),n.timeAxisViewModel.totalSize-1),l=n.isVertical?i:s,c=n.isVertical?a:o,d=n.getDateFromCoordinate(l,"round",!0),u=n.getDateFromCoordinate(c,"round",!0),h=r.dateConstraints;let g=je.min(d,u),m=je.max(d,u);h&&(m=je.constrain(m,h.start,h.end),g=je.constrain(g,h.start,h.end)),Object.assign(r.createContext,{startDate:g,endDate:m}),e.valid=r.checkValidity(r.createContext,t),e.message="",e.valid&&"boolean"!=typeof e.valid&&(e.message=e.valid.message,e.valid=e.valid.valid),e.valid=!1!==e.valid}onResize({context:{valid:e},event:t}){const r=this,{startDate:n,endDate:s}=r.createContext;(!n||!s||s-n<=0)&&(e=!1),r.createContext=r.prepareCreateContextForFinalization(r.createContext,t,r.finalize.bind(r)),e&&r.client.trigger("beforeDragCreateFinalize",{context:r.createContext,event:t,proxyElement:r.proxy}),r.createContext&&(r.resize.context.async=r.createContext.async,r.createContext.async?r.resize.removeListeners():r.finalize(e))}prepareCreateContextForFinalization(e,t,r,n=!1){return Object.assign({},e,{async:n,event:t,finalize:r})}get dragging(){return this.resize}onCancel(){this.cancel()}cancel(){this.reset(),this.mouseUpDetacher&&this.mouseUpDetacher()}reset(){this.removeProxy(),this.createContext=null,this.monitorMove=!1}checkValidity(e,t){throw new Error("Implement in subclass")}triggerDragCreateEnd(e,t){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,t){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}}xd._$name="DragCreateBase";class Td extends xd{static get $name(){return"EventDragCreate"}static get defaultConfig(){return{validatorFn:()=>{}}}construct(e,t){this.scheduler=e,this.store=e.eventStore,super.construct(e,t)}finalizeDragCreate(e){const t=new this.store.modelClass({startDate:e.startDate,endDate:e.endDate});this.proxy.dataset.eventId=t.id,this.scheduler.trigger("dragCreateEnd",{newEventRecord:t,resourceRecord:e.rowRecord,event:e.event,proxyElement:this.proxy})}handleBeforeDragCreate(e,t){const r=this,n=r.scheduler.trigger("beforeDragCreate",{resourceRecord:r.createContext.rowRecord,date:e,event:t});if(n){const e=r.scheduler.features.scheduleTooltip;e&&e.hoverTip&&e.hoverTip.hide()}return r.dateConstraints=r.scheduler.getDateConstraints(r.createContext.rowRecord,e),n}checkValidity(e,t){const r=this.client;return e.resourceRecord=e.rowRecord,(r.allowOverlap||r.isDateRangeAvailable(e.startDate,e.endDate,null,e.resourceRecord))&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}isRowEmpty(e){const t=this.store.getEventsForResource(e);return!t||!t.length}}Td._$name="EventDragCreate",Va.registerFeature(Td,!0,"Scheduler");const Rd=je,Md=e=>{if(1===e.length)return e[0].value;if(2===e.length){const[t,r]=e[0]instanceof Vs?e:e.reverse(),n=Rd.parse(t.value);return n&&n.setHours(r.value.getHours(),r.value.getMinutes(),r.value.getSeconds(),r.value.getMilliseconds()),n}return null},kd=(e,t,r)=>{if(e&&t){const e=Rd.add(((e,t)=>{let r=new Date(e.getTime());return r.setHours(t.getHours(),t.getMinutes()),r})(r.startDateField.value,r.startTimeField.value),r.eventRecord.durationMS,"milliseconds");r.endDateField.value=e,r.endTimeField.value=Rd.clone(e)}};class Id extends Nn{static get defaultConfig(){return{autoClose:!0,saveAndCloseOnEnter:!0,triggerEvent:null,showDeleteButton:!0,showNameField:!0,startTimeConfig:null,startDateConfig:null,endTimeConfig:null,endDateConfig:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,extraItems:null,extraWidgets:null,weekStartDay:null}}construct(e,t){const r=this;e.eventEdit=r,super.construct(e,ze.assign({weekStartDay:e.weekStartDay},t)),r.clientListenersDetacher=e.on({[r.triggerEvent]:r.onActivateEditor,dragcreateend:r.onDragCreateEnd,thisObj:r})}doDestroy(){this.clientListenersDetacher(),this.editor&&this.editor.destroy(),super.doDestroy()}get editorConfig(){return this._editorConfig}set editorConfig(e){const t=this.getDefaultConfiguration().editorConfig;(e=ze.assign({},t,e)).items=e.items||[],this.insertExtraWidgetsIntoDefaultWidgets(e),this._editorConfig=e}get extraWidgets(){return this._skipWarn||console.warn("`extraWidgets` was deprecated in 2.1, please change your code to use `extraItems`"),this._extraItems}set extraWidgets(e){console.warn("`extraWidgets` was deprecated in 2.1, please change your code to use `extraItems`"),this._extraItems=e}get extraItems(){const e=this;return e._skipWarn=!0,e._thisIsAUsedExpression(e.extraWidgets),e._skipWarn=!1,e._extraItems}set extraItems(e){this._extraItems=e}insertExtraWidgetsIntoDefaultWidgets(e){if(!this.extraItems||!this.extraItems.length)return;let t,r=e.items.findIndex(e=>"extraItems"===e.type);r>-1&&(e.items.splice(r,1),t=e.items.splice(r));let n=this.extraItems.filter(e=>e.index>=0),s=this.extraItems.filter(e=>!(e.index>=0));e.items=e.items.concat(s),n.sort((e,t)=>e.index-t.index),n.forEach(t=>e.items.splice(t.index,0,t)),t&&t.length&&(e.items=e.items.concat(t))}onDatesChange(e){const t=this,r=e.source,n=e.value;switch(r.ref){case"startDateField":t.startTimeField&&kd(n,t.startTimeField.value,t);break;case"startTimeField":t.startDateField&&kd(t.startDateField.value,n,t)}t.endTimeField&&(Rd.isEqual(Rd.clearTime(t.startDateField.value),Rd.clearTime(t.endDateField.value))?t.endTimeField.min=t.startTimeField.value:t.endTimeField.min=null)}async save(){throw new Error("Implement in subclass")}get isValid(){return Object.values(this.editor.widgetMap).every(e=>!(e.name&&!e.hidden)||!1!==e.isValid)}get values(){const e=[],t=[],r={};return this.editor.eachWidget(n=>{const s=n.name;if(s&&!n.hidden)switch(s){case"startDate":e.push(n);break;case"endDate":t.push(n);break;case"resource":r[s]=n.record;break;default:r[s]=n.value}},!0),r.startDate=Md(e),r.endDate=Md(t),r.duration=Rd.diff(r.startDate,r.endDate,this.editor.record.durationUnit,!0),r}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;this.scheduler.assignmentStore&&delete t.resource,e.set(t)}resetEditingContext(){const e=this;e.isEditing=!1,e.client.element.classList.remove("b-eventeditor-editing"),e.phantomEventElement&&e.phantomEventElement.remove(),e.phantomEventElement=null}onPopupKeyDown({event:e}){"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),"startDate"===e.target.name&&kd(this.startDateField.value,this.startTimeField.value,this),this.onSaveClick())}async onSaveClick(){await this.save()&&this.editor.close()}async onDeleteClick(){await this.deleteEvent()&&(this.editor.autoClose&&!this.editor.containsFocus||this.editor.close())}onCancelClick(){this.editor.close()}}Id._$name="EditBase";class Fd extends vn{static get $name(){return"EventEditor"}static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible",scrollable:{overflowY:!0}}}processWidgetConfig(e){var t;const r=this,n=r.eventEditFeature;if((null===(t=e.type)||void 0===t?void 0:t.includes("date"))&&null==e.weekStartDay&&(e.weekStartDay=r.weekStartDay),"extraItems"===e.type)return!1;let s={};if("resourceField"===e.ref){if(!n.showResourceField)return!1;r.resourceStore=e.store=n.resourceStore.makeChained(e=>!e.meta.specialRow,null,{excludeCollapsedRecords:!1}),e.multiSelect=Boolean(n.scheduler.assignmentStore),n.resourceFieldConfig&&(s=n.resourceFieldConfig)}return!("nameField"===e.ref&&!n.showNameField)&&(!("deleteButton"===e.ref&&!n.showDeleteButton)&&("startDate"!==e.name&&"endDate"!==e.name||"date"!==e.type||(s.format=n.dateFormat),"startDate"!==e.name&&"endDate"!==e.name||"time"!==e.type||(s.format=n.timeFormat),n.startDateConfig&&"startDate"===e.name&&"date"===e.type&&(s=n.startDateConfig),n.startTimeConfig&&"startDate"===e.name&&"time"===e.type&&(s=n.startTimeConfig),n.endDateConfig&&"endDate"===e.name&&"date"===e.type&&(s=n.endDateConfig),n.endTimeConfig&&"endDate"===e.name&&"time"===e.type&&(s=n.endTimeConfig),Object.assign(e,s),super.processWidgetConfig(e)))}show(...e){this.resourceStore&&this.resourceStore.fillFromMaster(),super.show(...e)}beforeShow(...e){const t=this.widgetMap.deleteButton;t&&(t.hidden=this.readOnly||!this.record.stores.length),super.beforeShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}set readOnly(e){const{deleteButton:t,saveButton:r,cancelButton:n}=this.widgetMap;this._readOnly=e,this.element.classList[e?"add":"remove"]("b-readonly"),this.eachWidget(t=>{"_originalReadOnly"in t||(t._originalReadOnly=t._readOnly||!1),t.readOnly=e||t._originalReadOnly}),t&&(t.hidden=e),r&&(r.hidden=e),n&&(n.hidden=e)}get readOnly(){return this._readOnly}}Fd._$name="EventEditor";class Ad extends vn{static get $name(){return"RecurrenceConfirmationPopup"}static get defaultConfig(){return{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,centered:!0,scrollAction:"realign",constrainTo:window,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:[{color:"b-green",localeClass:this,text:"L{Object.Yes}",ref:"changeMultipleButton"},{color:"b-gray",localeClass:this,text:"L{update-only-this-btn-text}",ref:"changeSingleButton"},{color:"b-gray",text:"L{Object.Cancel}",localeClass:this,ref:"cancelButton"}]}}construct(...e){const t=this;super.construct(...e);const{changeMultipleButton:r,changeSingleButton:n,cancelButton:s}=t.widgetMap;r&&r.on("click",t.onChangeMultipleButtonClick,t),n&&n.on("click",t.onChangeSingleButtonClick,t),s&&s.on("click",t.onCancelButtonClick,t),t.on("toolclick",t.onToolClick,t)}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.close()}onChangeSingleButtonClick(){this.processSingleRecord(),this.close()}onCancelButtonClick(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.close()}onToolClick({tool:e}){"close"===e.handler&&this.cancelFn&&this.cancelFn.call(this.thisObj)}confirm(e={}){const t=this;return["actionType","eventRecord","title","html","changerFn","cancelFn","thisObj"].forEach(r=>{r in e&&(t[r]=e[r])}),t.updatePopupContent(),super.show(e)}updatePopupContent(){const e=this,{changeMultipleButton:t,changeSingleButton:r,cancelButton:n}=e.widgetMap,{eventRecord:s,actionType:i="update"}=e,o=s&&s.isRecurring;o?(t.text=e.L("L{Object.Yes}"),e.html=e.L(i+"-all-message")):(t.text=e.L(i+"-further-btn-text"),e.html=e.L(i+"-further-message")),r.text=e.L(i+"-only-this-btn-text"),n.text=e.L("L{Object.Cancel}"),o?r.hide():r.show(),e.width=e.L("L{width}"),e.title=e.L(i+"-title")}processMultipleRecords(){const{eventRecord:e,changerFn:t,thisObj:r}=this,{recurringEvent:n}=e,s=new Date(e.startDate-1);e.beginBatch(),t.call(r,e),e.recurringTimeSpanId=null,e.endBatch(),n&&(n.recurrence.endDate=s)}processSingleRecord(){const{eventRecord:e,changerFn:t,thisObj:r}=this,{recurringEvent:n,startDate:s}=e;e.beginBatch(),t.call(r),e.recurrence=null,e.endBatch(),n.addExceptionDate(s)}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}}Ad._$name="RecurrenceConfirmationPopup",U.register("recurrenceconfirmation",Ad);class Pd extends(fl(As)){static get $name(){return"RecurrenceFrequencyCombo"}static get defaultConfig(){return{editable:!1,displayField:"text",valueField:"value"}}buildLocalizedItems(){return[{value:"DAILY",text:this.L("L{Daily}")},{value:"WEEKLY",text:this.L("L{Weekly}")},{value:"MONTHLY",text:this.L("L{Monthly}")},{value:"YEARLY",text:this.L("L{Yearly}")}]}}Pd._$name="RecurrenceFrequencyCombo",U.register("recurrencefrequencycombo",Pd);class Ld extends Pd{static get $name(){return"RecurrenceCombo"}static get defaultConfig(){return{customValue:"custom",placeholder:"None",splitCls:"b-recurrencecombo-split",items:!0,highlightExternalChange:!1}}buildLocalizedItems(){return[{value:"none",text:this.L("L{None}")},...super.buildLocalizedItems(),{value:this.customValue,text:this.L("L{Custom}"),cls:this.splitCls}]}set value(e){e=e||"none",super.value=e}get value(){return super.value}set recurrence(e){const t=this;t.value=e?t.isCustomRecurrence(e)?t.customValue:e.frequency:null}isCustomRecurrence(e){const{interval:t,days:r,monthDays:n,months:s}=e;return Boolean(t>1||r&&r.length||n&&n.length||s&&s.length)}}Ld._$name="RecurrenceCombo",U.register("recurrencecombo",Ld);class Od extends(ae()){static get $name(){return"RecurrenceLegend"}static get allDaysValue(){return"SU,MO,TU,WE,TH,FR,SA"}static get workingDaysValue(){return"MO,TU,WE,TH,FR"}static get nonWorkingDaysValue(){return"SU,SA"}static getLegend(e,t){const r=this,{timeSpan:n,interval:s,days:i,monthDays:o,months:a,positions:l}=e,c=t||n.startDate,d={interval:s};let u;switch(e.frequency){case"DAILY":return 1===s?r.L("L{Daily}"):r.L("L{Every {0} days}",d);case"WEEKLY":return i&&i.length?d.days=r.getDaysLegend(i):c&&(d.days=je.getDayName(c.getDay())),r.L(1===s?"L{Weekly on {1}}":"L{Every {0} weeks on {1}}",d);case"MONTHLY":return i&&i.length&&l&&l.length?d.days=r.getDaysLegend(i,l):o&&o.length?(o.sort((e,t)=>e-t),d.days=r.arrayToText(o)):c&&(d.days=c.getDate()),r.L(1===s?"L{Monthly on {1}}":"L{Every {0} months on {1}}",d);case"YEARLY":return i&&i.length&&l&&l.length?d.days=r.getDaysLegend(i,l):d.days=c.getDate(),a&&a.length?(a.sort((e,t)=>e-t),u=a.length>2?e=>je.getMonthShortName(e-1):e=>je.getMonthName(e-1),d.months=r.arrayToText(a,u)):d.months=je.getMonthName(c.getMonth()),r.L(1===s?"L{Yearly on {1} of {2}}":"L{Every {0} years on {1} of {2}}",d)}}static getDaysLegend(e,t){const r=this,n={position:""};let s;if(t&&t.length&&(n.position=r.arrayToText(t,e=>r.L(`L{position${e}}`))),e.length)switch(e.sort((e,t)=>Ac.decodeDay(e)[0]-Ac.decodeDay(t)[0]),e.join(",")){case r.allDaysValue:n.days=r.L("L{day}");break;case r.workingDaysValue:n.days=r.L("L{weekday}");break;case r.nonWorkingDaysValue:n.days=r.L("L{weekend day}");break;default:s=e.length>2?e=>je.getDayShortName(Ac.decodeDay(e)[0]):e=>je.getDayName(Ac.decodeDay(e)[0]),n.days=r.arrayToText(e,s)}return r.L("L{daysFormat}",n)}static arrayToText(e,t){return t&&(e=e.map(t)),e.join(", ").replace(/,(?=[^,]*$)/,this.L("L{ and }"))}}Od._$name="RecurrenceLegend";class _d extends An{static get $name(){return"RecurrenceLegendButton"}static get defaultConfig(){return{localizableProperties:[],recurrence:null}}set recurrence(e){this._recurrence=e,this.updateLegend()}get recurrence(){return this._recurrence}set eventStartDate(e){this._eventStartDate=e,this.updateLegend()}get eventStartDate(){return this._eventStartDate}updateLegend(){const{recurrence:e}=this;this.text=e?Od.getLegend(e,this.eventStartDate):""}onLocaleChange(){this.updateLegend()}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}}_d._$name="RecurrenceLegendButton",U.register("recurrencelegendbutton",_d);class $d extends(fl(As)){static get $name(){return"RecurrenceDaysCombo"}static get defaultConfig(){return{allDaysValue:"SU,MO,TU,WE,TH,FR,SA",editable:!1,defaultValue:"SU,MO,TU,WE,TH,FR,SA",workingDaysValue:"MO,TU,WE,TH,FR",nonWorkingDaysValue:"SU,SA",splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildLocalizedItems(){const e=this;return e._weekDays=null,e.weekDays.concat([{value:e.allDaysValue,text:e.L("L{day}"),cls:e.splitCls},{value:e.workingDaysValue,text:e.L("L{weekday}")},{value:e.nonWorkingDaysValue,text:e.L("L{weekend day}")}])}get weekDays(){const e=this;if(!e._weekDays){const t=je.weekStartDay,r=je.getDayNames().map((e,t)=>({text:e,value:Ac.encodeDay(t)}));e._weekDays=r.slice(t).concat(r.slice(0,t))}return e._weekDays}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),e&&t.store.findRecord("value",e)||(e=t.defaultValue),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}}$d._$name="RecurrenceDaysCombo",U.register("recurrencedayscombo",$d);class jd extends Pn{static get $name(){return"RecurrenceDaysButtonGroup"}static get defaultConfig(){return{defaults:{cls:"b-raised",toggleable:!0}}}construct(e={}){e.columns=7,e.items=this.buildItems(),super.construct(e)}updateItemText(e){const t=Ac.decodeDay(e.value)[0];e.text=je.getDayName(t).substring(0,3)}buildItems(){const e=this;if(!e.__items){const t=je.weekStartDay,r=je.getDayNames().map((e,t)=>({text:e.substring(0,3),value:Ac.encodeDay(t)}));e.__items=r.slice(t).concat(r.slice(0,t))}return e.__items}set value(e){e&&Array.isArray(e)&&(e=e.join(",")),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}jd._$name="RecurrenceDaysButtonGroup",U.register("recurrencedaysbuttongroup",jd);class Hd extends Pn{static get $name(){return"RecurrenceMonthDaysButtonGroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}get minValue(){return 1}get maxValue(){return 31}construct(e={}){e.columns=7,e.items=this.buildItems(),super.construct(e)}buildItems(){const e=this,t=[];for(let r=e.minValue;r<=e.maxValue;r++)t.push({text:r+"",value:r});return t}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}Hd._$name="RecurrenceMonthDaysButtonGroup",U.register("recurrencemonthdaysbuttongroup",Hd);class Nd extends Pn{static get $name(){return"RecurrenceMonthsButtonGroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}construct(e={}){e.columns=4,e.items=this.buildItems(),super.construct(e)}buildItems(){return je.getMonthNames().map((e,t)=>({text:e.substring(0,3),value:t+1}))}updateItemText(e){e.text=je.getMonthName(e.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}Nd._$name="RecurrenceMonthsButtonGroup",U.register("recurrencemonthsbuttongroup",Nd);class Bd extends(fl(As)){static get $name(){return"RecurrenceStopConditionCombo"}static get defaultConfig(){return{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}}buildLocalizedItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(e){e=e||"never",super.value=e}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(e){let t=null;e.endDate?t="date":e.count&&(t="count"),this._recurrence=e,this.value=t}}Bd._$name="RecurrenceStopConditionCombo",U.register("recurrencestopconditioncombo",Bd);class zd extends(fl(As)){static get $name(){return"RecurrencePositionsCombo"}static get defaultConfig(){return{editable:!1,splitCls:"b-sch-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildLocalizedItems(){return this.buildDayNumbers().concat([{value:"-1",text:this.L("L{position-1}"),cls:this.splitCls}])}buildDayNumbers(){const e=this;return z.populate(e.maxPosition,t=>({value:t,text:e.L("position"+t)}))}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),e&&t.store.findRecord("value",e)||(e=t.defaultValue),super.value=e}get value(){const e=super.value;return e?(""+e).split(",").map(e=>parseInt(e,10)):[]}}zd._$name="RecurrencePositionsCombo",U.register("recurrencepositionscombo",zd);class Vd extends vn{static get $name(){return"RecurrenceEditor"}static get defaultConfig(){return{draggable:!0,closable:!0,floating:!0,cls:"b-recurrenceeditor",title:"L{Repeat event}",autoClose:!0,width:400,items:{frequencyField:!0,daysButtonField:!0,monthDaysRadioField:!0,monthDaysButtonField:!0,monthsButtonField:!0,positionAndDayRadioField:!0,stopRecurrenceField:!0,countField:!0,endDateField:!0,intervalField:!0,positionsCombo:!0,daysCombo:!0},namedItems:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",localeClass:this,label:"L{Frequency}",weight:10,onChange:"up.onFrequencyFieldChange"},intervalField:{type:"numberfield",weight:15,name:"interval",localeClass:this,label:"L{Every}",labels:[{align:"end",reference:"intervalUnit",style:{width:"50em"}}],min:1,allowBlank:!1},daysButtonField:{type:"recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY"},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",forFrequency:"MONTHLY",localeClass:this,label:"L{Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:50,name:"months",forFrequency:"YEARLY"},positionAndDayRadioField:{type:"checkbox",weight:60,toggleGroup:"radio",forFrequency:"MONTHLY|YEARLY",localeClass:this,label:"L{On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY"},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",flex:1},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,localeClass:this,label:"L{End repeat}",onChange:"up.onStopRecurrenceFieldChange"},countField:{type:"numberfield",weight:110,name:"count",min:2,localeClass:this,allowBlank:!1,disabled:!0,label:" ",labels:[{align:"end",reference:"countUnit",label:"L{time(s)}"}]},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",allowBlank:!1}},bbar:[{type:"widget",cls:"b-label-filler"},{type:"button",color:"b-green",ref:"saveButton",text:"L{Save}",localeClass:this,onClick:"up.onSaveClick"},{type:"button",color:"b-gray",ref:"cancelButton",text:"L{Object.Cancel}",localeClass:this,onClick:"up.onCancelClick"}]}}get record(){return super.record}set record(e){super.record=e;const t=this,r=e.timeSpan,n=r&&r.startDate,{daysButtonField:s,monthDaysButtonField:i,monthsButtonField:o,monthDaysRadioField:a,positionAndDayRadioField:l,stopRecurrenceField:c}=t.widgetMap;n&&(e.days&&e.days.length||(s.value=[Ac.encodeDay(n.getDay())]),e.monthDays&&e.monthDays.length||(i.value=n.getDate()),e.months&&e.months.length||(o.value=n.getMonth()+1)),e.days&&e.positions?(l.check(),t.isPainted||a.uncheck()):(a.check(),t.isPainted||l.uncheck()),c.recurrence=e}onSaveClick(){const e=this;e.saveHandler?e.saveHandler.call(e.thisObj||e,e,e.record):(e.updateRecord(),e.close())}onCancelClick(){const e=this;e.cancelHandler?e.cancelHandler.call(e.thisObj||e,e,e.record):e.close()}updateRecord(e){const t=this.getValues(t=>t.name in e&&!t.disabled);e.set(t)}toggleStopFields(){const{countField:e,endDateField:t}=this.widgetMap;switch(this.widgetMap.stopRecurrenceField.value){case"count":e.show(),e.enable(),t.hide(),t.disable();break;case"date":e.hide(),e.disable(),t.show(),t.enable();break;default:e.hide(),t.hide(),e.disable(),t.disable()}}onMonthDaysRadioFieldChange({checked:e}){const{monthDaysButtonField:t}=this.widgetMap;t.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onPositionAndDayRadioFieldChange({checked:e}){const{daysCombo:t,positionsCombo:r}=this.widgetMap;t.disabled=r.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onStopRecurrenceFieldChange(){this.toggleStopFields()}isWidgetAvailableForFrequency(e,t=this.widgetMap.frequencyField.value){return!e.forFrequency||e.forFrequency.indexOf(t)>-1}onFrequencyFieldChange({value:e,valid:t}){const r=this,n=r.queryAll(e=>"forFrequency"in e);if(t&&e){for(let t=0;t<n.length;t++){const s=n[t];r.isWidgetAvailableForFrequency(s,e)?(s.show(),s.enable()):(s.hide(),s.disable())}r.widgetMap.intervalField.intervalUnit.innerHTML=r.L(e+"intervalUnit"),r.toggleFieldsState()}}toggleFieldsState(){const{widgetMap:e}=this;this.onMonthDaysRadioFieldChange({checked:e.monthDaysRadioField.checked}),this.onPositionAndDayRadioFieldChange({checked:e.positionAndDayRadioField.checked}),this.onStopRecurrenceFieldChange()}updateLocalization(){const{countField:e,intervalField:t,frequencyField:r}=this.widgetMap;e.countUnit.innerHTML=this.L("L{time(s)}"),t.intervalUnit.innerHTML=this.L(r.value+"intervalUnit"),super.updateLocalization()}}Vd._$name="RecurrenceEditor",U.register("recurrenceeditor",Vd);var Wd=e=>class extends(e||B){static get $name(){return"RecurringEventEdit"}static get defaultConfig(){return{recurringEventsItems:[{type:"recurrencecombo",label:"L{EventEdit.Repeat}",ref:"recurrenceCombo"},{type:"recurrencelegendbutton",ref:"editRecurrenceButton",name:"recurrenceRule",flex:"1"}],showRecurringUI:null}}insertExtraWidgetsIntoDefaultWidgets(e){this.processEditorConfig(e),super.insertExtraWidgetsIntoDefaultWidgets(e)}processEditorConfig(e){const{items:t}=e,r=t.findIndex(e=>"extraItems"===e.type);r<0?t.push(...this.recurringEventsItems):t.splice(r,0,...this.recurringEventsItems)}construct(e,t){super.construct(e,t),this.scheduler.on({beforeEventDelete:this.onRecurrableEventBeforeDelete,beforeEventSave:this.onRecurrableEventBeforeSave,thisObj:this})}doDestroy(){this._recurrenceConfirmation&&this.recurrenceConfirmation.destroy(),this._recurrenceEditor&&this.recurrenceEditor.destroy(),super.doDestroy()}get isRecurringEnabled(){return Boolean(this.scheduler.features.recurringEvents&&!this.scheduler.features.recurringEvents.disabled)}onEditorConstructed(e){const t=this;e.on("hide",t.onRecurringEventEditorHide,t),t.editRecurrenceButton&&t.editRecurrenceButton.on("click",t.onEditRecurrenceClick,t),t.recurrenceCombo.on("change",t.onRecurrenceComboChange.bind(t))}internalShowEditor(){this.toggleRecurringFieldsVisibility(this.isRecurringEnabled&&!1!==this.showRecurringUI)}toggleRecurringFieldsVisibility(e=!0){const t=e?"show":"hide";this.editRecurrenceButton&&this.editRecurrenceButton[t](),this.recurrenceCombo&&this.recurrenceCombo[t]()}onRecurringEventEditorHide({source:e}){const{recurrenceEditor:t,recurrenceConfirmation:r}=this;t&&t.isVisible&&t.hide(),r&&r.isVisible&&r.hide()}makeRecurrence(e){const t=this.eventRecord,r=t.copy();let n=t.recurrence;return n=!e&&n?n.copy():new t.recurrenceModel({rule:e}),n.timeSpan=r,r.setStartDate(this.values.startDate),n.suspendTimeSpanNotifying(),n}onRecurrableEventBeforeSave({eventRecord:e,context:t}){const r=this;if(e.supportsRecurring&&(e.isRecurring||e.isOccurrence))return r.recurrenceConfirmation.confirm({actionType:"update",eventRecord:e,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),t.async=!0,!1}showDisplayConfirmationOnEventDelete(e){return this.isEditing&&this.eventRecord===e&&e.supportsRecurring&&(e.isRecurring||e.isOccurrence)}onRecurrableEventBeforeDelete({eventRecords:e,context:t}){const[r]=e;if(this.showDisplayConfirmationOnEventDelete(r))return this.recurrenceConfirmation.confirm({actionType:"delete",eventRecord:r,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),!1}set recurrenceConfirmation(e){this._recurrenceConfirmation=e}get recurrenceConfirmation(){const e=this;let t=e._recurrenceConfirmation;return t&&t.$name||(t=J.createWidget(Object.assign({type:"recurrenceconfirmation",owner:e.getEditor()},t)),e._recurrenceConfirmation=t),t}set recurrenceEditor(e){this._recurrenceEditor=e}get recurrenceEditor(){const e=this;let t=e._recurrenceEditor;return t&&t.$name||(t=J.createWidget(Object.assign({type:"recurrenceeditor",autoShow:!1,owner:e.getEditor(),scrollAction:"realign",clippedBy:[e.scheduler.timeAxisSubGridElement,e.scheduler.bodyContainer],constrainTo:window,anchor:!0,saveHandler:e.recurrenceEditorSaveHandler,thisObj:e},t)),e._recurrenceEditor=t),t}showRecurrenceEditor(){const e=this,{recurrenceEditor:t,eventRecord:r}=e;t&&r&&r.supportsRecurring&&(e.recurrence||(e.recurrence=e.makeRecurrence()),e.recurrence.timeSpan.setStartDate(e.values.startDate),t.record=e.recurrence,t.showBy(e.recurrenceCombo.element))}onEditRecurrenceClick(){this.showRecurrenceEditor()}loadRecurrenceData(e){this.recurrence=e,this.updateRecurrenceFields(e)}updateRecurrenceFields(e){const t=this;t.recurrenceCombo&&(t.recurrenceCombo.recurrence=e),t.editRecurrenceButton&&(t.editRecurrenceButton.recurrence=e,t.editRecurrenceButton.value=e?e.rule:null,e&&t.isRecurringEnabled&&!1!==t.showRecurringUI?t.editRecurrenceButton.show():t.editRecurrenceButton.hide())}onRecurrenceComboChange({source:e,value:t,userAction:r}){const n=this;t==e.customValue?r&&n.showRecurrenceEditor():n.loadRecurrenceData(t?n.makeRecurrence("FREQ="+t):null)}recurrenceEditorSaveHandler(e,t){e.updateRecord(t),this.updateRecurrenceFields(t),e.close()}onDatesChange(...e){super.onDatesChange(...e);const t=this,{editRecurrenceButton:r}=t;if(!t.loadingRecord&&r){const{startDate:e}=t.values;e&&(r.eventStartDate=e)}}internalLoadRecord(e,t){this.recurrenceCombo&&e&&e.supportsRecurring&&this.loadRecurrenceData(e.recurrence?this.makeRecurrence():null)}};class Gd extends(Wd(Id)){static get $name(){return"EventEdit"}static get defaultConfig(){return{triggerEvent:"eventdblclick",showResourceField:!0,resourceFieldConfig:null,typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{title:"L{Edit Event}",localeClass:this,closable:!0,items:[{type:"text",localeClass:this,label:"L{Name}",clearable:!0,name:"name",ref:"nameField"},{type:"combo",localeClass:this,label:"L{Resource}",name:"resource",ref:"resourceField",editable:!0,valueField:"id",displayField:"name"},{type:"date",cls:"b-inline",clearable:!1,required:!0,localeClass:this,label:"L{Start}",name:"startDate",ref:"startDateField",flex:"1 0 60%"},{type:"time",clearable:!1,required:!0,name:"startDate",ref:"startTimeField",cls:"b-match-label",flex:"1 0 40%"},{type:"date",cls:"b-inline",clearable:!1,required:!0,localeClass:this,label:"L{End}",name:"endDate",ref:"endDateField",flex:"1 0 60%"},{type:"time",clearable:!1,required:!0,name:"endDate",ref:"endTimeField",cls:"b-match-label",flex:"1 0 40%"},{type:"extraItems"}],bbar:[{type:"widget",cls:"b-label-filler"},{color:"b-green",localeClass:this,text:"L{Save}",ref:"saveButton"},{color:"b-gray",localeClass:this,text:"L{Delete}",ref:"deleteButton"},{color:"b-gray",text:"L{Object.Cancel}",localeClass:this,ref:"cancelButton"}]}}}static get pluginConfig(){return{chain:["getEventMenuItems","onEventEnterKey"],assign:["editEvent"]}}construct(e,t){this.scheduler=e,this.eventStore=e.eventStore,this.resourceStore=e.resourceStore,super.construct(e,t)}get readOnly(){return this.editor?this.editor.readOnly:this._readOnly}set readOnly(e){this._readOnly=e,this.editor&&(this.editor.readOnly=e)}getEditor(){const e=this;let{editor:t}=e;return t||(t=e.editor=new Fd(e.getEditorConfig()),0===t.items.length&&console.warn("Event Editor configured without any `items`"),t.on({beforehide:e.resetEditingContext,keydown:e.onPopupKeyDown,thisObj:e}),Object.values(t.widgetMap).forEach(t=>{const r=t.ref||t.id;if(r&&!e[r])switch(e[r]=t,t.name){case"startDate":case"endDate":t.on("change",e.onDatesChange,e)}}),e.onEditorConstructed&&e.onEditorConstructed(t),e.eventTypeField&&e.eventTypeField.on("change",e.onEventTypeChange,e),e.saveButton&&e.saveButton.on("click",e.onSaveClick,e),e.deleteButton&&e.deleteButton.on("click",e.onDeleteClick,e),e.cancelButton&&e.cancelButton.on("click",e.onCancelClick,e),e.editor)}getEditorConfig(){const e=this,{autoClose:t,cls:r,readOnly:n}=e;return ze.assign({eventEditFeature:e,weekStartDay:e.weekStartDay,align:"b-t",id:e.scheduler.id+"-event-editor",autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[e.scheduler.timeAxisSubGridElement,e.scheduler.bodyContainer],constrainTo:window,autoClose:t,readOnly:n,cls:r},e.editorConfig)}internalShowEditor(e,t,r=null){const n=this,s=n.scheduler,i=r||Et.down(s.getElementFromEventRecord(e,t),s.eventInnerSelector);if(i||!e.isPartOfStore(s.eventStore)){if(!1===s.trigger("beforeEventEdit",{eventEdit:n,eventRecord:e,resourceRecord:t,eventElement:i}))return s.element.classList.remove("b-eventeditor-editing"),n.phantomEventElement&&n.phantomEventElement.remove(),void(n.phantomEventElement=null);n.resourceRecord=t;const o=n.getEditor(e);super.internalShowEditor&&super.internalShowEditor(e,t,r),n.typeField&&n.toggleEventType(e.get(n.typeField)),s.trigger("beforeEventEditShow",{eventEdit:n,eventRecord:e,resourceRecord:t,eventElement:i,editor:o}),n.isEditing=!0,n.loadRecord(e,t),i?(i.classList.add("b-editing"),o.showBy({target:i,anchor:!0})):o.showBy({target:s.element,anchor:!1,align:"c-c"});const a=s.timeAxisViewModel.timeResolution;"hour"!==a.unit&&"minute"!==a.unit||(n.startTimeField.step=n.endTimeField.step=`${a.increment}${a.unit}`)}}editEvent(e,t,r=null){const n=this,s=n.scheduler,i=s.eventStore.indexOf(e)<0;n.isEditing&&n.resetEditingContext(),s.readOnly||n.disabled||(s.element.classList.add("b-eventeditor-editing"),t||(e.resource?t=e.resource:e.resourceId&&(t=s.resourceStore.getById(e.resourceId))),i&&(this.phantomEventElement=r),r||i?n.internalShowEditor(e,t,r):s.scrollResourceEventIntoView(t,e,null,{animate:!0,edgeOffset:0,extendTimeAxis:!1}).then(()=>n.internalShowEditor(e,t),()=>s.element.classList.remove("b-eventeditor-editing")))}loadRecord(e,t){this.loadingRecord=!0,this.internalLoadRecord(e,t),this.loadingRecord=!1}internalLoadRecord(e,t){const r=this,{eventStore:n}=r.client;if(r.eventRecord=e,r.resourceRecord=t,r.editor.record=e,r.resourceField){const t=n.getResourcesForEvent(e);!n.storage.includes(e,!0)&&r.resourceRecord?r.resourceField.value=r.resourceRecord[r.resourceField.valueField]:r.scheduler.assignmentStore&&(r.resourceField.value=t.map(e=>e[r.resourceField.valueField]))}super.internalLoadRecord(e,t)}toggleEventType(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget(t=>t.dataset&&t.dataset.eventType&&(t.hidden=t.dataset.eventType!==e))}get values(){const e=super.values;return!this.scheduler.assignmentStore&&e.resource&&(e.resourceId=e.resource.id,delete e.resource),e}finalizeEventSave(e,t,r,n){const s=this,{scheduler:i,eventStore:o}=s;if(s.onBeforeSave(e),e.beginBatch(),s.updateRecord(e),e.endBatch(),o&&!e.stores.length){if(!1===i.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:t,resources:t}))return void r(!1);if(i.isInTimeAxis(e)){if(s.phantomEventElement){const r=i.generateTplData(e,t[0]);r&&(Et.syncClassList(s.phantomEventElement,r.wrapperCls),Et.createElement({tag:"div",parent:s.phantomEventElement,className:r.cls.toString()}),s.phantomEventElement.classList.add("b-sch-dragcreator-proxy"),s.phantomEventElement.id=r.id,s.phantomEventElement.dataset.syncId=e.id,i.isHorizontal&&i.currentOrientation.releaseTimeSpanDiv(s.phantomEventElement,!0),s.phantomEventElement=null,e.instanceMeta(i).fromDragProxy=!0)}}else s.phantomEventElement.remove();if(s.eventStore.add(e),s.eventStore.assignEventToResource(e,t),!s.eventStore.includes(e)){const e=i.element.querySelector(".b-sch-dragcreator-proxy");e&&(i.currentOrientation.availableDivs.remove(e),e.remove())}}else i.assignmentStore&&s.eventStore.assignEventToResource(e,t,!0);i.trigger("afterEventSave",{eventRecord:e}),s.onAfterSave(e),r(e)}save(){return new Promise((e,t)=>{const r=this,{scheduler:n,eventRecord:s}=r;if(!s||!r.isValid)return void e(!1);const{eventStore:i,values:o}=r,a=r.resourceField&&r.resourceField.records||[r.resourceRecord],l=a[0];if(!r.scheduler.allowOverlap&&i){if(a.some(e=>!i.isDateRangeAvailable(o.startDate,o.endDate,s,e)))return void e(!1)}const c={finalize(n){try{!1!==n?r.finalizeEventSave(s,a,e,t):e(!1)}catch(e){t(e)}}};!1!==n.trigger("beforeEventSave",{eventRecord:s,resourceRecords:a,resourceRecord:l,values:o,context:c})?c.finalize():c.async||e()})}deleteEvent(){return new Promise((e,t)=>{const{eventRecord:r,editor:n}=this;this.scheduler.removeRecords([r],t=>{t&&n.containsFocus&&n.revertFocus(),e(t)})})}get resourceStore(){return this._resourceStore}set resourceStore(e){this._resourceStore=e,this.resourceField&&(this.resourceField.store=e)}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:r}){this.editEvent(e,t,r)}onDragCreateEnd({newEventRecord:e,resourceRecord:t,proxyElement:r}){const n=this;if(!n.disabled){n.scheduler.onEventCreated(e);const s=r.cloneNode(!0);s.removeAttribute("id"),r.parentElement.appendChild(s),n.editEvent(e,t,s)}}onEventEnterKey({assignmentRecord:e,eventRecord:t}){e?this.editEvent(t,e.resource):t&&this.editEvent(t,t.resource)}onEventTypeChange({value:e}){this.toggleEventType(e)}getEventMenuItems({eventRecord:e,resourceRecord:t,items:r}){this.scheduler.readOnly||(r.editEvent={text:"L{Edit Event}",localeClass:this,icon:"b-icon b-icon-edit",weight:-200,onItem:()=>{this.editEvent(e,t)}})}}Gd._$name="EventEdit",Va.registerFeature(Gd,!0,"Scheduler");class Ud extends Nn{static get $name(){return"EventFilter"}static get pluginConfig(){return{chain:["getHeaderMenuItems"]}}construct(e,t){super.construct(e,t),this.scheduler=e}getHeaderMenuItems(e,t){const r=this;"timeAxis"===e.type&&t.push({text:"L{filterEvents}",localeClass:this,icon:"b-fw-icon b-icon-filter",disabled:r.disabled,menu:{type:"popup",items:[{type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:this,width:200,listeners:{change:r.onEventFilterChange,thisObj:r}}],onBeforeShow({source:e}){const[t]=e.items,n=r.scheduler.eventStore.filters.getBy("property","name");t.value=n&&n.value}}})}onEventFilterChange({value:e}){const t=this;""!==e?t.scheduler.eventStore.filter("name",e):t.scheduler.eventStore.removeFilter("name")}}Ud.featureClass="b-event-filter",Ud._$name="EventFilter",Va.registerFeature(Ud,!0,["Scheduler","Gantt"]);const Yd={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"};class qd extends Nn{static get defaultConfig(){return{showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>{},validatorFnThisObj:null,tip:null,tipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `}}static get pluginConfig(){return{chain:["render"]}}render(){const e=this;e.resize&&e.resize.destroy(),e.resize=e.createResizeHelper(),e.showTooltip&&(e.clockTemplate=new ud({scheduler:e.client}))}doDestroy(){const e=this;e.tip&&e.tip.destroy(),e.clockTemplate&&e.clockTemplate.destroy(),e.resize&&e.resize.destroy(),super.doDestroy()}isElementResizable(e,t){const{client:r,resize:n}=this,s=r.resolveTimeSpanRecord(e);if(r.readOnly)return!1;let i=s&&s.isResizable;const o=(e=Et.up(t.target,r.eventSelector))?e.firstElementChild:e,a=t.target.closest('[class$="-handle"]');if(!i||a&&a!==o)return!1;const l=e.classList.contains("b-sch-event-startsoutside"),c=e.classList.contains("b-sch-event-endsoutside");if(!0===i){if(l&&c)return!1;if(l)i="end";else{if(!c)return n.overStartHandle(t,e)||n.overEndHandle(t,e);i="start"}}return!(l&&"start"===i||c&&"end"===i)&&!!(n.overStartHandle(t,e)&&"start"===i||n.overEndHandle(t,e)&&"end"===i)}onBeforeResizeStart({element:e,event:t}){const{client:r}=this,n=r.scheduledEventName,s=r.resolveTimeSpanRecord(e);return!this.disabled&&!1!==r.trigger(`before${r.capitalizedEventName}Resize`,{[n+"Record"]:s,event:t})}onResizeStart({context:e,event:t}){const r=this,n=r.client,s=n.resolveTimeSpanRecord(e.element),i=n.scheduledEventName;n.element.classList.add("b-resizing-event"),r.setupProductResizeContext(e,t),r.showTooltip&&(r.tip?(r.tip.align=Yd[e.edge],r.tip.showBy(r.getTooltipTarget())):(r.tip=new Mn({id:n.id+"-event-resize-tip",autoShow:!0,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,getHtml:r.getTipHtml.bind(r),align:Yd[e.edge],hideDelay:0}),r.tip.on("innerhtmlupdate",r.updateDateIndicator,r))),s.instanceMeta(n).retainElement=!0,n.trigger(i+"ResizeStart",{[i+"Record"]:s,event:t})}updateDateIndicator(){const{edge:e,startDate:t,endDate:r}=this.resize.context,{element:n}=this.tip;(t||r)&&("right"===e||"bottom"===e?this.clockTemplate.updateDateIndicator(n.querySelector(".b-sch-tooltip-enddate"),r):this.clockTemplate.updateDateIndicator(n,t))}getTooltipTarget(){const e=this,t=Xt.from(e.resize.context.element,null,!0);return"horizontal"===e.resize.direction?("right"===e.resize.context.edge&&(t.x=t.right-1),t.width=e.tip.anchorSize[0]/2):("bottom"===e.resize.context.edge&&(t.y=t.bottom-1),t.height=e.tip.anchorSize[1]/2),{target:t}}onResizing({context:e,event:t}){const r=this,{client:n}=r,s=n.features.dependencies,i=r.getTimespanRecord(e),o=n.scheduledEventName,{element:a,edge:l}=e,c=Et.getTranslateXY(a);let d,u;if("top"===l||"left"===l?(u=i.endDate,n.snapRelativeToEventStartDate?(d=n.getDateFromXY(c,null,!0),d=n.timeAxis.roundDate(d,i.startDate)):d=n.getDateFromXY(c,"round",!0)):(c[0]+=a.offsetWidth,c[1]+=a.offsetHeight,d=i&&i.startDate,n.snapRelativeToEventStartDate?(u=n.getDateFromXY(c,null,!0),u=n.timeAxis.roundDate(u,i.endDate)):u=n.getDateFromXY(c,"round",!0)),d=d||e.startDate,u=u||e.endDate,e.dateConstraints&&(d=je.constrain(d,e.dateConstraints.start,e.dateConstraints.end),u=je.constrain(u,e.dateConstraints.start,e.dateConstraints.end)),r.showExactResizePosition||n.timeAxisViewModel.snap){const t="top"===l||"left"===l?n.timeAxisViewModel.getDistanceBetweenDates(d,i.endDate):n.timeAxisViewModel.getDistanceBetweenDates(i.startDate,u);switch(l){case"top":Et.setTranslateY(a,e.elementStartY+e.elementWidth-t),a.style.height=t+"px";break;case"right":a.style.width=t+"px";break;case"bottom":a.style.height=t+"px";break;case"left":Et.setTranslateX(a,e.elementStartX+e.elementWidth-t),a.style.width=t+"px"}}const h=e.endDate-u!=0||e.startDate-d!=0;e.endDate=u,e.startDate=d,h&&(e.valid=r.checkValidity(e,t)),n.trigger(o+"PartialResize",{[o+"Record"]:i,startDate:d,endDate:u,element:a,context:e}),s&&s.updateDependenciesForTimeSpan(i,a),r.showTooltip&&r.tip.alignTo(r.getTooltipTarget())}checkValidity(e,t){let r=e.startDate&&e.endDate>e.startDate&&this.validatorFn.call(this.validatorFnThisObj||this,e,t);return r&&"boolean"!=typeof r&&(e.message=r.message||"",r=r.valid),!1!==r}onFinishResize({source:e,context:t,event:r}){const n=this,s=n.getTimespanRecord(t),i=s.startDate,o=s.endDate,a=t.startDate||i,l=t.endDate||o,c=n.client;let d=!1;n.tip&&n.tip.hide(),s.instanceMeta(c).retainElement=!1;const u=t.finalize;t.finalize=(...e)=>{t.async&&n.finalize(...e),u.call(t,e)},t.valid=a&&l&&l-a>0&&(a-i!=0||l-o!=0)&&!1!==t.valid,t.valid&&(c.trigger(`before${c.scheduledEventName}ResizeFinalize`,{context:t,event:r}),d=!0),t.async||n.finalize(d)}onCancelResize({context:e}){const t=this.getTimespanRecord(e);t&&(t.instanceMeta(this.client).retainElement=!1),this.finalize(!1)}finalize(e){const t=this,{client:r}=t,n=t.resize.context,s=t.getTimespanRecord(n),i=r.scheduledEventName;let o=!1;if(t.tip&&t.tip.hide(),n.started&&(e&&(o=t.internalUpdateRecord(n,s)),!e||!o)){const e=r.features.dependencies;t.resize.abortResize(null,!0),e&&e.scheduleDraw(!0)}r.element.classList.remove("b-resizing-event"),r.trigger(i+"ResizeEnd",{changed:o,[i+"Record"]:s||r.resolveEventRecord(n.element)})}getTipHtml({tip:e}){const t=this;let{startDate:r,endDate:n,valid:s,message:i}=t.resize.context;if(!r||!n)return e.html;void 0===i&&(i=""),n=t.client.getDisplayEndDate(n,r);const o=t.client.getFormattedDate(r),a=t.client.getFormattedDate(n);return t.tipTemplate({valid:s,startDate:r,endDate:n,startText:o,endText:a,message:i,startClockHtml:t.clockTemplate.template({date:r,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:t.clockTemplate.template({date:n,text:a,cls:"b-sch-tooltip-enddate"})})}getRowRecord(e){throw new Error("Implement in subclass")}getTimespanRecord(e){throw new Error("Implement in subclass")}setupProductResizeContext(e,t){throw new Error("Implement in subclass")}get store(){throw new Error("Implement in subclass")}}qd._$name="ResizeBase";class Xd extends qd{static get $name(){return"EventResize"}createResizeHelper(){const e=this,t=e.client;return new No({direction:t.isVertical?"vertical":"horizontal",name:e.constructor.$name,isElementResizable:(t,r)=>e.isElementResizable(t,r),targetSelector:t.eventSelector,handleContainerSelector:t.eventInnerSelector,resizingCls:"b-sch-event-wrap-resizing",allowResize:e.isElementResizable.bind(e),outerElement:t.timeAxisSubGridElement,scrollManager:t.scrollManager,dragThreshold:0,dynamicHandleSize:!0,reservedSpace:5,scroller:t.timeAxisSubGrid.scrollable,listeners:{beforeresizestart:e.onBeforeResizeStart,resizestart:e.onResizeStart,resizing:e.onResizing,resize:e.onFinishResize,cancel:e.onCancelResize,thisObj:e}})}get store(){return this.client.eventStore}getTimespanRecord(e){return e.eventRecord}getRowRecord(e){return e.resourceRecord}setupProductResizeContext(e,t){const r=this.client,n=r.resolveEventRecord(e.element),s=r.resolveResourceRecord(e.element);Object.assign(e,{eventRecord:n,resourceRecord:s,dateConstraints:r.getDateConstraints(s,n)})}onResizeStart({context:e,event:t}){super.onResizeStart({context:e,event:t}),this.client.features.dependencies&&this.client.features.dependencies.hideTerminals(e.element),e.element.querySelector(".b-sch-event").classList.add("b-sch-event-resizing")}checkValidity(e,t){return(this.client.allowOverlap||this.client.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&super.checkValidity(e,t)}onFinishResize({source:e,context:t,event:r}){super.onFinishResize({source:e,context:t,event:r}),this.client.features.dependencies&&this.client.features.dependencies.showTerminals(t.eventRecord,t.element)}internalUpdateRecord(e,t){const{store:r}=this,{generation:n}=t;return"left"===e.edge||"top"===e.edge?t.setStartDate(e.startDate,!1,r.skipWeekendsDuringDragDrop):t.setEndDate(e.endDate,!1,r.skipWeekendsDuringDragDrop),t.generation!==n||(this.client.repaintEventsForResource(e.resourceRecord),!1)}finalize(e){this.resize.context.element.querySelector(".b-sch-event").classList.remove("b-sch-event-resizing"),super.finalize(e)}}Xd._$name="EventResize",Va.registerFeature(Xd,!0,"Scheduler");class Kd extends Nn{static get defaultConfig(){return{autoUpdate:!1,template:null,cls:null,align:{align:"b-t"},clockTemplate:null}}static get pluginConfig(){return{chain:["render"]}}construct(e,t){const r=this;t=r.processConfig(t),super.construct(e,t),r.forSelector||(r.forSelector=e.eventInnerSelector+":not(.b-dragproxy)"),r.clockTemplate=new ud({scheduler:e}),e.on({[`before${e.scheduledEventName}drag`]:()=>{r.tooltip&&r.tooltip.hide()}})}processConfig(e){return"function"==typeof e?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.clockTemplate&&this.clockTemplate.destroy(),this.tooltip&&this.tooltip.destroy(),super.doDestroy()}doDisable(e){this.tooltip&&(this.tooltip.disabled=e),super.doDisable(e)}render(){const e=this,t=e.client,r=[".b-dragselecting",".b-eventeditor-editing",".b-resizing-event",".b-dragcreating",".b-dragging-"+t.scheduledEventName,".b-creating-dependency",".b-dragproxy"].map(e=>`:not(${e})`).join("");e.tooltip&&e.tooltip.destroy(),e.tooltip=new Mn(Object.assign({axisLock:"flexible",id:e.tipId||e.client.id+"-event-tip",cls:e.tipCls,forSelector:`.b-timelinebase${r} .b-grid-body-container:not(.b-scrolling) ${e.forSelector}`,scrollAction:"realign",clippedBy:[t.timeAxisSubGridElement,t.bodyContainer],forElement:t.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:100,anchorToTarget:!0,allowOver:Boolean(e.config.items||e.config.tools),getHtml:e.getTipHtml.bind(e),disabled:e.disabled},e.config)),e.tooltip.on("innerhtmlupdate",e.updateDateIndicator,e)}updateDateIndicator(){const e=this.client,t=this.tooltip,r=t.activeTarget&&e.resolveTimeSpanRecord(t.activeTarget),n=t.element.querySelector(".b-sch-tooltip-enddate");r&&(this.clockTemplate.updateDateIndicator(t.element,r.startDate),n&&this.clockTemplate.updateDateIndicator(n,r.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,activeTarget:t}){const r=this,n=r.client,s=r.recordType||n.scheduledEventName+"Record",i=r.resolveTimeSpanRecord(t);if(i){const{startDate:t,endDate:o}=i,a=n.getFormattedDate(t),l=n.getDisplayEndDate(o,t),c=n.getFormattedDate(l);return e.eventRecord=i,e.title=i.name,r.template({tip:e,[""+s]:i,startDate:t,endDate:o,startText:a,endText:c,startClockHtml:r.clockTemplate.template({date:t,text:a,cls:"b-sch-tooltip-startdate"}),endClockHtml:i.isMilestone?"":r.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})})}return e.hide(),""}}Kd._$name="TooltipBase";class Zd extends Kd{static get $name(){return"EventTooltip"}static get defaultConfig(){return{template:e=>`\n                ${e.eventRecord.name?`<div class="b-sch-event-title">${e.eventRecord.name}</div>`:""}\n                ${e.startClockHtml}\n                ${e.endClockHtml}`,cls:"b-sch-event-tooltip"}}construct(e,t){const r=this;super.construct(e,t),"string"==typeof r.align&&(r.align={align:r.align})}render(){const e=this,t=e.client.features.dependencies;if(super.render(),t){const r=e.align.offset;e.tooltip.on("beforeshow",({source:e})=>{t.disabled?e.align.offset=r:e.align.offset=[0,10]})}}}Zd._$name="EventTooltip",Va.registerFeature(Zd,!0,"Scheduler");class Jd extends Nn{static get $name(){return"HeaderContextMenu"}static get defaultConfig(){return{extraItems:null,processItems:null}}static get pluginConfig(){return{chain:["getHeaderMenuItems"]}}construct(e,t){super.construct(e,t),this.scheduler=e}getHeaderMenuItems(e,t){const r=this,{scheduler:n,processItems:s}=r,{timeAxis:i}=n,o={magnitude:i.shiftIncrement,unit:i.shiftUnit};"timeAxis"===e.type&&(t.push({text:"L{pickZoomLevel}",localeClass:this,icon:"b-fw-icon b-icon-search-plus",disabled:!n.presets.count||r.disabled,menu:{type:"popup",items:[{type:"slider",showValue:!1,listeners:{input:r.onZoomSliderChange,thisObj:r},minWidth:130}],onBeforeShow({source:e}){const[t]=e.items;t.min=n.minZoomLevel,t.max=n.maxZoomLevel,t.value=n.zoomLevel}}}),r.startDateField=new Vs({label:r.L("L{startText}"),labelWidth:"6em",required:!0,step:o,listeners:{change:r.onRangeDateFieldChange,thisObj:r}}),r.endDateField=new Vs({label:r.L("L{endText}"),labelWidth:"6em",required:!0,step:o,listeners:{change:r.onRangeDateFieldChange,thisObj:r}}),t.push({text:"L{activeDateRange}",localeClass:this,icon:"b-fw-icon b-icon-calendar",disabled:r.disabled,menu:{type:"popup",width:"20em",items:[r.startDateField,r.endDateField,{type:"button",cls:"b-left-nav-btn",icon:"b-icon b-icon-prev",color:"b-blue b-raised",flex:1,margin:0,listeners:{click:r.onLeftShiftBtnClick,thisObj:r}},{type:"button",cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",localeClass:this,flex:4,margin:"0 8",listeners:{click:r.onTodayBtnClick,thisObj:r}},{type:"button",cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,listeners:{click:r.onRightShiftBtnClick,thisObj:r}}],onBeforeShow:()=>r.initDates()}}),r.extraItems&&t.push.apply(t,r.extraItems),s&&s({items:t}))}onZoomSliderChange({value:e}){const t=this.client.features.contextMenu.currentMenu;t.scrollAction="realign",this.scheduler.zoomLevel=e,t.setTimeout({fn:()=>t.scrollAction="hide",delay:100,cancelOutstanding:!0})}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.scheduler.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.scheduler.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const t=this,r=e===t.startDateField,{client:n}=t,{timeResolution:s}=n,{scrollable:i}=n.timeAxisSubGrid,o=t.startDateFieldInitialValue&&!r?t.startDateFieldInitialValue:t.startDateField.value,a=n.getDateFromX(i.x);let l=t.endDateFieldInitialValue&&r?t.endDateFieldInitialValue:t.endDateField.value;r?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,l-o?l<o&&(l=je.add(o,s.increment,s.unit)):l=je.add(l,s.increment,s.unit),t.scheduler.timeAxis.setTimeSpan(o,l),i.x=n.getCoordinateFromDate(a,!0),t.initDates()}onLeftShiftBtnClick(){this.scheduler.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=je.clearTime(new Date);this.scheduler.timeAxis.setTimeSpan(e,je.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.scheduler.timeAxis.shiftNext(),this.initDates()}}Jd.featureClass="",Jd._$name="HeaderContextMenu",Va.registerFeature(Jd,!0,["Scheduler","Gantt"]);class Qd extends Nn{static get $name(){return"HeaderZoom"}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove","onElementMouseUp"]}}onElementMouseDown(e){const t=this,r=t.client;if(!e.touches&&0===e.button&&!t.disabled&&e.target.matches(".b-sch-header-timeaxis-cell")){const n=r.subGrids.normal.header.headersElement;t.startX=e.clientX,t.element=Et.createElement({parent:n,tag:"div",className:"b-headerzoom-rect"}),t.headerElementRect=Xt.from(n)}}onElementMouseMove(e){const t=this;if(0!==e.buttons||P.isSafari||P.isIE11&&!e.isTrusted){if("number"==typeof t.startX){const r=Math.max(e.clientX,t.headerElementRect.left),n=Math.min(t.startX,r),s=Math.abs(t.startX-r),i=new Xt(n-t.headerElementRect.x+t.client.scrollLeft,0,s,t.headerElementRect.height);Et.setTranslateX(t.element,i.left),t.element.style.width=i.width+"px"}}else t.onElementMouseUp(e)}onElementMouseUp(e){const t=this;if("number"==typeof t.startX){const e=t.client,r=Xt.from(t.element),n=e.getDateFromCoordinate(r.left,"round",!1),s=e.getDateFromCoordinate(r.right,"round",!1);t.element&&t.element.remove(),t.startX=null,t.client.zoomToSpan({startDate:n,endDate:s})}}}Qd._$name="HeaderZoom",Va.registerFeature(Qd,!1,"Scheduler");class eu extends(br(Nn)){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",store:{modelClass:jc},enableResizing:!1,showTooltip:!0,showHeaderElements:!0,dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    <div class="b-sch-tip-name">${e.name||""}</div>\n                    ${e.startClockHtml}\n                    ${e.endClockHtml||""}\n                </div>\n            `,baseCls:"b-sch-timerange",cls:""}}static get pluginConfig(){return{chain:["onPaint","getHeaderMenuItems"]}}construct(e,t){const r=this;super.construct(e,t),r.cls=r.cls||"b-timerange-"+r.constructor.$name,r.baseSelector=`.${r.baseCls}.${r.cls}`,r.enableResizing&&(r.showHeaderElements=!0)}doDestroy(){const e=this;e.storeDetacher&&e.storeDetacher(),e.timeAxisViewModelDetacher&&e.timeAxisViewModelDetacher(),e.timeAxisDetacher&&e.timeAxisDetacher(),e.clockTemplate&&e.clockTemplate.destroy(),e.tip&&e.tip.destroy(),e.drag&&e.drag.destroy(),e.resize&&e.resize.destroy(),super.doDestroy()}doDisable(e){this.client.isPainted&&this.renderRanges(),super.doDisable(e)}onPaint(){const e=this;e.isPainted||(e.timeAxisViewModel=e.client.timeAxisViewModel,e.timeAxisViewModelDetacher=e.timeAxisViewModel.on({reconfigure:e.onTimeAxisViewModelUpdate,update:e.onTimeAxisViewModelUpdate,thisObj:e}),e.timeAxisDetacher=e.client.timeAxis.on({includeChange:e.onTimeAxisViewModelUpdate,thisObj:e}),e.enableResizing&&!e.client.hideHeaders&&(e.drag=new Fo({name:"rangeDrag",mode:e.client.isVertical?"translateY":"translateX",constrain:!0,outerElement:e.headerContainerElement,targetSelector:""+e.baseSelector,isElementDraggable:(t,r)=>!e.client.readOnly&&e.isElementDraggable(t,r),transitionDuration:e.client.transitionDuration,listeners:{dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,abort:e.onInvalidDrop,thisObj:e}}),e.resize=new No({direction:e.client.mode,targetSelector:e.baseSelector+".b-sch-range",outerElement:e.headerContainerElement,isElementResizable:e=>!e.closest(".b-dragging"),listeners:{resizestart:e.onResizeStart,resizing:e.onResizeDrag,resize:e.onResize,cancel:e.onInvalidResize,thisObj:e}})),e.renderRanges())}renderRanges(){const e=this,t=e.client.foregroundCanvas;if(t){const{headerContainerElement:r,store:n}=e;if(Et.removeEachSelector(t,e.baseSelector),r&&Et.removeEachSelector(r,e.baseSelector),!e.disabled)for(const t of n)e.renderRange(t,!0)}}renderRange(e,t){const r=this,n=r.client;if(e.duration&&n.timeAxis.timeSpanInAxis(e.startDate,e.endDate)||e.startDate&&n.timeAxis.dateInAxis(e.startDate)){const s=n.getCoordinateFromDate(je.max(e.startDate,n.timeAxis.startDate),{respectExclusion:!0}),i=e.duration&&n.getCoordinateFromDate(je.min(e.endDate,n.timeAxis.endDate),{respectExclusion:!0,isEnd:!0}),o=`<label>${e.name||"&nbsp;"}</label>`,a={className:`${r.baseCls} ${r.cls} ${i?r.rangeCls:r.lineCls} ${e.cls||""}`,dataset:{id:e.id},style:n.isVertical?`transform: translateY(${s}px); ${i?`height:${i-s}px`:""};`:`transform: translateX(${s}px); ${i?`width:${i-s}px`:""};`,retainElement:!0},l=Et.createElement(Object.assign({},a,{parent:t&&n.foregroundCanvas,style:a.style+(e.style||""),html:r.showHeaderElements?"":o}));let c;r.showHeaderElements&&(c=Et.createElement(Object.assign({parent:t&&r.headerContainerElement,html:e.name?o:""},a)));const d={bodyElement:l,headerElement:c};return t&&r.rotateLabel(d),d}}rotateLabel({bodyElement:e}){const t=e.firstChild;if(!t)return;t.classList.remove("b-vertical");const r=this.client.isVertical?t.offsetHeight<e.offsetHeight:t.offsetWidth>e.offsetWidth;t.classList[r?"add":"remove"]("b-vertical")}getElementsByRecord(e){const t="object"!=typeof e?e:e.id,r=this.client.foregroundCanvas.querySelector(`${this.baseSelector}[data-id="${t}"]`),n=this.headerContainerElement.querySelector(`${this.baseSelector}[data-id="${t}"]`);return r?{bodyElement:r,headerElement:n}:null}getBodyElementByRecord(e){const t="string"==typeof e?e:e.id;return this.client.foregroundCanvas.querySelector(`${this.baseSelector}[data-id="${t}"]`)}getRecordByElement(e){return this.store.getById(e.dataset.id)}get headerContainerElement(){const{isVertical:e,timeView:t,timeAxisColumn:r}=this.client;let n=null;return e&&t.element?n=t.element.parentElement:e||(n=r.element),n}get showHeaderElements(){return this._showHeaderElements}set showHeaderElements(e){this._showHeaderElements=e,this.client.isPainted&&(e?this.client.element.classList.add("b-sch-timeranges-with-headerelements"):this.client.element.classList.remove("b-sch-timeranges-with-headerelements"),this.renderRanges())}getHeaderMenuItems(e,t){return[]}get store(){return this._store}set store(e){const t=this;t._store=Cs.getStore(e,Cs);let r=!1;t.storeDetacher&&(t.storeDetacher(),r=!0),t.storeDetacher=t._store.on({change:t.onStoreChanged,refresh:t.onStoreChanged,thisObj:t}),r&&this.renderRanges()}onTimeAxisViewModelUpdate(){this.renderRanges()}onStoreChanged(e){const t=this;if(!(t.disabled||t.isConfiguring||"refresh"===e.type&&"batch"!==e.action))if("update"===e.action){const r=e.changes.hasOwnProperty("id")?e.changes.id.oldValue:e.record.id,n=t.getElementsByRecord(r),s=t.renderRange(e.record,!n);if(n&&!s&&(n.bodyElement.remove(),n.headerElement&&n.headerElement.remove()),!n||!s)return;t.client.runWithTransition(()=>{Et.sync(s.bodyElement,n.bodyElement),t.showHeaderElements&&Et.sync(s.headerElement,n.headerElement),t.rotateLabel(n)})}else t.renderRanges()}showTip(e){const t=this;t.showTooltip&&(t.clockTemplate=new ud({scheduler:t.client}),t.tip=new Mn({id:t.client.id+"-time-range-tip",cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:()=>t.getTipHtml(e.record,e.element)}))}isElementDraggable(e){return(e=e.closest(this.baseSelector+":not(.b-resizing)"))&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const t=this,r=t.getRecordByElement(e.element.closest(t.baseSelector)),n=t.getBodyElementByRecord(r),s=t.drag;Object.assign(e,{record:r,rangeBodyEl:n,originRangeX:Et.getTranslateX(n),originRangeY:Et.getTranslateY(n)}),t.client.isVertical?(s.minY=0,s.maxY=t.timeAxisViewModel.totalSize-e.rangeBodyEl.offsetHeight,s.minX=0,s.maxX=Number.MAX_SAFE_INTEGER):(s.minX=0,s.maxX=t.timeAxisViewModel.totalSize-e.rangeBodyEl.offsetWidth,s.minY=0,s.maxY=Number.MAX_SAFE_INTEGER),t.client.element.classList.add("b-dragging-timerange"),t.showTip(e)}onDrag({context:e}){this.client.isVertical?Et.setTranslateY(e.rangeBodyEl,Et.getTranslateY(e.element)):Et.setTranslateX(e.rangeBodyEl,Et.getTranslateX(e.element))}onDrop({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,r=e.record,n=e.rangeBodyEl.getBoundingClientRect(),s=t.client.getDateFromCoordinate(t.client.isVertical?n.top:n.left,"round",!1);r.startDate-s!=0?r.setStartDate(s):t.onInvalidDrop(),t.tip&&(t.tip.destroy(),t.tip=null),t.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){const e=this;e.drag.reset(),e.renderRanges(),e.client.element.classList.remove("b-dragging-timerange"),e.tip&&(e.tip.destroy(),e.tip=null)}onResizeStart({context:e}){const t=this.getRecordByElement(e.element.closest(this.baseSelector)),r=this.getBodyElementByRecord(t);Object.assign(e,{record:t,rangeBodyEl:r}),this.showTip(e)}onResizeDrag({context:e}){this.client.isVertical?("top"===e.edge&&Et.setTranslateY(e.rangeBodyEl,e.newY),e.rangeBodyEl.style.height=e.newHeight+"px"):("left"===e.edge&&Et.setTranslateX(e.rangeBodyEl,e.newX),e.rangeBodyEl.style.width=e.newWidth+"px")}onResize({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,{client:r}=t,n=e.record,s=e.element.getBoundingClientRect(),i=r.isVertical?s.top:s.left,o=r.isVertical?s.bottom:s.right,a=r.getDateFromCoordinate(i,"round",!1),l="left"===e.edge||"top"===e.edge,c=r.getDateFromCoordinate(o,"round",!1);(l&&n.startDate-a!=0||c&&n.endDate-c!=0)&&c>a?l?n.setStartDate(a,!1):n.setEndDate(c,!1):t.onInvalidResize(),t.tip&&(t.tip.destroy(),t.tip=null)}onInvalidResize(){const e=this;e.resize.reset(),e.renderRanges(),e.tip&&(e.tip.destroy(),e.tip=null)}getTipHtml(e,t){const{client:r}=this,n=t.getBoundingClientRect(),s=r.isVertical?n.top:n.left,i=r.isVertical?n.bottom:n.right,o=r.getDateFromCoordinate(s,"round",!1),a=e.endDate&&r.getDateFromCoordinate(i,"round",!1),l=r.getFormattedDate(o),c=a&&r.getFormattedEndDate(a,o);return this.dragTipTemplate({name:e.name||"",startDate:o,endDate:a,startText:l,endText:c,startClockHtml:this.clockTemplate.template({date:o,text:l,cls:"b-sch-tooltip-startdate"}),endClockHtml:c&&this.clockTemplate.template({date:a,text:c,cls:"b-sch-tooltip-enddate"})})}}eu._$name="AbstractTimeRanges";class tu extends eu{static get $name(){return"NonWorkingTime"}static get defaultConfig(){return{highlightWeekends:!0,showHeaderElements:!0,cls:"b-sch-nonworkingtime"}}construct(e,t){const r=this;super.construct(e,t),r.calendar&&e.calendar||(r.calendar=new ed),r.bindCalendar(r.calendar)}doDestroy(){this.bindCalendar(null),super.doDestroy()}bindCalendar(e){const t=this;t.calendarDetacher&&t.calendarDetacher(),e&&(t.calendarDetacher=e.on({change:t.renderRanges,thisObj:t,delay:1})),t.calendar=e,t.renderRanges()}renderRanges(){const e=this;if(e.store&&!e.store.isDestroyed){const t=je.as(e.client.timeAxis.unit,1,"week")>=1;e.store.removeAll(!0),e.calendar&&e.highlightWeekends&&t&&e.store.add(e.calendar.getHolidaysRanges(e.client.timeAxis.startDate,e.client.timeAxis.endDate,!0),!0)}super.renderRanges()}}tu._$name="NonWorkingTime",Va.registerFeature(tu,!1,"Scheduler");class ru extends Nn{static get $name(){return"Pan"}static get defaultConfig(){return{vertical:!0}}construct(e,t){if(this.timeline=e,e.features.eventDragCreate&&!e.features.eventDragCreate.disabled)throw new Error("Cannot combine Pan and eventDragCreate features");this.targetSelector=[".b-grid-cell",".b-timeline-subgrid"].join(","),super.construct(e,t)}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove","onElementMouseUp"]}}onElementMouseDown(e){const t=this,r=t.timeline,n=Object.values(r.features).find(e=>e instanceof hd),s=r.readOnly||!n||n.disabled;e.touches||0!==e.button||t.disabled||(e.target.matches(t.targetSelector)||s&&e.target.closest(r.eventSelector))&&(t.mouseX=e.clientX,t.mouseY=e.clientY)}onElementMouseMove(e){const t=this;if(0!==e.buttons||P.isSafari||P.isIE11&&!e.isTrusted){if("number"==typeof t.mouseX){const r=t.timeline.subGrids.normal.scrollable,n=t.timeline.scrollable,s=e.clientX,i=e.clientY;e.preventDefault(),t.vertical&&n.scrollBy(0,t.mouseY-i),r.scrollBy(t.mouseX-s),t.mouseX=s,t.mouseY=i}}else t.onElementMouseUp()}onElementMouseUp(e){this.mouseX=this.mouseY=null}}ru._$name="Pan",Va.registerFeature(ru,!1,["Scheduler","Gantt"]);class nu extends jc{static get fields(){return["resourceId","timeRangeColor"]}static get relationConfig(){return[{relationName:"resource",fieldName:"resourceId",store:"resourceStore",collectionName:"timeRanges",nullFieldOnRemove:!0}]}get isResourceTimeRange(){return!0}get resources(){return[this.resource]}}nu._$name="ResourceTimeRangeModel";class su extends Ds{static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:nu,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}}su._$name="ResourceTimeRangeStore";class iu extends Nn{static get $name(){return"ResourceTimeRanges"}static get defaultConfig(){return{idPrefix:"resourcetimerange",rangeCls:"b-sch-resourcetimerange",store:!1,resourceTimeRanges:null}}static get pluginConfig(){return{chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"]}}noFeatureElementsInAxis(){const{timeAxis:e}=this.scheduler;return!this.store.storage.values.some(t=>e.isTimeSpanInAxis(t))}construct(e,t){const r=this;r.scheduler=e,super.construct(e,t),Object.defineProperty(e,"resourceTimeRanges",{get:()=>r.store.records,set:e=>r.store.data=e})}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}set store(e){const t=this,{scheduler:r}=t;t._store=e=e||new su,r.resourceTimeRangeStore||(r.resourceTimeRangeStore=e),r.resourceTimeRanges&&(e.add(r.resourceTimeRanges),delete r.resourceTimeRanges),e.resourceStore||(e.resourceStore=r.resourceStore),t.storeDetacher&&t.storeDetacher(),t.storeDetacher=t.store.on({change:t.onStoreChange,thisObj:t})}get store(){return this._store}getEventsToRender(e,t){return e.timeRanges&&e.timeRanges.length&&!this.disabled&&t.push(...e.timeRanges),t}onEventDataGenerated(e){const t=this,r=e.event||e.eventRecord;r.isResourceTimeRange&&(t.scheduler.isVertical?e.width=t.scheduler.resourceColumnWidth:(e.top=0,e.id=`${t.scheduler.id}-${t.idPrefix}-${r.id}`),e.fillSize=!0,e.wrapperCls[t.rangeCls]=1,e.wrapperCls["b-sch-color-"+r.timeRangeColor]=r.timeRangeColor,e.body=document.createDocumentFragment(),e.body.textContent=r.name,e.eventId=`${t.idPrefix}-${r.id}`,e.eventContent=r.name)}onStoreChange(e){this.scheduler.onInternalEventStoreChange(e)}}iu.featureClass="",iu._$name="ResourceTimeRanges",Va.registerFeature(iu,!1,"Scheduler");class ou extends md{static get $name(){return"ScheduleContextMenu"}static get defaultConfig(){return{items:null,processItems:null,defaultItems:{addEvent:!0}}}construct(e,t){super.construct(e,t),this.scheduler=e}showEventContextMenu(e){const t=this.scheduler,r=t.getEventData(e),n=r?t.columns.getById(r.columnId)===t.timeAxisColumn:t.timeAxisSubGrid.element===e.target,s=t.resolveResourceRecord(e)||t.resourceStore.last;!n||s&&s.meta.specialRow||(this.showContextMenu({menuType:"schedule",date:t.getDateFromDomEvent(e,"floor"),resourceRecord:s,event:e}),e.preventDefault())}get namedItems(){const e=this.client;return this._namedItems||(this._namedItems={addEvent:{text:"L{Scheduler.Add event}",localeClass:this,icon:"b-icon b-icon-add",disabled:0===e.resourceStore.count,weight:100,onItem({date:t,resourceRecord:r}){e.internalAddEvent(t,r,e.getRowFor(r))}}}),this._namedItems}}ou.featureClass="",ou._$name="ScheduleContextMenu",Va.registerFeature(ou,!0,"Scheduler");var au=e=>class extends(e||B){static get defaultConfig(){return{showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["left","top","right","bottom"],allowCreate:!0}}construct(e,t){super.construct(e,t);const r=this;r.view=e,r.eventName=e.scheduledEventName,r.view.on("readOnly",()=>r.updateCreateListeners()),r.updateCreateListeners()}doDestroy(){const e=this;e.detachListeners("view"),e.creationData=null,e.mouseDetacher&&e.mouseDetacher(),e.creationTooltip&&e.creationTooltip.destroy(),super.doDestroy()}updateCreateListeners(){const e=this;e.view&&(e.detachListeners("view"),e.isCreateAllowed&&e.view.on({name:"view",[e.eventName+"mouseenter"]:"onTimeSpanMouseEnter",[e.eventName+"mouseleave"]:"onTimeSpanMouseLeave",thisObj:e}))}set allowCreate(e){this._allowCreate=e,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.view.readOnly&&!this.disabled}onTimeSpanMouseEnter(e){const t=e[this.eventName+"Record"],r=e[this.eventName+"Element"];this.showTerminals(t,Et.down(r,e.source.eventInnerSelector))}onTimeSpanMouseLeave(e){const t=this,r=e[t.eventName+"Element"];t.creationData&&Et.isDescendant(r,t.creationData.sourceTerminal.parentElement)||t.hideTerminals(r)}onTerminalMouseOut(e){const t=this,r=Et.up(e.target,t.view.eventSelector);!r||Et.isDescendant(r,t.showingTerminalsFor)||t.creationData&&r===t.creationData.sourceTerminal.parentElement||(t.hideTerminals(r),t.view.unhover(e))}onTerminalMouseDown(e){const t=this;if(0===e.button&&!t.creationData){const r=t.view,n=r.timeAxisSubGridElement,s=e.target,i=s.parentElement.closest(r.eventSelector),o=Xt.from(r.element,document.body);e.preventDefault(),e.stopPropagation(),t.creationData={source:r.resolveTimeSpanRecord(i),sourceTerminal:s,startPoint:Xt.from(s,n).center,startX:e.pageX-o.x+r.scrollLeft,startY:e.pageY-o.y+r.scrollTop,valid:!1},r.resolveResourceRecord&&(t.creationData.sourceResource=r.resolveResourceRecord(i)),t.mouseDetacher=gr.on({mouseup:{element:document.body,handler:"onMouseUp"},mousemove:{element:n,handler:"onMouseMove"},thisObj:t})}}onMouseMove(e){const t=this,{view:r,creationData:n}=t,s=Xt.from(r.element,document.body),i=e.pageX-s.x+r.scrollLeft-n.startX,o=e.pageY-s.y+r.scrollTop-n.startY,a=Math.round(Math.sqrt(i*i+o*o))-3,l=Math.atan2(o,i);let{connector:c}=t;if(!c){if(!1===this.onRequestDragCreate())return;c=t.connector}c.style.width=a+"px",c.style.transform=`rotate(${l}rad)`,t.lastMouseMoveEvent=e}onRequestDragCreate(){const e=this,{view:t,creationData:r}=e;if(!1===t.trigger("beforeDependencyCreateDrag",{data:r}))return e.abort(),!1;t.element.classList.add("b-creating-dependency"),e.connector=e.createConnector(r.startPoint.x,r.startPoint.y),t.trigger("dependencyCreateDragStart",{data:r}),e.showCreationTooltip&&(e.creationTooltip=e.creationTooltip||e.createDragTooltip(),e.creationTooltip.disabled=!1,e.creationTooltip.show()),t.scrollManager.startMonitoring({element:t.timeAxisSubGridElement,callback:()=>e.lastMouseMoveEvent&&e.onMouseMove(e.lastMouseMoveEvent),thisObj:e})}onOverTargetTerminal(e){const t=this,{target:r}=e,{view:n,creationData:s}=t,{connector:i}=t;if(!ze.isPromise(s.valid))if(r!==s.sourceTerminal){if(r!==s.targetTerminal){s.targetTerminal=r,s.target=n.resolveTimeSpanRecord(r),n.resolveResourceRecord&&(s.targetResource=n.resolveResourceRecord(r));const e=s.sourceTerminal.dataset.side,o=s.targetTerminal.dataset.side,a=e=>{t.isDestroyed||(s.valid=e,r.classList.add(e?"b-valid":"b-invalid"),i.classList.add(e?"b-valid":"b-invalid"),n.trigger("dependencyValidationComplete",{data:s}))};let l;switch(!0){case"left"===e&&"left"===o:l=od.Type.StartToStart;break;case"left"===e&&"right"===o:l=od.Type.StartToEnd;break;case"right"===e&&"left"===o:l=od.Type.EndToStart;break;case"right"===e&&"right"===o:l=od.Type.EndToEnd}n.trigger("dependencyValidationStart",{data:s}),s.valid=t.dataApi.isValidDependencyToCreate({type:l,sourceEvent:s.source,targetEvent:s.target,dependencyStore:t.dependencyStore}),ze.isPromise(s.valid)?s.valid.then(a):a(s.valid)}}else i.classList.remove("b-valid"),i.classList.remove("b-invalid")}onMouseUp(e){const t=this,r=t.creationData,n=e.target;t.abort();const s=async()=>{r.targetTerminal=e.target;const n=t.createDependency(r);ze.isPromise(n)&&await n,t.view.trigger("dependencyCreateDrop",{data:r})},i=e=>{t.view.trigger("afterDependencyCreateDrop",{data:e})};r.valid&&n.matches("."+t.terminalCls)?ze.isPromise(r.valid)?r.valid.then(e=>{r.valid=e,e?s().then(()=>i(r)):i(r)}):s().then(()=>i(r)):(r.valid=!1,i(r))}abort(){const e=this,{view:t,creationData:r}=e;if(r){const{source:n,sourceResource:s,target:i,targetResource:o}=r;if(n){const r=t.getElementFromEventRecord(n,s);r&&e.hideTerminals(r)}if(i){const r=t.getElementFromEventRecord(i,o);r&&e.hideTerminals(r)}}e.creationTooltip&&(e.creationTooltip.disabled=!0),e.creationData=e.lastMouseMoveEvent=null,e.mouseDetacher&&e.mouseDetacher(),e.removeConnector()}createConnector(e,t){const r=this.view;return this.connector=Et.createElement({parent:r.timeAxisSubGridElement,className:this.baseCls+"-connector",style:`left:${e}px;top:${t}px`}),r.element.classList.add("b-creating-dependency"),this.connector}createDragTooltip(){const e=this,t=e.view;return e.creationTooltip=new Mn(Object.assign({id:t.id+"-dependency-drag-tip",cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",autoShow:!0,anchorToTarget:!1,forSelector:".b-sch-terminal",forElement:t.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,getHtml:({tip:t,event:r})=>{if(e.creationData)return r&&e.onOverTargetTerminal(r),e.generateTooltipContent(t,e.creationData)},header:{dock:"right"},listeners:{pointerout:({source:t})=>{const r=e.creationData;return r.target=r.targetTerminal=null,r.valid=!1,t.html=t.getHtml({tip:t}),!1},beforeShow:({source:e})=>{e.html=e.getHtml({tip:e})}}},e.creationTooltip||{}))}removeConnector(e){const t=this,{connector:r,view:n}=t;r&&(r.classList.add("b-removing"),r.style.width="0",t.setTimeout(()=>{r.remove(),t.connector=null,e&&e.call(t)},200)),n.element.classList.remove("b-creating-dependency"),t.creationTooltip&&t.creationTooltip.hide(),n.scrollManager.stopMonitoring(n.timeAxisSubGridElement)}showTerminals(e,t){const r=this;if(!r.isCreateAllowed)return;const n=r.terminalCls,s=n+"s-visible";(t=Et.down(t,r.view.eventInnerSelector)).classList.contains(s)||this.view.element.classList.contains("b-resizing-event")||r.view.readOnly||(r.terminalSides.forEach(e=>{const s=Et.createElement({parent:t,className:`${n} ${n}-${e}`,dataset:{side:e,feature:!0}});s.detacher=gr.on({element:s,mouseout:"onTerminalMouseOut",mousedown:{handler:"onTerminalMouseDown",capture:!0},thisObj:r})}),t.classList.add(s),e.cls.add(s),r.showingTerminalsFor=t)}hideTerminals(e){const t=this,r=t.client.getTimeSpanMouseEventParams(e),n=null==r?void 0:r[this.eventName+"Record"],s=t.terminalCls+"s-visible";Et.forEachSelector(e,"."+t.terminalCls,e=>{e.detacher&&e.detacher(),e.remove()}),Et.down(e,t.view.eventInnerSelector).classList.remove(s),n.cls.remove(s),t.showingTerminalsFor=null}createDependency(e){const t=e.source,r=e.target,n=e.sourceTerminal.dataset.side,s=e.targetTerminal.dataset.side,i=("left"===n?0:2)+("right"===s?1:0);return this.dataApi.createDependency({sourceEvent:t,targetEvent:r,dependencyStore:this.dependencyStore,type:i,fromSide:n,toSide:s})}generateTooltipContent(e,t){const r=this,{valid:n}=t;let s,i;return Object.assign(t,{fromText:t.source.name,toText:t.target?t.target.name:"",fromSide:t.sourceTerminal.dataset.side,toSide:t.targetTerminal?t.targetTerminal.dataset.side:""}),ze.isPromise(n)?(e.element.classList.remove("b-invalid"),e.element.classList.add("b-checking"),s="checking",i=r.L("L{Dependencies.Checking}"),new Promise(s=>n.then(n=>{t.valid=n,e.isDestroyed||s(r.generateTooltipContent(e,t))}))):(!0===n?(e.element.classList.remove("b-invalid"),e.element.classList.remove("b-checking"),s="valid",i=r.L("L{Dependencies.valid}")):(e.element.classList.remove("b-checking"),e.element.classList.add("b-invalid"),s="invalid",i=r.L("L{Dependencies.invalid}")),e.titleElement.innerHTML=`<i class="b-icon b-icon-${s}"></i>${i}`,`<table class="b-sch-dependency-creation-tooltip">\n                        <tr><td>${r.L("L{Dependencies.from}")}: </td><td>${t.fromText}</td><td><div class="b-sch-box b-${t.fromSide}"></div></td></tr>\n                        <tr><td>${r.L("L{Dependencies.to}")}: </td><td>${t.toText}</td><td><div class="b-sch-box b-${t.toSide}"></div></td></tr>\n                    </table>`)}};class lu extends B{static get defaultConfig(){return{startSide:"right",startArrowSize:0,startArrowMargin:12,startShift:0,endSide:"left",endArrowSize:0,endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null}}findPath(e,t){let r,n,s,i,o,a,l,c,d,u,h,g,m,p,f,v,y,b,C,w,S,D,E,x,T,R,M,k,I,F,A,P=this;for(t&&!Array.isArray(t)&&(t=[t]),A=0;e&&!F;)for(r=Object.assign(P.config,e),n=r.startBox,s=r.endBox,i=r.startShift,o=r.endShift,a=r.startSide,l=r.endSide,c=r.startArrowSize,d=r.endArrowSize,u=r.startArrowMargin,h=r.endArrowMargin,g=r.horizontalMargin,m=r.verticalMargin,p=r.hasOwnProperty("startHorizontalMargin")?r.startHorizontalMargin:g,f=r.hasOwnProperty("startVerticalMargin")?r.startVerticalMargin:m,v=r.hasOwnProperty("endHorizontalMargin")?r.endHorizontalMargin:g,y=r.hasOwnProperty("endVerticalMargin")?r.endVerticalMargin:m,b=r.hasOwnProperty("otherHorizontalMargin")?r.otherHorizontalMargin:g,C=r.hasOwnProperty("otherVerticalMargin")?r.otherVerticalMargin:m,w=r.otherBoxes,a=P.normalizeSide(a),l=P.normalizeSide(l),S=P.getConnectionCoordinatesFromBoxSideShift(n,a,i),D=P.getConnectionCoordinatesFromBoxSideShift(s,l,o),M=P.calcGridBaseBoxFromBoxAndDrawParams(n,a,c,u,p,f),k=P.calcGridBaseBoxFromBoxAndDrawParams(s,l,d,h,v,y),w=w&&w.map(e=>P.calcGridBaseBoxFromBoxAndDrawParams(e,!1,0,0,b,C)),E=P.getConnectionCoordinatesFromBoxSideShift(M,a,i),x=P.getConnectionCoordinatesFromBoxSideShift(k,l,o),I=P.buildPathGrid(M,k,E,x,a,l,w),T=P.convertDecartPointToGridPoint(I,E),R=P.convertDecartPointToGridPoint(I,x),F=P.findPathOnGrid(I,T,R,a,l),e=!1;!F&&!e&&t&&A<t.length;A++)e=t[A](r);return F&&(F=P.prependPathWithArrowStaffSegment(F,S,c,a),F=P.appendPathWithArrowStaffSegment(F,D,d,l),F=P.optimizePath(F)),F}getConnectionCoordinatesFromBoxSideShift(e,t,r){let n;switch(t){case"left":n={x:e.start,y:(e.top+e.bottom)/2+r};break;case"right":n={x:e.end,y:(e.top+e.bottom)/2+r};break;case"top":n={x:(e.start+e.end)/2+r,y:e.top};break;case"bottom":n={x:(e.start+e.end)/2+r,y:e.bottom}}return n}calcGridBaseBoxFromBoxAndDrawParams(e,t,r,n,s,i){let o;switch(t){case"left":o={start:e.start-Math.max(r+n,s),end:e.end+s,top:e.top-i,bottom:e.bottom+i};break;case"right":o={start:e.start-s,end:e.end+Math.max(r+n,s),top:e.top-i,bottom:e.bottom+i};break;case"top":o={start:e.start-s,end:e.end+s,top:e.top-Math.max(r+n,i),bottom:e.bottom+i};break;case"bottom":o={start:e.start-s,end:e.end+s,top:e.top-i,bottom:e.bottom+Math.max(r+n,i)};break;default:o={start:e.start-s,end:e.end+s,top:e.top-i,bottom:e.bottom+i}}return o}buildPathGrid(e,t,r,n,s,i,o){let a,l,c,d,u,h,g,m,p,f,v,y,b,C={},w=[];for(a=[e.start,"left"===s||"right"===s?(e.start+e.end)/2:r.x,e.end,t.start,"left"===i||"right"===i?(t.start+t.end)/2:n.x,t.end],l=[e.top,"top"===s||"bottom"===s?(e.top+e.bottom)/2:r.y,e.bottom,t.top,"top"===i||"bottom"===i?(t.top+t.bottom)/2:n.y,t.bottom],o&&o.forEach(e=>{a.push(e.start,(e.start+e.end)/2,e.end),l.push(e.top,(e.top+e.bottom)/2,e.bottom)}),a=[...new Set(a.sort((e,t)=>e-t))],l=[...new Set(l.sort((e,t)=>e-t))],h=0,m=l.length;h<m;++h)for(C[h]=C[h]||{},c=l[h],u=0,g=a.length;u<g;++u){if(d=a[u],y=(d<=e.start||d>=e.end||c<=e.top||c>=e.bottom)&&(d<=t.start||d>=t.end||c<=t.top||c>=t.bottom),o)for(p=0,f=o.length;y&&p<f;++p)v=o[p],y=d<=v.start||d>=v.end||c<=v.top||c>=v.bottom||d===r.x&&c===r.y||d===n.x&&c===n.y;b={distance:Math.pow(2,53)-1,permitted:y,x:d,y:c,ix:u,iy:h},C[h][u]=b,w.push(b)}return{width:a.length,height:l.length,xs:a,ys:l,points:C,linearPoints:w}}convertDecartPointToGridPoint(e,t){let r=e.xs.indexOf(t.x),n=e.ys.indexOf(t.y);return e.points[n][r]}findPathOnGrid(e,t,r,n,s){let i=this,o=!1;return t.permitted&&r.permitted&&(e=i.waveForward(e,t,0),o=i.collectPath(e,r,s)),o}getGridPointNeighbors(e,t,r){let n,s=t.ix,i=t.iy,o=[];return i<e.height-1&&(n=e.points[i+1][s],(!r||r(n))&&o.push(n)),i>0&&(n=e.points[i-1][s],(!r||r(n))&&o.push(n)),s<e.width-1&&(n=e.points[i][s+1],(!r||r(n))&&o.push(n)),s>0&&(n=e.points[i][s-1],(!r||r(n))&&o.push(n)),o}waveForward(e,t,r){const n=this;return fs.preWalkUnordered([t,r],([t,r])=>n.getGridPointNeighbors(e,t,e=>e.permitted&&e.distance>r+1).map(e=>[e,r+1]),([e,t])=>e.distance=t),e}collectPath(e,t,r){let n,s,i,o,a=this,l=!0,c=[];for(;l&&t.distance;)if(n=a.getGridPointNeighbors(e,t,e=>e.permitted&&e.distance==t.distance-1),l=n.length>0,l){switch(n=n.sort((e,n)=>{let s,i;s=e.ix-t.ix,i=e.iy-t.iy;let o=("left"===r||"right"===r)&&0===i||("top"===r||"bottom"===r)&&0===s?-1:1;s=n.ix-t.ix,i=n.iy-t.iy;let a=("left"===r||"right"===r)&&0===i||("top"===r||"bottom"===r)&&0===s?-1:1;return o>a?1:o<a?-1:o===a?e.y>n.y?-1:1:void 0}),s=n[0],c.push({x1:s.x,y1:s.y,x2:t.x,y2:t.y}),i=s.ix-t.ix,o=s.iy-t.iy,!0){case!o&&i>0:r="left";break;case!o&&i<0:r="right";break;case!i&&o>0:r="top";break;case!i&&o<0:r="bottom"}t=s}return l&&c.reverse()||!1}prependPathWithArrowStaffSegment(e,t,r,n){let s,i;if(e.length>0){switch(i=e[0],s={x2:i.x1,y2:i.y1},n){case"left":s.x1=t.x-r,s.y1=i.y1;break;case"right":s.x1=t.x+r,s.y1=i.y1;break;case"top":s.x1=i.x1,s.y1=t.y-r;break;case"bottom":s.x1=i.x1,s.y1=t.y+r}e.unshift(s)}return e}appendPathWithArrowStaffSegment(e,t,r,n){let s,i;if(e.length>0){switch(i=e[e.length-1],s={x1:i.x2,y1:i.y2},n){case"left":s.x2=t.x-r,s.y2=i.y2;break;case"right":s.x2=t.x+r,s.y2=i.y2;break;case"top":s.x2=i.x2,s.y2=t.y-r;break;case"bottom":s.x2=i.x2,s.y2=t.y+r}e.push(s)}return e}optimizePath(e){let t,r,n=[];if(e.length>0)for(t=e.shift(),n.push(t);e.length>0;)r=e.shift(),t.x1==r.x1&&t.y1==r.y1&&t.x2==r.x2&&t.y2==r.y2?t=r:t.y1-t.y2==0&&r.y1-r.y2==0?t.x2=r.x2:t.x1-t.x2==0&&r.x1-r.x2==0?t.y2=r.y2:(n.push(r),t=r);return n}normalizeSide(e){return lu.sideToSide[e]||e}static get sideToSide(){return{l:"left",r:"right",t:"top",b:"bottom"}}}lu._$name="RectangularPathFinder";const cu=["left","left","right","right"],du=["left","right","left","right"];class uu extends(Qn(Nn).mixes(au,vd,br,Sd)){static get $name(){return"Dependencies"}static get defaultConfig(){return{pathFinderConfig:null,overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",store:null,dependencies:null,highlightDependenciesOnEventHover:!1,showTooltip:!0,tooltip:null,bufferSize:50,cacheGridSize:{x:500,index:25},drawnDependencies:[],drawnLines:[],dependenciesToRefresh:new Map,storeClass:ld}}static get pluginConfig(){return{chain:["render","renderContents","onElementClick","onElementDblClick","onElementMouseOver","onElementMouseOut"],assign:["getElementForDependency","getDependencyForElement"]}}construct(e,t={}){const r=this;if(e.isVertical)throw new Error("Dependencies feature is not supported in vertical mode");r.doScheduleDraw=r.createOnFrame("draw",[],r,!0),super.construct(e,t),r.pathFinder=new lu(r.pathFinderConfig),delete r.pathFinderConfig,r.lineDefAdjusters=r.createLineDefAdjusters()}doDestroy(){this.tooltip&&this.tooltip.destroy(),super.doDestroy()}doDisable(e){this.updateCreateListeners(),this.client.isPainted&&this.draw(),super.doDisable(e)}exposeSchedulerDependenciesProperty(){const e=this;e.dependenciesPropertyExposed&&delete e.client.dependencies,Object.defineProperty(e.client,"dependencies",{configurable:!0,get:()=>e.dependencyStore.records,set:t=>e.dependencyStore.data=t}),e.dependenciesPropertyExposed=!0}get rowStore(){return this.resourceStore}get scheduler(){return this.client}findDependencyIndex(e=[],t,r){return e.findIndex(e=>e.dependency===t&&(e.assignmentData===r||e.assignmentData&&r&&e.assignmentData.from===r.from&&e.assignmentData.to===r.to))}includesDependency(){return this.findDependencyIndex(...arguments)>=0}getResourceStoreListenersConfig(){return{refresh:this.onRowStoreRefresh}}obtainDependencyStore(e,t){let r=t&&t.store||super.obtainDependencyStore(e,t);return!0!==r&&r||(r=new this.storeClass),r}getDependencyStoreListenersConfig(){return{change:this.onDependencyChange}}onDependencyStoreChange(e,t){const r=this,n=r.client;r.resetGridCache(),r.resetBoundsCache(),n.dependencyStore=e,e&&(!r.dependenciesPropertyExposed&&n.dependencies&&(e.data=n.dependencies,delete n.dependencies),r.dependencies&&(e.data=r.dependencies,delete r.dependencies),e.metaMapId=n.id,e.eventStore=n.eventStore,r.exposeSchedulerDependenciesProperty())}getAssignmentStoreListenersConfig(){return{change:this.onAssignmentChange,refresh:this.onAssignmentRefresh}}getEventStoreListenersConfig(){return{change:this.onEventChange}}createMarkers(){const e=this,t=e.client.svgCanvas,r=e.endMarker=e.initMarkerElement("arrowEnd","8","M0,0 L0,6 L9,3 z");if(P.isEdge||P.isIE11){const r=e.startMarker=e.initMarkerElement("arrowStart","1","M0,3 L9,6 L9,0 z");t.appendChild(r)}else r.setAttribute("orient","auto-start-reverse");t.appendChild(r)}initMarkerElement(e,t,r){return Et.createElement({id:e,tag:"marker",ns:"http://www.w3.org/2000/svg",markerHeight:9,markerWidth:9,refX:t,refY:3,viewBox:"0 0 9 6",orient:"auto",markerUnits:"userSpaceOnUse",children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:r}]})}createLineDefAdjusters(){const e=this.client;return[function(t){let r=!1;return(t.startArrowMargin>e.barMargin||t.endArrowMargin>e.barMargin)&&(t.startArrowMargin=t.endArrowMargin=e.barMargin,r=!0),r?t:r},function(e){let t=!1;return(e.startArrowMargin>0||e.endArrowMargin>0)&&(e.startArrowMargin=e.endArrowMargin=0,t=!0),t?e:t}]}getElementForDependency(e,t=null){let r=`[depId="${e.id}"]`;return t&&(r+=`[fromId="${t.from.id}"][toId="${t.to.id}"]`),this.client.svgCanvas.querySelector(r)}getDependencyForElement(e){const t="string"==typeof e?e:e.getAttribute("depId");return this.dependencyStore.getById(t)}onToggleNode(){this.dependencyGridCache=null,this.scheduleDraw(!0)}onViewportResize(){this.scheduleDraw(!0)}onTranslateRow({row:e}){e.lastTop>=0&&e.top!==e.lastTop&&this.scheduleDraw(!0)}onChangeTotalHeight(){this.scheduleDraw(!0)}onHorizontalScroll({subGrid:e}){this.isDrawn&&e===this.client.timeAxisSubGrid&&this.scheduleDraw(!1)}onVerticalScroll(){this.isDrawn&&this.scheduleDraw(!1)}onRowsRefresh(){this.scheduleDraw(!0)}onRowsRerender(){this.scheduleDraw(!0)}onRowStoreRefresh({action:e}){switch(e){case"sort":case"filter":case"batch":this.dependencyGridCache=null,this.scheduleDraw(!0)}}onDependencyChange({action:e,record:t,records:r}){const n=this;if(n.client.isPainted&&!n.disabled){switch(e){case"dataset":n.dependencyGridCache={};case"add":const e=n._dependencyGridCache;return r.forEach(t=>{e&&n.addToGridCache(t)}),e||n._thisIsAUsedExpression(n.dependencyGridCache),void n.scheduleDraw();case"update":return n.scheduleRefreshDependency(t);case"remove":return r.forEach(e=>{n.releaseDependency(e,!0),n.removeFromCache(e)}),void n.client.trigger("dependenciesDrawn");case"removeall":case"filter":n.dependencyGridCache=null}n.scheduleDraw(!0)}}onEventChange({action:e,record:t}){switch(e){case"filter":this.scheduleDraw(!0);break;case"update":if(t.isEvent){const e=[t];t.resources.forEach(t=>e.push(...t.events)),new Set(e).forEach(e=>this.drawForTimeSpan(e,!0))}else this.drawForTimeSpan(t,!0);break;case"removeall":this.resetGridCache(),this.scheduleDraw(!0)}}onAssignmentRefresh({action:e}){"dataset"===e&&(this.resetGridCache(),this.scheduleDraw(!0))}onAssignmentChange({action:e,record:t,records:r}){const n=this;t&&(r=[t]),"add"!==e&&"remove"!==e&&"update"!==e||r.forEach(r=>{this.dataApi.getAssignmentDependencies({assignment:r,dependencyStore:this.dependencyStore}).forEach(s=>{if("add"===e)n.scheduleRefreshDependency(s);else if("remove"===e){let e;e=this.dataApi.isDependencySourceAssignment({dependency:s,assignment:r})?this.dataApi.getDependencyTargetAssignments({dependency:s,assignmentStore:this.assignmentStore}).map(e=>({from:r,to:e})):this.dataApi.getDependencySourceAssignments({dependency:s,assignmentStore:this.assignmentStore}).map(e=>({from:e,to:r})),e.forEach(e=>{n.releaseDependency(s,e),n.removeFromCache(s,e)})}else"update"===e&&this.dataApi.getDependencyAssignmentsAsFromToArray({dependency:s,assignmentStore:this.assignmentStore}).filter(e=>e.from===t||e.to===t).forEach(e=>{this.scheduleRefreshDependency(s,e)})})})}onElementClick(e){const t=this;if(e.target.matches("."+t.baseCls)){const r=ei.get(e.target).dependency,n="click"===e.type?"Click":"DblClick";t.client.trigger("dependency"+n,{dependency:r,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementMouseOver(e){const t=this;if(e.target.matches("."+t.baseCls)){const r=ei.get(e.target).dependency;t.client.trigger("dependencyMouseOver",{dependency:r,event:e}),t.overCls&&t.highlight(r,t.overCls)}}onElementMouseOut(e){const t=this;if(e.target.matches("."+t.baseCls)){const r=ei.get(e.target).dependency;t.client.trigger("dependencyMouseOut",{dependency:r,event:e}),t.overCls&&!r.meta.removed&&t.unhighlight(r)}}highlight(e,t=this.overCls){const r=this.getElementForDependency(e);r&&r.classList.add(t),e.highlight(t)}unhighlight(e,t=this.overCls){const r=this.getElementForDependency(e);r&&r.classList.remove(t),e.unhighlight(t)}highlightEventDependencies(e){e.allDependencies.forEach(e=>this.highlight(e))}unhighlightEventDependencies(e){e.allDependencies.forEach(e=>this.unhighlight(e))}isDependencyVisible(e,t=null){const{dataApi:r,resourceStore:n,eventStore:s}=this,i=r.getDependencySourceEvent({dependency:e}),o=r.getDependencyTargetEvent({dependency:e});if(!i||!o)return!1;let a,l;if(t){if(a=r.getAssignmentResource({assignment:t.from,resourceStore:n}),l=r.getAssignmentResource({assignment:t.to,resourceStore:n}),s.isFiltered&&(-1===s.indexOf(i)||-1===s.indexOf(o)))return!1}else a=r.getEventResource({event:i,resourceStore:n}),l=r.getEventResource({event:o,resourceStore:n});return i instanceof Jn&&a instanceof nd&&l instanceof nd&&!a.instanceMeta(n).hidden&&!l.instanceMeta(n).hidden}getBox(e,t,r=null){const n=this.getTimeSpanRecordFromDependency(e,t);let s;return s=r?this.dataApi.getAssignmentResource({assignment:r[t?"from":"to"],resourceStore:this.resourceStore}):this.dataApi.getEventResource({event:n,resourceStore:this.resoureStore}),this.client.getResourceEventBox(n,s,!0)}getRowRecordFromDependency(e,t,r){let n;return n=r?this.dataApi.getAssignmentResource({assignment:r[t?"from":"to"],resourceStore:this.resourceStore}):this.dataApi.getEventResource({event:this.getTimeSpanRecordFromDependency(e,t),resourceStore:this.resourceStore}),n}getTimeSpanRecordFromDependency(e,t=!0){return e[(t?"source":"target")+"Event"]}getMetaId(e=null){return e?`${this.client.id}-ass${e.from.id}-ass${e.to.id}`:this.client.id}getDependencyBounds(e,t=null){const r=this,n=r.client,s=e.getDateRange();if(!n.rowManager.rowCount||!r.isDependencyVisible(e,t))return null;if(!s||!je.intersectSpans(s.start,s.end,n.startDate,n.endDate))return null;const i=r.getMetaId(t),o=e.instanceMeta(i),a=r.getBox(e,!0,t),l=r.getBox(e,!1,t);if(!a||!l)return null;if(r._resetBoundsCache||!o.bounds||!o.bounds.layout){const t=r.getTimeSpanRecordFromDependency(e,!0),s=r.getTimeSpanRecordFromDependency(e,!1),i=a instanceof Xt?a:new Xt(a.start,a.top,a.end-a.start,a.bottom-a.top),c=l instanceof Xt?l:new Xt(l.start,l.top,l.end-l.start,l.bottom-l.top),d=Xt.union(i,c);n.isGantt||[[t,i,a],[s,c,l]].map(([e,t,r])=>{if("default"===n.milestoneLayoutMode&&e.isMilestone){!n.milestoneWidth&&r.eventEl&&e.iconCls&&(n.milestoneWidth=r.eventEl.firstElementChild.offsetWidth);const s=n.milestoneWidth||t.height;t.left-=s/2,t.right+=s/2}}),o.bounds={bounds:d,startRectangle:i,endRectangle:c,layout:a.layout&&l.layout}}return e.instanceMeta(i).bounds}get dependencyGridCache(){const e=this;return e._dependencyGridCache||(e._dependencyGridCache={},e.dependencyStore.forEach(t=>e.addToGridCache(t))),e._dependencyGridCache}getIteratableDependencyAssignments(e){return this.assignmentStore?this.dataApi.getDependencyAssignmentsAsFromToArray({dependency:e,assignmentStore:this.assignmentStore}):[null]}addToGridCache(e){const t=this,{dependencyGridCache:r,cacheGridSize:n,rowStore:s}=t;t.getIteratableDependencyAssignments(e).forEach(i=>{const o=t.getDependencyBounds(e,i);if(o){const a=t.getMetaId(i),l=e.instanceMeta(a).gridCache=[],c=s.indexOf(t.getRowRecordFromDependency(e,!0,i)),d=s.indexOf(t.getRowRecordFromDependency(e,!1,i)),u=Math.min(c,d),h=Math.max(c,d),g=o.bounds,m=Math.floor(Math.max(g.x,0)/n.x),p=Math.floor(g.right/n.x),f=Math.floor(u/n.index),v=Math.floor(h/n.index);let y,b,C,w;for(C=m;C<=p;C++)for(y=r[C]||(r[C]={}),w=f;w<=v;w++)b=y[w]||(y[w]=[]),b.find(t=>t.dependency.id===e.id&&t.assignmentData===i&&t.metaId===a)||b.push({dependency:e,assignmentData:i,metaId:a}),l.push([C,w])}})}removeFromCache(e,t=null){const r=this;let n;n=t?[t]:this.getIteratableDependencyAssignments(e),n.forEach(t=>{const n=r.getMetaId(t),s=e.instanceMeta(n);s.gridCache&&r._dependencyGridCache&&s.gridCache.forEach(([n,s])=>{if(r._dependencyGridCache.hasOwnProperty(n)&&r._dependencyGridCache[n].hasOwnProperty(s)){const i=r._dependencyGridCache[n][s],o=r.findDependencyIndex(i,e,t);o>-1&&i.splice(o,1)}}),s.bounds=null,s.gridCache=null})}set dependencyGridCache(e){this._dependencyGridCache=e}resetBoundsCache(){this._resetBoundsCache=!0}resetGridCache(){this.dependencyGridCache=null}prepareLineDef(e,t,r=null){const n=this,s=n.getTimeSpanRecordFromDependency(e,!0),i=n.getTimeSpanRecordFromDependency(e,!1),o=e.type;let a=e.fromSide,l=e.toSide;if(!a)switch(!0){case o===ad.Type.StartToEnd:case o===ad.Type.StartToStart:a=n.getConnectorStartSide(s);break;case o===ad.Type.EndToStart:case o===ad.Type.EndToEnd:a=n.getConnectorEndSide(s);break;default:throw new Error("Invalid dependency type: "+o)}if(!l)switch(!0){case o===ad.Type.StartToEnd:l=n.getConnectorEndSide(i);break;case o===ad.Type.StartToStart:case o===ad.Type.EndToStart:l=n.getConnectorStartSide(i);break;case o===ad.Type.EndToEnd:l=n.getConnectorEndSide(i);break;default:throw new Error("Invalid dependency type: "+o)}const{startRectangle:c,endRectangle:d}=t;return{startBox:{start:c.x,end:c.right,top:c.y,bottom:c.bottom},endBox:{start:d.x,end:d.right,top:d.y,bottom:d.bottom},startSide:a,endSide:l}}drawLine(e,t,r,n=null,s=!0){const i=this.client,o=this.getMetaId(n);let a=t.instanceMeta(o).lineElement;if(a&&s||(a=document.createElementNS("http://www.w3.org/2000/svg","polyline"),s&&(t.instanceMeta(o).lineElement=a),a.setAttribute("depId",t.id),n&&(a.setAttribute("fromId",n.from.id),a.setAttribute("toId",n.to.id)),e.appendChild(a)),a.classList.length&&a.classList.remove.apply(a.classList,a.getAttribute("class").split(" ")),a.classList.add(this.baseCls),t.cls&&a.classList.add(t.cls),t.bidirectional&&a.classList.add("b-sch-bidirectional-line"),t.highlighted&&a.classList.add(...t.highlighted.split(" ")),P.isIE11){const e=t.getDateRange(!0),r=i.startDate;e.start<r&&a.classList.add("b-no-start-marker"),e.end<r&&a.classList.add("b-no-end-marker")}return a.setAttribute("points",r?r.map((e,t)=>t!==r.length-1?`${e.x1},${e.y1}`:`${e.x1},${e.y1} ${e.x2},${e.y2}`).join(" "):""),ei.set(a,{dependency:t}),a}refreshDependency(e){const t=this,r=t.getIteratableDependencyAssignments(e);t.releaseDependency(e,null!==r[0]),t.removeFromCache(e),t.addToGridCache(e),r.forEach(r=>t.drawDependency(e,null,r))}refreshDependencyAssignment(e,t){this.releaseDependency(e,t),this.removeFromCache(e,t),this.addToGridCache(e),this.drawDependency(e,null,t)}scheduleRefreshDependency(e,t=null){const r=this.dependenciesToRefresh;t?r.has(e)?!0!==r.get(e)&&r.get(e).add(t):r.set(e,new Set([t])):r.set(e,!0),1===r.size&&this.requestAnimationFrame(()=>{this.refreshDependencyOnFrame()})}refreshDependencyOnFrame(){const e=this,t=e.dependenciesToRefresh;e.client.isPainted&&(t.forEach((t,r)=>{if(!0===t){const t=e.getIteratableDependencyAssignments(r);e.releaseDependency(r,null!==t[0]),e.removeFromCache(r)}else t.forEach(t=>{e.releaseDependency(r,t),e.removeFromCache(r,t)})}),t.forEach((t,r)=>{e.addToGridCache(r)}),t.forEach((t,r)=>{!0===t&&(t=e.getIteratableDependencyAssignments(r)),t.forEach(t=>{e.drawDependency(r,null,t)})}),t.clear(),e.client.trigger("dependenciesDrawn",{partial:!0}))}drawDependency(e,t=null,r=null,n=this.client.svgCanvas,s=!0){const i=this,{drawnDependencies:o,oldDrawnDependencies:a}=i,l=t||i.getDependencyBounds(e,r);if(!i.disabled&&l){const t=i.prepareLineDef(e,l),a=i.pathFinder.findPath(t,i.lineDefAdjusters);i.drawLine(n,e,a,r,s),s&&!this.includesDependency(o,e,r)&&o.push({dependency:e,assignmentData:r})}const c=this.findDependencyIndex(a,e,r);c>=0&&a.splice(c,1)}drawForTimeSpan(e,t=!1){const r=this;r.client.isAnimating?r.client.on({transitionend(){r.drawForTimeSpan(e,!0)},once:!0}):r.dependencyStore.getTimeSpanDependencies(e).forEach(e=>{t?r.scheduleRefreshDependency(e):r.refreshDependency(e)})}drawForEvent(e){this.drawForTimeSpan(e)}updateDependenciesForTimeSpan(e,t){const r=this,n=e.isAssignment?e.event:e,s=r.dependencyStore.getTimeSpanDependencies(n),i=r.getMetaId(),o=r.client,a=Xt.from(t,o.timeAxisSubGridElement);let l;s.forEach(t=>{this.getIteratableDependencyAssignments(t).forEach(s=>{const o=a.clone();let c,d,u;s&&s.from!==e&&s.to!==e||r.isDependencyVisible(t,s)&&(r.getTimeSpanRecordFromDependency(t,!0)===n?(c=o,(l=t.instanceMeta(i).bounds)?d=l.endRectangle:(u=r.getBox(t,!1,s),u&&(d=u instanceof Xt?u:new Xt(u.start,u.top,u.end-u.start,u.bottom-u.top)))):((l=t.instanceMeta(i).bounds)?c=l.startRectangle:(u=r.getBox(t,!0,s),u&&(c=u instanceof Xt?u:new Xt(u.start,u.top,u.end-u.start,u.bottom-u.top))),d=o),c&&d&&r.drawDependency(t,{startRectangle:c,endRectangle:d},s))})})}scheduleDraw(e=!1){const t=this;t.disabled||(e&&t.resetBoundsCache(),t.client.isAnimating?t.clientTransitionRemover||(t.clientTransitionRemover=t.client.on({transitionend(){t.clientTransitionRemover(),t.clientTransitionRemover=null,t.draw()},once:!0})):t.doScheduleDraw())}draw(e=!1){const t=this,r=t.client;if(!t.oldDrawnDependencies&&!t.dependencyStore.count||!r.isPainted)return;if(r.isAnimating)return void r.on({transitionend(){t.scheduleDraw(!0)},once:!0});const n=r.timeAxisSubGrid.viewRectangle;if(e&&t.resetBoundsCache(),n.width&&n.height){if(t.oldDrawnDependencies=t.drawnDependencies,t.drawnDependencies=[],n.inflate(t.bufferSize),!t.disabled&&t.rowStore.count&&r.rowManager.rowCount){const e={},{dependencyGridCache:s,cacheGridSize:i}=t,o=Math.floor(Math.max(n.left,0)/i.x),a=Math.floor(n.right/i.x),l=Math.floor(r.rowManager.topRow.dataIndex/i.index),c=Math.floor(r.rowManager.bottomRow.dataIndex/i.index),d=[];let u,h,g;for(u=o;u<=a;u++)for(h=l;h<=c;h++){const i=s[u],o=i&&i[h];for(g=0;o&&g<o.length;g++){const{dependency:s,assignmentData:i,metaId:a}=o[g],l=s.id+"-"+a;if(!e[l]){const o=t.getDependencyBounds(s,i);(o&&o.bounds.intersect(n,!0,!0)||r.ignoreViewBox)&&d.push([s,o,i]),e[l]=!0}}}d.forEach(([e,r,n])=>{t.drawDependency(e,r,n)})}t._resetBoundsCache=!1,t.oldDrawnDependencies.forEach(e=>t.releaseDependency(e.dependency,e.assignmentData)),r.trigger("dependenciesDrawn"),this.isDrawn=!0}}releaseDependency(e,t=null){if(!0===t)Object.keys(e.meta.map||{}).filter(e=>e.startsWith(this.client.id)).forEach(t=>{const r=e.meta.map[t];r.lineElement&&(r.lineElement.remove(),r.lineElement=null)});else{const r=this.getMetaId(t),n=e.instanceMeta(r).lineElement;n&&(e.instanceMeta(r).lineElement=null,n.remove())}}render(){const e=this,t=e.client;e.showTooltip&&(e.tooltip=e.createTooltip()),t.timeAxis.on({endreconfigure:e.resetGridCache,thisObj:e}),t.rowManager.on({refresh:e.onRowsRefresh,changetotalheight:e.onChangeTotalHeight,thisObj:e}),t.on({horizontalscroll:e.onHorizontalScroll,svgcanvascreated:e.createMarkers,togglenode:e.onToggleNode,scroll:e.onVerticalScroll,timelineviewportresize:e.onViewportResize,thisObj:e}),e.highlightDependenciesOnEventHover&&(t.on(t.scheduledEventName+"MouseEnter",t=>e.highlightEventDependencies(t.eventRecord||t.taskRecord)),t.on(t.scheduledEventName+"MouseLeave",t=>e.unhighlightEventDependencies(t.eventRecord||t.taskRecord))),e.draw()}renderContents(){this.draw()}getConnectorStartSide(e){return this.client.currentOrientation.getConnectorStartSide(e)}getConnectorEndSide(e){return this.client.currentOrientation.getConnectorEndSide(e)}createTooltip(){const e=this,t=e.client;return new Mn(Object.assign({align:"b-t",id:t.id+"-dependency-tip",forSelector:".b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) ."+e.baseCls,clippedBy:[t.timeAxisSubGridElement,t.bodyContainer],forElement:t.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:e.getHoverTipHtml.bind(e)},e.tooltip||{}))}getHoverTipHtml({activeTarget:e}){const t=this,r=t.getDependencyForElement(e),n=t.dataApi.getDependencySourceEvent({dependency:r,eventStore:this.eventStore}),s=t.dataApi.getDependencyTargetEvent({dependency:r,eventStore:this.eventStore});return Cn.tpl`
             <table class="b-sch-dependency-tooltip">
                <tr>
                    <td>${t.L("L{from}")}: </td>
                    <td>${n.name}</td>
                    <td>
                        <div class="b-sch-box b-${cu[r.type]}"></div>
                    </td>
                </tr>
                <tr>
                    <td>${t.L("L{to}")}: </td>
                    <td>${s.name}</td>
                    <td><div class="b-sch-box b-${du[r.type]}"></div></td>
                </tr>
            </table>
        `}}uu._$name="Dependencies",Va.registerFeature(uu,!1,"Scheduler"),document.createElementNS&&!("classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))&&function(e){if("Element"in e){var t=e.Element.prototype,r=Object,n=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array.prototype.indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1},i=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},o=function(e,t){if(""===t)throw new i("SYNTAX_ERR","The token must not be empty.");if(/\s/.test(t))throw new i("INVALID_CHARACTER_ERR","The token must not contain space characters.");return s.call(e,t)},a=function(e){for(var t=n.call(e.getAttribute("class")||""),r=t?t.split(/\s+/):[],s=0,i=r.length;s<i;s++)this.push(r[s]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=a.prototype=[],c=function(){return new a(this)};if(i.prototype=Error.prototype,l.item=function(e){return this[e]||null},l.contains=function(e){return~o(this,e+"")},l.add=function(){var e,t=arguments,r=0,n=t.length,s=!1;do{e=t[r]+"",~o(this,e)||(this.push(e),s=!0)}while(++r<n);s&&this._updateClassName()},l.remove=function(){var e,t,r=arguments,n=0,s=r.length,i=!1;do{for(e=r[n]+"",t=o(this,e);~t;)this.splice(t,1),i=!0,t=o(this,e)}while(++n<s);i&&this._updateClassName()},l.toggle=function(e,t){var r=this.contains(e),n=r?!0!==t&&"remove":!1!==t&&"add";return n&&this[n](e),!0===t||!1===t?t:!r},l.replace=function(e,t){var r=o(e+"");~r&&(this.splice(r,1,t),this._updateClassName())},l.toString=function(){return this.join(" ")},r.defineProperty){var d={get:c,enumerable:!0,configurable:!0};try{r.defineProperty(t,"classList",d)}catch(e){void 0!==e.number&&-2146823252!==e.number||(d.enumerable=!1,r.defineProperty(t,"classList",d))}}else r.prototype.__defineGetter__&&t.__defineGetter__("classList",c)}}(window),function(){var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){for(var r=0,n=arguments.length;r<n;r++)e=arguments[r],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var r=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:r.call(this,e)}}"replace"in document.createElement("_").classList||(DOMTokenList.prototype.replace=function(e,t){var r=this.toString().split(" "),n=r.indexOf(e+"");~n&&(r=r.slice(n),this.remove.apply(this,r),this.add(t),this.add.apply(this,r.slice(1)))}),e=null}();class hu extends vn{static get $name(){return"DependencyEditor"}static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const t=this.dependencyEditFeature;return!("lagField"===e.ref&&!t.showLagField)&&(!("deleteButton"===e.ref&&!t.showDeleteButton)&&(Object.assign(e,{}),super.processWidgetConfig(e)))}afterShow(...e){const t=this.widgetMap.deleteButton;t&&(t.hidden=!this.record.isPartOfStore()),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}}hu._$name="DependencyEditor";class gu extends Nn{static get $name(){return"DependencyEdit"}static get defaultConfig(){return{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:this,closable:!0,items:[{type:"display",localeClass:this,label:"L{From}",editable:!1,ref:"fromNameField"},{type:"display",localeClass:this,label:"L{To}",ref:"toNameField"},{type:"combo",localeClass:this,label:"L{Type}",name:"type",ref:"typeField",editable:!1,valueField:"id",displayField:"name",items:Object.keys(ad.Type).map(e=>({id:ad.Type[e],name:this.L(`L{${e}}`)}))},{type:"duration",localeClass:this,label:"L{Lag}",name:"lag",ref:"lagField",allowNegative:!0}],bbar:[{type:"widget",cls:"b-label-filler"},{color:"b-green",localeClass:this,text:"L{Save}",ref:"saveButton"},{color:"b-gray",localeClass:this,text:"L{Delete}",ref:"deleteButton"},{color:"b-gray",text:"L{Object.Cancel}",localeClass:this,ref:"cancelButton"}]}}}construct(e,t){const r=this;if(e.dependencyEdit=r,r.dependencyStore=e.dependencyStore,super.construct(e,t),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit");r.clientListenersDetacher=e.on({[r.triggerEvent]:r.onActivateEditor,thisObj:r})}doDestroy(){this.clientListenersDetacher(),this.editor&&this.editor.destroy(),super.doDestroy()}get editorConfig(){return this._editorConfig}set editorConfig(e){const t=this.getDefaultConfiguration().editorConfig;(e=ze.assign({},t,e)).items=e.items||[],this._editorConfig=e}get isValid(){return Object.values(this.editor.widgetMap).every(e=>!(e.name&&!e.hidden)||!1!==e.isValid)}get values(){const e={};return this.editor.eachWidget(t=>{t.name&&!t.hidden&&(e[t.name]=t.value)},!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const t=this.values;if(e.beginBatch(),e.set(t),this.lagField){const t=this.lagField.value;e.setLag(t.magnitude,t.unit)}this.typeField&&"type"in t&&e.set({fromSide:null,toSide:null}),e.endBatch()}onPopupKeyDown({event:e}){"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),this.onSaveClick())}onSaveClick(){this.save()&&this.editor.hide()}onDeleteClick(){this.deleteDependency(),this.editor.hide()}onCancelClick(){this.editor.hide()}internalShowEditor(e){const t=this,r=t.client;let n=t.lastPointerDownCoordinate;if(!1===r.trigger("beforeDependencyEdit",{dependencyEdit:t,dependencyRecord:e}))return;const s=t.getEditor(e);if(t.loadRecord(e),r.trigger("beforeDependencyEditShow",{dependencyEdit:t,dependencyRecord:e,editor:s}),!n){const e=Xt.from(t.client.element).center;n=[e.x-s.width/2,e.y-s.height/2]}s.showByPoint(n)}editDependency(e){this.client.readOnly||this.internalShowEditor(e)}getEditor(){const e=this;let{editor:t}=e;return t||(t=e.editor=new hu(ze.assign({dependencyEditFeature:e,autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[e.client.timeAxisSubGridElement,e.client.bodyContainer],constrainTo:window,autoClose:e.autoClose,cls:e.cls,listeners:{keydown:e.onPopupKeyDown,thisObj:e}},e.editorConfig)),0===t.items.length&&console.warn("Editor configured without any `items`"),t.eachWidget(t=>{const r=t.ref||t.id;r&&!e[r]&&(e[r]=t)}),e.saveButton&&e.saveButton.on("click",e.onSaveClick,e),e.deleteButton&&e.deleteButton.on("click",e.onDeleteClick,e),e.cancelButton&&e.cancelButton.on("click",e.onCancelClick,e),e.editor)}loadRecord(e){const t=this;t.fromNameField.value=e.sourceEvent.name,t.toNameField.value=e.targetEvent.name,t.lagField&&(t.lagField.unit=e.lagUnit),t.editor.record=t.dependencyRecord=e}save(){const e=this,{client:t,dependencyRecord:r}=e;if(!r||!e.isValid)return;const n=e.dependencyStore,s=e.values;if(!1!==t.trigger("beforeDependencySave",{dependencyRecord:r,values:s})){if(e.onBeforeSave(r),e.updateRecord(r),n&&!r.stores.length){if(!1===t.trigger("beforeDependencyAdd",{dependencyRecord:r,dependencyEdit:e}))return;n.add(r)}t.project&&t.project.propagate(),t.trigger("afterDependencySave",{dependencyRecord:r}),e.onAfterSave(r)}return r}deleteDependency(){const e=this;return!1!==e.client.trigger("beforeDependencyDelete",{dependencyRecord:e.dependencyRecord})&&(e.editor.containsFocus&&e.editor.revertFocus(),e.client.dependencyStore.remove(e.dependencyRecord),e.client.project&&e.client.project.propagate(),!0)}onActivateEditor({dependency:e,event:t}){this.disabled||(this.lastPointerDownCoordinate=[t.clientX,t.clientY],this.editDependency(e))}}gu._$name="DependencyEdit",Va.registerFeature(gu,!1);class mu extends jl{static get $name(){return"SchedulerHeader"}refreshContent(){this.headersElement&&0===this.headersElement.childNodes.length&&super.refreshContent()}}mu._$name="Header";class pu extends(G()){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,calendar:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,eventStore:null,originalTickSize:null,headersDatesCache:[]}}construct(e){const t=this;t.unitToPixelsCache={},super.construct(e);const r=t.timeAxis.viewPreset||t.viewPreset;if(r)if(r instanceof qc)t.consumeViewPreset(r);else{const e=Kc.getPreset(r);e&&t.consumeViewPreset(e)}t.timeAxis.on("reconfigure",t.onTimeAxisReconfigure,t),t.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this)}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get headers(){return this._headers}set headers(e){if(e&&e.length&&e[e.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=e}get isTimeAxisViewModel(){return!0}get isHorizontal(){return"vertical"!==this.mode}get isVertical(){return"vertical"===this.mode}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){this.headers=null,this.setConfig(e),this.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:t}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),t||this.update()}update(e,t=!1,r=!1){const n=this,{timeAxis:s,headers:i}=n;if(n.isConfiguring||n._availableSpace===e)return void(r&&n.trigger("update"));if(n._availableSpace=Math.max(e||n.availableSpace||0,0),"number"!=typeof n.availableSpace)throw new Error("Invalid available space provided to TimeAxisModel");n.columnConfig=[];const o=n._tickSize=n.calculateTickSize(n.originalTickSize);if("number"!=typeof o||o<=0)throw new Error("Invalid timeAxis tick size");n.unitToPixelsCache={},n._totalSize=null;for(let e=0,{length:t}=i;e<t;e++){const t=i[e];if(t.cellGenerator){const r=t.cellGenerator.call(n,s.startDate,s.endDate);n.columnConfig[e]=n.createHeaderRow(e,t,r)}else n.columnConfig[e]=n.createHeaderRow(e,t)}t||n.trigger("update")}getDistanceBetweenDates(e,t){return Math.round(this.getPositionFromDate(t)-this.getPositionFromDate(e))}getDistanceForDuration(e){const t=this.timeAxis.getAt(0);return this.tickSize/(t.endDate-t.startDate)*e}getPositionFromDate(e,t={}){const r=this.getScaledTick(e,t);return-1===r?-1:Math.round(this.tickSize*(r-this.timeAxis.visibleTickStart))}getScaledTick(e,{respectExclusion:t,snapToNextIncluded:r,isEnd:n,min:s,max:i}){const{timeAxis:o}=this,{include:a,unit:l,weekStartDay:c}=o;let d=o.getTickFromDate(e);if(-1!==d&&t&&a){let t=!1;if(a.hour&&je.compareUnits(l,"hour")>0&&"day"!==l){const{from:n,to:s,lengthFactor:i,center:o}=a.hour,l=e.getHours(),c=Math.min(Math.max(l,n),s);if(!r&&c!==l)return-1;const d=o-(o-(c+e.getMinutes()/60))*i;e=je.add(e,d-l,"h"),t=!0}if(a.day&&je.compareUnits(l,"day")>0){const{from:o,to:l,lengthFactor:d,center:u}=a.day;let h=e.getDay();n&&0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()&&--h<0&&(h=6);let g=0;if(h<o||h>=l){if(!r)return-1;if(g=n?(l-h-8)%7:(o-h+7)%7,e=je.add(e,g,"d"),e=je.startOf(e,"d",!1),i&&e.getTime()>=i||s&&e.getTime()<=s)return-1}const m=0===e.getDay()?0:u,p=e.getDay()+e.getHours()/24,f=m-(m-p)*d;e=je.add(e,f-p+c,"d"),t=!0}t&&(e=je.constrain(e,o.startDate,o.endDate),d=o.getTickFromDate(e))}return d}getDateFromPosition(e,t,r=!1){const n=this.timeAxis,s=this.getScaledPosition(e)/this.tickSize+n.visibleTickStart;return s<0||s>n.count?r?s<0?je.add(n.startDate,s,n.unit):je.add(n.endDate,s-n.count,n.unit):null:n.getDateFromTick(s,t)}getScaledPosition(e){const{include:t,unit:r,weekStartDay:n}=this.timeAxis;if(t){const s=this.getSingleUnitInPixels("day");if(t.day&&je.compareUnits(r,"day")>0){const{from:r,lengthFactor:i}=t.day,o=e%(7*s);e=o/i+(r-n)*s+(e-o)}if(t.hour&&je.compareUnits(r,"hour")>0&&"day"!==r){const{from:r,lengthFactorExcl:n}=t.hour,i=e%s;e=i/n+r*this.getSingleUnitInPixels("hour")+(e-i)}}return e}getSingleUnitInPixels(e){const t=this;return t.unitToPixelsCache[e]||(t.unitToPixelsCache[e]=je.getUnitToBaseUnitRatio(t.timeAxis.unit,e,!0)*t.tickSize/t.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(e){this.setTickSize(e,!1)}setTickSize(e,t){this._tickSize=this.originalTickSize=e,this.update(void 0,t)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(e){const t=this,{forceFit:r,timeAxis:n,suppressFit:s}=t,i=n.unit;let o=0,a=1;if(t.snap){const e=n.resolution;a=je.getUnitToBaseUnitRatio(i,e.unit)*e.increment}if(s)o=e;else{const s=n.visibleTickTimeSpan,i=Math[r?"floor":"round"](t.availableSpace/s);if(o=r||e<i?i:e,a>0&&(!r||a<1)){const e=r?"floor":"round";o=Math.round(Math.max(1,Math[e](a*o))/a)}}return o}get totalSize(){return this._totalSize||(this._totalSize=Math.round(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(e){const t=this;if(t._availableSpace=Math.max(0,e),t._availableSpace>0){const e=t.calculateTickSize(t.originalTickSize);e>0&&e!==t.tickSize&&t.update()}}getDates(e=this.columnLinesFor,t=!1,r=!1){const n=this,s=[],i=t?n.lowestHeader:e,o=n.majorHeaderLevel,a=n.headers&&n.headers[e].unit,l=null!=o&&n.headers&&n.headers[o].unit,c=null!=o&&je.doesUnitsAlign(l,a);if(!(!n.headers||!n.headers[i].cellGenerator)){const e=n.columnConfig[i];for(let t=1,r=e.length;t<r;t++)s.push({date:e[t].startDate})}else n.forEachInterval(i,(t,i)=>{s.push({date:r?i:t,isMajor:o!==e&&c&&n.isMajorTick(r?i:t)})});return s}get forceFit(){return this._forceFit}fitToAvailableSpace(e){const t=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(t,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,t,r){const n=this,s=[],i=t.align,o=je.clearTime(new Date),a=t.headerCellCls||"",l=(r,l,d,u)=>{let h=je.format(r,t.dateFormat);const g={align:i,start:r,end:l,value:u?u.header:h,headerCellCls:a,width:this.getDistanceBetweenDates(r,l),index:d};0!==g.width&&(g.coord=c,c+=g.width,n.headersDatesCache[e][r.getTime()]=1,t.renderer&&(h=t.renderer.call(t.thisObj||n,r,l,g,d,n.eventStore),g.value=null==h?"":h),"day"!==t.unit||t.increment&&1!==t.increment||(g.headerCellCls+=" b-sch-dayheadercell-"+r.getDay(),n.calendar&&n.calendar.isWeekend(r)&&(g.headerCellCls+=" b-sch-dayheadercell-nonworking"),je.clearTime(r,!0)-o==0&&(g.headerCellCls+=" b-sch-dayheadercell-today")),s.push(g))};let c=0;return n.headersDatesCache[e]={},r?r.forEach((e,t)=>l(e.start,e.end,t,e)):n.forEachInterval(e,l),s}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:e}=this;return e?Math.max(e.length-2,0):null}isMajorTick(e){const t=this.majorHeaderLevel;return null!=t&&this.headersDatesCache[t]&&this.headersDatesCache[t][e.getTime()]||!1}forEachInterval(e,t,r=this){const{headers:n}=this;if(n)if(e===n.length-1)this.timeAxis.forEach((e,n)=>t.call(r,e.startDate,e.endDate,n));else{const s=n[e];this.timeAxis.forEachAuxInterval(s.unit,s.increment,t,r)}}forEachMainInterval(e,t){this.forEachInterval(this.mainHeaderLevel,e,t)}consumeViewPreset(e){const t=this;t.headers=null,t._thisIsAUsedExpression(t.tickSize),t.viewPreset=e,Object.assign(t,{headers:e.headers,columnLinesFor:e.columnLinesFor,mainHeaderLevel:e.mainHeaderLevel,_tickSize:t.isHorizontal?e.tickWidth:e.tickHeight}),t.originalTickSize=t.tickSize}}pu._$name="TimeAxisViewModel";const fu=new Date;var vu=e=>class extends(e||B){getDateFromCoordinate(e,t,r=!0,n=!1){return r||(e=this.currentOrientation.translateToScheduleCoordinate(e)),this.timeAxisViewModel.getDateFromPosition(e,t,n)}getDateFromX(e,t,r=!0){return this.getDateFromCoordinate(e,t,r)}getDateFromXY(e,t,r=!0,n=!1){return this.currentOrientation.getDateFromXY(e,t,r,n)}getDateFromDomEvent(e,t,r=!1){return this.getDateFromXY([e.clientX,e.clientY],t,!1,r)}getStartEndDatesFromRectangle(e,t,r){const n=this,{isHorizontal:s}=n,i=s?n.timeAxisSubGrid.width:n.timeAxisSubGrid.height,o=s?e.x:e.top,a=s?e.right:e.bottom;let l,c;return o>=0&&a<i?(l=n.getDateFromCoordinate(o,null,!0),c=n.getDateFromCoordinate(a,null,!0)):o<0?(c=n.getDateFromCoordinate(a,t,!0),l=c&&je.add(c,-r,"ms")):(l=n.getDateFromCoordinate(o,t,!0),c=l&&je.add(l,r,"ms")),{start:l,end:c}}get displayDateFormat(){return this._displayDateFormat}set displayDateFormat(e){this._displayDateFormat=e,this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return je.format(e,this.displayDateFormat)}getDisplayEndDate(e,t){return 0!==e.getHours()||0!==e.getMinutes()||t&&e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()||je.formatContainsHourInfo(this.displayDateFormat)||(e=je.add(e,-1,"day")),e}getFormattedEndDate(e,t){return this.getFormattedDate(this.getDisplayEndDate(e,t))}getCoordinateFromDate(e,t=!0){const r=this,{timeAxisViewModel:n}=r,{isContinuous:s,startMS:i,endMS:o,startDate:a,unit:l}=r.timeAxis,c=e.valueOf();let d;if(!0===t?t={local:!0}:t?"local"in t||(t.local=!0):t={local:!1},e instanceof Date||(fu.setTime(e),e=fu),s&&e.getTimezoneOffset()===a.getTimezoneOffset()&&-1!==je.getUnitToBaseUnitRatio(l,"day")){if(c<i||c>o)return-1;d=Math.round((c-i)/(o-i)*n.totalSize)}else d=n.getPositionFromDate(e,t);return t.local||(d=r.currentOrientation.translateToPageCoordinate(d)),d}getTimeSpanDistance(e,t){return this.timeAxisViewModel.getDistanceBetweenDates(e,t)}get viewportCenterDate(){const e=this,t=e.timeAxis,r=e.timeAxisSubGrid,n=r.scrollable,s=n.x+r.width/2,i=n.y+r.height/2;if(t.isContinuous){const r=e.isHorizontal?s/n.scrollWidth:i/n.scrollHeight,o=t.startMS+(t.endMS-t.startMS)*r;return new Date(o)}{const t=e.isHorizontal?[s,0]:[0,i];return e.getDateFromXY(t,null,!0)}}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(e){this.timeAxis.resolution="number"==typeof e?{increment:e,unit:this.timeAxis.resolution.unit}:e}set snap(e){this.isConfiguring?this._snap=e:this.timeAxisViewModel.snap=e}get snap(){return this.isConfiguring?this._snap:this.timeAxisViewModel.snap}onSchedulerHorizontalScroll({subGrid:e,scrollLeft:t}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}};const yu={mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseover:"MouseOver",mouseout:"MouseOut"};var bu=e=>class extends(e||B){static get defaultConfig(){return{scheduledBarEvents:{mousedown:"handleScheduledBarEvent",mouseup:"handleScheduledBarEvent",click:"handleScheduledBarEvent",dblclick:"handleScheduledBarEvent",contextmenu:"handleScheduledBarEvent",mouseover:"handleScheduledBarEvent",mouseout:"handleScheduledBarEvent"},schedulerEvents:{click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent"}}}initDomEvents(){const e=this;e.scheduledBarEvents.element=e.schedulerEvents.element=e.timeAxisSubGridElement,e.scheduledBarEvents.thisObj=e.schedulerEvents.thisObj=e,gr.on(e.scheduledBarEvents),gr.on(e.schedulerEvents)}getTimeSpanMouseEventParams(e,t){throw new Error("Implement in subclass")}getScheduleMouseEventParams(e,t){throw new Error("Implement in subclass")}handleScheduledBarEvent(e){const t=this,r=Et.up(e.target,t.eventInnerSelector),n=yu[e.type]||I.capitalizeFirstLetter(e.type);r&&t.trigger(t.scheduledEventName+n,t.getTimeSpanMouseEventParams(r,e))}handleScheduleEvent(e){const t=this,r=!Et.up(e.target,t.eventSelector)&&Et.up(e.target,"."+t.timeCellCls),n=yu[e.type]||I.capitalizeFirstLetter(e.type);if(r){const s=t.getDateFromDomEvent(e,"floor"),i=ei.get(r),o=i.row.dataIndex,a=t.timeAxis.getTickFromDate(s),l=t.timeAxis.getAt(Math.floor(a));l&&t.trigger("schedule"+n,Object.assign({date:s,tickStartDate:l.startDate,tickEndDate:l.endDate,row:i.row,index:o,event:e},t.getScheduleMouseEventParams(i,e)))}}onElementMouseOver(e){super.onElementMouseOver(e);const t=this,r=e.target;if(r.closest(t.eventInnerSelector)){const n=r.closest(t.eventSelector);if(n.classList.add(t.overScheduledEventClass),n!==t.hoveredEventNode&&!t.preventOverCls){t.hoveredEventNode=n;const r=t.getTimeSpanMouseEventParams(n,e);r&&t.trigger(t.scheduledEventName+"MouseEnter",r)}}else t.hoveredEventNode=null}onElementMouseOut(e){super.onElementMouseOut(e);const t=this;if(e.target.closest(t.eventInnerSelector)&&t.resolveTimeSpanRecord(e.target)&&t.hoveredEventNode){if(e.relatedTarget&&Et.isDescendant(e.target.closest(t.eventInnerSelector),e.relatedTarget))return;t.unhover(e)}}unhover(e){const t=this,r=t.hoveredEventNode;r&&(r.classList.remove(t.overScheduledEventClass),t.trigger(t.scheduledEventName+"MouseLeave",t.getTimeSpanMouseEventParams(r,e)),t.hoveredEventNode=null)}get widgetClass(){}},Cu=e=>class extends(e||B){static get defaultConfig(){return{viewPreset:"weekAndDayLetter",displayDateFormat:null,presets:!0}}set presets(e){!0===e&&(e=Kc.allRecords),this._presets=new Xc({data:e})}get presets(){return this._presets}get viewPreset(){return this._viewPreset}set viewPreset(e){e instanceof qc||!e.name||e.base||(A.deprecate("Scheduler","4.0.0","ViewPreset name config replaced by base config. See https://www.bryntum.com/docs/scheduler/#guides/upgrades/3.0.md"),e.base=e.name),this._viewPreset&&this._viewPreset.equals(e)||this.setViewPreset(e)}normalizePreset(e){const t=e,{presets:r}=this;if(!(e instanceof qc)){if("object"==typeof e){if(e.base){const t=r.getById(e.base)||Kc.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=ze.merge(ze.clone(t.data),Kc.createRecord(e).data)}e.id?e=r.createRecord(e):(e=r.createRecord(ze.assign({},e))).id=e.generateId(r)}else e="number"==typeof e?r.getAt(e):r.getById(e)||Kc.getById(e);if(!e)throw new Error("Invalid ViewPreset requested: "+t)}return r.add(e)[0]}setViewPreset(e,t,r,n,s={}){const i=this,{isHorizontal:o,_timeAxis:a}=i,l={startDate:t,endDate:r,from:i.viewPreset};if(e=l.to=l.preset=i.normalizePreset(e),!Object.keys(s).length&&i._viewPreset&&(i._viewPreset===e||i._viewPreset.equals(e)))return;n=n||i.isConfiguring;let c=s.centerDate;if(n||!1!==i.trigger("beforePresetChange",l)&&!1!==i.trigger("beforeZoomChange",l)){if(i._viewPreset=e,i._viewPresetChanging=!0,i.displayDateFormat=i.config.displayDateFormat||e.displayDateFormat,a){if(i.suspendRefresh(),!n||!a.isConfigured){const s={weekStartDay:i.weekStartDay,startTime:i.startTime,endTime:i.endTime};n?(0===a.count||t)&&(s.startDate=t||new Date,s.endDate=r):t?(s.startDate=t,s.endDate=r,!c&&r&&(c=new Date((t.getTime()+r.getTime())/2))):(s.startDate=a.startDate,s.endDate=r||a.endDate,c||(c=i.viewportCenterDate)),a.isConfigured=!1,a.viewPreset=e,a.reconfigure(s,!0),i.timeAxisViewModel.reconfigure({viewPreset:i.viewPreset,headers:e.headers,columnLinesFor:null!=e.columnLinesFor?e.columnLinesFor:e.headers.length-1,rowHeightHorizontal:i.readRowHeightFromPreset?e.rowHeight:i.rowHeight,tickSize:o?e.tickWidth:e.tickHeight||e.tickWidth||60}),i.resumeRefresh()}if(i.refresh(),!s.notScroll&&i.isPainted)if(c){i.cachedCenterDate=c,l.centerDate=c;let e=null;e=Math.max(Math.floor(i.getCoordinateFromDate(c,!0)-i.timeAxisSubGrid.width/2),0),i.viewPresetActiveScroll={left:e},i.scrollingToCenter=!0,i.scrollHorizontallyTo(e,!1),i.setTimeout(()=>{i.scrollingToCenter=!1},100)}else i.scrollHorizontallyTo(0,!1)}i.trigger("presetChange",l),i.trigger("zoomChange",l)}i._viewPresetChanging=!1}get widgetClass(){}},wu=e=>class extends(e||B){static get defaultConfig(){return{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,preventScrollZoom:null,minZoomLevel:null,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}}construct(e){const t=this;super.construct(e),t.zoomOnMouseWheel&&gr.on({element:t.timeAxisSubGridElement,wheel:"onWheel",thisObj:t,capture:!0,passive:!1}),t.zoomOnTimeAxisDoubleClick&&t.on("timeaxisheaderdblclick",({startDate:e,endDate:r})=>{t.isVertical||t.zoomToSpan({startDate:e,endDate:r})})}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(e){if("number"!=typeof e&&(e=this.presets.count-1),e<0||e>=this.presets.count)throw new Error("Invalid range for `setMinZoomLevel`");this._maxZoomLevel=e}get minZoomLevel(){return this._minZoomLevel||0}set minZoomLevel(e){if("number"!=typeof e&&(e=0),e<0||e>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=e}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(e){this.zoomToLevel(e)}getMilliSecondsPerPixelForZoomLevel(e,t){const{bottomHeader:r}=e,n=this.isHorizontal?e.tickWidth:e.tickHeight;return Math.round((je.add(new Date(1,0,1),r.increment||1,r.unit)-new Date(1,0,1))/(t?n:e.actualWidth||n))}zoomTo(e){const t=this;"object"==typeof e?e.preset?t.zoomToLevel(e.preset,e):null!=e.level?t.zoomToLevel(e.level,e):t.zoomToSpan(e):t.zoomToLevel(e)}zoomToLevel(e,t={}){"number"==typeof e&&(e=Math.min(Math.max(e,this.minZoomLevel),this.maxZoomLevel));const r=this,{config:n}=r,s=r.isVertical?"tickHeight":"tickWidth",i=r.normalizePreset(e),o=i[s],a=t.startDate?new Date(t.startDate):null,l=t.endDate?new Date(t.endDate):null;let c=a&&l?{startDate:a,endDate:l}:null;const d=t.centerDate||(c?new Date((a.getTime()+l.getTime())/2):r.viewportCenterDateCached),u=r.timeAxisSubGrid.width;if(0===u)return null;c||(c=n.startDate&&n.endDate&&n.viewPreset&&i.equals(r.normalizePreset(n.viewPreset))?{startDate:n.startDate,endDate:n.endDate}:r.calculateOptimalDateRange(d,u,i)),"width"in t&&i.setData(s,t.width),r.isZooming=!0,r.setViewPreset(i,c.startDate||r.startDate,c.endDate||r.endDate,!1,{centerDate:d}),i.actualWidth=r.timeAxisViewModel.tickSize,r.isZooming=!1,i.setData(s,o)}zoomToFit(e){const t=this.eventStore.getTotalTimeSpan();(e=Object.assign({leftMargin:0,rightMargin:0},e,t)).startDate&&e.endDate&&this.zoomToSpan(e)}zoomToSpan(e={}){if((e.leftMargin||e.rightMargin)&&(e.adjustStart=0,e.adjustEnd=0),e.leftMargin||(e.leftMargin=0),e.rightMargin||(e.rightMargin=0),!e.startDate||!e.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const t=this,r=e.adjustStart>=0||e.adjustEnd>=0;let{startDate:n,endDate:s}=e;if(r&&(n=je.add(n,-e.adjustStart,t.timeAxis.mainUnit),s=je.add(s,e.adjustEnd,t.timeAxis.mainUnit)),n<=s){const{availableSpace:i}=t.timeAxisViewModel,o=t.presets.allRecords,a=s-n||1;let l,c,d=Math.floor(t.zoomLevel);-1===d&&(d=0);let u,h=t.getMilliSecondsPerPixelForZoomLevel(o[d],!0),g=d+(l=a/h+e.leftMargin+e.rightMargin>i?-1:1),m=null;for(;g>=0&&g<=o.length-1;){u=o[g],h=t.getMilliSecondsPerPixelForZoomLevel(u,!0);const r=a/h+e.leftMargin+e.rightMargin;if(-1===l){if(r<=i){m=g;break}}else{if(!(r<=i))break;d!==g-l&&(m=g)}g+=l}m=null!=m?m:g-l,u=o[m];const p=u.bottomHeader.unit;(e.leftMargin||e.rightMargin)&&(n=new Date(n.getTime()-h*e.leftMargin),s=new Date(s.getTime()+h*e.rightMargin));const f=je.getDurationInUnit(n,s,p,!0)/u.bottomHeader.increment;if(0===f)return null;const v=Math.floor(i/f),y=e.centerDate||new Date((n.getTime()+s.getTime())/2);return c=r?{startDate:n,endDate:s}:t.calculateOptimalDateRange(y,i,u),t.zoomToLevel(m,Object.assign(c,{width:v,centerDate:y}))}return null}zoomIn(e=1){const t=this.zoomLevel;return t>=this.presets.count-1?null:this.zoomToLevel(Math.floor(t)+e)}zoomOut(e=1){const t=this.zoomLevel;return t<=0?null:this.zoomToLevel(Math.ceil(t)-e)}zoomInFull(){return this.zoomToLevel(this.maxZoomLevel)}zoomOutFull(){return this.zoomToLevel(this.minZoomLevel)}calculateOptimalDateRange(e,t,r,n){if(n)return n;const{timeAxis:s}=this,{bottomHeader:i}=r,o=this.isHorizontal?r.tickWidth:r.tickHeight;if(this.zoomKeepsOriginalTimespan)return{startDate:s.startDate,endDate:s.endDate};const a=i.unit,l=Math.ceil(t/o*i.increment*this.visibleZoomFactor/2),c=je.add(e,-l,a),d=je.add(e,l,a);return{startDate:s.floorDate(c,!1,a,i.increment),endDate:s.ceilDate(d,!1,a,i.increment)}}onWheel(e){const t=this;e.ctrlKey&&(e.preventDefault(),t.preventScrollZoom||(e.deltaY>0?t.zoomOut():e.deltaY<0&&t.zoomIn(),t.preventScrollZoom=!0,t.setTimeout(()=>t.preventScrollZoom=!1,30)))}setTimeSpan(e,t){this.timeAxis.setTimeSpan(e,t)}shift(e,t){this.timeAxis.shift(e,t)}shiftNext(e){this.timeAxis.shiftNext(e)}shiftPrevious(e){this.timeAxis.shiftPrevious(e)}get widgetClass(){}},Su=e=>class extends(e||B){static get defaultConfig(){return{barMargin:10,resourceMargin:null,managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed",eventStyle:"plain",eventColor:"green"}}get barMargin(){return this._barMargin}set barMargin(e){const t=this;ze.assertNumber(e,"barMargin"),t.isHorizontal&&t.rowHeight&&(e=Math.min(Math.ceil(t.rowHeight/2),e)),t._barMargin!==e&&(t._barMargin=e,t.rendered&&(t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition()))}get resourceMargin(){return null==this._resourceMargin?this.barMargin:this._resourceMargin}set resourceMargin(e){const t=this;ze.assertNumber(e,"resourceMargin"),t.isHorizontal&&t.rowHeight&&(e=Math.min(Math.ceil(t.rowHeight/2),e)),t._resourceMargin!==e&&(t._resourceMargin=e,t.rendered&&(t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition()))}set tickWidth(e){this.tickSize=e}get tickWidth(){return this.tickSize}set tickSize(e){ze.assertNumber(e,"tickSize"),this.timeAxisViewModel.tickSize=e}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal"]}get widgetClass(){}},Du=e=>class extends(e||B){scrollToDate(e,t={}){const r=this,n=r.timeAxisSubGrid.scrollable.viewport,s=r.getCoordinateFromDate(e,!0),i=r.isHorizontal?new Xt(r.getCoordinateFromDate(e,!1),n.y,r.timeAxisViewModel.tickSize,n.height):new Xt(n.x,r.getCoordinateFromDate(e,!1),n.width,r.timeAxisViewModel.tickSize);return r.scrollToCoordinate(s,i,e,t)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}scrollToCoordinate(e,t,r,n={}){const s=this;if(e<0){const e=(s.timeAxis.endDate-s.timeAxis.startDate)/2,t=new Date(r.getTime()-e),i=new Date(r.getTime()+e);return t-s.startDate!=0&&i-s.endDate!=0?(s.setTimeSpan(t,i),s.scrollToDate(r,n)):void 0}return s.timeAxisSubGrid.scrollable.scrollIntoView(t,n)}set scrollLeft(e){this.timeAxisSubGrid.scrollable.x=e}set scrollTop(e){this.scrollable.y=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.x}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}scrollVerticallyTo(e,t=!0){return this.scrollable.scrollTo(null,e,t)}scrollTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}get widgetClass(){}};const Eu=["viewPreset","eventBarTextField","eventRenderer","eventRendererThisObj","eventBodyTemplate"],xu={fn:"exitTransition",delay:0,cancelOutstanding:!0};class Tu extends(Qn(dc).mixes(vu,bu,Su,Du,Cu,wu)){static get $name(){return"TimelineBase"}static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,startDate:null,endDate:null,snap:!1,snapRelativeToEventStartDate:!1,forceFit:!1,suppressFit:!1,eventCls:null,getDateConstraints:null,timeCellCls:null,timeCellSelector:null,scheduledEventName:null,createEventOnDblClick:!0,overScheduledEventClass:null,preventOverCls:!1,hoveredEventNode:null,useBackgroundCanvas:!1,enableEventAnimations:!P.isIE11,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,milestoneLayoutMode:"default",defaultRegion:"locked"}}construct(e={}){const t=this,r=e.schedulerRegion||"normal",{subGridConfigs:n={}}=e;e.subGridConfigs=n,n[r]=n[r]||{},n[r].headerClass=mu,"flex"in n[r]||"width"in n[r]||(n[r].flex=1),e.startDate&&(e.startDate=je.parse(e.startDate)),e.endDate&&(e.endDate=je.parse(e.endDate)),super.construct(e),t.onSchedulerViewportResize=t.throttle(t.onSchedulerViewportResize,250),t.initDomEvents(),t.currentOrientation.init(),t.rowManager.on("refresh",()=>{t.forceLayout=!1})}doDestroy(){const e=this,{currentOrientation:t}=this;t&&t.destroy(),e.partneredWith&&(e.partneredWith.forEach(t=>{e.removePartner(t)}),e.partneredWith.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),this._thisIsAUsedExpression(this.partner)}onPaint({firstPaint:e}){if(e){const{timeAxisSubGrid:e}=this,t=this.isVertical?P.isIE11?e.element.parentElement.offsetHeight:e.height:e.width;this.timeAxisViewModel.update(t,!1,!0)}super.onPaint([...arguments])}initSubGrids(){super.initSubGrids();const e=this,t=e.timeAxisSubGrid=e.subGrids[e.timeAxisColumn.region];t.sealedColumns=!0,t.on({resize:e.onTimeAxisSubGridResize,thisObj:e})}onSchedulerHorizontalScroll(e,t){this.currentOrientation.updateFromHorizontalScroll(t),super.onSchedulerHorizontalScroll(e,t)}initScroll(){let e=this,t=0;super.initScroll(),P.isMobileSafari&&(e.scrollable.element.style.transform="translate3d(0, 0, 0)"),e.on("horizontalscroll",({subGrid:r,scrollLeft:n})=>{e.isPainted&&r===e.timeAxisSubGrid&&!e.isDestroying&&e.onSchedulerHorizontalScroll(r,n),t++}),"horizontal"===e.testPerformance&&e.setTimeout(()=>{let r=performance.now(),n=5,s=1,i=e.setInterval(()=>{if(n+=5,e.scrollLeft+=(10+Math.floor(n))*s,1===s&&e.scrollLeft>5500&&(s=-1,n=5),-1===s&&e.scrollLeft<=0){let n=1e3/((performance.now()-r)/t);n=Math.round(10*n)/10,clearInterval(i),console.log(e.eventPositionMode,e.eventScrollMode,n+"fps")}},0)},500)}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some(e=>this.timeAxis.isTimeSpanInAxis(e))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=I.capitalizeFirstLetter(this.scheduledEventName)),this._capitalizedEventName}set partner(e){const t=this,r=t.partneredWith||(t.partneredWith=new Fr);t._partner=e,r.includes(e)||(r.add(e),(e.partneredWith||(e.partneredWith=new Fr)).add(t),e.on({presetchange:"onPartnerPresetChange",thisObj:t}),t.on({presetchange:"onPartnerPresetChange",thisObj:e}),t.setConfig({viewPreset:e.viewPreset,timeAxis:e.timeAxis,timeAxisViewModel:e.timeAxisViewModel}),t.initScroll=Zt.createSequence(t.initScroll,()=>{t.scrollable.addPartner(e.scrollable,"x")},t))}removePartner(e){const t=this,r=t.partneredWith;r&&r.includes(e)&&(r.remove(e),e.partneredWith.remove(t),e.scrollable.removePartner(t.scrollable),e.un({presetchange:"onPartnerPresetChange",thisObj:t}),t.un({presetchange:"onPartnerPresetChange",thisObj:e}))}onPartnerPresetChange({preset:e,startDate:t,endDate:r,centerDate:n}){this._viewPresetChanging||this.viewPreset===e||this.setViewPreset(e,t,r,!1,{centerDate:n})}get partner(){return this._partner}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}get columns(){return super.columns}set columns(e){const t=this;let r,n,s,i;if(e){const s=Array.isArray(e);let o=e;s||(o=e.data),r=o&&o.length,o.forEach((e,t)=>{"timeAxis"===e.type&&(r=t,n=e)}),t.isVertical?(t._horizontalColumns=e,o=[{type:"verticalTimeAxis",locked:!0,timeline:t},o[r]],r=1):o=o.slice(),n=o[r]=Object.assign({type:"timeAxis",locked:!1,timeline:t,cellCls:t.timeCellCls,mode:t.mode},n),Eu.forEach(e=>{i=t[e],null!=i&&(n[e]=i)}),s?e=o:e.data=o}super.columns=e,e&&(s=t._timeAxisColumn=t.columns.getAt(r),t.isVertical&&(t.verticalTimeAxisColumn=t.columns.getAt(r-1)),s.relayAll(t))}get timeView(){const e=this;return e.columns&&e.isVertical?e.verticalTimeAxisColumn&&e.verticalTimeAxisColumn.view:e.timeAxisColumn&&e.timeAxisColumn.timeAxisView}set eventCls(e){const t=this;t._eventCls=e,t.eventSelector||(t.eventSelector=`.${e}-wrap`,t.unreleasedEventSelector=t.eventSelector+":not(.b-sch-released)"),t.eventInnerSelector||(t.eventInnerSelector="."+e)}get eventCls(){return this._eventCls}set timeAxisViewModel(e){const t=this,r={update:"onTimeAxisViewModelUpdate",prio:100,thisObj:t};t.partner&&!e||(e&&e.isTimeAxisViewModel?e.on(r):(e=Object.assign({mode:t._mode,snap:t.snap,forceFit:t.forceFit,timeAxis:t.timeAxis,suppressFit:t.suppressFit,listeners:r},e),e=new pu(e)),t._timeAxisViewModel=e)}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}set timeAxis(e){const t=this;t.partner&&!e||(t.timeAxisDetacher&&t.timeAxisDetacher(),e&&e.isTimeAxis||(e=ze.assign({viewPreset:t.viewPreset,autoAdjust:t.autoAdjustTimeAxis,mode:"plain",weekStartDay:t.weekStartDay},e),t.startDate&&(e.startDate=t.startDate),t.endDate&&(e.endDate=t.endDate),t.workingTime&&t.applyWorkingTime(e),e=new Zc(e)),t.timeAxisDetacher=e.on({thisObj:t,reconfigure({config:e}){t.trigger("timeAxisChange",{config:e})}}),t._timeAxis=e)}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){const t=this,r=t._workingTime;if(r){let t=null;r.fromHour>=0&&r.fromHour<24&&r.toHour>r.fromHour&&r.toHour<=24&&r.toHour-r.fromHour<24&&(t={from:r.fromHour,to:r.toHour});let n=null;r.fromDay>=0&&r.fromDay<7&&r.toDay>r.fromDay&&r.toDay<=7&&r.toDay-r.fromDay<7&&(n={from:r.fromDay,to:r.toDay}),e.include=t||n?{hour:t,day:n}:null}else e.include=null;t.isPainted&&(t.timeAxisColumn.refreshHeader(),t.features.columnLines&&t.features.columnLines.drawLines(),t.refreshWithTransition())}set startDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const r=this,n=r._timeAxis||{},{startDate:s,endDate:i,mainUnit:o}=n;if("string"==typeof e&&(e=je.parse(e)),r._timeAxis&&i){if(e){let r=i;if(t&&s){const t=je.diff(s,i,o,!0);r=je.add(e,t,o)}n.setTimeSpan(e,r)}}else r._tempStartDate=e}get startDate(){const e=this;return e._timeAxis?e._timeAxis.startDate:e._tempStartDate||new Date}set endDate(e){this.setEndDate(e)}setEndDate(e,t=!1){const r=this,n=r._timeAxis||{},{startDate:s,endDate:i,mainUnit:o}=n;if("string"==typeof e&&(e=je.parse(e)),r._timeAxis&&s){if(e){let r=s;if(t&&i){const t=je.diff(s,i,o,!0);r=je.add(e,-t,o)}n.setTimeSpan(r,e)}}else r._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||je.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}get features(){return super.features}set features(e){"regionResize"in(e=!0===e?{}:e)||(e.regionResize=!0),super.features=e}get eventStyle(){return this._eventStyle}set eventStyle(e){const t=this;t._eventStyle=e,t.isPainted&&t.refreshWithTransition()}get eventColor(){return this._eventColor}set eventColor(e){const t=this;t._eventColor=e,t.isPainted&&t.refreshWithTransition()}onLocaleChange(){super.onLocaleChange(),this.timeAxisColumn.refreshHeader()}onInternalResize(e,t,r,n,s){const i=this._bodyRectangle;super.onInternalResize(e,t,r,n,s),i&&r!==s&&this.onSchedulerViewportResize(i.width,this.bodyContainer.offsetHeight,i.width,i.height)}onTimeAxisSubGridResize({width:e,height:t,oldWidth:r,oldHeight:n}){if(this.isPainted&&e!==r){const t=this._bodyRectangle;this.onSchedulerViewportResize(e,t.height,r,t.height)}}onSchedulerViewportResize(e,t,r,n){if(this.isPainted){const s=this,i=s.timeAxisSubGrid;s.currentOrientation.onViewportResize(e,t,r,n),null!=s._lastOverflow&&s._lastOverflow!==i.overflowingHorizontally||(s.setTimeout(()=>{s.timeAxisViewModel.availableSpace=s.isHorizontal?i.width:i.height},0),s.partneredWith&&!s.isSyncingFromPartner&&s.partneredWith.forEach(e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,s.eachSubGrid(t=>{const r=e.subGrids[t.region];r.width!==t.width&&(t.collapsed?r.collapse():(r.collapsed&&r.expand(),t.flex?t.flex!==r.flex&&(r.flex=t.flex):r.width=t.width))}),e.isSyncingFromPartner=!1)})),s.trigger("timelineViewportResize",{width:e,height:t,oldWidth:r,oldHeight:n}),s._lastOverflow=i.overflowingHorizontally}}onTimeAxisViewModelUpdate(){this.updateCanvasSize(),this.isHorizontal&&(this.callEachSubGrid("refreshFakeScroll"),this.refreshVirtualScrollbars()),this.currentOrientation.onTimeAxisViewModelUpdate()}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id",K.generateId("svg")),t.retainElement=!0,e.foregroundCanvas.appendChild(t),e.trigger("svgCanvasCreated")}return e._svgCanvas}get timeAxisSubGridElement(){return this.timeAxisColumn&&this.timeAxisColumn.subGridElement}updateCanvasSize(){const e=this;e.isHorizontal?(e.backgroundCanvas&&(e.backgroundCanvas.style.width=e.timeAxisViewModel.totalSize+"px"),e.foregroundCanvas.style.width=e.timeAxisViewModel.totalSize+"px"):(e.backgroundCanvas&&(e.backgroundCanvas.style.width=Et.setLength(e.timeAxisColumn.width)),e.foregroundCanvas.style.width=Et.setLength(e.timeAxisColumn.width))}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}refresh(e=!0,t=null){const r=this;r.isPainted&&!r.refreshSuspended&&(r.hasVisibleEvents?(r.refreshRows(!1,e),t&&t()):r.rowManager.trigger("refresh"))}render(){const e=this,t=e.timeAxisSubGridElement;e.useBackgroundCanvas&&(e._backgroundCanvas=Et.createElement({className:"b-sch-background-canvas",parent:t,nextSibling:t.firstElementChild}));const r=e._foregroundCanvas=Et.createElement({className:"b-sch-foreground-canvas",style:`font-size:${e.rowHeight-2*e.resourceMargin}px`,parent:t});e.timeAxisSubGrid.insertRowsBefore=r,super.render(...arguments)}refreshRows(e=!1,t=!0){this.isConfiguring||(this.currentOrientation.refreshRows(t),super.refreshRows(e))}getDateConstraints(){}runWithTransition(e,t){const r=this;r.isVisible&&(null!=t&&!0!==t||(t=r.transitionDuration),t&&r.enableEventAnimations&&(r.isAnimating=!0,xu.delay=t,r.setTimeout(xu))),e()}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}refreshWithTransition(e){this.runWithTransition(()=>this.refresh(e))}getVisibleDateRange(){return this.currentOrientation.getVisibleDateRange()}}A.setVersion("scheduler","3.1.8"),Tu._$name="TimelineBase";const Ru=te.mergeLocales(oc,{ResourceInfoColumn:{eventCountText:function(e){return e+" event"+(1!==e?"s":"")}},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid",Checking:"Checkingâ€¦"},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",End:"End",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit Event":"Edit event",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},Scheduler:{"Add event":"Add event","Delete event":"Delete event","Unassign event":"Unassign event"},HeaderContextMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA"},hourAndDay:{topDateFormat:"ddd MM/DD"},weekAndDay:{displayDateFormat:"hh:mm A"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:e})=>"Weekly on "+e,"Monthly on {1}":({days:e})=>"Monthly on "+e,"Yearly on {1} of {2}":({days:e,months:t})=>`Yearly on ${e} of ${t}`,"Every {0} days":({interval:e})=>`Every ${e} days`,"Every {0} weeks on {1}":({interval:e,days:t})=>`Every ${e} weeks on ${t}`,"Every {0} months on {1}":({interval:e,days:t})=>`Every ${e} months on ${t}`,"Every {0} years on {1} of {2}":({interval:e,days:t,months:r})=>`Every ${e} years on ${t} of ${r}`,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:e,days:t})=>`${e} ${t}`},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s) on:",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s) in:",Each:"Each","On the":"On the","End repeat":"End repeat","time(s)":"time(s)"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":e=>"Summary for "+e},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"}});ne.registerLocale("En",{desc:"English",locale:Ru});var Mu=e=>class extends(e||B){getElementFromAssignmentRecord(e){return this.currentOrientation.getElementFromEventRecord(e.event,e.resource)}getElementFromEventRecord(e,t){return this.currentOrientation.getElementFromEventRecord(e,t)}getElementsFromEventRecord(e,t){return this.currentOrientation.getElementsFromEventRecord(e,t)}getEventIdFromDomNodeId(e){const t=e.substring(this.eventPrefix.length).split("-")[0];return t&&t.replace(/\._\./g,"-")}getEventRecordFromDomId(e){return e=this.getEventIdFromDomNodeId(e),this.eventStore.getById(e)}getResourceIdFromDomNodeId(e){const t=e.substring(this.eventPrefix.length).split("-")[1];return t&&t.replace(/\._\./g,"-")}getResourceRecordFromDomId(e){return e=this.getResourceIdFromDomNodeId(e),this.resourceStore.getById(e)}resolveResourceRecord(e,t){return this.currentOrientation.resolveRowRecord(e,t)}resolveEventRecord(e){if(e=Et.up(e,this.eventSelector)){if(e.dataset.eventId)return this.eventStore.getById(e.dataset.eventId);if(e.dataset.assignmentId)return this.assignmentStore.getById(e.dataset.assignmentId).event}return null}resolveTimeSpanRecord(e){return this.resolveEventRecord(e)}resolveAssignmentRecord(e){const{assignmentStore:t}=this.eventStore;let r=null;if(t){const n=Et.up(e,this.eventSelector),s=this.resolveEventRecord(n),i=this.resolveResourceRecord(n);s&&i&&(r=t.getAssignmentForEventAndResource(s,i))}return r}isRowVisible(e){return this.store.indexOf(e)>=0}getMilestoneLabelWidth(e){const t=this,r=t.milestoneLayoutMode;if("measure"===r){const r=t.milestoneMeasureElement||(t.milestoneMeasureElement=Et.createElement({className:"b-sch-event-wrap b-milestone-wrap b-measure",children:[{className:"b-sch-event b-milestone",html:"<label></label>"}],parent:t.foregroundCanvas}));return r.firstElementChild.firstElementChild.innerHTML=e.name,r.offsetWidth}return"estimate"===r?Math.max(e.name.length*t.milestoneCharWidth,t.milestoneMinWidth):"data"===r?Math.max(e.milestoneWidth,t.milestoneMinWidth):0}set milestoneLayoutMode(e){this._milestoneLayoutMode=e,this.element.classList["default"!==e?"add":"remove"]("b-sch-layout-milestones"),this.refresh()}get milestoneLayoutMode(){return this._milestoneLayoutMode}set milestoneAlign(e){this._milestoneAlign=e,this.refresh()}get milestoneAlign(){return this._milestoneAlign}set milestoneCharWidth(e){this._milestoneCharWidth=e,this.refresh()}get milestoneCharWidth(){return this._milestoneCharWidth}get widgetClass(){}},ku=e=>class extends(e||B){getTimeSpanMouseEventParams(e,t){return{eventRecord:this.resolveEventRecord(e),resourceRecord:this.resolveResourceRecord(e),assignmentRecord:this.resolveAssignmentRecord(e),eventElement:e,event:t}}getScheduleMouseEventParams(e,t){return{resourceRecord:this.isVertical?this.resolveResourceRecord(t):this.store.getById(e.id)}}onElementKeyDown(e){super.onElementKeyDown(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyDown",{eventRecord:t.selectedEvents})}onElementKeyUp(e){super.onElementKeyUp(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyUp",{eventRecord:t.selectedEvents})}get widgetClass(){}},Iu=e=>class extends(e||B){construct(e){const t=this;super.construct(e),t.hasFeature("eventDragCreate")&&t.on({dragcreateend:t.internalOnDragCreateEnd,thisObj:t})}internalOnDragCreateEnd({newEventRecord:e,resourceRecord:t}){const r=this;if(!r.hasFeature("eventEdit")||r.features.eventEdit.disabled){const n=t?[t]:[];!1!==r.trigger("beforeEventAdd",{eventRecord:e,resources:n,resourceRecords:n})&&(r.onEventCreated(e),r.eventStore.add(e),e.assign(t))}}get eventEditor(){return this._eventEditor}set eventEditor(e){this._eventEditor=e}get widgetClass(){}};class Fu extends B{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}getNumberOfBands(e,t){const r=this.nbrOfBandsByResource;if(r.hasOwnProperty(e.id))return r[e.id];const n=("function"==typeof t?t():t).map(e=>({start:e.startDate,end:e.endDate,event:e}));return this.applyLayout(n,e)}applyLayout(e,t){const r=e.slice(),n=this.layoutEventsInBands(r);return this.nbrOfBandsByResource[t.id]=n}}Fu._$name="HorizontalLayout";class Au extends Fu{layoutEventsInBands(e){let t=0;do{let r=0,n=e[0];for(;n;)n.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,t,n.event),e.splice(r,1),r=this.findClosestSuccessor(n,e),n=e[r];t++}while(e.length>0);return t}findClosestSuccessor(e,t){let r,n,s,i=1/0,o=e.endMs,a=0===e.event.duration;for(let e=0,l=t.length;e<l;e++)s=t[e],n=s.startMs-o,n>=0&&n<i&&(n>0||s.endMs-s.startMs>0||!a)&&(r=e,i=n);return r}}Au._$name="HorizontalLayoutStack";var Pu=e=>class extends(e||B){static get defaultConfig(){return{coordProp:"top",sizeProp:"height"}}applyLayout(e,t){const r=this,{coordProp:n,sizeProp:s}=r;let i,o,a,l;for(let c=0,d=e.length;c<d;c++){if(o=e[c],i=r.findStartSlot(e,o),a=r.getCluster(e,c),a.length>1){for(o[n]=i.start,o[s]=i.end-i.start,l=1;l<a.length-1&&a[l+1].start-o.start==0;)l++;const t=r.findStartSlot(e,a[l]);t&&t.start<.8&&(a.length=l)}const d=a.length,u=(i.end-i.start)/d;for(l=0;l<d;l++)t(a[l],l,i,u);c+=d-1}}findStartSlot(e,t){const{sizeProp:r,coordProp:n}=this,s=this.getPriorOverlappingEvents(e,t);let i;if(0===s.length)return{start:0,end:1};for(i=0;i<s.length;i++){if(0===i&&s[0][n]>0)return{start:0,end:s[0][n]};if(s[i][n]+s[i][r]<(i<s.length-1?s[i+1][n]:1))return{start:s[i][n]+s[i][r],end:i<s.length-1?s[i+1][n]:1}}return!1}getPriorOverlappingEvents(e,t){const r=t.start,n=t.end,s=[];for(let i=0,o=e.indexOf(t);i<o;i++)je.intersectSpans(r,n,e[i].start,e[i].end)&&s.push(e[i]);return s.sort(this.sortOverlappers.bind(this)),s}sortOverlappers(e,t){return e[this.coordProp]<t[this.coordProp]?-1:1}getCluster(e,t){const r=e[t];if(t>=e.length-1)return[r];const n=[r],s=e.length;let{start:i,end:o}=r,a=t+1;for(;a<s&&je.intersectSpans(i,o,e[a].start,e[a].end);)n.push(e[a]),i=je.max(i,e[a].start),o=je.min(e[a].end,o),a++;return n}};class Lu extends(Pu(Fu)){applyLayout(e){super.applyLayout(e,(e,t,r,n)=>{e.height=n,e.top=r.start+t*n}),e.forEach(e=>{Object.assign(e,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,e.top,e.height,null,e.event))})}}Lu._$name="HorizontalLayoutPack";const Ou=/-/g,_u=/dashed|colored|line/;var $u=e=>class extends(e||B){static get defaultConfig(){return{eventRenderer:null,eventRendererThisObj:null,eventPrefix:"",eventLayout:"stack",horizontalLayoutPackClass:Lu,horizontalLayoutStackClass:Au,horizontalEventSorterFn:null,eventBarTextField:"name",eventBodyTemplate:null,eventPositionMode:"translate",eventScrollMode:"move",fillTicks:!1,useInitialAnimation:!0,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:"none.png",resourceImageExtension:".jpg",resourceMargin:null,isFirstRender:!0}}get eventPrefix(){return this._eventPrefix}set eventPrefix(e){this._eventPrefix=e||this.id+"-"}get layouts(){const e=this;return e._eventLayout||(e._eventLayout={},e.horizontalLayoutPackClass&&(e._eventLayout.horizontalPack=new e.horizontalLayoutPackClass(Object.assign({scheduler:e,timeAxisViewModel:e.timeAxisViewModel,bandIndexToPxConvertFn:e.horizontal.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:e.horizontal}))),e.horizontalLayoutStackClass&&(e._eventLayout.horizontalStack=new e.horizontalLayoutStackClass(Object.assign({scheduler:e,timeAxisViewModel:e.timeAxisViewModel,bandIndexToPxConvertFn:e.horizontal.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:e.horizontal})))),e._eventLayout}get eventLayout(){return this._overlapMode}set eventLayout(e){const t=this;e!=t._overlapMode&&(t.element.classList.remove("b-eventlayout-"+t._overlapMode),t._overlapMode=e,t.runWithTransition(()=>{t.element.classList.add("b-eventlayout-"+t._overlapMode),t.refresh()}))}get fillTicks(){return this._fillTicks}set fillTicks(e){const t=this;e!=t._fillTicks&&(t._fillTicks=e,t.refreshWithTransition())}get currentEventLayout(){const e=this;if(!e.isHorizontal)return null;switch(e.eventLayout){case"stack":return e.layouts.horizontalStack;case"pack":return e.layouts.horizontalPack;default:return null}}get useInitialAnimation(){return this._useInitialAnimation}set useInitialAnimation(e){const t=this;t._useInitialAnimation&&t.element.classList.remove("b-initial-"+t._useInitialAnimation),t._useInitialAnimation=!0===e?"fade-in":e,e&&t.element.classList.add("b-initial-"+t._useInitialAnimation)}set isFirstRender(e){const t=this;t._isFirstRender=e,!t._firstRenderDone&&e&&(t._firstRenderDone=t.createOnFrame(()=>{t._isFirstRender=!1,t._firstRenderDone=null}))}get isFirstRender(){return this._isFirstRender}set horizontalEventSorterFn(e){this._horizontalEventSorterFn=e?(t,r)=>e(t.event,r.event):e,this.rendered&&this.refreshWithTransition()}get horizontalEventSorterFn(){return this._horizontalEventSorterFn}set resourceColumns(e){this._resourceColumns=e}get resourceColumns(){return this.timeAxisColumn&&this.timeAxisColumn.resourceColumns||this._resourceColumns}get resourceColumnWidth(){return this.resourceColumns?this.resourceColumns.columnWidth:null}getEventsToRender(e,t){return t}repaintEventsForResource(e){const t=this;if(t.isHorizontal){t.currentOrientation.cache.clearRow(e.id);const r=t.getRowFor(e);r&&r.render()}}repaintEvent(e){this.eventStore.getResourcesForEvent(e).forEach(e=>this.repaintEventsForResource(e))}generateTplData(e,t,r={viewport:!0}){const n=this,s=n.currentOrientation.getTimeSpanRenderData(e,t,r);let i="";if(s){let r=e.isResizable;s.startsOutsideView&&(!0===r?r="end":"start"===r&&(r=!1)),s.endsOutsideView&&(!0===r?r="start":"end"===r&&(r=!1));const o=e.isResourceTimeRange?new Ve:e.cls.clone(),a=e.isResourceTimeRange?e.cls.clone():new Ve;if(Object.assign(o,{[t.cls]:t.cls,[n.generatedIdCls]:e.hasGeneratedId,[n.dirtyCls]:e.isPersistable&&e.modifications,[n.committingCls]:e.isCommitting,[n.endsOutsideViewCls]:s.endsOutsideView,[n.startsOutsideViewCls]:s.startsOutsideView,"b-clipped-start":s.clippedStart,"b-clipped-end":s.clippedEnd}),Object.assign(a,{[n.eventCls+"-parent"]:t.isParent}),e.isEvent||e.isTask){Object.assign(o,{[n.eventCls]:1,"b-milestone":e.isMilestone,"b-sch-event-narrow":s.width<10,[n.fixedEventCls]:!1===e.isDraggable,["b-sch-event-resizable-"+r]:Boolean(n.features.eventResize),[n.eventSelectedCls]:n.isEventSelected(e),"b-recurring":e.isRecurring,"b-occurrence":e.isOccurrence}),s.eventId=e.id,s.id=n.getEventRenderId(e,t),"id"in e.meta.modified&&(s.oldId=n.getEventRenderId(e.meta.modified.id,t)),Object.assign(a,{[n.eventCls+"-wrap"]:1,"b-milestone-wrap":e.isMilestone});const i=e.eventStyle||t.eventStyle||n.eventStyle,l=e.eventColor||t.eventColor||n.eventColor;s.eventColor=l,s.eventStyle=i,n.assignmentStore&&e.assignments&&(s.assignment=e.assignments.find(e=>e.resourceId===t.id))}if(s.wrapperCls=a,s.cls=o,s.iconCls=new Ve(e.get(n.eventBarIconClsField)||e.iconCls),e.isResourceTimeRange?(s.style="",s.wrapperStyle=e.style||""):s.style=e.style||"",s.resource=t,s.resourceId=s.rowId,e.isEvent||e.isTask){if(n.eventRenderer){const r=n.eventRenderer.call(n.eventRendererThisObj||n,{eventRecord:e,resourceRecord:t,assignmentRecord:s.assignment,tplData:s});"string"==typeof s.cls&&(s.cls=new Ve(s.cls)),"string"==typeof s.wrapperCls&&(s.wrapperCls=new Ve(s.wrapperCls)),"string"==typeof s.iconCls&&(s.iconCls=new Ve(s.iconCls)),i=n.eventBodyTemplate&&n.eventBodyTemplate(r)||(null==r?"":String(r))}else n.eventBodyTemplate?i=n.eventBodyTemplate(e):n.eventBarTextField&&(i=e.data[n.eventBarTextField]||"");if(n.eventBodyTemplate||(e.isMilestone&&i&&(i=`<label>${i}</label>`),s.iconCls&&s.iconCls.length&&(i=`<i class="${s.iconCls}"></i>${i}`)),s.wrapperCls["b-sch-style-"+s.eventStyle]=s.eventStyle,s.eventColor&&s.eventColor.startsWith("#")){const e=_u.test(s.eventStyle)?"border-color":"background-color";if(s.style=`${e}:${s.eventColor};`+s.style,"colored"===s.eventStyle){const e=s.eventColor+(4===s.eventColor.length?"4":"44");s.style=`background-color:${e};`+s.style}}else s.wrapperCls["b-sch-color-"+s.eventColor]=s.eventColor}s.cls["b-sch-event-withicon"]=s.iconCls.length,i.includes("<")?s.body=Et.createElementFromTemplate(i,{fragment:!0}):(s.body=document.createDocumentFragment(),s.body.textContent=i),s.eventContent=i,n.onEventDataGenerated(s)}return s}onEventDataGenerated(e){}getEventRenderId(e,t){const r=(e instanceof jc?e.id:e).toString().replace(Ou,"._."),n=(t instanceof nd?t.id:t).toString().replace(Ou,"._.");return this.eventPrefix+`${r}-${n}-x`}restartInitialAnimation(e){this.useInitialAnimation=e,this._firstRenderDone=null,this.isFirstRender=!0,this.refresh()}get widgetClass(){}};const ju=Math.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Hu={add:1,update:1,remove:1,filter:1};var Nu=e=>class extends(e||B){static get defaultConfig(){return{events:null,eventStore:null,resources:null,resourceStore:null,assignments:null,assignmentStore:null,dependencies:null,dependencyStore:null,timeRanges:null,resourceTimeRanges:null,store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:!1,removeUnassignedEvent:!0}}onStoreDataChange({source:e,action:t}){this.currentOrientation.clearEvents(),super.onStoreDataChange(...arguments),"dataset"===t&&this.calculateAllRowHeights()}refreshFromRowOnStoreAdd(e,{isExpand:t}){const r=arguments;this.runWithTransition(()=>super.refreshFromRowOnStoreAdd(e,...r),!t)}onStoreAdd({source:e,records:t,isChild:r,isExpandAll:n}){const s=this,{rowManager:i}=s;if(n||r&&!t[0].ancestorsExpanded(e))return;i.calculateRowCount(!1,!0,!0);const o=Math.max(i.topIndex+i.rowCount,Math.min(i.visibleRowCount,e.count));t=t.sort((t,r)=>e.indexOf(t)-e.indexOf(r));let a=e.indexOf(t[0]);if(a<o){a=Math.max(a,i.topIndex);for(let t=a;t<o;t++)s.currentOrientation.onRowRecordUpdate({record:e.getAt(t)})}else i.estimateTotalHeight();super.onStoreAdd(...arguments)}onStoreUpdateRecord(){this.currentOrientation.onRowRecordUpdate(...arguments),super.onStoreUpdateRecord(...arguments)}onStoreRemove(){this.currentOrientation.onRowRecordRemove(...arguments),super.onStoreRemove(...arguments)}onStoreRemoveAll(){this.currentOrientation.clearEvents(),super.onStoreRemoveAll()}doDestroy(){super.doDestroy();const e=this;e.destroyStores&&e.constructor.destroy(e.assignmentStore,e.resourceStore,e.dependencyStore,e.eventStore)}get store(){const e=this;return e._thisIsAUsedExpression(e.resources),!e._store&&e.isVertical&&(e._store=new Cs({data:[{id:"verticalTimeAxisRow"}]})),super.store}set store(e){super.store=e}get resources(){const e=this.resourceStore;return e&&e.records}set resources(e){this.resourceStore.data=e}get resourceStore(){const e=this;return e._resourceStore||e.crudManager&&e.crudManager.resourceStore||(e.resourceStore=new sd),e._resourceStore}set resourceStore(e){const t=this,r=t._resourceStore;if(e!==r){if(e instanceof sd||(e=new sd(e)),r){const n=r===t.store;t._resourceStore=e,e&&t.isHorizontal&&(n?(t.store=t.resourceStore,t.store.metaMapId=t.id):t.refresh())}else t._resourceStore=e;e&&(t.isVertical&&e.on({load:()=>t.unmaskBody(),thisObj:t}),t.trigger("resourceStoreChange",{newResourceStore:e,oldResourceStore:r})),t.isHorizontal&&!t._store&&(t.store=e)}}getResourceStoreListenerConfig(){return{}}get events(){return this._eventStore.records}set events(e){this.eventStore.data=e}get eventStore(){const e=this;return e._eventStore||e.crudManager&&e.crudManager.eventStore||(e.eventStore=new Yc({resourceStore:e.resourceStore})),this._eventStore}set eventStore(e){const t=this,r=t._eventStore;let n=!1;if(e===r)return;const s=t.resourceStore;if(r){const r=t.eventStore,{assignmentStore:n,dependencyStore:i}=t;if(e===r)return;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,t.timeAxisViewModel.eventStore=e,e&&(s&&!e.resourceStore&&(e.resourceStore=s),n&&!e.assignmentStore&&(e.assignmentStore=n),i&&!e.dependencyStore&&(e.dependencyStore=i),t.trigger("eventStoreChange",{newEventStore:e,oldEventStore:r}),t.refresh())}else{if(e.isEventStore){if(s&&e.resourceStore!==s){if(e.resourceStore)throw new Error(`eventStore ${e.id} is already linked to resourceStore ${e.resourceStore.id}`);e.resourceStore=s}}else n=e.autoLoad,e.autoLoad=!1,e=new Yc(Object.assign({resourceStore:t.resourceStore},e));t._eventStore=e}if(e){const r=this.getEventStoreListenerConfig();t.passStartEndParameters&&(r.beforeload=t.applyStartEndParameters),t.eventStoreDetacher&&t.eventStoreDetacher(),t.eventStoreDetacher=e.on(r),e.assignmentStore&&(t.assignmentStore=e.assignmentStore),n&&e.load().catch(()=>{})}t.eventStore.count>0&&(t.eventsRendered=!0)}getEventStoreListenerConfig(){return{thisObj:this,detachable:!0,change:"onInternalEventStoreChange",clearchanges:"onEventClearChanges",beforecommit:"onEventBeforeCommit",commit:"onEventCommit",beforeRemove:"onEventStoreBeforeRemove",refresh:"onEventStoreRefresh",exception:"onEventException",idchange:"onEventIdChange"}}get assignments(){return this.assignmentStore&&this.assignmentStore.records}set assignments(e){this.assignmentStore||(this.eventStore.assignmentStore=this.assignmentStore=new Jc),this.assignmentStore.data=e}get assignmentStore(){const e=this.eventStore,t=this.crudManager;return t&&t.assignmentStore||e&&e.assignmentStore}set assignmentStore(e){const t=this,r=t.assignmentStore;t.eventStore.assignmentStore!==e&&(t.eventStore.assignmentStore=e),t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),e&&(t.assignmentStoreDetacher=e.on(t.getAssignmentStoreListenerConfig()),t.trigger("assignmentStoreChange",{newAssignmentStore:e,oldAssignmentStore:r}),t.refresh())}getAssignmentStoreListenerConfig(){const e=this;return{thisObj:e,refresh:e.onAssignmentRefresh,update:e.onAssignmentUpdate,add:e.onAssignmentAdd,beforeRemove:{fn:e.onBeforeAssignmentRemove,prio:-1e3},remove:e.onAssignmentRemove,filter:e.onAssignmentFilter,removeall:e.onAssignmentRemoveAll}}get dependencyStore(){const e=this.eventStore,t=this.crudManager;return t&&t.dependencyStore||e&&e.dependencyStore||this._dependencyStore}set dependencyStore(e){const t=this;if(t.isConfigured){const r=t.dependencyStore;t.eventStore.dependencyStore=e,e&&(t.trigger("dependencyStoreChange",{newDependencyStore:e,oldDependencyStore:r}),t.refresh())}else t._dependencyStore=e}getDependencyStoreListenerConfig(){return{}}onEventIdChange(e){this.currentOrientation.onEventStoreIdChange&&this.currentOrientation.onEventStoreIdChange(e)}onInternalEventStoreChange(e){const t=this;if(t._mode)if(t.isVertical)t.currentOrientation.onEventStoreChange(e);else{const r=t.currentOrientation,n=e.source,{rowManager:s,resourceStore:i}=t,{action:o,changes:a,isCollapse:l}=e,c=e.records||(e.record?[e.record]:null),d=[];let u,h,g=new Set,m=!1;if(!t.isPainted)return void("dataset"===e.action&&this.calculateAllRowHeights(!0));if(l||"update"===o&&c.length&&c[0].meta.removingResource)return;if(!("filter"===o&&t.hasFeature("resourceTimeRanges"))&&Hu[o]&&c){if(a&&"resourceId"in a&&null!=a.resourceId.oldValue){const e=i.getById(a.resourceId.oldValue),t=e&&s.getRowFor(e);t&&(d.push(e),g.add(t))}for(h=0,u=c.length;h<u;h++)d.push(...n.getResourcesForEvent(c[h]).filter(e=>{if(e&&t.resourceStore.isAvailable(e.id)){const t=s.getRowFor(e);if(t)return g.add(t),!0}return!1}));if(d.length){if(g.size>1)g=new Set([...g].sort((e,t)=>e.dataIndex-t.dataIndex));else if(!g.size)return}else if("filter"!==o||c.length)return void s.estimateTotalHeight();e.resources=d}switch(o){case"dataset":r.onEventDataset();break;case"add":r.onEventAdd(e),m=!0;break;case"update":r.onEventUpdate(e),m=!0;break;case"remove":r.onEventRemove(e),m=!0;break;case"removeall":r.onEventRemoveAll(),m=!0;break;case"filter":r.onEventFilter(e),g.clear(),m=!0;break;case"clearchanges":r.onEventClearChanges(e)}t.runWithTransition(()=>{g.size?s.renderRows(g):s.renderFromRow()},m)}}onEventStoreRefresh({action:e}){"batch"===e&&this.rowManager.rowCount&&(this.currentOrientation.onEventDataset&&this.currentOrientation.onEventDataset(),this.refresh())}onEventStoreBeforeRemove({records:e}){const t=this;if(t.activeEvent&&e.includes(t.activeEvent)){let r;if("key"===Yr.lastInteractionType)for(let n=0,s=e.length;n<s&&(!r||e.includes(r));n++)if(t.eventStore.getResourcesForEvent(e[n]).length){const s=e[n],i=s.assignments&&s.assignments.length?s.assignments[0]:s;r=t.getNext(i,!0)||t.getPrevious(i,!0)}r?t.navigateTo(r):Et.focusWithoutScrolling(t.focusElement)}}onEventCommit({changes:e}){let t=[...e.added,...e.modified].map(e=>this.eventStore.getResourcesForEvent(e));t=Array.prototype.concat.apply([],t),new Set(t).forEach(e=>this.repaintEventsForResource(e))}onEventBeforeCommit({changes:e}){[...e.added,...e.modified].forEach(e=>this.getElementsFromEventRecord(e).forEach(e=>e.classList.add(this.committingCls)))}onEventException({action:e}){if("commit"===e){const{changes:e}=this.eventStore;[...e.added,...e.modified,...e.removed].forEach(e=>this.repaintEvent(e))}}onEventClearChanges(){this.refresh()}onAssignmentRefresh(e){!this.isHorizontal||"dataset"!==e.action&&"batch"!==e.action||this.refresh()}onAssignmentAdd({records:e}){this.isHorizontal&&e.forEach(e=>{const t=e.resource;t&&this.repaintEventsForResource(t)})}onAssignmentUpdate({record:e,changes:t}){if(this.isHorizontal){const{rowManager:r}=this,n=this.currentOrientation.cache,s="resourceId"in t&&t.resourceId.oldValue,i=e.resourceId;let o,a=ju;null!=s&&(o=r.getRowFor(s))&&(n.clearRow(s),a=Math.min(a,o.index)),i&&(o=r.getRowFor(i))&&(n.clearRow(i),a=Math.min(a,o.index)),a!==ju&&r.renderFromRow(r.rows[a])}}onBeforeAssignmentRemove({source:e,records:t,doRemoveLastEvent:r}){if(e.isRemovingEvent)return;const n=this,s=t.reduce((e,t)=>{const r=t.event;return!r||r.placeHolder||e.includes(r)||e.push(r),e},[]);let i;if(n.activeEvent&&s.includes(n.activeEvent)){if("key"===Yr.lastInteractionType)for(let e=0,r=t.length;e<r&&(!i||t.includes(i));e++)if(n.eventStore.getResourcesForEvent(t[e].event).length){const r=t[e],s=r.assignments&&r.assignments.length?r.assignments[0]:r;i=n.getNext(s)||n.getPrevious(s)}i?n.navigateTo(i):Et.focusWithoutScrolling(n.focusElement)}if(n.removeUnassignedEvent&&!n.isRemoving&&!1!==r&&(!e.stm||!e.stm.isRestoring)){const e=s.reduce((e,r)=>{let n=r.assignments?r.assignments.length:0;return n-=t.filter(e=>e.event===r).length,n||e.push(r),e},[]);n.eventStore.remove(e)}}onAssignmentRemove({records:e}){this.isHorizontal&&e.forEach(e=>{const t=e.resource;t&&this.repaintEventsForResource(t)})}onAssignmentRemoveAll(){this.isHorizontal&&this.refresh()}onAssignmentFilter(){this.isHorizontal&&this.refresh()}applyStartEndParameters({source:e,params:t}){const r=e.modelClass.fieldMap.startDate.dateFormat;t[this.startParamName]=je.format(this.startDate,r),t[this.endParamName]=je.format(this.endDate,r)}get widgetClass(){}};const Bu=new Promise(e=>e()),zu={block:"nearest",edgeOffset:20},Vu={highlight:!1,focus:!1};var Wu=e=>class extends(e||B){scrollEventIntoView(e,t=zu){const r=e.resources||[e];if(r.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");return r.length?this.scrollResourceEventIntoView(r[0],e,null,t):(console.warn("You have asked to scroll to an event which is not assigned to a resource"),Bu)}scrollResourceEventIntoView(e,t,r,n=zu){const s=this,i=t.startDate,o=t.endDate,a=i<s.timeAxis.startDate|(o>s.timeAxis.endDate)<<1;let l;if(null==n.edgeOffset&&(n.edgeOffset=20),a&&!1!==n.extendTimeAxis){let e,r,n=s.timeAxis.endDate-s.timeAxis.startDate;3===a?s.timeAxis.setTimeSpan(new Date(i.valueOf()-n/2),new Date(o.getTime()+n/2)):(e=1&a?s.getCoordinateFromDate(t.endDate):s.getCoordinateFromDate(t.startDate),1&a?s.timeAxis.setTimeSpan(new Date(i),new Date(i.valueOf()+n)):s.timeAxis.setTimeSpan(new Date(o.valueOf()-n),new Date(o)),r=1&a?s.getCoordinateFromDate(t.endDate):s.getCoordinateFromDate(t.startDate),s.timeAxisSubGrid.scrollable.scrollBy(r-e))}if(l=s.getElementFromEventRecord(t,e),l){Et.isFocusable(l)||(l=l.parentNode);const e=s.timeAxisSubGrid.scrollable;return s.timeAxisSubGrid.forceScrollUpdate=!0,e.scrollIntoView(l,n)}return a&&!1===n.extendTimeAxis?(console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"),Bu):s.eventStore.isAvailable(t)?s.scrollUnrenderedEventIntoView(e,t,n):(console.warn("You have asked to scroll to an event which is not available"),Bu)}scrollUnrenderedEventIntoView(e,t,r=zu){return new Promise(n=>{const s=Object.assign({edgeOffset:20},r,Vu),i=this.timeAxisSubGrid.scrollable,o=this.getResourceEventBox(t,e),a=i.viewport;if(!a)return void n();const l=new Xt(o.start,o.top,o.end-o.start,o.bottom-o.top).translate(a.x-i.x,a.y-i.y),c=i.getDeltaTo(l,s)[this.isHorizontal?"xDelta":"yDelta"],d=({scheduler:e,eventRecord:s,resourceRecord:o,element:a,targetElement:l})=>{if(s===t){const e=a||l;u(),h.then(()=>{c>0&&i.scrollIntoView(e,{edgeOffset:r.edgeOffset}),r.highlight&&Et.highlight(e),r.focus&&e.focus(),n()})}},u=this.on({renderEvent:d,eventrepaint:d,eventpaint:d}),h=i.scrollIntoView(l,s)})}scrollResourceIntoView(e,t=zu){return this.isVertical?this.currentOrientation.scrollResourceIntoView(e,t):this.scrollRowIntoView(e,t)}get widgetClass(){}},Gu=e=>class extends(e||B){getScheduleRegion(e,t,r=!0){return this.currentOrientation.getScheduleRegion(e,t,r)}getResourceRegion(e,t,r){return this.currentOrientation.getRowRegion(e,t,r)}getResourceEventBox(e,t,r=!1){const n=this,s=n.currentOrientation.getResourceEventBox(e.id,t.id);if(s)return s;const i=n.timeAxis.startDate,o=n.timeAxis.endDate,a=e.startDate,l=e.endDate;let c,d,u,h,g,m,p,f,v,y=null;if(a&&l&&(r||je.intersectSpans(a,l,i,o))&&this.isRowVisible(t)){if(h=n.getRowFor(t),h)n.managedEventSizing?(c=n.currentEventLayout,d=n.eventStore.getEventsForResource(t).reduce((e,s)=>{const i=n[n.mode].getTimeSpanRenderData(s,t,r);return i&&e.push(i),e},[]),c&&c.applyLayout(d,t),u=d.find(t=>t.event==e),u&&(g=n.getRecordCoords(t,!0).y,y={layout:!0,start:u.hasOwnProperty("left")?u.left:u.right,end:(u.hasOwnProperty("left")?u.left:u.right)+u.width,top:g+u.top,bottom:g+u.top+u.height})):(m=n.getElementsFromEventRecord(e,e!==t&&t),m.length&&(p=m[0],f=p.getOffsetsTo(n.getEl()),v=p.getBox(),y={layout:!0,start:f[0],end:f[0]+v.width,top:f[1],bottom:f[1]+v.height}));else{y={layout:!1,start:n.getCoordinateFromDate(Math.max(e.startDateMS,n.timeAxis.startMS)),end:n.getCoordinateFromDate(Math.min(e.endDateMS,n.timeAxis.endMS))};const r=n.rowManager.getRecordCoords(t,!0);y.top=r.y+n.barMargin,y.height=Math.max(n.rowManager.rowHeight-2*n.barMargin,1),y.bottom=y.top+y.height}y&&(y=n.adjustItemBox(e,y))}return y}getItemBox(e,t=!1){return e.resources.map(r=>this.getResourceEventBox(e,r,t))}adjustItemBox(e,t){const r=this.timeAxis.startMS,n=this.timeAxis.endMS,s=e.startDateMS,i=e.endDateMS,o=this.timeAxisViewModel.totalSize;return r>s&&(t.start=-40),r>i&&(t.end=-40),n<s&&(t.start=o+40),n<i&&(t.end=o+40),t}get widgetClass(){}};const Uu=["eventLayout","barMargin","mode","eventColor","eventStyle","fillTicks"];var Yu=e=>class extends(e||B){getState(){const e=ze.copyProperties(super.getState(),this,Uu);return e.zoomLevel=this.zoomLevel,e.zoomLevelOptions={startDate:this.startDate,endDate:this.endDate,viewportCenterDate:this.viewportCenterDate,width:this.tickSize},e}applyState(e){e.zoomLevel&&this.zoomToLevel(e.zoomLevel,e.zoomLevelOptions),ze.copyProperties(this,e,Uu),super.applyState(e)}get widgetClass(){}},qu=e=>class extends(e||B){static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected",selectedCollection:{}}}afterConstruct(){super.afterConstruct(),this.navigator.on({navigate:"onEventNavigate",thisObj:this})}set selectedCollection(e){e instanceof Fr||(e=new Fr(e)),this._selectedCollection=e,e.on({change:"onSelectedCollectionChange",thisObj:this})}get selectedCollection(){return this._selectedCollection}get selectedEvents(){return this.selectedCollection.values}set selectedEvents(e){this.selectedCollection.splice(0,this.selectedCollection.count,e||[])}isEventSelected(e){return this.selectedCollection.includes(e)}selectEvent(e,t=!1){this.isEventSelected(e)||(t?this.selectedCollection.add(e):this.selectedEvents=e)}deselectEvent(e,t=!1){this.isEventSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e){this.selectedCollection.add(e)}deselectEvents(e){this.selectedCollection.remove(e)}clearEventSelection(){this.selectedEvents=[]}onSelectedCollectionChange({added:e,removed:t}){const r=this,n=r.selectedEvents,s=e||[],i=t||[];function o(e,t){const n=e.isTask?e:e.resource,s=e.isAssignment?e.event:e;if(s){const i=r.getElementFromEventRecord(s,n);r.currentOrientation.toggleCls(s,n,r.eventSelectedCls,t),e.isAssignment&&r.getElementsFromEventRecord(s).forEach(e=>{e!==i&&e.classList[t?"add":"remove"](r.eventAssignHighlightCls)})}}s.forEach(e=>o(e,!0)),i.forEach(e=>o(e,!1)),r.silent||r.trigger("eventSelectionChange",{action:n.length>0?s.length>0&&i.length>0?"update":s.length>0?"select":"deselect":"clear",selection:n,selected:s,deselected:i})}onInternalEventStoreChange({action:e,records:t,source:r}){super.onInternalEventStoreChange(...arguments);const n=this;n.silent=!n.triggerSelectionChangeOnRemove,"remove"===e?n.deselectEvents(t):"dataset"===e&&(n.maintainSelectionOnDatasetChange?n.selectedEvents=n.selectedEvents.filter(e=>r.includes(e)):n.clearEventSelection()),n.silent=!1}onAssignmentRemove({records:e}){super.onAssignmentRemove(...arguments);this.silent=!this.triggerSelectionChangeOnRemove,this.deselectEvents(e),this.silent=!1}onEventSelectionClick(e,t){const r=this;r.isEventSelected(t)?e.ctrlKey&&r.deselectEvent(t,r.multiEventSelect):r.selectEvent(t,e.ctrlKey&&r.multiEventSelect)}onEventNavigate({event:e,item:t}){if(!this.eventSelectionDisabled){const r=this,n=t&&(1===t.nodeType?r.assignmentStore?r.resolveAssignmentRecord(t):r.resolveEventRecord(t):t);n?r.onEventSelectionClick(e,n):r.clearEventSelection()}}get widgetClass(){}};const Xu=(e,t)=>e.startDate-t.startDate,Ku=e=>e.preventDefault();var Zu=e=>class extends(br(e||B)){static get defaultConfig(){return{navigator:null,focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}}construct(e){const t=this;t.isInTimeAxis=t.isInTimeAxis.bind(t),super.construct(e);const r=t.onDeleteKey=t.throttle(t.onDeleteKey,t.onDeleteKeyBuffer,t),n=ze.merge({ownerCmp:t,target:t.timeAxisSubGridElement,processEvent:t.processEvent,itemSelector:`.${t.eventCls}-wrap`,focusCls:t.focusCls,navigatePrevious:t.throttle(t.navigatePrevious,t.navigatePreviousBuffer,t,null,Ku),navigateNext:t.throttle(t.navigateNext,t.navigateNextBuffer,t,null,Ku),allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:r,Backspace:r}},t.navigator);t.navigator=new Ts(n)}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(e){return!e.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(e)}accessibleFocusCell(e,t){if((e=this.normalizeCellContext(e)).columnId!==this.timeAxisColumn.id)return super.focusCell(e,t)}getPrevious(e,t){const r=this,n=r.resourceStore,s=e.isAssignment;if(e.isTask)return r.eventStore.getAt(r.eventStore.indexOf(e)-1);let i=e.resource||r.eventStore.getResourcesForEvent(e)[0],o=i.getEvents().filter(r.isInTimeAxis).sort(Xu),a=s?e.event:e,l=o[o.indexOf(a)-1];if(!l)for(let e=n.indexOf(i)-1;(!l||t&&l===a)&&e>=0;e--){i=n.getAt(e);let t=i.getEvents().filter(r.isInTimeAxis).sort(Xu);l=t.length&&t[t.length-1]}return s?r.assignmentStore.getAssignmentForEventAndResource(l,i):l}navigatePrevious(e){const t=this,r=t.getPrevious(e.assignmentRecord||e.eventRecord);e.preventDefault(),r&&(e.ctrlKey||t.clearEventSelection(),t.navigateTo(r,e))}getNext(e,t){const r=this,n=r.resourceStore,s=e.isAssignment;if(e.isTask)return r.eventStore.getAt(r.eventStore.indexOf(e)+1);let i=s?e.resource:e.resources[0],o=i.getEvents().filter(r.isInTimeAxis).sort(Xu),a=s?e.event:e,l=o[o.indexOf(a)+1];if(!l)for(let e=n.indexOf(i)+1;(!l||t&&l===a)&&e<n.count;e++)i=n.getAt(e),l=i.getEvents().filter(r.isInTimeAxis).sort(Xu)[0];return s?r.assignmentStore.getAssignmentForEventAndResource(l,i):l}navigateNext(e){const t=this,r=t.getNext(e.assignmentRecord||e.eventRecord);e.preventDefault(),r&&(e.ctrlKey||t.clearEventSelection(),t.navigateTo(r,e))}navigateTo(e,t={}){const r=this;if(e){r.navigator.disabled=!0;const n=e.resource;r.scrollResourceEventIntoView(n,e.isAssignment?e.event:e,null,{animate:100}).then(()=>{r.isDestroyed||(r.navigator.disabled=!1,r.activeEvent=e,r.navigator.trigger("navigate",{event:t,item:Et.up(r.getElementFromEventRecord(e,n),r.navigator.itemSelector)}))})}}set activeEvent(e){const t=this.getElementFromEventRecord(e.isAssignment?e.event:e,e.resource);this.navigator.activeItem=t.parentNode}get activeEvent(){const{activeItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}get previousActiveEvent(){const{previousActiveItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}processEvent(e){const t=this,r=Et.up(e.target,t.eventSelector);return!t.navigator.disabled&&r&&(e.assignmentRecord=t.resolveAssignmentRecord(r),e.eventRecord=t.resolveEventRecord(r),e.resourceRecord=t.resolveResourceRecord(r)),e}onDeleteKey(e){const t=e.assignmentRecord||e.eventRecord;!this.readOnly&&this.enableDeleteKey&&t&&this.removeRecords([t])}removeRecords(e,t=null){if(!this.readOnly&&e.length){const r={finalize(r=!0){t&&t(r),!1!==r&&e.forEach(e=>e.remove())}};if(!1!==this.trigger("beforeEventDelete",{eventRecords:e,context:r}))return r.finalize(),!0}return!1}onEventSpaceKey(e){}onEventEnterKey(e){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}get widgetClass(){}};const Ju={},Qu=document.createRange();function eh(e){return!(e.classList.contains("b-dragging")||e.classList.contains("b-resizing"))}class th extends(br(B)){construct(e){const t=this;t.view=e,t.innerElCls=""+e.eventCls,t.availableDivs=new an,t.reservedIds={},t.divCount=0}init(){const e=this;e.view.rowManager.on({beforetranslaterow:e.onBeforeTranslateRow,translaterow:e.onTranslateRow,beforerowheight:e.onBeforeRowHeightChange,thisObj:e}),e.view.on({beforetogglenode:e.onBeforeToggleNode,beforetoggleallnodes:e.onBeforeToggleAllNodes,thisObj:e})}get column(){return this.view.timeAxisColumn}get timeAxis(){return this.view.timeAxis}get timeAxisViewModel(){return this.view.timeAxisViewModel}translateToPageCoordinate(e){const t=this.column.subGridElement;return e+t.getBoundingClientRect().left-t.scrollLeft}refreshRows(e){e&&(this.cache.clear(this.refreshFromRerender),this.view.refreshFromRerender=!1)}onDragAbort(e){this.view.currentOrientation.availableDivs.includes(e.element)&&e.element.classList.add("b-sch-released")}onLocaleChange(){this.cache.clear()}calculateMS(e){throw new Error("Implement in subclass")}getTimeSpanRenderData(e,t,r=!1){const n=this,{timeAxis:s}=n,i=!0===r||r.timeAxis,o=!0===r||r.viewport;if(i||s.isTimeSpanInAxis(e)){const r=n.view,i=r.getRowById(t);if(i||o){const a=r.scrollable.y,l=Math.max(a-50,0),c=Math.min(a+r._bodyRectangle.height+50,r.virtualScrollHeight);if(o||i.top<c&&i.top+(i.height||i.lastHeight)>=l){const o=n.timeAxisViewModel.getSingleUnitInPixels("minute"),a=e.startDate,l=e.endDate||a,c=s.startMS,d=s.endMS,{startMS:u,endMS:h,durationMS:g}=n.calculateMS(e),m=u<c|(u>d)<<1,p=h>d|(h<=c)<<1,f=g/6e4,v=p?o*f:null;let y,b=r.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!0}),C=!1,w=!1;if(m?y=(u-c)/6e4*o:(y=r.getCoordinateFromDate(u,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:-1!==b}),C=-1===y),p?b=y+v:w=-1===b,w&&!C&&(b=r.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),v>9999999&&(1===m?1===p?(y=-100,b=r.timeAxisColumn.width+100):y=b-9999999:1===p&&(b=y+9999999)),C&&w&&(y=r.getCoordinateFromDate(u,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:h}),b=r.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:u}),y===b))return e.instanceMeta(r).excluded=!0,null;const S={[n.view.scheduledEventName]:e,left:Math.min(y,b),width:Math.abs(b-y),start:a,end:l,startMs:u,endMs:h,rowId:t.id,startsOutsideView:m,endsOutsideView:p,clippedStart:C,clippedEnd:w,row:i};return n.view.fillTicks&&(S.dataStartMs=S.start.getTime(),S.dataEndMs=S.end.getTime()),S.top=Math.max(0,r.resourceMargin),r.managedEventSizing&&(S.height=Math.max(r.rowManager.rowHeight-2*r.resourceMargin,1)),S}}}}onTranslateRow({source:e}){}onBeforeRowHeightChange(e){const t=this.view,r=e?e.height:t.rowHeight;this.cache.clear(),t.foregroundCanvas&&(t.element.classList.add("b-notransition"),t.foregroundCanvas.style.fontSize=r-2*t.resourceMargin+"px",this._thisIsAUsedExpression(window.getComputedStyle(t.foregroundCanvas).fontSize),t.element.classList.remove("b-notransition")),t.milestoneWidth=null}onBeforeTranslateRow({row:e}){this.cache.clearRow(e.id)}onViewportResize(){this.lastUpdateScrollPos=null,this.update()}positionTimeSpan(e,t,r){switch(this.view.eventPositionMode||"translate"){case"position":return e.style.left=t+"px",void(e.style.top=r+"px");case"translate":return void(e.style.transform=`translate(${t}px,${r}px)`);case"translate3d":e.style.transform=`translate3d(${t}px,${r}px,0)`}}getTimeSpanDiv(e){const{availableDivs:t}=this,{id:r,oldId:n}=e;if("move"===this.view.eventScrollMode){let e;return r&&(e=t.get(r)||t.get(n)),e&&!eh(e)&&(e=null),e||(e=t.find(eh)),e&&(t.remove(e),e.classList.remove("b-sch-released")),e}return null}releaseTimeSpanDiv(e,t=!1){const r=this,n=e.style;t||e!==document.activeElement||r.view.focusElement.focus(),"move"===r.view.eventScrollMode?(r.availableDivs.add(e),!t&&eh(e)&&e.classList.add("b-sch-released")):t||(n.opacity=0,n.pointerEvents="none",r.setTimeout(()=>{e.remove(),n.opacity=1,n.pointerEvents=""},200))}updateElementId(e,t){const{availableDivs:r}=this;r.includes(e)&&(r.changeId(e,t),r.items.delete(e),r.items.add(e))}triggerPaint(e,t){throw new Error("Implement in subclass")}addTemporaryDragElement(e){const{scheduler:t}=this,r=t.generateTplData(e,e.resource,{timeAxis:!0,viewport:!0});r.top=r.row?r.top+r.row.top:t.getResourceEventBox(e,e.resource,!0).top;const n=this.renderTimeSpan(r,{},null,!0);return this.scheduler.currentOrientation.availableDivs.add(n),n}renderTimeSpan(e,t,r,n=!1){const s=this,i=s.view,{cls:o,id:a}=e;let l,c=t&&t.div,d=!1,u=!1,h=!1;n||c||!(c=s.getTimeSpanDiv(e))||(d=c.id!==a);const g=c&&c.classList.contains("b-sch-dragcreator-proxy");if(!c||d)d?(l=c.innerElement||c.firstElementChild,l.innerHTML="",l.style.cssText="",l.nextSibling&&(Qu.setStartAfter(l),Qu.setEndAfter(c.lastChild),Qu.deleteContents())):([c,l]=Et.createElement({tabIndex:0,children:[{className:""+s.innerElCls}]},!0),c.innerElement=l),c.id=a,e[i.scheduledEventName+"Id"]&&(c.dataset[i.scheduledEventName+"Id"]=e[i.scheduledEventName+"Id"]),Et.syncClassList(c,e.wrapperCls),c.parentNode!==i.foregroundCanvas&&i.foregroundCanvas.appendChild(c),Et.syncClassList(l,o),(e.style||e.internalStyle)&&(l.style.cssText=(e.internalStyle||"")+(e.style||"")),e.body&&l.appendChild(e.body.cloneNode(!0)),c.style.cssText=`width:${e.width}px;height:${e.height}px;${e.wrapperStyle||""}`,s.positionTimeSpan(c,e.left,e.top),u=!0;else{const n=r&&t.div?r:Ju;if(l=c.querySelector("."+s.innerElCls)||c.firstElementChild,Et.syncClassList(c,e.wrapperCls),Et.syncClassList(l,e.cls),e.style?l.style.cssText=e.style:l.style.cssText="",e.body){const t=l.innerHTML,r=l.featureEls;r&&r.forEach(t=>e.body.appendChild(t)),l.innerHTML="",l.appendChild(e.body.cloneNode(!0)),u=l.innerHTML!==t}document.activeElement&&document.activeElement.id===e.id&&c.classList.add(i.focusCls),h=!0,e.wrapperStyle&&(c.style.cssText+=e.wrapperStyle),(n.left!==e.left||n.top!==e.top||e.style)&&(s.positionTimeSpan(c,e.left,e.top),u=!0),(n.width!==e.width||e.style)&&(c.style.width=e.width+"px",u=!0),(n.height!==e.height||e.style)&&(c.style.height=e.height+"px",u=!0)}return t.div=c,t.eventEl=l,u&&(h&&g&&(h=!1,c.classList.remove("b-sch-dragcreator-proxy")),s.triggerPaint(e,c,h)),c}cacheTimeSpanElement(e,t,r){const n=this,{availableDivs:s,view:i}=n,o=i.getEventRenderId(e,t);s.includes(o)||(r?(r.id=o,i.foregroundCanvas.appendChild(r)):r=Et.createElement({id:o,tabIndex:0,children:[{className:""+n.innerElCls}]}),s.add(r))}updateRowTimeSpans(e,t,r=!1,n=!1){}renderer(e){}updateFromHorizontalScroll(e){const t=this,r=t.view,n=r.timeAxisSubGrid.width,s=r.getDateFromX(Math.max(0,e-100)),i=r.getDateFromX(e+n+100)||r.timeAxis.endDate,o=t.view.timeAxisSubGrid.scrollable.x,a=t.lastUpdateScrollPos;t.viewportStart=s&&s.getTime(),t.viewportEnd=i&&i.getTime(),(!a||Math.abs(o-a.x)>50)&&t.update(),r.timeView.range={startDate:s,endDate:i}}update(){const e=this,t=e.view;e.lastUpdateScrollPos={x:t.timeAxisSubGrid.scrollable.x,y:t.scrollable.y};for(const r of t.rowManager){const n=r.getCell(t.timeAxisColumn.id),s=ei.get(n),i=t.store.getById(s.id);i&&e.updateRowTimeSpans(s.row,i,!1,!0)}}getDateFromXY(e,t,r,n=!1){let s=e[0];return r||(s=this.translateToScheduleCoordinate(s)),this.timeAxisViewModel.getDateFromPosition(s,t,n)}translateToScheduleCoordinate(e){return e-this.column.subGridElement.getBoundingClientRect().left+this.view.scrollLeft}onBeforeToggleNode({record:e}){const t=this;if(e.children&&e.children.length){let r=t.view.store.getNext(e);for(;r&&t.view.getRowFor(r);)t.cache.clearRow(r.id),r=t.view.store.getNext(r.id)}}onBeforeToggleAllNodes(){this.cache.clear()}onRowRecordUpdate({record:e,changes:t={}}){"id"in t&&this.cache.clearRow(t.id.oldValue,!1,!0),this.cache.clearRow(e.id,!1,!0)}onRowRecordRemove({records:e}){e.forEach(e=>e.traverse(e=>this.cache.clearRow(e.id)))}getRowRegion(e,t,r){const{view:n,column:s}=this,i=n.getRowById(e.id);if(!i)return null;const o=i.getElement(s.region),a=this.timeAxis.startDate,l=this.timeAxis.endDate,c=t?je.max(a,t):a,d=r?je.min(l,r):l,u=n.getCoordinateFromDate(c),h=n.getCoordinateFromDate(d,!0,!0),g=i.top+n.verticalScroller.scrollTop,m=Math.min(u,h),p=g+o.offsetHeight;return new Xt(m,g,Math.max(u,h)-m,p-g)}getVisibleDateRange(){const e=this.view,t=e.timeAxisSubGrid.scrollable.x,r=e.timeAxisSubGrid.width;return{startDate:e.getDateFromX(t),endDate:e.getDateFromX(t+r)||e.timeAxis.endDate}}getConnectorStartSide(e){}getConnectorEndSide(e){}}th._$name="BaseHorizontalMapper";class rh{constructor(e){this.mapper=e,this.renderedEventsMap={},this.rowLayoutCache={}}clear(e=!1){const t=this;t.renderedEventsMap={},Object.keys(t.rowLayoutCache).forEach(r=>t.clearRow(r,!!e&&"immediate"))}addRenderedEvents(e,t){this.renderedEventsMap[e]=t}addRenderedEvent(e){if(e.resourceId in this.renderedEventsMap){(this.renderedEventsMap[e.resourceId]||(this.renderedEventsMap[e.resourceId]={}))[e.id]=e}}getRenderedTimeSpan(e,t){const r=this.renderedEventsMap[e];return r&&r[t]}clearRenderedTimeSpan(e,t){if(this.renderedEventsMap[e]){const r=this.renderedEventsMap[e][t];return delete this.renderedEventsMap[e][t],r}}getRenderedEvents(e){return this.renderedEventsMap[e]}clearRenderedEvents(e){this.renderedEventsMap[e]=null}getTimeSpan(e,t){const r=this.getTimeSpanCache(e,t);return r?r.layoutCache:null}getTimeSpanCache(e,t){const r=this.rowLayoutCache[t];return r&&r[e]}clearEvent(e,t,r=!1,n=!1){const s=this,i=s.getTimeSpan(e,t);if(!i)return null;i.div&&s.mapper.clearDiv(i.div,r,n),s.rowLayoutCache[t][e].layoutCache=null}getRow(e){return this.rowLayoutCache[e]}addRow(e,t){this.rowLayoutCache[e]=t}clearRow(e,t=!1,r=!1){const n=this,s=n.rowLayoutCache[e];s&&(n.renderedEventsMap[e]&&delete n.renderedEventsMap[e],Object.keys(s).forEach(s=>{"_allEvents"!==s&&"_rowHeight"!==s&&n.clearEvent(s,e,t,r)}),delete n.rowLayoutCache[e])}}rh._$name="HorizontalEventMapperCache";const nh=(e,t,r,n,s)=>{if(e.fillTicks){let e=t.getTickFromDate(r);if(e>=0){s&&e===Math.round(e)&&e>0&&e--;const r=Math.floor(e);return t.getAt(r)[s?"endDate":"startDate"].getTime()}}return n},sh=({startDateMS:e},{startDateMS:t})=>e-t;class ih extends th{construct(e){this.scheduler=e,super.construct(e),this.cache=new rh(this)}init(){super.init(),this.scheduler.on({togglegroup:this.onToggleGroup,rowremove:this.onRowRemove,prio:2,thisObj:this})}clearDiv(e,t,r){const n=this,s=e.style;!t||r?n.releaseTimeSpanDiv(e,r):"immediate"!==t&&n.scheduler.enableEventAnimations?(e.id=K.generateId("obsolete-event"),s.opacity=0,s.pointerEvents="none",n.setTimeout(()=>{e.remove(),s.opacity=1,s.pointerEvents=""},200)):e.remove()}clearAllDivs(){this.availableDivs.forEach(e=>e.remove()),this.availableDivs.clear()}clearEvents(){this.cache.clear(!0)}releaseEvent(e,t,r=!1){const n=this,s=n.cache.getRenderedTimeSpan(e,t),i=s&&n.cache.getTimeSpan(s.eventId,e);return i&&i.div&&(n.releaseTimeSpanDiv(i.div,r),i.div=i.eventEl=null),n.cache.clearRenderedTimeSpan(e,t)}getElementFromEventRecord(e,t=this.scheduler.eventStore.getResourcesForEvent(e)[0]){if(t){const r=this.cache.getRenderedEvents(t.id);if(r){const n=r[this.scheduler.getEventRenderId(e,t)],s=n&&n.layoutCache;return s&&s.eventEl}}}getElementsFromEventRecord(e,t){const r=this;return t?[r.getElementFromEventRecord(e,t)]:r.scheduler.eventStore.getResourcesForEvent(e).reduce((t,n)=>{const s=r.getElementFromEventRecord(e,n);return s&&t.push(s),t},[])}resolveRowRecord(e){const{view:t}=this,r=e instanceof Event?e.target:e,n=3===r.nodeType?r.parentElement:r,s=n.matches(t.eventSelector)&&n||Et.up(n,t.eventSelector);return s?t.getResourceRecordFromDomId(s.id):t.getRecordFromElement(n)}toggleCls(e,t,r,n=!0){if(!t)return;const s=this.cache.getTimeSpanCache(e.id,t.id),i=this.getElementFromEventRecord(e,t);s&&(s.cls[r]=n?1:0),i&&i.classList[n?"add":"remove"](r)}getResourceEventBox(e,t){const r=this.cache.getTimeSpan(e,t);if(r)return r}getScheduleRegion(e,t,r=!0){const n=this,s=n.view,i=n.column;let o;if(e){const r=t&&n.getElementsFromEventRecord(t,e)[0];if(o=Xt.from(s.getRowById(e.id).getElement("locked")),r){const e=Xt.from(r,i.subGridElement);o.y=e.y,o.bottom=e.bottom}else o.y=o.y+s.resourceMargin,o.bottom=o.bottom-s.resourceMargin}else o=Xt.from(i.subGridElement).moveTo(null,0),o.width=i.subGridElement.scrollWidth,o.y=o.y+s.resourceMargin,o.bottom=o.bottom-s.resourceMargin;const a=n.timeAxis.startDate,l=n.timeAxis.endDate,c=s.getDateConstraints(e,t)||{start:a,end:l},d=o.y,u=o.bottom;let h=s.getCoordinateFromDate(je.max(a,c.start)),g=s.getCoordinateFromDate(je.min(l,c.end));return r||(h=n.translateToPageCoordinate(h),g=n.translateToPageCoordinate(g)),{top:d,right:Math.max(h,g),bottom:u,left:Math.min(h,g)}}getResoureEventBox(e,t){return this.cache.getTimeSpan(e,t)}layoutEventVerticallyStack(e){const{resourceMargin:t,rowHeight:r,barMargin:n}=this.scheduler;return 0===e?t:t+e*(r-2*t)+e*n}layoutEventVerticallyPack(e,t){const{resourceMargin:r,rowHeight:n,barMargin:s}=this.scheduler,i=1/t,o=e*i,a=(n-2*r-(i-1)*s)*t;return{top:r+o*a+o*s,height:a}}calculateRowHeight(e){const{scheduler:t}=this;if("stack"===t.eventLayout&&t.eventStore.count){const{eventStore:r,timeAxis:n,resourceMargin:s,barMargin:i}=t,o=t.rowHeight-2*s,a=e=>r.storage.filterFunction(e)&&n.isTimeSpanInAxis(e),l=r.getEventsForResource(e).filter(a).sort(sh).map(e=>({event:e,startMs:e.startDateMS,endMs:e.endDate?e.endDateMS:e.startDateMS})),c=t.currentEventLayout.layoutEventsInBands(l);return c*o+(c-1)*i+2*s}return t.rowHeight}calculateMS(e){const t=this,r=t.view;let n=nh(r,t.timeAxis,e.startDate,e.startDateMS,!1),s=nh(r,t.timeAxis,e.endDate,e.endDateMS,!0),i=s-n;if("default"!==r.milestoneLayoutMode&&0===i){const o=t.timeAxisViewModel.getSingleUnitInPixels("minute");switch(i=60*(r.getMilestoneLabelWidth(e)*(1/o))*1e3,r.milestoneAlign){case"start":case"left":s=n+i;break;case"end":case"right":s=n,n=s-i;break;default:s=n+i/2,n=s-i}}return{startMS:n,endMS:s,durationMS:i}}layoutEvents(e,t,r){const n=this,{timeAxis:s}=n,{eventStore:i}=e,o=t.id,a=i.getEventsForResource(o),l=i.isFiltered?a.filter(e=>i.indexOf(e)>-1):a,c=(e.getEventsToRender(t,l)||[]).filter(e=>s.isTimeSpanInAxis(e)).reduce((r,s)=>{const i=e.generateTplData(s,t);return i?r.push(i):n.cache.getRenderedEvents(o)&&n.releaseEvent(o,e.getEventRenderId(s,t)),r},[]);if(!c.length)return n.cache.clearRenderedEvents(o),!1;c.sort(e.horizontalEventSorterFn||n.eventSorter);let d=e.rowHeight;const u=e.currentEventLayout,h=c.filter(e=>e.event.isEvent||e.event.isTask);if("stack"===e.eventLayout){const r=u.applyLayout(h,t),n=e.rowHeight-2*e.resourceMargin;d=r*n+(r-1)*e.barMargin+2*e.resourceMargin}else"pack"===e.eventLayout&&u.applyLayout(h,t);let g=r.top;d!==r.height&&r.estimatedTop&&(g=r.top+r.height-d);const m={_allEvents:c,_rowHeight:d};return c.forEach(e=>{const t=n.cache.getTimeSpan(e.eventId,o),r=e.top;e.top+=g,e.rowTop=g,e.fillSize&&(e.height=d),e.layoutCache={layout:!0,div:t&&t.div,eventEl:t&&t.eventEl,width:e.width,height:e.height,start:e.left,end:e.left+e.width,relativeTop:r,top:e.top,relativeBottom:r+e.height,bottom:e.top+e.height},m[e.eventId]=e}),n.cache.addRow(o,m),!0}eventSorter(e,t){const r=e.dataStartMs||e.startMs,n=e.dataEndMs||e.endMs,s=t.dataStartMs||t.startMs,i=t.dataEndMs||t.endMs;return r===s?n-i==0?e.event.name<t.event.name?-1:1:n>i?-1:1:r<s?-1:1}onTranslateRow({row:e}){this.matchRowTranslation(e)}renderEvent(e){const t=this,r=t.view.scheduledEventName+"Id",n=e[r],s=t.cache.getTimeSpan(n,e.resourceId),i=t.cache.getRenderedEvents(e.resourceId),o=e.event.instanceMeta(t.scheduler),a=t.renderTimeSpan(e,s,i[e.id],o.requireElement&&!o.fromDragProxy);e.assignment&&(a.dataset.assignmentId=e.assignment.id),n&&(a.dataset[r]=n),i[e.id]=e,o.requireElement&&(delete o.requireElement,delete o.fromDragProxy),t.scheduler.trigger("renderEvent",{eventRecord:e.event,resourceRecord:e.resource,assignmentRecord:e.assignment,element:a,tplData:e})}triggerPaint(e,t,r=!1){const{scheduler:n}=this;n.trigger(r?"eventRepaint":"eventPaint",{scheduler:n,eventRecord:e.event,resourceRecord:e.resource,element:t})}isEventInView(e){return e.startMs===e.endMs?e.startMs<=this.viewportEnd&&e.endMs>this.viewportStart:e.startMs<this.viewportEnd&&e.endMs>this.viewportStart}updateRowTimeSpans(e,t,r=!1,n=!1){const s=this,{scheduler:i,cache:o}=s,a=t.id;let l=o.getRenderedEvents(a),c=o.getRow(a);if((i.forceLayout||r||!c)&&!s.layoutEvents(i,t,e))return c&&c._rowHeight;if(c=o.getRow(a),!c)return null;const d=c._allEvents.filter(e=>e.event.instanceMeta(i).retainElement||e.assignment&&e.assignment.instanceMeta(i).retainElement||s.isEventInView(e));l||(l={},o.addRenderedEvents(a,l));for(let e=0;e<d.length;e++){const t=d[e];if(i._firstRenderDone&&i._firstRenderDone(),!n&&!t.event.instanceMeta(i).retainElement||n&&!t.layoutCache.div){i.isFirstRender&&t.top<i.bodyHeight&&i.useInitialAnimation&&(t.wrapperCls.add("b-first-render"),t.internalStyle=`animation-delay: ${t.row.index/20}s;`),s.renderEvent(t),t.wrapperCls["b-first-render"]=null}}const u=Object.keys(l);for(let e=0;e<u.length;e++){const t=u[e];d.some(e=>e.id===t)||s.releaseEvent(a,t)}return c._rowHeight}renderer(e){e.size.height=this.updateRowTimeSpans(e.row,e.record)}matchRowTranslation(e){const t=this,r=t.scheduler.store.getAt(e.dataIndex).id,n=t.cache.getRow(r),s=n&&n._allEvents.length>0&&n._allEvents[0];if(s&&s.rowTop!==e.top){const r=e.top-s.rowTop;n._allEvents.forEach(n=>{const s=n.layoutCache;s.top+=r,s.bottom+=r,s.div&&t.positionTimeSpan(s.div,s.start,s.top),n.top+=r,n.rowTop=e.top})}}onTimeAxisViewModelUpdate(){this.cache.clear(),this.updateFromHorizontalScroll(this.scheduler.timeAxisSubGrid.scrollable.x)}onRowRemove({isCollapse:e}){const{scheduler:t}=this;e||t.runWithTransition(()=>{t.rowManager.forEach(e=>this.matchRowTranslation(e))})}onToggleGroup({groupRecord:e,collapse:t}){const r=this.scheduler.store;let n=r.indexOf(e)+(t?1:e.groupChildren.length);for(t&&e.groupChildren.forEach(e=>{this.cache.clearRow(e.id)});n<r.count;n++)this.cache.clearRow(r.getAt(n).id)}onEventDataset(){this.cache.clear(!0),this.scheduler.calculateAllRowHeights()}onEventAdd({records:e,resources:t}){const r=this,{scheduler:n}=r,s=new Set;e.forEach(e=>{const{startDate:i,endDate:o}=e;if(i&&o&&r.timeAxis.timeSpanInAxis(i,o)){const i=e.resources;i&&i.some(e=>n.getRowFor(e))&&(e.instanceMeta(n).requireElement=!0),t.forEach(e=>{r.cache.clearRow(e.id,!1,!0),s.add(e)})}}),n.calculateRowHeights([...s])}onEventRemove({resources:e}){e.forEach(e=>this.cache.clearRow(e.id,!0)),this.scheduler.calculateRowHeights(e)}onEventUpdate({source:e,record:t,changes:r={},resources:n}){const s=this,{cache:i,scheduler:o}=s,a="resourceId"in r;if(a||n.length){if(a){const n=e.resourceStore.getById(r.resourceId.oldValue),a=t.resource,l=a&&e.resourceStore.isAvailable(a),c=t.resource&&Boolean(s.getTimeSpanRenderData(t,t.resource));if(o.calculateRowHeights([n,a]),n){const e=i.getTimeSpan(t.id,n.id);e&&(l?(e.div&&a&&(e.div.id=o.getEventRenderId(t,a)),i.clearRow(n.id,!1,l)):i.clearEvent(t.id,r.resourceId.oldValue,!0))}else l&&(t.instanceMeta(o).requireElement=!0);l&&i.clearRow(a.id,!1,c)}else("startDate"in r||"endDate"in r)&&o.calculateRowHeights(n);n.forEach(e=>{const r=s.getTimeSpanRenderData(t,e),n=Boolean(r&&s.isEventInView(r));i.clearRow(e.id,!1,n)})}}onEventStoreIdChange({oldValue:e,value:t}){const{view:r}=this;Et.forEachSelector(r.element,`[data-event-id="${e}"]`,e=>{e.id=r.getEventRenderId(t,r.getResourceIdFromDomNodeId(e.id))})}onEventClearChanges(){this.cache.clear()}onEventFilter(){this.cache.clear(),this.scheduler.calculateAllRowHeights()}onEventRemoveAll(){this.cache.clear(!0),this.scheduler.calculateAllRowHeights()}getConnectorStartSide(e){return"left"}getConnectorEndSide(e){return"right"}}ih._$name="HorizontalEventMapper";class oh extends(Pu()){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(e,t,r,n,s){super.applyLayout(e,(e,s,i,o)=>{if("none"===this.scheduler.eventLayout)e.width=t-2*r,e.left+=r;else{e.widthFactor=o;const a=e.leftFactor=i.start+s*o,l=Math.round(1/o),c=a/o,d=t-2*r-n*(l-1);"mixed"===this.scheduler.eventLayout&&2===l?(e.left+=a*t/5+n,e.width=t-a*t/5-2*n,e.zIndex=5+c):(e.width=o*d,e.left+=a*d+r+n*c)}})}}oh._$name="VerticalLayout";const ah={releaseElement:1,reuseElement:1},lh={newElement:1,reuseOwnElement:1,reuseElement:1};class ch extends(br(B)){static get properties(){return{eventMap:{},resourceMap:{},releasedElements:{}}}construct(e){this.scheduler=e,this.timeAxisViewModel=e.timeAxisViewModel,this.verticalLayout=new oh({scheduler:e}),super.construct({})}init(){const e=this,{scheduler:t}=e;e.resourceColumns=t.timeAxisColumn.resourceColumns,t.element.classList.add("b-sch-vertical"),t.on({assignmentstorechange:e.onChangeAssignmentStore,resourcestorechange:e.onChangeResourceStore,thisObj:e}),e.resourceColumns.on({columnWidthChange:e.onResourceColumnWidthChange,thisObj:e}),e.resourceStore=t.resourceStore,e.assignmentStore=t.assignmentStore,e.initialized=!0,t.isPainted&&e.renderer(),e.resourceColumns.availableWidth=t.timeAxisSubGrid.width}resolveRowRecord(e,t){const{scheduler:r}=this,n=e instanceof Event?e:null,s=n?n.target:e,i=n?[n.offsetX,n.offsetY]:t,o=3===s.nodeType?s.parentElement:s,a=Et.up(o,r.eventSelector);if(a)return r.resourceStore.getById(a.dataset.resourceId);if(!Et.up(s,".b-sch-timeaxis-cell"))return null;if(!i)throw new Error("Vertical mode needs coordinates to resolve this element. Can also be called with a browser \n                event instead of element to extract element and coordinates from");const l=Math.floor(i[0]/this.resourceColumns.columnWidth);return r.resourceStore.getAt(l)}getElementFromEventRecord(e,t){const r=this.getElementsFromEventRecord(e,t);return r.length?r[0]:null}getElementsFromEventRecord(e){const{syncIdMap:t}=this.scheduler.foregroundCanvas,{eventInnerSelector:r}=this.scheduler,n=e.assignments||[e],s=[];return n.forEach(e=>{t[e.id]&&s.push(t[e.id].querySelector(r))}),s}toggleCls(e,t,r,n=!0){const s=ze.getPath(this.eventMap,`${e.id}.${t.id}`);if(s){s.tplData.cls[r]=n?1:0;const i=this.getElementFromEventRecord(e,t);i&&i.classList[n?"add":"remove"](r)}}getDateFromXY(e,t,r,n=!1){let s=e[1];return r||(s=this.translateToScheduleCoordinate(s)),this.timeAxisViewModel.getDateFromPosition(s,t,n)}translateToScheduleCoordinate(e){return e-this.scheduler._bodyRectangle.y+this.scheduler.scrollTop}translateToPageCoordinate(e){return e+this.scheduler._bodyRectangle.y-this.scheduler.scrollTop}getResourceEventBox(e,t){let{tplData:r}=ze.getPath(this.eventMap,`${e}.${t}`)||{};return r||(this.layoutResource(this.scheduler.resourceStore.getById(t)),r=ze.getPath(this.eventMap,`${e}.${t}`).tplData),r?{start:r.left,end:r.left+r.width,top:r.top,bottom:r.bottom}:null}getScheduleRegion(e,t,r){const n=this,{scheduler:s}=n,i=Xt.from(s.timeAxisSubGridElement);e&&(i.left=n.resourceStore.indexOf(e)*s.resourceColumnWidth,i.right=i.left+s.resourceColumnWidth);const o=s.timeAxis.startDate,a=s.timeAxis.endDate,l=s.getDateConstraints(e,t)||{start:o,end:a},c=s.getCoordinateFromDate(je.max(o,l.start)),d=s.getCoordinateFromDate(je.min(a,l.end));return r?(i.top=c,i.bottom=d):(i.top=n.translateToPageCoordinate(c),i.bottom=n.translateToPageCoordinate(d)),i}getRowRegion(e,t,r){const{scheduler:n}=this,s=this.resourceStore.indexOf(e)*n.resourceColumnWidth,i=n.timeAxis.startDate,o=n.timeAxis.endDate,a=t?je.max(i,t):i,l=r?je.min(o,r):o,c=n.getCoordinateFromDate(a),d=n.getCoordinateFromDate(l,!0,!0),u=Math.min(c,d),h=Math.abs(c-d);return new Xt(s,u,n.resourceColumnWidth,h)}getVisibleDateRange(){const e=this.scheduler,t=e.scrollable.y,r=e.scrollable.clientHeight;return{startDate:e.getDateFromCoordinate(t),endDate:e.getDateFromCoordinate(t+r)||e.timeAxis.endDate}}onResourceColumnWidthChange({width:e,oldWidth:t}){const r=this,{scheduler:n}=r;r.resourceColumns.width=n.timeAxisColumn.width=r.resourceStore.count*e,r.clearAll(),n.runWithTransition(()=>r.renderer(),Math.abs(e-t)>30)}onEventStoreChange({action:e,records:t,record:r,replaced:n,changes:s,fromRelationUpdate:i}){const o=this,a=t||(r?[r]:[]),l=new Set;let c=!0;switch(a.forEach(e=>{e.resources.forEach(e=>l.add(e.id))}),e){case"sort":case"group":case"move":return;case"dataset":o.clearAll(),c=!1;break;case"add":case"remove":case"updateMultiple":o.clearResources(l);break;case"replace":n.forEach(([e,t])=>{e.resources.map(e=>l.add(e.id)),t.resources.map(e=>l.add(e.id))}),o.clearResources(l);break;case"removeall":case"filter":o.clearAll();break;case"update":if(r.meta.removingResource)return;let e=!1;if(("startDate"in s||"endDate"in s||"duration"in s||"id"in s)&&(o.clearResources(l),e=!0),"resourceId"in s){if(i)return;l.add(s.resourceId.oldValue),o.clearResources(l),e=!0}if(!e){Object.values(o.eventMap[r.id]).forEach(e=>{const{tplData:t}=e;e.tplData=o.scheduler.generateTplData(t.eventRecord,t.resourceRecord),e.tplData.left=t.left,e.tplData.width=t.width})}}o.scheduler.runWithTransition(()=>o.renderer(),c)}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t.resourceColumns.resourceStore=t._resourceStore=e,t.resourceStoreDetacher=e.on({change:t.onResourceStoreChange,refresh:t.onResourceStoreRefresh,thisObj:t,prio:1})}get timeView(){return this.scheduler.timeView}get resourceStore(){return this._resourceStore}onChangeResourceStore({newResourceStore:e}){const t=this;t.firstResource=t.lastResource=null,t.clearAll(),t.resourceStore=e,t.renderer()}onResourceStoreChange({source:e,action:t,records:r,record:n}){const s=this,i=r||(n?[n]:[]);switch(s.firstResource=s.lastResource=null,t){case"add":for(let t=i.reduce((t,r)=>Math.min(t,e.indexOf(r)),e.count);t<e.count;t++)s.clearResources([e.getAt(t).id]);return;case"remove":case"removeall":return void s.clearAll();case"replace":case"update":break;case"filter":s.clearAll()}s.scheduler.runWithTransition(()=>s.renderer())}onResourceStoreRefresh({action:e}){const t=this;if("group"===e)throw new Error("Grouping of resources not supported in vertical mode");"sort"===e&&(t.firstResource=t.lastResource=null,t.clearAll(),t.scheduler.runWithTransition(()=>t.renderer()))}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&(t.assignmentStoreDetacher=e.on({change:t.onAssignmentStoreChange,thisObj:t}))}get assignmentStore(){return this._assignmentStore}onChangeAssignmentStore({newAssignmentStore:e}){this.assignmentStore=e}onAssignmentStoreChange({action:e,records:t,replaced:r,record:n,changes:s}){const i=this,o=new Set((t||(n?[n]:[])).map(e=>e.resourceId));switch(e){case"add":case"remove":case"updateMultiple":i.clearResources(o);break;case"filter":case"removeall":i.clearAll();break;case"replace":r.forEach(([e,t])=>{o.add(e.resourceId),o.add(t.resourceId)}),i.clearResources(o);break;case"update":"resourceId"in s&&o.add(s.resourceId.oldValue),i.clearResources(o)}i.scheduler.runWithTransition(()=>i.renderer())}refreshRows(e){e&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}updateFromHorizontalScroll(e){e!==this.prevScrollLeft&&(this.renderer(),this.prevScrollLeft=e)}updateFromVerticalScroll(){this.renderer()}scrollResourceIntoView(e,t){const{scheduler:r}=this,n=r.resourceStore.indexOf(e)*r.resourceColumnWidth;return r.scrollHorizontallyTo(n,t)}onViewportResize(e){this.resourceColumns.availableWidth=e,this.renderer()}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}clearEvents(){}updateElementId(){}releaseTimeSpanDiv(){}get resourceRange(){const{scheduler:e,resourceStore:t}=this;return t&&t.count?{firstResource:Math.max(Math.floor(e.scrollLeft/e.resourceColumnWidth)-1,0),lastResource:Math.min(Math.floor((e.scrollLeft+e.timeAxisSubGrid.width)/e.resourceColumnWidth)+1,t.count-1)}:{firstResource:-1,lastResource:-1}}get dateRange(){const{scheduler:e}=this;let t=e.getDateFromCoordinate(Math.min(e.scrollTop+e.bodyHeight+e.tickSize-1,(e.virtualScrollHeight||e.scrollable.scrollHeight)-1));return t||(t=e.timeAxis.last.endDate),{topDate:e.getDateFromCoordinate(Math.max(e.scrollTop-e.tickSize,0)),bottomDate:t}}getTimeSpanRenderData(e,t,r=!1){const{scheduler:n}=this,{startDate:s,endDate:i}=e,o=n.getCoordinateFromDate(s),a=this.resourceStore.indexOf(t)*n.resourceColumnWidth,l=n.resourceColumnWidth-2*n.resourceMargin,c=s.getTime(),d=i.getTime();let u=n.getCoordinateFromDate(i),h=u-o;return-1===u&&(h=Math.round((d-c)*n.timeAxisViewModel.getSingleUnitInPixels("ms")),u=o+h),{eventRecord:e,resourceRecord:t,left:a,top:o,bottom:u,width:l,height:h,startDate:s,endDate:i,startDateMS:c,endDateMS:d,start:s,end:i,startMs:c,endMs:d}}eventSorter(e,t){const r=e.dataStartMs||e.startDateMS,n=e.dataEndMs||e.endDateMS,s=t.dataStartMs||t.startDateMS,i=t.dataEndMs||t.endDateMS;return r===s?n-i==0?e.eventRecord.name<t.eventRecord.name?-1:1:n>i?-1:1:r<s?-1:1}layoutResource(e){const t=this,{scheduler:r}=t,n=t.resourceMap[e.id]={},s=r.resourceStore.indexOf(e);let i=r.eventStore.getEventsForResource(e);i=r.getEventsToRender(e,i);const o=i.reduce((i,o)=>{const a=r.generateTplData(o,e),l={tplData:a};return ze.setPath(t.eventMap,`${a.eventId}.${e.id}`,l),n[a.eventId]=l,a.fillSize?(a.left=s*r.resourceColumnWidth,a.width=r.resourceColumnWidth):i.push(a),i},[]);return o.sort(t.eventSorter),t.verticalLayout.applyLayout(o,r.resourceColumnWidth,r.resourceMargin,r.barMargin,s),n}addTemporaryDragElement(e){const{scheduler:t}=this,r=t.generateTplData(e,e.resource,{timeAxis:!0,viewport:!0});r.top=r.row?r.top+r.row.top:t.getResourceEventBox(e,e.resource,!0).top;const n=this.renderEvent({tplData:r}),{dataset:s}=n;delete n.tabIndex,delete s.eventId,delete s.resourceId,delete s.syncId,s.transient=!0,n.parent=this.scheduler.foregroundCanvas,n.retainElement=!0;const i=Et.createElement(n);return i.innerElement=i.firstChild,e.instanceMeta(t).hasTemporaryDragElement=!0,i}renderEvent(e){const t=e.tplData,{resourceRecord:r,eventRecord:n}=t,s={className:t.wrapperCls,tabIndex:"0",children:[{className:t.cls,style:(t.internalStyle||"")+(t.style||""),html:t.body.cloneNode(!0),compareHtml:t.eventContent}],style:{transform:`translate(${t.left}px, ${t.top}px)`,height:t.height,width:t.width,zIndex:t.zIndex},dataset:{resourceId:r.id,eventId:t.eventId,syncId:t.assignment?t.assignment.id:t.eventId},elementData:e,retainElement:n.instanceMeta(this.scheduler).retainElement};return t.assignment&&(s.dataset.assignmentId=t.assignment.id),s}renderResource(e){const t=this,{topDateMS:r,bottomDateMS:n}=t,s=[];let i=t.resourceMap[e.id];i||(i=t.layoutResource(e));for(const e in i){const o=i[e],{endDateMS:a,startDateMS:l,eventRecord:c}=o.tplData;a>=r&&l<=n&&!c.instanceMeta(t.scheduler).hasTemporaryDragElement&&s.push(t.renderEvent(o))}return s}renderer(){const e=this,{scheduler:t}=e,{resourceStore:r}=t,{firstResource:n,lastResource:s}=e.resourceRange,{topDate:i,bottomDate:o}=e.dateRange,a=[],l=[];if(e.initialized){if(je.isEqual(i,e.topDate)&&je.isEqual(o,e.bottomDate)||(e.topDate=i,e.bottomDate=o,e.topDateMS=i.getTime(),e.bottomDateMS=o.getTime(),e.timeView.range={startDate:i,endDate:o}),-1!==n&&-1!==s)for(let t=n;t<=s;t++)a.push.apply(a,e.renderResource(r.getAt(t)));t.getForegroundDomConfigs(l),a.push.apply(a,l),bo.sync({domConfig:{onlyChildren:!0,children:a},targetElement:t.foregroundCanvas,syncIdField:"syncId",callback({action:e,domConfig:r,lastDomConfig:n,targetElement:s}){if(r&&r.className&&r.className[t.eventCls+"-wrap"]){const i=lh[e];if(ah[e]&&n&&!n.isReleased){const e=n.elementData.tplData,r={tplData:e,assignmentRecord:e.assignment,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,targetElement:s};t.trigger("releaseEvent",r)}if(i){const n=r.elementData.tplData,i={tplData:n,assignmentRecord:n.assignment,eventRecord:n.eventRecord,resourceRecord:n.resourceRecord,targetElement:s};s.elementData.element=s,i.reusingElement="reuseElement"===e,t.trigger("renderEvent",i)}"none"===e&&(r.elementData.element=s)}}}),e.firstResource===n&&e.lastResource===s||(e.resourceColumns.range={firstResource:n,lastResource:s},e.firstResource=n,e.lastResource=s)}}clearResources(e){e.forEach(e=>{this.resourceMap[e]&&(Object.keys(this.resourceMap[e]).forEach(t=>{delete this.eventMap[t][e]}),delete this.resourceMap[e])})}clearAll(){this.resourceMap={},this.eventMap={}}}function dh(e,t){return e===t.length-1}function uh(e,t){return t===e.cells[e.cells.length-1]}ch._$name="VerticalEventMapper";class hh extends Vr{static get defaultConfig(){return{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null,wrapText:null}}static get properties(){return{startDate:null,endDate:null,levels:[],size:null}}set range(e){this.startDate=e.startDate,this.endDate=e.endDate,this.refresh(),this.trigger("rangeChange",{startDate:e.startDate,endDate:e.endDate})}buildCells(){const e=this,{sizeProperty:t}=e,r=[],n=e.levels.map((r,n)=>({className:{"b-sch-header-row":1,["b-sch-header-row-"+r.position]:1,"b-sch-header-row-main":n===e.model.viewPreset.mainHeaderLevel,"b-lowest":dh(n,e.levels)},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:"headerRow"+n,headerPosition:r.position},children:r.cells.filter(t=>t.start<e.endDate&&t.end>e.startDate).map(n=>({className:{"b-sch-header-timeaxis-cell":1,[n.headerCellCls]:n.headerCellCls,["b-align-"+n.align]:n.align,"b-last":uh(r,n)},dataset:{tickIndex:n.index,...window.DEBUG&&{date:n.start.getTime()}},style:{[e.positionProperty]:n.coord,[t]:n.width,["min-"+t]:n.width},children:e.wrapText?[{className:"b-sch-header-text",html:n.value}]:null,html:e.wrapText?null:n.value}))}));return e.client&&e.client.getHeaderDomConfigs(r),n.push(...r),{className:"b-widget "+e.cls,syncOptions:{releaseThreshold:0},style:{[t]:e.size},children:n}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const t=this,{columnConfig:r}=t.model,{levels:n}=t,s=n.length;if(e){n.length=0,r.forEach((e,t)=>n[t]={position:t,cells:e}),t.size=n[0].cells.reduce((e,t)=>e+t.width,0);const e=t.element.parentElement;e&&(e.classList.remove("b-sch-timeaxiscolumn-levels-"+s),e.classList.add("b-sch-timeaxiscolumn-levels-"+n.length))}t.startDate&&t.endDate&&(bo.sync({domConfig:t.buildCells(),targetElement:t.element,syncIdField:"headerFeature"}),t.trigger("refresh"))}get widgetClass(){}}hh._$name="TimeAxisBase";class gh extends hh{static get $name(){return"HorizontalTimeAxis"}static get defaultConfig(){return{cls:"b-horizontaltimeaxis",sizeProperty:"width",positionProperty:"left",wrapText:!1}}construct(){super.construct(...arguments),this.model.on({update:this.onModelUpdate,thisObj:this})}get width(){return this.size}onModelUpdate(){this.model.availableSpace!==this.width&&this.refresh(!0)}}gh._$name="HorizontalTimeAxis";class mh extends Vr{static get $name(){return"ResourceHeader"}static get defaultConfig(){return{resourceStore:null,columnWidth:150,headerRenderer:null,fillWidth:!0,fitWidth:!1,imagePath:null,imageExtension:null,defaultImageName:null}}static get properties(){return{firstResource:-1,lastResource:-1}}construct(e){super.construct(e);const t=this;null!=t.imagePath&&(gr.on({element:t.element,delegate:".b-resource-image",capture:!0,error:e=>t.setDefaultResourceImage(e.target),thisObj:t}),t.element.classList.add("b-has-images")),gr.on({element:t.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:t})}set resourceStore(e){const t=this;e!==t._resourceStore&&(t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,t.resourceStoreDetacher=e.on({change:"onResourceStoreDataChange",thisObj:t}),e.count&&t.onResourceStoreDataChange({}))}get resourceStore(){return this._resourceStore}onResourceStoreDataChange({action:e}){const t=this,r=t.resourceStore.count*t.columnWidth;r!==t.width&&(t.element.style.width=r+"px",t.column.set("width",r,t.column.grid.isConfiguring)),"removeall"===e&&(t.element.innerHTML=""),"remove"!==e&&"add"!==e&&"filter"!==e||t.refreshWidths()}get columnWidth(){return this._columnWidth}set columnWidth(e){const t=this;if(e!==t._columnWidth){const r=t._columnWidth;t._columnWidth=e,t.refreshingWidths||(t._originalColumnWidth=e,t.refreshWidths()),t.isConfiguring||(t.refresh(),t.trigger("columnWidthChange",{width:t._columnWidth,oldWidth:r}))}}get fillWidth(){return this._fillWidth}set fillWidth(e){this._fillWidth=e,this.refreshWidths()}get fitWidth(){return this._fitWidth}set fitWidth(e){this._fitWidth=e,this.refreshWidths()}setDefaultResourceImage(e){if(this.defaultImageName){const t=this.getImageURL(this.defaultImageName);e.src&&!e.src.endsWith(t.replace(/^[./]*/gm,""))&&(e.src=t)}}getImageURL(e){return I.joinPaths([this.imagePath||"",e||""])}get imagePath(){return this._imagePath}set imagePath(e){this._imagePath=e,this.refresh()}get availableWidth(){return this._availableWidth}set availableWidth(e){this._availableWidth=e,this.refreshWidths()}refreshWidths(){const e=this,{availableWidth:t,_originalColumnWidth:r}=e,n=e.resourceStore&&e.resourceStore.count;if(!t||!n)return;e.refreshingWidths=!0;const s=e.fitWidth||e.fillWidth&&r*n<t?Math.floor(t/n):r,i=e.column.grid.enableEventAnimations&&Math.abs(e._columnWidth-s)>30;Et.addTemporaryClass(e.element,"b-animating",i?300:0,e),e.columnWidth=s,e.refreshingWidths=!1}set range(e){this.firstResource=e.firstResource,this.lastResource=e.lastResource,this.refresh()}refresh(){const e=this,{firstResource:t,lastResource:r}=e;if(e.column.grid.isConfiguring||-1===t||-1===r||r>=e.resourceStore.count)return;const n=[];for(let s=t;s<=r;s++){const t=e.resourceStore.getAt(s),r={className:new Ve({"b-resourceheader-cell":1}),dataset:{resourceId:t.id},style:{left:s*e.columnWidth,width:e.columnWidth},children:[]};if(e.headerRenderer){const n=e.headerRenderer({elementConfig:r,resourceRecord:t});null!=n&&(r.html=n)}else{let n;if(t.imageUrl)n=t.imageUrl;else if(null!=e.imagePath){const r=t.image||t.name&&t.name.toLowerCase()+e.imageExtension||e.defaultImageName;n=e.getImageURL(r)}null!=n&&r.children.push({tag:"img",className:"b-resource-image",src:n}),t.iconCls&&r.children.push({tag:"i",className:t.iconCls}),r.children.push({tag:"span",className:"b-resource-name",html:t.name})}n.push(r)}bo.sync({domConfig:{onlyChildren:!0,children:n},targetElement:e.element,syncIdField:"resourceId"})}onResourceMouseEvent(e){const t=e.target.closest(".b-resourceheader-cell"),r=this.resourceStore.getById(t.dataset.resourceId);this.trigger("resourceHeader"+I.capitalizeFirstLetter(e.type),{resourceRecord:r,event:e})}}mh._$name="ResourceHeader";class ph extends(G(Da)){construct(){const e=this;super.construct(...arguments),e.initialRender=!0,e.thisObj=e,e.timeAxisViewModel=e.timeline.timeAxisViewModel,e.mode=e.mode,e.grid.on({paint:"onTimelinePaint",thisObj:e,once:!0}),e.timeAxisViewModel.on({update:e.onViewModelUpdate,thisObj:e})}static get autoExposeFields(){return!0}static get fields(){return["mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1}}static get type(){return"timeAxis"}doDestroy(){this.resourceColumns&&this.resourceColumns.destroy(),super.doDestroy()}set mode(e){const t=this,{timeline:r}=t;t.set("mode",e),"horizontal"===e?t.timeAxisView=new gh({model:t.timeAxisViewModel,compactCellWidthThreshold:t.compactCellWidthThreshold,owner:t.grid,client:t.grid}):"vertical"===e&&(t.resourceColumns=new mh(ze.assign({column:t,resourceStore:r.resourceStore,imagePath:r.resourceImagePath,imageExtension:r.resourceImageExtension,defaultImageName:r.defaultResourceImageName},r.resourceColumns||{})),t.relayEvents(t.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:e}){const t=this;"horizontal"===t.mode?(t.refreshHeader(!0),t.width=e.totalSize,t.timeline.refresh()):"vertical"===t.mode&&t.timeline.refreshRows()}onTimelinePaint({firstPaint:e}){const t=this;t.subGrid.insertRowsBefore&&e&&(t.subGridElement.classList.add("b-timeline-subgrid"),t.element&&gr.on({element:t.element,thisObj:t,click:"onContainerElementClick",dblclick:"onContainerElementClick",contextmenu:"onContainerElementClick"}),"vertical"===t.mode&&t.refreshHeader())}refreshHeader(e){const t=this,{element:r}=t;r&&("horizontal"===t.mode?(!e&&t.timeAxisViewModel.update(null,!0),t.timeAxisView.rendered?t.timeAxisView.refresh(!0):(r.innerHTML="",t.timeAxisView.render(r))):"vertical"===t.mode&&(t.resourceColumns.currentElement||(r.innerHTML="",t.resourceColumns.render(r))))}renderer(e){return this.timeline.currentOrientation.renderer(e)}onContainerElementClick(e){const t=Et.up(e.target,".b-sch-header-timeaxis-cell");if(t){const r=t.dataset.tickIndex,n=t.parentElement.dataset.headerPosition,s=this.timeAxisViewModel.columnConfig[n][r],i=this.grid.features.contextMenu;i&&e.type===i.triggerEvent||this.trigger("timeAxisHeader"+I.capitalizeFirstLetter(e.type),{startDate:s.start,endDate:s.end,event:e})}}}Ea.registerColumnType(ph),ph._$name="TimeAxisColumn";class fh extends hh{static get $name(){return"VerticalTimeAxis"}static get defaultConfig(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}get height(){return this.size}}fh._$name="VerticalTimeAxis";class vh extends Da{static get type(){return"verticalTimeAxis"}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cellCls:"b-verticaltimeaxiscolumn"}}get isFocusable(){return!1}construct(e){super.construct(...arguments),this.timeAxisViewModel=e.timeline.timeAxisViewModel,this.view=new fh({model:this.timeAxisViewModel,client:e.timeline})}renderer({cellElement:e,size:t}){this.view.render(e),t.height=this.view.height}}Ea.registerColumnType(vh),vh._$name="VerticalTimeAxisColumn";class yh extends(Qn(Tu).mixes(Dc,Mu,ku,Iu,Nu,Wu,Yu,$u,Gu,qu,Zu)){static get $name(){return"SchedulerBase"}static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",timeCellSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,milestoneCharWidth:10,milestoneAlign:"center",preCalculateHeightLimit:1e4,milestoneMinWidth:40,crudManagerClass:cd,testConfig:{loadMaskHideTimeout:10}}}construct(e={}){const t=this;super.construct(e),t.createEventOnDblClick&&t.on("scheduledblclick",t.onSchedulerDblClick)}set timeAxisViewModel(e){super.timeAxisViewModel=e,this.eventStore&&(this.timeAxisViewModel.eventStore=this.eventStore)}get timeAxisViewModel(){return super.timeAxisViewModel}get store(){return super.store}set store(e){super.store=e}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}onSchedulerDblClick({date:e,resourceRecord:t,row:r}){this.readOnly||t.meta.specialRow||this.internalAddEvent(e,t,r)}onColumnsChanged({action:e,changes:t,record:r}){r===this.timeAxisColumn&&"width"in t&&this.updateCanvasSize(),super.onColumnsChanged(...arguments)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}onEventCreated(e){}get isHorizontal(){return"horizontal"===this.mode}get isVertical(){return"vertical"===this.mode}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||("horizontal"===e?(t.horizontal=new ih(t),t.isPainted&&t.horizontal.init(),t.un("scroll",t.onVerticalScroll,t)):"vertical"===e&&(t.zoomOnTimeAxisDoubleClick=t.zoomOnMouseWheel=!1,t.vertical=new ch(t),t.rendered&&t.vertical.init(),t.on("scroll",t.onVerticalScroll,t)))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){super.onElementKeyDown(e)}onElementKeyUp(e){super.onElementKeyUp(e)}onElementMouseOver(e){super.onElementMouseOver(e)}onElementMouseOut(e){super.onElementMouseOut(e)}getEventMenuItems(){}getScheduleMenuItems(){}internalAddEvent(e,t,r){const n=this,s=[t],i=new n.eventStore.modelClass({startDate:e,endDate:je.add(e,1,n.timeAxis.unit)});if(n.onEventCreated(i),n.eventEdit){const e=n.currentOrientation.getTimeSpanRenderData(i,t),s=Et.createElement({parent:n.foregroundCanvas,className:"b-sch-dragcreator-proxy",style:`width:${e.width}px;height:${e.height}px`});return Et.setTranslateXY(s,e.left,(r&&r.top||0)+e.top),void n.editEvent(i,t,s)}!1!==n.trigger("beforeEventAdd",{eventRecord:i,resourceRecords:s,resources:s})&&(n.eventStore.add(i),n.eventStore.assignEventToResource(i,t))}isDateRangeAvailable(e,t,r,n){return this.eventStore.isDateRangeAvailable(e,t,r,n)}toggleEmptyText(){const e=this;e.bodyContainer&&Et.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.crudManager&&e.crudManager.isLoading))}getRowHeight(e){if(this.currentOrientation.calculateRowHeight){const t=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,t),t}}calculateRowHeights(e){e.forEach(e=>e&&this.getRowHeight(e)),this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(e=!1){const{store:t,rowManager:r}=this,n=Math.min(t.count,this.preCalculateHeightLimit);if(n){r.clearKnownHeights();for(let e=0;e<n;e++)this.getRowHeight(t.getAt(e));e||r.estimateTotalHeight(!0)}}}yh.localeClass="Scheduler",yh._$name="SchedulerBase",U.register("schedulerbase",yh);class bh extends Nn{static get $name(){return"ScheduleTooltip"}static get defaultConfig(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`}}static get pluginConfig(){return{chain:["render"]}}render(){const e=this,t=e.client;let r;e.hoverTip&&e.hoverTip.destroy();const n=e.hoverTip=new Mn({id:t.id+"-schedule-tip",cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:t.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,forSelector:".b-schedulerbase:not(.b-animating):not(.b-dragging-event):not(.b-dragcreating) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",constrainTo:null,getHtml:e.getHoverTipHtml.bind(e),onDocumentMouseDown(e){n.forElement.contains(e.event.target)&&(r=gr.on({element:t.timeAxisSubGridElement,mousemove:e=>n.internalOnPointerOver(e),capture:!0}));const s=n.hideAnimation;n.hideAnimation=!1,n.constructor.prototype.onDocumentMouseDown.call(n,e),n.hideAnimation=s},listeners:{pointerover:({event:t})=>{const n="buttons"in t?t.buttons>0:t.which>0;return!n&&r&&r(),!e.disabled&&!n}}});e.clockTemplate=new ud({scheduler:t})}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:e,event:t}){const r=this,n=r.client,s=t&&n.getDateFromDomEvent(t,"floor",!0);let i=r.lastHtml;if(s){const e=n.resolveResourceRecord(t);s-r.lastTime==0&&e===r.lastResource||(r.lastResource=e,i=r.lastHtml=r.generateTipContent({date:s,event:t,resourceRecord:e}))}else e.hide(),r.lastTime=null,r.lastResource=null;return i}generateTipContent({date:e,event:t,resourceRecord:r}){const n=this,s=n.clockTemplate.generateContent({date:e,text:n.client.getFormattedDate(e)}),i=n.messageTemplate({message:n.getText(e,t,r)||""});return n.lastTime=e,s+i}getText(e,t,r){}}bh.featureClass="b-scheduletip",bh._$name="ScheduleTooltip",Va.registerFeature(bh,!0,"Scheduler");class Ch extends yh{static get $name(){return"Scheduler"}}Ch._$name="Scheduler",U.register("scheduler",Ch);class wh extends cl{static get $name(){return"Summary"}static get defaultConfig(){return{showTooltip:!0,summaries:null,renderer:null}}construct(e,t){const r=this;if(e.isVertical)throw new Error("Summary feature is not supported in vertical mode");r.scheduler=e,super.construct(e,t),r.summaries||(r.summaries=[{renderer:r.renderer}]),e instanceof Ch&&(e.eventStore.on({change:r.updateScheduleSummaries,thisObj:r}),e.resourceStore.on({change:r.updateScheduleSummaries,thisObj:r}),e.timeAxisViewModel.on({update:r.renderRows,thisObj:r}))}renderRows(){super.renderRows(),this.render()}updateScheduleSummaries(){const e=this,t=e.scheduler,r=t.element.querySelector(".b-grid-footer.b-sch-timeaxiscolumn");r&&Et.forEachSelector(r,".b-timeaxis-tick",(r,n)=>{const s=t.timeAxis.getAt(n),i=t.eventStore.getEventsInTimeSpan(s.startDate,s.endDate,!0,!0);let o="",a=`<header>${e.L("L{Summary for}",t.getFormattedDate(s.startDate))}</header>`;e.summaries.forEach(n=>{const l=n.renderer({startDate:s.startDate,endDate:s.endDate,eventStore:t.eventStore,resourceStore:t.resourceStore,events:i,element:r}),c=`<div class="b-timeaxis-summary-value">${l}</div>`;(e.summaries.length>1||""!==l)&&(o+=c),a+=`<label>${n.label||""}</label>`+c}),r.innerHTML=o,r._tipHtml=a})}render(){const e=this,t=e.scheduler,r=t.element.querySelector(".b-grid-footer.b-sch-timeaxiscolumn");r&&(e.summaries.some(e=>e.label)&&e.showTooltip&&!e._tip&&(e._tip=new Mn({id:t.id+"-summary-tip",cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:r,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:e})=>e._tipHtml})),r.innerHTML=`<div class="b-timeaxis-tick" style="width: ${t.tickSize}px"></div>`.repeat(t.timeAxis.count),e.updateScheduleSummaries())}}wh._$name="Summary",wh._$name="Summary",Va.registerFeature(wh,!1,"Scheduler");class Sh extends Nn{static get $name(){return"SimpleEventEdit"}static get defaultConfig(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}static get pluginConfig(){return{chain:["onEventEnterKey"],assign:["editEvent"]}}construct(e,t){const r=this;r.scheduler=e,r.eventStore=e.eventStore,e.eventEdit=r,super.construct(e,t),r.clientListenersDetacher=e.on({[r.triggerEvent]:({eventRecord:e,eventElement:t})=>r.editEvent(e,e.resource,t),dragcreateend:r.onDragCreateEnd,thisObj:r})}doDestroy(){this.clientListenersDetacher(),this.editor&&this.editor.destroy(),super.doDestroy()}editEvent(e,t,r){const n=this,s=n.scheduler;s.readOnly||n.disabled||(r=Et.down(r,s.eventInnerSelector)||r,e=e instanceof xc?e.event:e,n.resource=t,n.event=e,n.element=r,s.element.classList.add("b-eventeditor-editing"),n.editor||(n.editor=new Bs(Object.assign({owner:n.scheduler.timeAxisSubGrid,appendTo:n.scheduler.timeAxisSubGridElement,scrollAction:"realign",cls:"b-simpleeventeditor",listeners:{complete:n.onEditorComplete,cancel:n.onEditorCancel,thisObj:n}},n.editorConfig)),n.relayEvents(n.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),n.editor.startEdit({target:r,record:e,field:n.field}),n.scheduler.navigator.disabled=!0)}onEditorComplete(){const e=this;0===e.event.stores.length&&(e.eventStore.add(e.editor.record),e.event.assign(e.resource)),e.element&&e.element.classList.contains("b-sch-dragcreator-proxy")&&e.element.remove(),e.reset()}onEditorCancel(){0===this.event.stores.length&&this.element.remove(),this.reset()}reset(){this.scheduler.element.classList.remove("b-eventeditor-editing"),this.scheduler.navigator.disabled=!1}onEventEnterKey({assignmentRecord:e,eventRecord:t}){const r=e?this.scheduler.getElementFromAssignmentRecord(e):this.scheduler.getElementFromEventRecord(t),n=(e||t).resource;this.editEvent(t,n,r)}onDragCreateEnd({newEventRecord:e,resourceRecord:t,proxyElement:r}){this.scheduler.onEventCreated(e);const n=r.cloneNode(!0);n.removeAttribute("id"),r.parentElement.appendChild(n),this.element=n,this.editEvent(e,t,n)}}Sh._$name="SimpleEventEdit",Va.registerFeature(Sh,!1,"Scheduler");class Dh extends eu{static get $name(){return"TimeRanges"}static get defaultConfig(){return{store:{modelClass:jc,storeId:"timeRanges"},updateCurrentTimeLineInterval:1e4,currentDateFormat:"HH:mm",timeRanges:null,showCurrentTimeLine:!1}}construct(e,t){const r=this;super.construct(e,t),e._timeRangesExposed||(Object.defineProperty(e,"timeRanges",{get:()=>r.store.records,set:e=>r.store.data=e}),e._timeRangesExposed=!0)}startConfigure(e){const{client:t}=this;if(t.project){const r=t.project.timeRangeStore;r&&(e.store=r)}}initCurrentTimeLine(){const e=this,t=new Date;!e.currentTimeLine&&e.showCurrentTimeLine&&(e.currentTimeLine=new e.store.modelClass({id:"currentTime",cls:"b-sch-current-time",startDate:t,name:je.format(t,e.currentDateFormat)}),e.updateCurrentTimeLine=e.updateCurrentTimeLine.bind(e),e.currentTimeInterval=e.setInterval(e.updateCurrentTimeLine,e.updateCurrentTimeLineInterval),e.client.isPainted&&e.renderRanges())}updateCurrentTimeLine(){const e=this;e.currentTimeLine.startDate=new Date,e.currentTimeLine.name=je.format(e.currentTimeLine.startDate,e.currentDateFormat),e.onStoreChanged({action:"update",record:e.currentTimeLine,changes:{}})}hideCurrentTimeLine(){const e=this;e.currentTimeLine&&(e.clearInterval(e.currentTimeInterval),e.currentTimeLine=null,e.client.isPainted&&e.renderRanges())}renderRanges(){const e=this;super.renderRanges(),e.showCurrentTimeLine&&!e.disabled&&e.renderRange(e.currentTimeLine,!0)}get showCurrentTimeLine(){return this._showCurrentTimeLine}set showCurrentTimeLine(e){this._showCurrentTimeLine=e,e?this.initCurrentTimeLine():this.hideCurrentTimeLine()}getHeaderMenuItems(e,t){const r=this;t.some(e=>e.isCurrentTimeline)||"timeAxis"!==e.type||t.push({isCurrentTimeline:!0,text:"L{showCurrentTimeLine}",localeClass:this,checked:r.showCurrentTimeLine,onToggle:({checked:e})=>{r.showCurrentTimeLine=e}})}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.client.isPainted&&this.renderRanges()}get store(){return this._store}set store(e){const t=this,r=t.client;e.storeId||(e.storeId="timeRanges"),super.store=e,r.timeRanges&&!r._timeRangesExposed&&(t._store.add(r.timeRanges),delete r.timeRanges),t.timeRanges&&(t._store.add(t.timeRanges),delete t.timeRanges)}}Dh._$name="TimeRanges",Va.registerFeature(Dh,!1,["Scheduler","Gantt"]);const Eh={completeview:"completeview",currentview:"currentview",daterange:"daterange"};class xh extends vl{static get $name(){return"ScheduleRangeCombo"}static get defaultConfig(){return{editable:!1}}buildLocalizedItems(){const e=this;return Object.entries(Eh).map(([t,r])=>({id:t,text:e.L(`L{${r}}`)}))}}xh._$name="ScheduleRangeCombo",U.register(xh.$name.toLowerCase(),xh);class Th extends Cl{static get $name(){return"SchedulerExportDialog"}static get defaultConfig(){return{scheduleRange:"completeview"}}onLocaleChange(){const e=this.L("labelWidth");this.width=this.L("L{width}"),this.items.forEach(t=>{t instanceof jn?t.labelWidth=e:"rangeFieldsContainer"===t.ref&&(t.items[0].width=e)})}get fieldProperties(){return["scheduleRange",...super.fieldProperties]}buildDialogItems(e){const t=this,{client:r}=e,{scheduleRange:n}=t.getDefaultFieldValues(e),s=super.buildDialogItems(e),i=t.L("labelWidth");t.columnsStore=r.columns.chain(e=>e.isLeaf&&!(e instanceof ph));const o=s.find(e=>"columnsField"===e.ref);return o.store=t.columnsStore,o.value=t.columnsStore.allRecords,s.splice(1,0,{labelWidth:i,type:"schedulerangecombo",ref:"scheduleRangeField",label:"L{Schedule range}",localeClass:t,value:n,onChange({value:e}){const t=e!==Eh.daterange,r=this.owner.widgetMap;r.rangeStartField.hidden=r.rangeEndField.hidden=t}},{type:"container",ref:"rangeFieldsContainer",flex:"1 0 100%",items:[{type:"widget",width:i},{type:"datefield",ref:"rangeStartField",label:"L{Export from}",hidden:!0,flex:"1 0 25%",localeClass:t,value:r.startDate,max:je.max(r.startDate,je.add(r.endDate,-1,"d")),onChange({value:e}){this.owner.widgetMap.rangeEndField.min=je.add(e,1,"d")}},{type:"datefield",ref:"rangeEndField",label:"L{Export to}",hidden:!0,flex:"1 0 25%",localeClass:t,value:r.endDate,min:je.min(r.endDate,je.add(r.startDate,1,"d")),onChange({value:e}){this.owner.widgetMap.rangeStartField.max=je.add(e,-1,"d")}}]}),s}}Th._$name="SchedulerExportDialog";const Rh=Promise.resolve();var Mh=e=>class extends e{async scrollRowIntoView(e,t){const{rowManager:r,scrollable:n}=e,s=n.y;return t<e.store.count&&(n.scrollTo(null,r.calculateTop(t)),n.y!==s)?new Promise(n=>{const s=e.on({scroll({scrollTop:e}){null!=e&&r.getRow(t)&&(s(),n())}})}):Rh}async scrollToDate(e,t){let r=!1;const n=[],s=e.timeAxisSubGrid.scrollable.on({scrollstart({x:e}){null!=e&&(r=!0)}});n.push(e.scrollToDate(t,{block:"start"})),s(),r&&(n.push(e.timeView.await("refresh",{checkLog:!1})),n.push(e.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1}))),await Promise.all(n)}async prepareComponent(e){const t=this,{client:r}=e,n=r.timeAxisSubGrid.width>0;switch(e.scheduleRange){case Eh.completeview:e.rangeStart=r.startDate,e.rangeEnd=r.endDate;break;case Eh.currentview:const{startDate:t,endDate:n}=r.getVisibleDateRange();e.rangeStart=t,e.rangeEnd=n}n&&(r.setTimeSpan(e.rangeStart,e.rangeEnd),r.svgCanvas),await super.prepareComponent(e);const{exportMeta:s}=t,i=t.element.querySelector(".b-sch-foreground-canvas"),o=t.element.querySelector(".b-horizontaltimeaxis");if(s.includeTimeline=n,n&&e.scheduleRange!==Eh.completeview){s.totalWidth-=s.subGrids.normal.width,s.totalWidth+=s.subGrids.normal.width=r.timeAxisViewModel.getDistanceBetweenDates(e.rangeStart,e.rangeEnd);const t=Math.ceil(s.totalWidth/s.pageWidth),n=t*s.verticalPages;s.horizontalPages=t,s.totalPages=n,s.subGrids.normal.scrollLeft=r.getCoordinateFromDate(e.rangeStart)}if(s.timeAxisHeaders=[],s.timeAxisPlaceholders=[],s.headersColleted=!1,Et.forEachSelector(o,".b-sch-header-row",e=>{s.timeAxisPlaceholders.push(t.createPlaceholder(e)),s.timeAxisHeaders.push(new Map)}),s.subGrids.normal.eventsPlaceholder=t.createPlaceholder(i,!1),Et.removeEachSelector(i,".b-sch-event-wrap"),Et.removeEachSelector(i,".b-released"),s.eventsBoxes=new Map,s.client=r,r.features.dependencies&&!r.features.dependencies.disabled){const e=t.element.querySelector(`[id="${r.svgCanvas.getAttribute("id")}"]`);(s.dependenciesPlaceholder=e)&&Et.removeEachSelector(e,".b-sch-dependency")}n&&!je.betweenLesser(e.rangeStart,r.startDate,r.endDate)&&await t.scrollToDate(r,e.rangeStart)}async restoreState(e){let t=!1;const{client:r}=e,n=[],s=r.timeAxisSubGrid.scrollable.on({scrollStart({x:e}){this.element.scrollLeft!==e&&(t=!0)}});n.push(super.restoreState(e)),s(),t&&n.push(r.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(n)}async onRowsCollected(e,t){const r=this;if(await super.onRowsCollected(e),r.exportMeta.includeTimeline){const{client:n}=t,{timeView:s}=n,{pageRangeStart:i,pageRangeEnd:o}=r.getCurrentPageDateRange(t);let a=!1;for(await r.scrollToDate(n,i);!a;)if(r.collectHeaders(t),r.collectEvents(e,t),je.timeSpanContains(s.startDate,s.endDate,i,o))a=!0;else if(s.endDate.getTime()>=o.getTime())a=!0;else{const e=s.endDate;if(await r.scrollToDate(n,s.endDate),e.getTime()===s.endDate.getTime())throw new Error("Could not scroll to date")}await r.scrollToDate(n,t.rangeStart)}}getCurrentPageDateRange({rangeStart:e,rangeEnd:t,client:r}){const{exportMeta:n}=this,{horizontalPages:s,horizontalPosition:i,pageWidth:o,subGrids:a}=n;let l,c;if(s>1){const e=i*o,n=(i+1)*o,s=a.locked.width;n<=s?c=l=null:(l=r.getDateFromCoordinate(Math.max(e-s,0)),c=r.getDateFromCoordinate(1.2*(n-s))||t)}else l=e,c=t;return{pageRangeStart:l,pageRangeEnd:c}}prepareExportElement(){const{element:e,exportMeta:t}=this,{id:r,headerId:n,footerId:s,scrollLeft:i}=t.subGrids.normal,o=e.querySelector(`[id="${r}"]`);return[".b-sch-background-canvas",".b-sch-foreground-canvas"].forEach(e=>{const r=o.querySelector(e);r&&(t.lastExportedRowBottom?r.style.height=t.lastExportedRowBottom+"px":r.style.height="",i&&(r.style.marginLeft=`-${i}px`))}),i&&[n,s].forEach(t=>{const r=e.querySelector(`[id="${t}"] .b-widget-scroller`);r&&(r.style.marginLeft=`-${i}px`)}),super.prepareExportElement()}collectRow(e){const{subGrids:t}=this.exportMeta;Object.entries(e.elements).forEach(([r,n])=>{const s=[n.outerHTML,e.top,e.offsetHeight];"normal"===r&&s.push(new Map),t[r].rows.push(s)})}collectHeaders(e){const{client:t}=e,{exportMeta:r}=this;if(!r.headersCollected){const e=t.timeView.element,n=r.timeAxisHeaders;Et.forEachSelector(e,".b-sch-header-row",(e,s,i)=>{const o=n[s];Et.forEachSelector(e,".b-sch-header-timeaxis-cell",e=>{o.has(e.dataset.tickIndex)||o.set(e.dataset.tickIndex,e.outerHTML)}),s===i.length-1&&o.has(String(t.timeAxis.count-1))&&(r.headersCollected=!0)})}}collectEvents(e,t){const r=e.length,{client:n}=t,s=this.exportMeta.subGrids.normal.rows;e.forEach((e,t)=>{const i=s[s.length-r+t],o=n.store.getAt(e.dataIndex),a=i[3];o.events&&o.events.forEach(e=>{if(e.isScheduled){let t=n.getElementFromEventRecord(e,o);t&&(t=t.parentElement)&&!a.has(e.id)&&a.set(e.id,[t.outerHTML,Xt.from(t,t.offsetParent)])}})})}buildPageHtml(){const e=this,{subGrids:t,timeAxisHeaders:r,timeAxisPlaceholders:n}=e.exportMeta;let s=e.prepareExportElement();return Object.values(t).forEach(({placeHolder:t,eventsPlaceholder:r,rows:n})=>{const i=t.outerHTML,{resources:o,events:a}=e.positionRows(n);s=s.replace(i,o.join("")),r&&(s=s.replace(r.outerHTML,a.join("")))}),r.forEach((e,t)=>{s=s.replace(n[t].outerHTML,Array.from(e.values()).join(""))}),s=e.buildDependenciesHtml(s),s}getDependenciesOuterHTML(){const{dependenciesPlaceholder:e}=this.exportMeta;let t;if(P.isIE11){const r=document.createElement("div"),n=e.cloneNode(!0);r.appendChild(n),t=r.innerHTML}else t=e.outerHTML;return t}renderDependencies(){const{client:e,dependenciesPlaceholder:t,eventsBoxes:r}=this.exportMeta,{dependencies:n}=e,s=e.features.dependencies,i=Array.from(r.keys());n.filter(e=>i.includes(String(e.from))||i.includes(String(e.to))).forEach(e=>{let n=r.get(String(e.from)),i=r.get(String(e.to));const{sourceEvent:o,targetEvent:a}=e;if(!n&&o){const t=s.getBox(e,!0);t&&(n=t instanceof Xt?t:new Xt(t.start,t.top,t.end-t.start,t.bottom-t.top))}if(!i&&a){const t=s.getBox(e,!1);t&&(i=t instanceof Xt?t:new Xt(t.start,t.top,t.end-t.start,t.bottom-t.top))}const l={startRectangle:n&&n.clone(),endRectangle:i&&i.clone()};n&&i&&s.drawDependency(e,l,null,t,!1)});const o=this.getDependenciesOuterHTML();return Et.removeEachSelector(t,".b-sch-dependency"),o}buildDependenciesHtml(e){const{dependenciesPlaceholder:t,includeTimeline:r}=this.exportMeta;if(t&&r){const t=this.getDependenciesOuterHTML();e=e.replace(t,this.renderDependencies())}return e}};class kh extends(Mh(Tl)){async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}positionRows(e){const t=[],r=[];return e.forEach(([e,n,s,i])=>{t.push(e),i&&Array.from(i.entries()).forEach(([e,[t,n]])=>{r.push(t),this.exportMeta.eventsBoxes.set(String(e),n)})}),{resources:t,events:r}}}kh._$name="MultiPageExporter";class Ih extends(Mh(Rl)){async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}async prepareComponent(e){await super.prepareComponent(e),e.scheduleRange!==Eh.completeview&&this.estimateTotalPages(e)}positionRows(e){const t=[],r=[];return e.forEach(([e,n,s,i])=>{t.push(e),i&&Array.from(i.entries()).forEach(([e,[t,n]])=>{r.push(t),this.exportMeta.eventsBoxes.set(String(e),n)})}),{resources:t,events:r}}}Ih._$name="MultiPageExporter";class Fh extends(Mh(Ml)){collectDependencies(){}positionRows(e){let t=0,r=[],n=[],s=/translate\((\d+.?\d*)px, (\d+.?\d*)px\)/;return e.forEach(([e,i,o,a])=>{r.push(e.replace(s,`translate($1px, ${t}px)`));const l=t-i;a&&Array.from(a.entries()).forEach(([e,[t,r]])=>{r.translate(0,l),this.exportMeta.eventsBoxes.set(String(e),r),n.push(t.replace(s,`translate($1px, ${r.y}px)`))}),t+=o}),{resources:r,events:n}}}Fh._$name="SinglePageExporter";class Ah extends kl{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[Fh,kh,Ih],scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){return ze.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"])}showExportDialog(){const e=this;e.exportDialog||(e.exportDialog=new Th(Object.assign({},e.defaultExportDialogConfig,{listeners:{export:e.onExportDialogExport,thisObj:e}}))),e.exportDialog.show()}buildExportConfig(e){e=super.buildExportConfig(e);const{scheduleRange:t,rangeStart:r,rangeEnd:n}=this;return e.columns&&!e.columns.find(e=>"timeAxis"===e.type)&&e.columns.push(e.client.timeAxisColumn.id),ze.assign({scheduleRange:t,rangeStart:r,rangeEnd:n},e)}}Ah._$name="PdfExport",Va.registerFeature(Ah,!1,"Scheduler");class Ph extends(ae(Il)){static get defaultConfig(){return{includeUnassigned:!0,eventColumns:[{text:"Task",field:"name"},{text:"Starts",field:"startDate",width:140},{text:"Ends",field:"endDate",width:140}]}}normalizeColumns(e){super.normalizeColumns(e),e.eventColumns=e.eventColumns.map(e=>"string"==typeof e?{field:e}:e)}generateExportData(e){const t=this.target instanceof Ch,r=this.generateColumns(e),n=t?this.generateEventColumns(e):[];return{columns:r.concat(n),rows:this.generateRows(e)}}generateEventColumns(e){return e.eventColumns.map(t=>this.processEventColumn(t,e))}processEventColumn(e,t){const{width:r,minWidth:n}=e,{defaultColumnWidth:s}=t;return{field:e.field,value:e.text,width:Math.max(r||s,n||s),eventColumn:!0,type:this.getColumnType(e,this.target.eventStore)}}generateRows(e){const t=this,{target:r}=t;let n;if(r instanceof Ch){if(n=[],r.resourceStore.map(r=>{const s=r.events||[];s.length||s.push(""),s.forEach(s=>n.push(t.getRowData(e,r,s)))}),e.includeUnassigned&&e.eventColumns.length){const s=r.eventStore.query(e=>!e.resources.length&&!r.resourceStore.isAvailable(e));if(s.length){const r=new Array(e.columns.length).fill("");r.push(t.L("L{ExcelExporter.No resource assigned}")),n.push(r),s.forEach(r=>n.push(t.getRowData(e,null,r)))}}n=n.filter(e=>e.length)}else n=super.generateRows(e);return n}getRowData(e,t,r){const{columns:n,eventColumns:s}=e,i=[],o=this.processRecord(t,n,e);if(o&&i.push(...o),!t||!t.meta.specialRow){const t=this.processRecord(r,s,e);t&&i.push(...t)}return i}}Ph._$name="ScheduleTableExporter";class Lh extends Al{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{exporterClass:Ph,exporterConfig:null}}}Lh._$name="ExcelExporter",Va.registerFeature(Lh,!1,"Scheduler");class Oh extends Da{static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showImage","imagePath","validNames","defaultImageName","autoScaleThreshold"]}static get defaults(){return{showImage:!0,showEventCount:!0,showRole:!1,imagePath:null,validNames:["amit","angelo","arcady","arnold","celia","chang","dan","dave","emilia","george","gloria","henrik","hitomi","jong","kate","lee","linda","lisa","lola","macy","madison","malik","mark","maxim","mike","rob","steve"],defaultImageName:null,autoScaleThreshold:40,field:"name",htmlEncode:!1,width:140,cellCls:"b-resourceinfo-cell",editor:!A.isTestEnv&&"text"}}construct(){const e=this;super.construct(...arguments),e.grid.isPainted?e.addErrorListener():e.grid.on({paint:e.addErrorListener,thisObj:e,once:!0})}set imagePath(e){this.set("imagePath",e)}get imagePath(){return this.get("imagePath")||this.grid.resourceImagePath}set defaultImageName(e){this.set("defaultImageName",e)}get defaultImageName(){return this.get("defaultImageName")||this.grid.defaultResourceImageName}getImageURL(e){return I.joinPaths([this.imagePath||"",e||""])}addErrorListener(){gr.on({element:this.grid.element,delegate:".b-resource-image",error:e=>this.setDefaultResourceImage(e.target),capture:!0})}setDefaultResourceImage(e){if(this.defaultImageName){const t=this.getImageURL(this.defaultImageName);e.src&&!e.src.endsWith(t.replace(/^[./]*/gm,""))&&(e.src=t)}}template(e){const t=this,{showImage:r,showRole:n,showEventCount:s}=t,i="string"==typeof n?n:"role",o=e.events.length,a=e.get(t.field);let l;if(r)if(e.imageUrl)l=e.imageUrl;else{const n="string"==typeof r?r:e.image||a&&a.toLowerCase()+t.grid.resourceImageExtension||t.defaultImageName;l=t.getImageURL(n),n.includes(".")||(!t.validNames||t.validNames.includes(n)?l+=t.grid.resourceImageExtension:l=t.getImageURL(t.defaultImageName))}return{class:"b-resource-info",children:[l?{tag:"img",draggable:"false",class:"b-resource-image",src:l}:null,{tag:"dl",children:[{tag:"dt",html:a},n?{tag:"dd",class:"b-resource-role",html:e[i]}:null,s?{tag:"dd",class:"b-resource-events",html:t.L("L{eventCountText}",o)}:null]}]}}defaultRenderer({grid:e,record:t,cellElement:r,value:n,isExport:s}){let i;return t.meta.specialRow?i="":s?i=n:(this.autoScaleThreshold&&e.rowHeight<this.autoScaleThreshold?r.style.fontSize=e.rowHeight/40+"em":r.style.fontSize="",i=this.template(t)),i}}Ea.registerColumnType(Oh),Oh._$name="ResourceInfoColumn";class _h extends Vs{static get $name(){return"EndDateField"}static get defaultConfig(){return{project:null}}transformTimeValue(e){const t=this.project&&this.project.calendar;if(t){const r=je.clearTime(e),n=je.add(r,1,"day"),s=t.skipNonWorkingTime(n,!1);if(je.isValidDate(s)&&je.isEqual(s,r,"day"))return je.copyTimeValues(r,s)}return super.transformTimeValue(e)}}_h._$name="EndDateField",U.register("enddatefield",_h),U.register("enddate",_h);var $h,jh,Hh,Nh,Bh,zh,Vh,Wh=e=>class extends(e||G(B)){get isReadyStatePropagator(){return!0}get canSave(){return!0}requestReadyStateChange(){this.trigger("readystatechange",{canSave:this.canSave})}get widgetClass(){}},Gh=e=>class extends(e||un){getProject(){return this.record&&this.record.getProject()}loadEvent(e){this.record=e}resetData(){this.record=null}beforeSave(){}afterSave(){this.resetData()}beforeCancel(){}afterCancel(){this.resetData()}beforeDelete(){}afterDelete(){this.resetData()}get widgetClass(){}},Uh=e=>class extends(e||G(B)){get isEventChangePropagator(){return!0}requestPropagation(){this.trigger("requestPropagation")}get widgetClass(){}},Yh=e=>class extends e{startConfigure(e){e.extraItems&&e.items&&(e.items.push(...e.extraItems),e.items.sort((e,t)=>(0|e.index)-(t.index-0))),super.afterConfigure()}get widgetClass(){}};class qh extends(Uh(Yh(Gh(un)))){static get $name(){return"FormTab"}static get defaultConfig(){return{layoutStyle:{flexFlow:"row wrap",alignItems:"flex-start",alignContent:"flex-start"},defaults:{labelWidth:"7em"}}}afterConfigure(){const e=this;super.afterConfigure(),Object.values(e.widgetMap).forEach(t=>{t.name&&t.on("change",e.onWidgetValueChange,e)}),ne.on({locale:e.onLocaleChange,thisObj:e})}loadEvent(e){this._loading=!0,super.loadEvent(e),this._loading=!1}resetData(){this._loading=!0,super.resetData(),this._loading=!1}onWidgetValueChange({source:e,value:t,checked:r,valid:n}){const s=this,i=s.getProject();if(n=void 0!==n?n:"function"==typeof e.isValid?e.isValid():e.isValid,!s._loading&&n&&i&&!i.isPropagating()){const r=s.record,n="set"+I.capitalizeFirstLetter(e.name);(n in r||e.name in r||r.$[e.name])&&(n in r?r[n](t):e.name in r?r[e.name]=t:r.$[e.name].put(t),s.requestPropagation())}}onLocaleChange(){Object.values(this.widgetMap).forEach(e=>{e instanceof jn&&e.parent===this&&(e.labelWidth=this.L("labelWidth"))})}}qh._$name="FormTab";class Xh extends Vs{static get $name(){return"StartDateField"}static get defaultConfig(){return{project:null}}transformTimeValue(e){const t=this.project&&this.project.calendar;if(t){const r=je.clearTime(e),n=t.skipNonWorkingTime(r);if(je.isValidDate(n)&&je.isEqual(n,r,"day"))return je.copyTimeValues(r,n)}return super.transformTimeValue(e)}}Xh._$name="StartDateField",U.register("startdatefield",Xh),U.register("startdate",Xh);class Kh extends pa{static get $name(){return"EffortField"}static get type(){return"effort"}}Kh._$name="EffortField",U.register(Kh.type,Kh),U.register(Kh.type+"field",Kh);class Zh extends qh{static get $name(){return"GeneralTab"}static get type(){return"generaltab"}static get defaultConfig(){return{localeClass:this,title:"L{General}",ref:"generaltab",defaults:{localeClass:this,labelWidth:this.L("labelWidth")},items:[{type:"text",required:!0,label:"L{Name}",clearable:!0,name:"name",ref:"nameField",cls:"b-name"},{type:"number",label:"L{% complete}",name:"renderedPercentDone",ref:"percentDoneField",cls:"b-percent-done b-inline",flex:"1 0 50%",min:0,max:100},{type:"effort",label:"L{Effort}",name:"fullEffort",ref:"effortField",flex:"1 0 50%"},{html:"",dataset:{text:this.L("L{Dates}")},cls:"b-divider",flex:"1 0 100%"},{type:"startdate",label:"L{Start}",name:"startDate",ref:"startDateField",cls:"b-start-date b-inline",flex:"1 0 50%"},{type:"enddate",label:"L{Finish}",name:"endDate",ref:"endDateField",cls:"b-end-date",flex:"1 0 50%"},{type:"durationfield",label:"L{Duration}",name:"fullDuration",ref:"fullDurationField",flex:".5 0",cls:"b-inline"}]}}loadEvent(e){const t={unit:e.durationUnit,magnitude:1},{isParent:r}=e,{fullDurationField:n,percentDoneField:s,startDateField:i,endDateField:o,effortField:a}=this.widgetMap;n&&(n.disabled=r),s&&(s.disabled=r),i&&(i.step=t),o&&(o.step=t,o.disabled=r),a&&(a.unit=e.effortUnit,a.disabled=r),super.loadEvent(e)}}Zh._$name="GeneralTab",U.register(Zh.type,Zh);class Jh extends As{static get $name(){return"ModelCombo"}static get type(){return"modelcombo"}get value(){const e=super.value;return this.store.getById(e)||e}set value(e){super.value=e}}Jh._$name="ModelCombo",U.register(Jh.type,Jh);class Qh extends Jh{static get $name(){return"CalendarField"}static get type(){return"calendarfield"}static get defaultConfig(){return{valueField:"id",displayField:"name",editable:!1,listItemTpl:e=>e&&e.name?e.name:this.L("L{Default calendar}"),displayValueRenderer:e=>e?e.name:this.L("L{Default calendar}")}}get value(){return super.value}set value(e){e&&e.isDefault&&e.isDefault()&&(e=null),super.value=e}}Qh._$name="CalendarField",U.register(Qh.type,Qh);class eg extends Zh{static get $name(){return"SchedulerGeneralTab"}static get type(){return"schedulergeneraltab"}static get defaultConfig(){return{localeClass:this,title:"L{General}",ref:"generaltab",defaults:{localeClass:this,labelWidth:this.L("labelWidth")},items:[{type:"text",required:!0,label:"L{Name}",clearable:!0,name:"name",ref:"nameField",cls:"b-name"},{type:"number",label:"L{% complete}",name:"renderedPercentDone",ref:"percentDoneField",cls:"b-percent-done b-inline",flex:"1 0 50%",min:0,max:100},{type:"calendarfield",ref:"calendarField",name:"calendar",label:"L{Calendar}",flex:"1 0 50%"},{html:"",dataset:{text:this.L("L{Dates}")},cls:"b-divider",flex:"1 0 100%"},{type:"date",label:"L{Start}",name:"startDate",ref:"startDateField",cls:"b-start-date b-inline",flex:"1 0 50%"},{type:"date",label:"L{Finish}",name:"endDate",ref:"endDateField",cls:"b-end-date",flex:"1 0 50%"},{type:"durationfield",label:"L{Duration}",name:"fullDuration",ref:"fullDurationField",flex:"1 0 50%",cls:"b-inline"},{type:"checkbox",ref:"manuallyScheduledField",name:"manuallyScheduled",label:"L{Manually scheduled}",flex:"1 0 50%"}]}}loadEvent(e){const t={unit:e.durationUnit,magnitude:1},{isParent:r}=e,{fullDurationField:n,percentDoneField:s,startDateField:i,endDateField:o,calendarField:a}=this.widgetMap,l=!this.record;n&&(n.disabled=r),s&&(s.disabled=r),i&&(i.step=t),o&&(o.step=t,o.disabled=r),a&&l&&(a.store=e.getProject().getCalendarManagerStore()),super.loadEvent(e)}}eg._$name="SchedulerGeneralTab",U.register(eg.type,eg),function(e){e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.Year="year"}($h||($h={})),function(e){e.MustStartOn="muststarton",e.MustFinishOn="mustfinishon",e.StartNoEarlierThan="startnoearlierthan",e.StartNoLaterThan="startnolaterthan",e.FinishNoEarlierThan="finishnoearlierthan",e.FinishNoLaterThan="finishnolaterthan"}(jh||(jh={})),function(e){e.Normal="Normal",e.FixedDuration="FixedDuration",e.FixedEffort="FixedEffort",e.FixedUnits="FixedUnits"}(Hh||(Hh={})),function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToStart=2]="EndToStart",e[e.EndToEnd=3]="EndToEnd"}(Nh||(Nh={})),function(e){e.Project="Project",e.FromEvent="FromEvent",e.ToEvent="ToEvent"}(Bh||(Bh={})),function(e){e[e.Unknown=0]="Unknown",e[e.Gantt=1]="Gantt",e[e.Scheduler=2]="Scheduler"}(zh||(zh={})),function(e){e.Forward="Forward",e.Backward="Backward",e.None="None"}(Vh||(Vh={}));const tg=e=>e.map((e,t)=>[t,e]);class rg extends As{static get $name(){return"DependencyTypePicker"}static get type(){return"dependencytypepicker"}construct(e){super.construct(e),ne.on({locale:()=>{this.items=tg(this.L("L{SchedulerProCommon.dependencyTypesLong}"))},thisObj:this})}get store(){return this._items||(this.items=this._items=tg(this.L("L{SchedulerProCommon.dependencyTypesLong}"))),super.store}set store(e){super.store=e}}rg._$name="DependencyTypePicker",U.register(rg.type,rg);class ng extends Fa{static get type(){return"duration"}static get isGanttColumn(){return!0}get durationUnitField(){return this.field+"Unit"}static get fields(){return[{name:"decimalPrecision",defaultValue:null}]}static get defaults(){return{field:"fullDuration",text:"L{Duration}",min:0,step:1,instantUpdate:!0,sortable:(e,t)=>{const r=e.isScheduled?e.calendar.calculateDuration(e.startDate,e.endDate,$h.Millisecond):0,n=t.isScheduled?t.calendar.calculateDuration(t.startDate,t.endDate,$h.Millisecond):0;return r===n?0:r<n?-1:1}}}defaultRenderer({record:e,isExport:t}){const r=e[this.field],n=typeof r,s="number"===n?r:r&&r.magnitude;if("number"!=typeof s)return t?"":null;switch(n){case"number":return this.round(s)+" "+je.getLocalizedNameOfUnit(e[this.durationUnitField],1!==r);case"object":return this.round(s)+" "+je.getLocalizedNameOfUnit(r.unit,1!==r.magnitude)}}round(e){let{decimalPrecision:t}=this;if(!1===t)return e;null==t&&(t=this.grid.durationDisplayPrecision||1);const r=Math.pow(10,t);return Math.round(e*r)/r}get defaultEditor(){return{type:"duration",name:this.field}}canEdit(e){return e.isLeaf}}Ea.registerColumnType(ng),ng._$name="DurationColumn";const sg=(e,t)=>{e.instanceMeta(t).valid=!0},ig=(e,t)=>{e.instanceMeta(t).valid=!1},og=(e,t)=>!1!==e.instanceMeta(t).valid;class ag extends(Wh(Uh(Yh(Gh(br(un)))))){static get $name(){return"DependencyTab"}static makeDefaultConfig(e){const t="fromEvent"===e?"predecessorstab":"successorstab";return{direction:e,negDirection:"fromEvent"===e?"toEvent":"fromEvent",ref:t,localeClass:this,title:"fromEvent"===e?"L{Predecessors}":"L{Successors}",layoutStyle:{flexFlow:"column nowrap"},items:[{type:"container",flex:"0 0 auto",items:[{type:"button",cls:"b-add-button b-green",icon:"b-icon b-icon-add",ref:t+"-add"},{type:"button",cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0,ref:t+"-remove"}]},{type:"grid",flex:"1 1 auto",ref:t+"-grid",emptyText:"",columns:[{localeClass:this,text:"L{ID}",flex:1,editor:!1,htmlEncode:!1,renderer({record:t,row:r,grid:n}){let s;if(og(t,n)){const r=t[e];s=!r||r.hasGeneratedId?"*":r.id}else r.addCls("b-invalid"),s='<div class="b-icon b-icon-warning"></div>';return s}},{localeClass:this,text:"L{Name}",field:e,flex:5,renderer:({value:e})=>e&&e.name||"",editor:{type:"modelcombo",displayField:"name",valueField:"id",editable:!1,allowInvalid:!0}},{localeClass:this,text:"L{Type}",field:"type",flex:3,editor:"dependencytypepicker",renderer({value:e}){return this.L("L{SchedulerProCommon.dependencyTypesLong}")[e]}},{localeClass:this,text:"L{Lag}",type:"duration",field:"fullLag",flex:2,editor:{allowNegative:!0}}],disableGridRowModelWarning:!0}]}}afterConstruct(){super.afterConstruct();const e=this,t=e.addButton=e.widgetMap[e.ref+"-add"],r=e.removeButton=e.widgetMap[e.ref+"-remove"],n=e.grid=e.widgetMap[e.ref+"-grid"];t&&t.on("click",e.onAddClick,e),r&&r.on("click",e.onRemoveClick,e),n.on({selectionChange:e.onGridSelectionChange,startCellEdit:e.onGridStartCellEdit,finishCellEdit:e.onGridFinishCellEdit,cancelCellEdit:e.onGridCancelCellEdit,thisObj:e})}get dependencyGrid(){return this.widgetMap&&this.widgetMap[this.ref+"-grid"]}get taskCombo(){const e=this.dependencyGrid,t=e&&e.columns.get(this.direction);return t&&t.editor}loadEvent(e){const t=this,r=t.dependencyGrid,n=!r.store.isChained,s=!n&&e!==t.record;super.loadEvent(e);const i=t.taskCombo,o=t.getProject().getDependencyStore(),a=t.getProject().getEventStore();n?(t.depStoreGeneration=o.storage.generation,t.eventStoreGeneration=a.storage.generation,r.store=o.makeChained(e=>e[t.negDirection]===t.record,null),i.store=a.makeChained(e=>e!==t.record,null,{doRelayToMaster:[],excludeCollapsedRecords:!1}),i.store.filterBy(e=>!r.store.find(r=>r[t.direction]===e)),i.on({thisObj:t,change:"onGridCellEditChange"})):((s||o.storage.generation!==t.depStoreGeneration)&&(r.store.fillFromMaster(),t.depStoreGeneration=o.storage.generation),(s||a.storage.generation!==t.eventStoreGeneration)&&(i.store.fillFromMaster(),t.eventStoreGeneration=a.storage.generation)),t.requestReadyStateChange()}unshadowAll(){this.dependencyGrid.store.forEach(e=>{e.isShadowed&&(e.forEachFieldAtom(e=>{e.clearUserInput()}),sg(e,this.dependencyGrid),e.unshadow())})}beforeSave(){this.unshadowAll(),super.beforeSave()}beforeCancel(){const e=this._activeCellEdit;e&&e.editor.cancelEdit(),this.unshadowAll(),super.beforeCancel()}async insertNewDependency(){const e=this,t=e.dependencyGrid,r=t.store,n=e.getProject().getDependencyStore(),[s]=r.insert(0,{type:Nh.EndToStart,lag:0,lagUnit:$h.Day,[e.negDirection]:e.record});return e.depStoreGeneration=n.storage.generation,t.features.cellEdit.startEditing({field:e.direction,id:s.id}),ig(s,t),s}onAddClick(){this.insertNewDependency()}onRemoveClick(){const e=this,t=e.dependencyGrid.selectedRecords,r=t.some(e=>!e.isShadowed());e.getProject().getDependencyStore().remove(t),e.dependencyGrid.selectedRecords=null,e.taskCombo.store.fillFromMaster(),e.removeButton.disable(),r&&e.requestPropagation()}onGridSelectionChange({selection:e}){e&&e.length?this.removeButton.enable():this.removeButton.disable()}clearActiveEditorErrors(){const e=this._activeCellEdit;e&&e.column.field===this.direction&&e.editor.inputField.clearError()}onGridCellEditChange(){this.clearActiveEditorErrors()}onGridStartCellEdit({editorContext:e}){const t=this,r=t._editingDependency=e.record,n=t.dependencyGrid,s=t.direction;t._activeCellEdit=e,e.column.field===s&&(og(r,n)?t.clearActiveEditorErrors():r[s]?e.editor.inputField.setError(t.L("L{Cyclic dependency has been detected}")):e.editor.inputField.setError(t.L("L{Invalid dependency}")),r.shadow())}onGridFinishCellEdit({editorContext:e}){const t=this,{record:r,column:n}=e,s=t.direction,i=t.dependencyGrid;if(n.field===s)if(r[s]){t.getProject().getDependencyStore().isValidDependency({[t.direction]:r[t.direction],[t.negDirection]:r[t.negDirection],lag:r.lag,lagUnit:r.lagUnit,type:r.type}).then(e=>{e?(sg(r,t.dependencyGrid),r.unshadow(),t.taskCombo.store.fillFromMaster(),t.redrawDependencyRow(r),t.requestPropagation(),t.requestReadyStateChange()):(ig(r,i),t.redrawDependencyRow(r),Tn.show({html:t.L("L{Cyclic dependency has been detected}")}),t.requestReadyStateChange())})}else ig(r,i),t.redrawDependencyRow(r),t.requestReadyStateChange();else t.redrawDependencyRow(r),r[s]&&og(r,i)&&(r.unshadow(),t.requestPropagation()),t.requestReadyStateChange();t._activeCellEdit=t._editingDependency=null}onGridCancelCellEdit(e){const t=this;if(t._editingDependency){const e=t._editingDependency,r=t.dependencyGrid;e[t.direction]?og(e,r)&&e.unshadow():(ig(e,r),t.redrawDependencyRow(e)),t._activeCellEdit=t._editingDependency=null}t.requestReadyStateChange()}redrawDependencyRow(e){const t=this.dependencyGrid,r=t.rowManager.getRowById(e);r&&r.render(t.store.indexOf(e),e)}get canSave(){const e=this.dependencyGrid;return e.store.reduce((t,r)=>t&&og(r,e),!0)}}ag._$name="DependencyTab";class lg extends ag{static get $name(){return"SuccessorsTab"}static get type(){return"successorstab"}static get defaultConfig(){return Object.assign(this.makeDefaultConfig("toEvent"),{cls:"b-successors-tab"})}}lg._$name="SuccessorsTab",U.register(lg.type,lg);class cg extends ag{static get $name(){return"PredecessorsTab"}static get type(){return"predecessorstab"}static get defaultConfig(){return Object.assign(this.makeDefaultConfig("fromEvent"),{cls:"b-predecessors-tab"})}}cg._$name="PredecessorsTab",U.register(cg.type,cg);class dg extends(Uh(Yh(Gh(un)))){static get $name(){return"ResourcesTab"}static get type(){return"resourcestab"}static get defaultConfig(){return{localeClass:this,ref:"resourcestab",title:"L{Resources}",layoutStyle:{flexFlow:"column nowrap"},items:[{type:"container",flex:"0 0 auto",items:[{type:"button",cls:"b-add-button b-green",icon:"b-icon b-icon-add",ref:"resourcestab-add"},{type:"button",cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0,ref:"resourcestab-remove"}]},{type:"grid",flex:"1 1 auto",ref:"resourcestab-grid",columns:[{localeClass:this,text:"L{Resource}",field:"resource",flex:7,renderer:({value:e})=>e&&e.name||"",editor:{type:"modelcombo",displayField:"name",valueField:"id",editable:!1}},{localeClass:this,text:"L{Units}",field:"units",flex:3,renderer:e=>this.L("L{unitsTpl}",e),editor:{type:"numberfield",min:0,max:100,step:10}}],disableGridRowModelWarning:!0}]}}afterConstruct(){super.afterConstruct();const e=this,t=e.addButton=e.widgetMap["resourcestab-add"],r=e.removeButton=e.widgetMap["resourcestab-remove"],n=e.grid=e.widgetMap["resourcestab-grid"];t&&t.on("click",e.onAddClick,e),r&&r.on("click",e.onRemoveClick,e),n.on({selectionChange:e.onGridSelectionChange,startCellEdit:e.onGridStartCellEdit,finishCellEdit:e.onGridFinishCellEdit,thisObj:e})}get assignmentGrid(){return this.widgetMap&&this.widgetMap["resourcestab-grid"]}get resourceCombo(){const e=this.assignmentGrid,t=e&&e.columns.get("resource");return t&&t.editor}loadEvent(e){const t=this,r=t.assignmentGrid,n=!r.store.isChained,s=!n&&e!==t.record;super.loadEvent(e);const i=t.resourceCombo,o=t.getProject().getAssignmentStore(),a=t.getProject().getResourceStore();n?(t.assignmentStoreGeneration=o.storage.generation,t.resourceStoreGeneration=a.storage.generation,r.store=o.makeChained(e=>t.record&&e.event===t.record,["resource"]),i.store=a.makeChained(e=>t.record&&!t.record.isAssignedTo(e)||!t.activeAssignment||t.activeAssignment.resource===e)):((s||o.storage.generation!==t.assignmentStoreGeneration)&&r.store.fillFromMaster(),(s||a.storage.generation!==t.resourceStoreGeneration)&&i.store.fillFromMaster())}get activeAssignment(){return this.assignmentGrid.features.cellEdit.activeRecord}async insertNewAssignment(){const e=this.getProject().getAssignmentStore(),t=this.assignmentGrid,[r]=e.insert(0,{event:this.record,resource:null,units:100});return this.assignmentStoreGeneration=e.storage.generation,t.features.cellEdit.startEditing({field:"resource",id:r.id}),r}beforeSave(){this.pruneInvalidAssignments()}onAddClick(){this.insertNewAssignment()}onRemoveClick(){const e=this;e.assignmentGrid.store.remove(e.assignmentGrid.selectedRecords),e.assignmentGrid.selectedRecords=null,e.removeButton.disable(),e.requestPropagation()}onGridSelectionChange({selection:e}){e&&e.length?this.removeButton.enable():this.removeButton.disable()}onGridStartCellEdit({editorContext:e}){"resource"===e.column.field&&(this.resourceCombo.store.fillFromMaster(),this._editingAssignment=e.record)}onGridFinishCellEdit(){const e=this;e._editingAssignment?(e._editingAssignment.resource&&e.requestPropagation(),e._editingAssignment=null):e.requestPropagation()}pruneInvalidAssignments(){const e=this.assignmentGrid.store;e.remove(e.query(e=>!e.isValid))}}dg._$name="ResourcesTab",U.register(dg.type,dg);class ug extends As{static get $name(){return"ConstraintTypePicker"}static get type(){return"constrainttypepicker"}updateLocalization(){super.updateLocalization(),this.store.data=this.buildStoreData()}buildStoreData(){const e=this;return[{id:"none",text:e.L("L{none}")},{id:"muststarton",text:e.L("L{muststarton}")},{id:"mustfinishon",text:e.L("L{mustfinishon}")},{id:"startnoearlierthan",text:e.L("L{startnoearlierthan}")},{id:"startnolaterthan",text:e.L("L{startnolaterthan}")},{id:"finishnoearlierthan",text:e.L("L{finishnoearlierthan}")},{id:"finishnolaterthan",text:e.L("L{finishnolaterthan}")}]}set value(e){super.value=e}get value(){const e=super.value;return"none"===e?null:e}get store(){return this._store||(this.store=new Cs({data:this.buildStoreData(),allowNullId:!0})),this._store}set store(e){super.store=e}}ug._$name="ConstraintTypePicker",U.register(ug.type,ug);class hg extends As{static get $name(){return"SchedulingModePicker"}static get type(){return"schedulingmodecombo"}buildStoreData(){return[{id:Hh.Normal,text:this.L("L{Normal}")},{id:Hh.FixedDuration,text:this.L("L{Fixed Duration}")},{id:Hh.FixedUnits,text:this.L("L{Fixed Units}")},{id:Hh.FixedEffort,text:this.L("L{Fixed Effort}")}]}get store(){return this._store||(this.store=new Cs({data:this.buildStoreData()})),this._store}set store(e){super.store=e}updateLocalization(){super.updateLocalization(),this.store.data=this.buildStoreData()}}hg._$name="SchedulingModePicker",U.register(hg.type,hg);class gg extends qh{static get $name(){return"AdvancedTab"}static get type(){return"advancedtab"}static get defaultConfig(){return{localeClass:this,title:"L{Advanced}",ref:"advancedtab",defaults:{localeClass:this,labelWidth:this.L("labelWidth")},items:[{type:"calendarfield",ref:"calendarField",name:"calendar",label:"L{Calendar}",flex:"1 0 50%",cls:"b-inline"},{type:"checkbox",ref:"manuallyScheduledField",name:"manuallyScheduled",label:"L{Manually scheduled}",flex:"1 0 50%"},{type:"schedulingmodecombo",ref:"schedulingModeField",name:"schedulingMode",label:"L{Scheduling mode}",flex:"1 0 50%",cls:"b-inline"},{type:"checkbox",ref:"effortDrivenField",name:"effortDriven",label:"L{Effort driven}",flex:"1 0 50%"},{html:"",dataset:{text:this.L("L{Constraint}")},cls:"b-divider",flex:"1 0 100%"},{type:"constrainttypepicker",ref:"constraintTypeField",name:"constraintType",label:"L{Constraint type}",clearable:!0,flex:"1 0 50%",cls:"b-inline"},{type:"date",ref:"constraintDateField",name:"constraintDate",label:"L{Constraint date}",flex:"1 0 50%",cls:"b-inline"},{type:"checkbox",ref:"rollupField",name:"rollup",label:"L{Rollup}",flex:"1 0 50%",cls:"b-inline"}]}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}loadEvent(e){const t=!this.record,r=this.calendarField;r&&t&&(r.store=e.getProject().getCalendarManagerStore()),super.loadEvent(e)}}gg._$name="AdvancedTab",U.register(gg.type,gg);class mg extends qh{static get $name(){return"NotesTab"}static get type(){return"notestab"}static get defaultConfig(){return{localeClass:this,title:"L{Notes}",ref:"notestab",layoutConfig:{alignItems:"flex-start",alignContent:"stretch"},items:[{type:"textareafield",cls:"b-taskeditor-notes-field",name:"note"}]}}}mg._$name="NotesTab",U.register(mg.type,mg);class pg extends(Wh(vn)){static get $name(){return"TaskEditorBase"}static get defaultConfig(){return{localeClass:this,title:"L{Information}",width:this.L("L{editorWidth}"),cls:"b-schedulerpro-taskeditor",closable:!0,draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible",autoClose:!0,onChange:null,onCancel:null,onSave:null,autoShow:!1,height:"30em",closeAction:"cancelAndHide",items:null,bbar:[{text:"L{Save}",localeClass:this,type:"button",color:"b-green",ref:"saveButton"},{text:"L{Delete}",localeClass:this,type:"button",color:"b-gray",ref:"deleteButton"},{text:"L{Object.Cancel}",localeClass:this,type:"button",color:"b-gray",ref:"cancelButton"}],durationDecimalPrecision:1,extraItems:null,tabsConfig:null,extraWidgets:null,defaultTabs:null,project:null}}get extraWidgets(){return console.warn("`extraWidgets` was deprecated in 1.0.1, please change your code to use `extraItems`"),this.extraItems}set extraWidgets(e){console.warn("`extraWidgets` was deprecated in 1.0.1, please change your code to use `extraItems`"),this.extraItems=e}processWidgetConfig(e){var t;const r=this;switch((null===(t=e.type)||void 0===t?void 0:t.includes("date"))&&null==e.weekStartDay&&(e.weekStartDay=r.weekStartDay),e.ref){case"startDateField":case"endDateField":e.project=r.project;break;case"fullDurationField":e.decimalPrecision=r.durationDecimalPrecision;break;case"predecessorstab-grid":case"successorstab-grid":e.durationDisplayPrecision=r.durationDisplayPrecision;break;case"tabs":e.items.forEach(e=>{e.extraItems=(r.extraItems||{})[e.type]})}return!("deleteButton"===e.ref&&!r.showDeleteButton)&&e}startConfigure(e){const t=e.tabsConfig||{},r=ze.clone(e.defaultTabs);Object.keys(t).forEach(e=>{let n;const s=t[e],i=r.find((t,r)=>(n=r,(e||"").toLowerCase()===t.type));i?!1===s?r.splice(n,1):"object"==typeof s&&Object.assign(i,s):r.push(s)}),e.items[0].items=r,super.startConfigure(e)}afterConfigure(){const e=this,t=e.widgetMap,r=e.bbar&&e.bbar.widgetMap||{},{cancelButton:n,deleteButton:s,saveButton:i}=r;i&&i.on("click",e.onSaveClick,e),n&&n.on("click",e.onCancelClick,e),s&&s.on("click",e.onDeleteClick,e),Object.values(t).forEach(t=>{t.isEventChangePropagator&&t.on("requestPropagation",e.onPropagationRequested,e),t.isReadyStatePropagator&&t.on("readystatechange",e.onReadyStateChange,e)}),ne.on({locale:e.onLocaleChange,thisObj:e})}onSaveClick(){this.canSave?this.trigger("save"):Tn.show({html:this.L("L{saveError}")})}onCancelClick(){this.trigger("cancel")}onDeleteClick(){this.trigger("delete")}onPropagationRequested(){this.trigger("requestPropagation")}onReadyStateChange({source:e,canSave:t}){this.requestReadyStateChange(),e.couldSaveTitle||(e.couldSaveTitle=e.title),e.parent===this.widgetMap.tabs&&(t?(e.titleElement.classList.remove("b-invalid"),e.title=e.couldSaveTitle,e.couldSaveTitle=null):(e.titleElement.classList.add("b-invalid"),e.title="<span class='b-icon b-icon-warning'></span>"+e.couldSaveTitle))}get canSave(){let e=!0;return Object.values(this.widgetMap).forEach(t=>{t.isReadyStatePropagator&&(e=e&&t.canSave)}),e}get canCancel(){let e=!0;return Object.values(this.widgetMap).forEach(t=>{t.isReadyStatePropagator&&(e=e&&t.canCancel)}),e}cancelAndHide(){this.onCancelClick()}loadEvent(e){this.eachWidget(t=>("function"==typeof t.loadEvent&&t.loadEvent(e),!0))}beforeSave(){this.callWidgetHook("beforeSave")}afterSave(){this.callWidgetHook("afterSave")}beforeCancel(){this.callWidgetHook("beforeCancel")}afterCancel(){this.callWidgetHook("afterCancel")}beforeDelete(){this.callWidgetHook("beforeDelete")}afterDelete(){this.callWidgetHook("afterDelete")}callWidgetHook(e,t=[]){this.eachWidget(r=>{"function"==typeof r[e]&&r[e](...t)})}onInternalKeyDown(e){if("Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()){if(e.target.matches("input")){const t=K.fromElement(e.target);t&&t.internalOnChange&&t.internalOnChange()}e.preventDefault(),this.onSaveClick()}super.onInternalKeyDown(e)}onLocaleChange(){this.width=this.L("L{editorWidth}")}}pg._$name="TaskEditorBase";class fg extends pg{static get $name(){return"GanttTaskEditor"}static get defaultConfig(){return{items:[{type:"tabpanel",ref:"tabs",flex:"1 0 100%",layoutConfig:{alignItems:"stretch",alignContent:"stretch"},items:[]}],defaultTabs:[{type:"generaltab"},{type:"successorstab"},{type:"predecessorstab"},{type:"resourcestab"},{type:"advancedtab"},{type:"notestab"}]}}}fg._$name="GanttTaskEditor";var vg=e=>class extends(e||B){addAssignment({event:e,resource:t,assignmentStore:r,assignmentConfig:n}){const s={assignment:r.add(Object.assign({},n,{event:e,resource:t}))[0]};return s.propagationPromise=r.getProject().propagate(),s}removeAssignments(e,t){const r=new Set;return e.forEach(n=>{const s=n.event;if(s&&!s.placeHolder&&t){s.assignments.every(t=>e.includes(t))?r.has(s.id)||(s.remove(),r.add(s.id)):n.remove()}}),this.project.propagate()}};const yg=(e,t)=>{if(e!==t)throw new Error("Store set is prohibited for Scheduler Pro entity!")};var bg,Cg,wg=e=>class extends(e||B){static get relationConfig(){return[]}get taskStore(){return this.eventStore}set taskStore(e){this.eventStore=e}get eventStore(){const e=this.getProject();return e&&e.getEventStore()||null}get leftProjectEventStore(){const e=this.leftProject;return e&&e.getEventStore()||null}set eventStore(e){yg(this.eventStore,e)}get dependencyStore(){const e=this.getProject();return e&&e.getDependencyStore()||null}set dependencyStore(e){yg(this.dependencyStore,e)}get assignmentStore(){const e=this.getProject();return e&&e.getAssignmentStore()||null}set assignmentStore(e){yg(this.assignmentStore,e)}get resourceStore(){const e=this.getProject();return e&&e.getResourceStore()||null}set resourceStore(e){yg(this.resourceStore,e)}get calendarManagerStore(){const e=this.getProject();return e&&e.getCalendarManagerStore()||null}set calendarManagerStore(e){yg(this.calendarManagerStore,e)}};class Sg{initialize(e){e&&Object.assign(this,e)}static new(e){const t=new this;return t.initialize(e),t}}!function(e){e[e.Cancel=0]="Cancel",e[e.Restart=1]="Restart",e[e.Resume=2]="Resume"}(bg||(bg={}));class Dg extends Sg{}class Eg extends Dg{}class xg extends Dg{}class Tg extends Dg{}class Rg extends Dg{}!function(e){e[e.Cancel=0]="Cancel",e[e.Resume=1]="Resume"}(Cg||(Cg={}));class Mg extends Sg{onNode(e){}onTopologicalNode(e){}onCycle(e,t){return Cg.Cancel}}const kg=e=>class extends e{walkDepth(e){const t=new Map,r=new Set,n=[{node:this,from:this}];let s;for(;s=n.length;){const i=n[s-1].node;if(r.has(i)){n.pop();continue}const o=t.get(i);if(null!=o){if(o<s){if(e.onCycle(i,n)!==Cg.Resume)break}else r.add(i),e.onTopologicalNode(i);n.pop()}else{t.set(i,s),e.onNode(i);const o=n.length;e.forEachNext(i,e=>n.push({node:e,from:i})),n.length===o&&(r.add(i),e.onTopologicalNode(i),n.pop())}}}},Ig=e=>{const t=e[e.length-1].node,r=[t];let n=e.length-1,s=e.length-1;do{for(;n>=0&&e[n].from===e[s].from;n--);n>=0&&(r.push(e[n].node),s=n,n--)}while(n>=0&&e[n].node!==t);return r.push(t),r.reverse()};class Fg extends Mg{forEachNext(e,t){e.forEachOutgoing(this,t)}}const Ag=e=>class extends e{forEachOutgoing(e,t){this.getOutgoing(e).forEach(t)}},Pg=e=>class extends e{forEachIncoming(e,t){this.getIncoming(e).forEach(t)}},Lg=e=>class extends e{constructor(){super(...arguments),this.outgoing=new Set}hasEdgeTo(e){return this.outgoing.has(e)}addEdgeTo(e){this.outgoing.add(e)}removeEdgeTo(e){this.outgoing.delete(e)}addEdgesTo(e){e.forEach(e=>this.addEdgeTo(e))}getOutgoing(e){return Array.from(this.outgoing)}forEachOutgoing(e,t){this.outgoing.forEach(t)}},Og=e=>class extends e{constructor(){super(...arguments),this.incoming=new Set}hasEdgeFrom(e){return this.incoming.has(e)}addEdgeFrom(e){this.incoming.add(e)}removeEdgeFrom(e){this.incoming.delete(e)}addEdgesFrom(e){e.forEach(e=>this.addEdgeFrom(e))}getIncoming(e){return Array.from(this.incoming)}forEachIncoming(e,t){this.incoming.forEach(t)}},_g=e=>class extends e{addEdgeTo(e){super.addEdgeTo(e),e.incoming.add(this)}removeEdgeTo(e){super.removeEdgeTo(e),e.incoming.delete(this)}addEdgeFrom(e){super.addEdgeFrom(e),e.outgoing.add(this)}removeEdgeFrom(e){super.removeEdgeFrom(e),e.outgoing.delete(this)}};class $g extends(_g(Lg(Og(Ag(Pg(kg(Sg))))))){}const jg=e=>class extends e{constructor(){super(...arguments),this.nodes=new Set}getNodes(){return this.nodes}hasDirectNode(e){return this.getNodes().has(e)}addNodes(e){e.forEach(e=>this.addNode(e))}addNode(e){return this.nodes.add(e),e}removeNodes(e){e.forEach(e=>this.removeNode(e))}removeNode(e){if(!this.hasDirectNode(e))throw new Error(`This [${e}] does not exists in the graph`);e.outgoing.forEach(t=>t.removeEdgeFrom(e)),e.incoming.forEach(t=>t.removeEdgeTo(e)),this.nodes.delete(e)}getIncoming(){return Array.from(this.nodes)}getOutgoing(){return Array.from(this.nodes)}forEachIncoming(e,t){this.nodes.forEach(t)}forEachOutgoing(e,t){this.nodes.forEach(t)}};class Hg extends(jg(Lg(Og(Ag(Pg(kg(Sg))))))){}const Ng=e=>e.slice(0,1).toUpperCase()+e.slice(1),Bg=e=>Object(e)!==e,zg=(e,t,r)=>(Object.defineProperty(e,t,{value:r}),r);var Vg;!function(e){e[e.Canceled=0]="Canceled",e[e.Completed=1]="Completed",e[e.Passed=2]="Passed"}(Vg||(Vg={}));const Wg=e=>class extends e{constructor(){super(...arguments),this.nodesMap=new Map,this.needRecalculationAtoms=new Set,this.stableAtoms=new Set,this.isPropagating=!1,this.propagateCompletedListeners=[],this.propagateSuspended=0}isAtomNeedRecalculation(e){return this.needRecalculationAtoms.has(e)}markAsNeedRecalculation(e){this.needRecalculationAtoms.add(e)}markProcessed(e){this.needRecalculationAtoms.delete(e)}markStable(e){this.stableAtoms.add(e)}isAtomStable(e){return this.stableAtoms.has(e)}commit(){this.needRecalculationAtoms.forEach(e=>e.clearUserInput()),this.needRecalculationAtoms.clear(),this.changedAtoms.forEach(e=>e.commitValue()),this.stableAtoms.forEach(e=>e.commitEdges()),this.stableAtoms.clear()}reject(){this.rejectPartialProgress(),this.needRecalculationAtoms.forEach(e=>e.clearUserInput()),this.needRecalculationAtoms.clear()}rejectPartialProgress(){this.touchedAtoms.forEach((e,t)=>t.reject()),this.stableAtoms.clear()}addNode(e){const t=super.addNode(e);return this.nodesMap.set(e.id,e),this.markAsNeedRecalculation(e),e.onEnterGraph(this),t}removeNode(e){e.outgoing.forEach(e=>this.markAsNeedRecalculation(e));const t=super.removeNode(e);return this.nodesMap.delete(e.id),this.needRecalculationAtoms.delete(e),this.stableAtoms.delete(e),e.onLeaveGraph(this),t}startAtomCalculation(e){const t=e.calculate(e.proposedValue);let r=t.next();const n=r.value;return n instanceof Dg?{effect:n,continuation:{iterator:t}}:r.done?{value:n}:{continuation:{atom:n,iterator:t}}}continueAtomCalculation(e,t,r){const n=this,s=t.iterator;let i=t.atom;do{let t;if(i)if(e.observedDuringCalculation.push(i),r.has(i)&&!this.isAtomStable(i)){let e;n.walkDepth(Fg.new({forEachNext:function(e,t){e===n?n.needRecalculationAtoms.forEach(t):e.observedDuringCalculation.forEach(t)},onCycle:(t,r)=>(e=Ig(r),Cg.Cancel)})),t={value:Rg.new({cycle:e}),done:!0}}else t=s.next(i.hasNextStableValue()?i.getNextStableValue():i.getConsistentValue());else t=s.next();const o=t.value;if(o instanceof Dg)return{effect:o,continuation:{iterator:s}};if(t.done)return{value:o};i=o}while(!r.has(i)||this.isAtomStable(i));return{continuation:{iterator:s,atom:i}}}*propagateSingle(){const e=[],t=new Set,r=this;let n,s=null;if(this.walkDepth(Fg.new({forEachNext:function(e,t){e===r?r.needRecalculationAtoms.forEach(t):Fg.prototype.forEachNext.call(this,e,t)},onNode:e=>{},onCycle:(e,t)=>(s=Ig(t),Cg.Cancel),onTopologicalNode:r=>{r!==this&&(t.add(r),e.push(r))}})),s)return Rg.new({cycle:s});const i=this.touchedAtoms=new Map,o=new Map,a=this.changedAtoms=[];for(;n=e.length;){const r=e[n-1];if(this.isAtomStable(r)||!t.has(r)){e.pop();continue}let s;if(null!=o.get(r)){const e=i.get(r);s=this.continueAtomCalculation(r,e,t)}else o.set(r,n),s=this.startAtomCalculation(r);if(s.effect&&(yield s.effect),s.continuation){i.set(r,s.continuation);const t=s.continuation.atom;t&&(r.observedDuringCalculation.push(t),e.push(t))}else{i.set(r,null);const t=s.value;r.equality(t,r.getConsistentValue())||(a.push(r),r.nextStableValue=t),this.markStable(r),e.pop()}}return{success:!0}}async onEffect(e){if(e instanceof Eg)return await e.promise,bg.Resume;if(e instanceof xg)return bg.Cancel;if(e instanceof Tg)return bg.Restart;if(e instanceof Rg)throw new Error("Graph cycle detected");return bg.Resume}waitForPropagateCompleted(){return this.isPropagating?new Promise(e=>{this.propagateCompletedListeners.push(e)}):Promise.resolve(null)}suspendPropagate(){this.propagateSuspended++}async resumePropagate(e){if(this.propagateSuspended){if(--this.propagateSuspended)return this.resumePromise;if(this.resumePromise&&!1!==e)return this.propagate()}return Promise.resolve(Vg.Completed)}async propagate(e,t=!1){const r=this;if(r.propagateSuspended)return r.resumePromise||(r.resumePromise=new Promise((e,t)=>{r.resumeResolved=e,r.resumeRejected=t})),r.resumePromise;if(r.resumePromise){const n=r.resumeResolved,s=r.resumeRejected;return r.resumePromise=r.resumeResolved=r.resumeRejected=null,r.propagateUnsuspended(e,t).then(e=>(n(e),e),e=>(s(e),e))}return r.propagateUnsuspended(e,t)}async propagateUnsuspended(e,t=!1){if(this.isPropagating)throw new Error("Can not nest calls to `propagate`, use `waitForPropagateCompleted`");let r,n;this.isPropagating=!0;do{r=!1;const n=this.propagateSingle();let s;do{s=n.next();const i=s.value;if(i instanceof Dg){let n;if(n=e?await e(i):await this.onEffect(i),n===bg.Cancel)return"function"==typeof t&&t(),this.reject(),this.isPropagating=!1,await this.propagationCompletedHook(),this.onPropagationCompleted(Vg.Canceled),Vg.Canceled;if(n===bg.Restart){this.rejectPartialProgress(),r=!0;break}}}while(!s.done)}while(r);return t?("function"==typeof t&&t(),this.reject(),this.isPropagating=!1,await this.propagationCompletedHook(),this.onPropagationCompleted(Vg.Completed),n=Vg.Passed):(this.commit(),this.isPropagating=!1,await this.propagationCompletedHook(),this.onPropagationCompleted(Vg.Completed),n=Vg.Completed),n}async tryPropagateWithNodes(e,t,r){t&&t.length&&(t=t.filter(e=>e.graph!==this)).length&&this.addNodes(t);const n=await this.propagate(e,r||!0);return t&&t.length&&t&&this.removeNodes(t),n}async propagationCompletedHook(){}onPropagationCompleted(e){this.propagateCompletedListeners.forEach(t=>t(e)),this.propagateCompletedListeners=[]}commitAllEdges(){this.nodes.forEach(e=>e.commitEdges())}toDotOnCycleException(){return this.commitAllEdges(),this.toDot()}toDotAtomName(e){let[t,r]=String(e.id).split("/");if(e.self){const r=e.self;r.name&&(t=r.name)}return`${t}/${r||"self"}`}toDotAtomValue(e){let t;if(e.newRefs&&e.oldRefs){const r=e.get();t=`Set(${r&&r.size||0})`}else t=e.get();return t instanceof Date?t=[t.getFullYear(),".",t.getMonth()+1,".",t.getDate()," ",t.getHours()+":"+t.getMinutes()].join(""):Array.isArray(t)&&(t=`Array(${t.length})`),t}toDotAtomColor(e){return!this.isAtomNeedRecalculation(e)||this.isAtomStable(e)?"darkgreen":"red"}toDotObtainCycle(){let e={};return this.walkDepth(Fg.new({onCycle:(t,r)=>{const n=Ig(r);return e=n.reduce(([e,t],r)=>(t&&(e[t.id]=r.id),[e,r]),[e,null])[0],Cg.Cancel}})),e}toDot(){let e=["digraph ChronoGraph {","splines=spline"];const t=Array.from(this.nodesMap.entries()),r=t.reduce((e,[t,r])=>{let[n,s]=String(t).split("/");const{id:i,name:o}=r.self||{},{field:a}=r;return n=o||i||n,s=a&&a.name||s,e.has(n)?e.get(n).add([s,r]):e.set(n,new Set([[s||"",r]])),e},new Map);e=Array.from(r.entries()).reduce((e,[t,r],n)=>(e.push(`subgraph cluster_${n} {`),e.push(`label="${t}"`),(e=Array.from(r.values()).reduce((e,[t,r])=>{let n=this.toDotAtomValue(r),s=this.toDotAtomColor(r);return e.push(`"${r.id}" [label="${t}=${n}", fontcolor="${s}"]`),e},e)).push("}"),e),e);let n=this.toDotObtainCycle();return e=t.reduce((e,[t,r])=>{const s=r.outgoing;return Array.from(s).reduce((e,s)=>{let i=!this.isAtomNeedRecalculation(r)||this.isAtomStable(r)?"darkgreen":"red",o=n[t]==s.id?5:1;return e.push(`"${t}" -> "${s.id}" [label="", color="${i}", penwidth=${o}]`),e},e),e},e),e.push("}"),e.join("\n")}toDotAtomIncoming(e){let t=["digraph ChronoGraph {","splines=spline"],r=new Set;((e,t,r)=>{let n,s,i=[e];for(;i.length;)n=i.pop(),r(n),s=t(n),s&&(i=i.concat(s.slice().reverse()))})(e,e=>Array.from(e.incoming),e=>r.add(e)),t=Array.from(r).reduce((t,r)=>{const n=this.toDotAtomName(r),s=this.toDotAtomValue(r);let i,o;return r==e?(i="orange",o=5):(i=this.toDotAtomColor(r),o=1),t.push(`"${r.id}" [label="${n}=${s}", fontcolor="${i}", penwidth=${o}]`),t},t);const n=this.toDotObtainCycle();return t=Array.from(r).reduce((e,t)=>Array.from(t.incoming).reduce((e,r)=>{const s=r.id,i=t.id,o=this.toDotAtomColor(r),a=n[s]==i?5:1;return e.push(`"${s}" -> "${i}" [label="", color="${o}", penwidth=${a}]`),e},e),t),t.push("}"),t.join("\n")}};class Gg extends(Wg(Hg)){}const Ug=Symbol("IteratorReturnedEarly");class Yg extends Sg{constructor(){super(...arguments),this.fields=new Map}hasField(e){return void 0!==this.getField(e)}getField(e){let t=void 0;return this.forEachParent(r=>{const n=r.fields.get(e);if(n)return t=n,Ug}),t}addField(e){const t=e.name;if(!t)throw new Error("Field must have a name");if(this.fields.has(t))throw new Error(`Field with name [${String(t)}] already exists`);return e.entity=this,this.fields.set(t,e),e}forEachParent(e){let t=this;for(;t;){if(e(t)===Ug)return Ug;t=t.parentEntity}}forEachField(e){const t=new Set;this.forEachParent(r=>{r.fields.forEach((r,n)=>{t.has(n)||(t.add(n),e(r,n))})})}}let qg=1;const Xg=e=>class extends e{constructor(){super(...arguments),this.id="chrono"+qg++}},Kg=(e,t)=>e instanceof Date&&t instanceof Date?e-t==0:e===t,Zg=e=>class extends e{constructor(){super(...arguments),this.equality=Kg,this.observedDuringCalculation=[]}clearUserInput(){this.proposedValue=void 0,this.proposedArgs=void 0}commitValue(){const e=this.nextStableValue;this.nextStableValue=void 0,this.value=e}commitEdges(){this.incoming.forEach(e=>this.removeEdgeFrom(e)),this.observedDuringCalculation.forEach(e=>this.addEdgeFrom(e)),this.observedDuringCalculation=[]}reject(){this.nextStableValue=void 0,this.observedDuringCalculation=[]}*calculate(e){return this.calculation?yield*this.calculation.call(this.calculationContext||this,e):void 0!==e?e:this.value}hasValue(){return this.hasNextStableValue()||this.hasProposedValue()||this.hasConsistentValue()}hasStableValue(){return this.hasNextStableValue()||this.hasConsistentValue()}hasNextStableValue(){return void 0!==this.nextStableValue}hasConsistentValue(){return void 0!==this.value}hasProposedValue(){return void 0!==this.proposedArgs&&void 0!==this.proposedArgs[0]}get(){return this.hasNextStableValue()?this.getNextStableValue():this.hasProposedValue()?this.getProposedValue():this.getConsistentValue()}put(e,...t){this.proposedValue=e,this.proposedArgs=Array.prototype.slice.call(arguments),this.graph&&this.graph.markAsNeedRecalculation(this)}getNextStableValue(){return this.nextStableValue}getConsistentValue(){return this.value}getProposedValue(){return this.proposedValue}getProposedOrPreviousValue(){return void 0!==this.proposedValue?this.proposedValue:this.value}async set(e,...t){const r=this.graph;return this.put(e,...t),r?r.propagate():Promise.resolve(Vg.Completed)}onEnterGraph(e){this.graph=e}onLeaveGraph(e){this.graph=void 0}};class Jg extends(Zg(Xg($g))){}const Qg=e=>class extends e{put(e,...t){return super.put(this.field.converter?this.field.converter(e,this.field):e,...t)}toString(){return`Field atom [${this.field.name}] of entity [${this.self}}]`}};class em extends(Qg(Jg)){}const tm=e=>class extends e{toString(){return`Entity atom [${this.self.id}]`}};class rm extends(tm(Jg)){}class nm extends Sg{constructor(){super(...arguments),this.persistent=!0,this.createAccessors=!0,this.atomCls=em}}const sm=Symbol("isReplica"),im=e=>class extends e{[sm](){}addEntity(e){e.enterGraph(this)}addEntities(e){e.forEach(e=>this.addEntity(e))}removeEntity(e){e.leaveGraph()}removeEntities(e){e.forEach(e=>this.removeEntity(e))}async tryPropagateWithEntities(e,t,r){t&&t.length&&(t=t.filter(e=>e.$$.graph!==this),this.addEntities(t));const n=await this.propagate(e,r||!0);return t&&t.length&&this.removeEntities(t),n}};class om extends(im(Gg)){}const am=Symbol("isEntity"),lm=e=>{return class extends e{[am](){}get $entity(){return cm(this.constructor.prototype)}get $(){const e={};return this.$entity.forEachField((t,r)=>{e[r]=this.createFieldAtom(t)}),zg(this,"$",e)}get $$(){return zg(this,"$$",rm.new({entity:this.$entity,self:this,equality:()=>!1,calculation:this.calculateSelf,calculationContext:this}))}*calculateSelf(){return this}createFieldAtom(e){const t=e.name,r=this.$calculations&&this[this.$calculations[t]];return e.atomCls.new({id:`${this.$$.id}/${t}`,field:e,self:this,calculationContext:r?this:void 0,calculation:r})}getGraph(){return this.$$.graph}forEachFieldAtom(e){const t=this.$;for(let r in t)e.call(this,t[r],r)}enterGraph(e){this.forEachFieldAtom(t=>e.addNode(t)),e.addNode(this.$$)}leaveGraph(){const e=this.$$.graph;e&&(this.forEachFieldAtom(t=>e.removeNode(t)),e.removeNode(this.$$))}isPropagating(){return this.getGraph().isPropagating}suspendPropagate(){const e=this.getGraph();e&&e.suspendPropagate()}async resumePropagate(e){const t=this.getGraph();return t&&t.resumePropagate(e)||Promise.resolve(Vg.Completed)}async propagate(e,t=!1){const r=this.getGraph();return r&&r.propagate(e,t)||Promise.resolve(Vg.Completed)}async waitForPropagateCompleted(){return this.getGraph().waitForPropagateCompleted()}async tryPropagateWithNodes(e,t,r){return this.getGraph().tryPropagateWithNodes(e,t,r)}async tryPropagateWithEntities(e,t,r){const n=this.getGraph();let s;if(i=n,!Boolean(i&&i[sm]))throw new Error("Entity is not part of replica");var i;return s=n.tryPropagateWithEntities(e,t,r),s}markAsNeedRecalculation(e){const t=this.getGraph();t&&t.markAsNeedRecalculation(e)}markStable(e){const t=this.getGraph();t&&t.markStable(e)}static getField(e){return this.getEntity().getField(e)}static getEntity(){return dm(this.prototype)}run(e,...t){const r=this[e](...t);let n,s;for(;;){n=r.next(s);const e=n.value;if(e instanceof Dg)throw new Error("Helper methods can not yield effects during computation");if(n.done)return e;const t=e;if(this.getGraph().isAtomNeedRecalculation(t))throw new Error("Can not use stale atom for calculations");s=t.get()}}}},cm=e=>{let t=Object.getPrototypeOf(e);return zg(e,"$entity",Yg.new({parentEntity:t.hasOwnProperty(am)?null:t.$entity}))},dm=e=>{let t=e.$entity;return e.hasOwnProperty("$entity")||(t=cm(e)),t},um=(e,t=nm)=>function(r,n){if(dm(r).addField(t.new(Object.assign(e||{},{name:n}))).createAccessors){const e="put"+Ng(n);let t=e in r?function(t){return this[e](t)}:function(e){return this.$[n].put(e)};Object.defineProperty(r,n,{get:function(){return this.$[n].get()},set:t});const s="get"+Ng(n),i="set"+Ng(n);s in r||(r[s]=function(...e){return this.$[n].get(...e)}),i in r||(r[i]=function(...e){return this.$[n].set(...e)})}},hm=um,gm=function(e){return function(t,r,n){let s=t.$calculations;s||(s=t.$calculations={}),s[e]=r}},mm=e=>class extends e{constructor(){super(...arguments),this.atomCls=Dm}};class pm extends(mm(nm)){}const fm=e=>class extends e{constructor(){super(...arguments),this.persistent=!1,this.atomCls=wm}};class vm extends(fm(nm)){}const ym=(e,t=vm)=>um(e,t),bm=(e,t=pm)=>um(e,t),Cm=e=>class extends e{constructor(){super(...arguments),this.oldRefs=new Set,this.newRefs=new Set,this.value=new Set}commitValue(){super.commitValue(),this.oldRefs.clear(),this.newRefs.clear()}reject(){super.reject(),this.oldRefs.clear(),this.newRefs.clear()}*calculate(e){const t=new Set;let r;for(r of this.incoming)if(!this.oldRefs.has(r)){const e=yield r;null!=e&&t.add(e)}for(r of this.newRefs){const e=yield r;null!=e&&t.add(e)}return t}};class wm extends(Cm(em)){}const Sm=e=>class extends e{hasBucket(){return Boolean(this.field.bucket)}addToBucket(e){e.newRefs.add(this.self.$$),this.graph&&this.graph.markAsNeedRecalculation(e)}removeFromBucket(e){e.oldRefs.add(this.self.$$),this.graph&&this.graph.markAsNeedRecalculation(e)}*calculate(e){const t=this.resolve(void 0!==e?e:this.value);return Bg(t)||(yield t.$$),t}resolve(e){const t=this.field.resolver;return t&&void 0!==e&&Bg(e)?t.call(this.self,e):e}getBucket(e){return e.$[this.field.bucket]}onEnterGraph(e){const t=this.get();let r=!0;if(void 0!==t&&Bg(t)){r=!1;const e=this.resolve(t);Bg(e)||(this.put(e),r=!0)}if(super.onEnterGraph(e),void 0!==this.get()&&r&&this.hasBucket()){const e=this.getBucket(this.get());this.addToBucket(e)}}onLeaveGraph(e){if(this.hasValue()&&this.hasBucket()){const e=this.get();if(!Bg(e)){const t=this.getBucket(e);this.removeFromBucket(t)}}super.onLeaveGraph(e)}put(e){const t=this.value;if(this.hasBucket()&&(null==t||Bg(t)||this.removeFromBucket(this.getBucket(t)),null!=e))if(Bg(e)){const t=this.resolve(e);null!=t&&(this.addToBucket(this.getBucket(t)),e=t)}else this.addToBucket(this.getBucket(e));super.put(e)}};class Dm extends(Sm(Qg(Jg))){}class Em extends nm{constructor(){super(...arguments),this.atomCls=Rm,this.modelFieldConfig={}}}class xm extends(mm(Em)){constructor(){super(...arguments),this.atomCls=Mm}}class Tm extends(fm(Em)){constructor(){super(...arguments),this.atomCls=km}initialize(...e){super.initialize(...e),this.modelFieldConfig=Object.assign({isEqual:()=>!1,defaultValue:new Set,persist:!1},this.modelFieldConfig)}}class Rm extends em{get value(){return this.self.get(this.field.name)}set value(e){this.self.set(this.field.name,e)}}class Mm extends(Sm(Rm)){}class km extends(Cm(Rm)){get value(){if(this.self)return this.self.get(this.field.name)}set value(e){this.self&&this.self.set(this.field.name,e)}}const Im=function(e={},t={}){return function(r,n){um(Object.assign({modelFieldConfig:e},t),Em)(r,n),Fm(r.constructor)}},Fm=e=>{e.hasOwnProperty("fields")||Object.defineProperty(e,"fields",{get:function(){return Am(this)}})},Am=e=>{let t=[];const r=e.prototype;return r.hasOwnProperty("$entity")&&r.$entity.fields.forEach(e=>{e instanceof Em&&t.push(Object.assign(e.modelFieldConfig||{},{name:e.name}))}),t},Pm=(e,t)=>null===e?null:(e instanceof Date||(e=je.parse(e,t.modelFieldConfig.format||t.modelFieldConfig.dateFormat)),e||void 0),Lm=e=>class extends e{construct(e,...t){this.constructor.exposeProperties();const r={},n={};this.originalData=e=e||{};for(let t in e){const s=this.getFieldDefinitionFromDataSource(t),i=s?s.name:t;this.$entity.getField(i)&&"expanded"!=i&&"children"!=i?n[i]=e[t]:r[t]=e[t]}super.construct(r,...t),Object.assign(this,n)}copy(e=null,t=!0){const r=super.copy(e);return t&&this.forEachFieldAtom((e,t)=>{r.$[t].put(e.get())}),r}},Om=Symbol("PartOfProjectStoreMixin"),_m=e=>{return class extends e{[Om](){}calculateProject(){return this.project}loadData(e){super.loadData(e);const t=this.getProject();t&&t.trigger("storerefresh",{store:this})}}},$m=e=>Boolean(e&&e[Om]),jm=e=>class extends e{joinStore(e){let t=!1;if($m(e)){const r=e.getProject();!r||this.getProject()||this.isShadowed()||(this.setProject(r),t=!0)}super.joinStore(e),t&&this.joinProject()}unJoinStore(e){super.unJoinStore(e);const t=this.isShadowed()?this.shadowedProject:this.getProject();$m(e)&&t&&t===e.getProject()&&(this.leaveProject(),this.setProject(null),this.shadowedProject=null)}joinProject(){this.getGraph().addEntity(this)}leaveProject(){const e=this.getProject();this.isShadowed()||this.getGraph().removeEntity(this),this.leftProject=e}shadow(){const e=this.getProject();return e&&(this.leaveProject(),this.setProject(null),this.shadowedProject=e),this}unshadow(){return this.shadowedProject&&(this.setProject(this.shadowedProject),this.shadowedProject=null,this.joinProject()),this}isShadowed(){return!!this.shadowedProject}getProject(){return this.isShadowed()?null:super.getProject()}calculateProject(){const e=this.stores.find(e=>$m(e)&&!!e.getProject());return e&&e.getProject()}afterSet(e,t,r,n,s,i){i&&this.getProject()&&this.getProject().getStm().isRestoring&&Object.keys(i).forEach(e=>{const t=this.$[e];t&&t.graph&&t.graph.markAsNeedRecalculation(t)}),super.afterSet&&super.afterSet(e,t,r,n,s,i)}},Hm=e=>class extends e{calculateProject(){throw new Error("Implement me")}setProject(e){return this.project=e}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getGraph(){const e=this.getProject();return e&&e.getGraph()}getEventStore(){const e=this.getProject();return e&&e.eventStore}getDependencyStore(){const e=this.getProject();return e&&e.dependencyStore}getAssignmentStore(){const e=this.getProject();return e&&e.assignmentStore}getResourceStore(){const e=this.getProject();return e&&e.resourceStore}getCalendarManagerStore(){const e=this.getProject();return e&&e.calendarManagerStore}getEventById(e){return this.getEventStore()&&this.getEventStore().getById(e)}getDependencyById(e){return this.getDependencyStore()&&this.getDependencyStore().getById(e)}getResourceById(e){return this.getResourceStore()&&this.getResourceStore().getById(e)}getAssignmentById(e){return this.getAssignmentStore()&&this.getAssignmentStore().getById(e)}getCalendarById(e){return this.getCalendarManagerStore()&&this.getCalendarManagerStore().getById(e)}},Nm=function(){var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),r=t.length>>>0;if(0===r)return-1;var n=0;if(arguments.length>1&&((n=Number(arguments[1]))!=n?n=0:0!=n&&n!=1/0&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=r)return-1;for(var s=n>=0?n:Math.max(r-Math.abs(n),0);s<r;s++)if(s in t&&t[s]===e)return s;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(e,t){e.sort((function(e,t){return+e-+t})),t&&0===e[0]&&e.push(e.shift())},e.array.next=function(e,t,r){for(var n,s=0!==r[0],i=0,o=t.length-1;o>-1;--o){if((n=t[o])===e)return n;if(!(n>e||0===n&&s&&r[1]>e))break;i=o}return t[i]},e.array.nextInvalid=function(e,t,r){for(var n=r[0],s=r[1],i=t.length,o=0===t[i-1]&&0!==n?s:0,a=e,l=t.indexOf(e),c=a;a===(t[l]||o);)if(++a>s&&(a=n),++l===i&&(l=0),a===c)return;return a},e.array.prev=function(e,t,r){for(var n,s=t.length,i=0!==r[0],o=s-1,a=0;a<s;a++){if((n=t[a])===e)return n;if(!(n<e||0===n&&i&&r[1]<e))break;o=a}return t[o]},e.array.prevInvalid=function(e,t,r){for(var n=r[0],s=r[1],i=t.length,o=0===t[i-1]&&0!==n?s:0,a=e,l=t.indexOf(e),c=a;a===(t[l]||o);)if(--a<n&&(a=s),-1===--l&&(l=i-1),a===c)return;return a},e.day=e.D={name:"day",range:86400,val:function(t){return t.D||(t.D=e.date.getDate.call(t))},isValid:function(t,r){return e.D.val(t)===(r||e.D.extent(t)[1])},extent:function(t){if(t.DExtent)return t.DExtent;var r=e.M.val(t),n=e.DAYS_IN_MONTH[r-1];return 2===r&&366===e.dy.extent(t)[1]&&(n+=1),t.DExtent=[1,n]},start:function(t){return t.DStart||(t.DStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)))},end:function(t){return t.DEnd||(t.DEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)))},next:function(t,r){r=r>e.D.extent(t)[1]?1:r;var n=e.date.nextRollover(t,r,e.D,e.M),s=e.D.extent(n)[1];return r=r>s?1:r||s,e.date.next(e.Y.val(n),e.M.val(n),r)},prev:function(t,r){var n=e.date.prevRollover(t,r,e.D,e.M),s=e.D.extent(n)[1];return e.date.prev(e.Y.val(n),e.M.val(n),r>s?s:r||s)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(t){return t.dc||(t.dc=Math.floor((e.D.val(t)-1)/7)+1)},isValid:function(t,r){return e.dc.val(t)===r||0===r&&e.D.val(t)>e.D.extent(t)[1]-7},extent:function(t){return t.dcExtent||(t.dcExtent=[1,Math.ceil(e.D.extent(t)[1]/7)])},start:function(t){return t.dcStart||(t.dcStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(1,7*(e.dc.val(t)-1)+1||1)))},end:function(t){return t.dcEnd||(t.dcEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(7*e.dc.val(t),e.D.extent(t)[1])))},next:function(t,r){r=r>e.dc.extent(t)[1]?1:r;var n=e.date.nextRollover(t,r,e.dc,e.M);r=r>e.dc.extent(n)[1]?1:r;var s=e.date.next(e.Y.val(n),e.M.val(n),0===r?e.D.extent(n)[1]-6:1+7*(r-1));return s.getTime()<=t.getTime()?(n=e.M.next(t,e.M.val(t)+1),e.date.next(e.Y.val(n),e.M.val(n),0===r?e.D.extent(n)[1]-6:1+7*(r-1))):s},prev:function(t,r){var n=e.date.prevRollover(t,r,e.dc,e.M),s=e.dc.extent(n)[1];return r=r>s?s:r||s,e.dc.end(e.date.prev(e.Y.val(n),e.M.val(n),1+7*(r-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(t){return t.dw||(t.dw=e.date.getDay.call(t)+1)},isValid:function(t,r){return e.dw.val(t)===(r||7)},extent:function(){return[1,7]},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,r){return r=r>7?1:r||7,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(r-e.dw.val(t))+(r<=e.dw.val(t)?7:0))},prev:function(t,r){return r=r>7?7:r||7,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(r-e.dw.val(t))+(r>=e.dw.val(t)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(t){return t.dy||(t.dy=Math.ceil(1+(e.D.start(t).getTime()-e.Y.start(t).getTime())/e.DAY))},isValid:function(t,r){return e.dy.val(t)===(r||e.dy.extent(t)[1])},extent:function(t){var r=e.Y.val(t);return t.dyExtent||(t.dyExtent=[1,r%4?365:366])},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,r){r=r>e.dy.extent(t)[1]?1:r;var n=e.date.nextRollover(t,r,e.dy,e.Y),s=e.dy.extent(n)[1];return r=r>s?1:r||s,e.date.next(e.Y.val(n),e.M.val(n),r)},prev:function(t,r){var n=e.date.prevRollover(t,r,e.dy,e.Y),s=e.dy.extent(n)[1];return r=r>s?s:r||s,e.date.prev(e.Y.val(n),e.M.val(n),r)}},e.hour=e.h={name:"hour",range:3600,val:function(t){return t.h||(t.h=e.date.getHour.call(t))},isValid:function(t,r){return e.h.val(t)===r},extent:function(){return[0,23]},start:function(t){return t.hStart||(t.hStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},end:function(t){return t.hEnd||(t.hEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},next:function(t,r){r=r>23?0:r;var n=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(r<=e.h.val(t)?1:0),r);return!e.date.isUTC&&n.getTime()<=t.getTime()&&(n=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n),r+1)),n},prev:function(t,r){return r=r>23?23:r,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(r>=e.h.val(t)?-1:0),r)}},e.minute=e.m={name:"minute",range:60,val:function(t){return t.m||(t.m=e.date.getMin.call(t))},isValid:function(t,r){return e.m.val(t)===r},extent:function(e){return[0,59]},start:function(t){return t.mStart||(t.mStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},end:function(t){return t.mEnd||(t.mEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},next:function(t,r){var n=e.m.val(t),s=e.s.val(t),i=r>59?60-n:r<=n?60-n+r:r-n,o=new Date(t.getTime()+i*e.MIN-s*e.SEC);return!e.date.isUTC&&o.getTime()<=t.getTime()&&(o=new Date(t.getTime()+(i+120)*e.MIN-s*e.SEC)),o},prev:function(t,r){return r=r>59?59:r,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(r>=e.m.val(t)?-1:0),r)}},e.month=e.M={name:"month",range:2629740,val:function(t){return t.M||(t.M=e.date.getMonth.call(t)+1)},isValid:function(t,r){return e.M.val(t)===(r||12)},extent:function(){return[1,12]},start:function(t){return t.MStart||(t.MStart=e.date.next(e.Y.val(t),e.M.val(t)))},end:function(t){return t.MEnd||(t.MEnd=e.date.prev(e.Y.val(t),e.M.val(t)))},next:function(t,r){return r=r>12?1:r||12,e.date.next(e.Y.val(t)+(r>e.M.val(t)?0:1),r)},prev:function(t,r){return r=r>12?12:r||12,e.date.prev(e.Y.val(t)-(r>=e.M.val(t)?1:0),r)}},e.second=e.s={name:"second",range:1,val:function(t){return t.s||(t.s=e.date.getSec.call(t))},isValid:function(t,r){return e.s.val(t)===r},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(t,r){var n=e.s.val(t),s=r>59?60-n:r<=n?60-n+r:r-n,i=new Date(t.getTime()+s*e.SEC);return!e.date.isUTC&&i.getTime()<=t.getTime()&&(i=new Date(t.getTime()+(s+7200)*e.SEC)),i},prev:function(t,r,n){return r=r>59?59:r,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(r>=e.s.val(t)?-1:0),r)}},e.time=e.t={name:"time",range:1,val:function(t){return t.t||(t.t=3600*e.h.val(t)+60*e.m.val(t)+e.s.val(t))},isValid:function(t,r){return e.t.val(t)===r},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(t,r){r=r>86399?0:r;var n=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(r<=e.t.val(t)?1:0),0,0,r);return!e.date.isUTC&&n.getTime()<t.getTime()&&(n=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n),e.h.val(n),e.m.val(n),r+7200)),n},prev:function(t,r){return r=r>86399?86399:r,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(r>=e.t.val(t)?-1:0),0,0,r)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(t){return t.wm||(t.wm=(e.D.val(t)+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(t)))/7)},isValid:function(t,r){return e.wm.val(t)===(r||e.wm.extent(t)[1])},extent:function(t){return t.wmExtent||(t.wmExtent=[1,(e.D.extent(t)[1]+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(e.M.end(t))))/7])},start:function(t){return t.wmStart||(t.wmStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(e.D.val(t)-e.dw.val(t)+1,1)))},end:function(t){return t.wmEnd||(t.wmEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(e.D.val(t)+(7-e.dw.val(t)),e.D.extent(t)[1])))},next:function(t,r){r=r>e.wm.extent(t)[1]?1:r;var n=e.date.nextRollover(t,r,e.wm,e.M),s=e.wm.extent(n)[1];return r=r>s?1:r||s,e.date.next(e.Y.val(n),e.M.val(n),Math.max(1,7*(r-1)-(e.dw.val(n)-2)))},prev:function(t,r){var n=e.date.prevRollover(t,r,e.wm,e.M),s=e.wm.extent(n)[1];return r=r>s?s:r||s,e.wm.end(e.date.next(e.Y.val(n),e.M.val(n),Math.max(1,7*(r-1)-(e.dw.val(n)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(t){if(t.wy)return t.wy;var r=e.dw.next(e.wy.start(t),5),n=e.dw.next(e.Y.prev(r,e.Y.val(r)-1),5);return t.wy=1+Math.ceil((r.getTime()-n.getTime())/e.WEEK)},isValid:function(t,r){return e.wy.val(t)===(r||e.wy.extent(t)[1])},extent:function(t){if(t.wyExtent)return t.wyExtent;var r=e.dw.next(e.wy.start(t),5),n=e.dw.val(e.Y.start(r)),s=e.dw.val(e.Y.end(r));return t.wyExtent=[1,5===n||5===s?53:52]},start:function(t){return t.wyStart||(t.wyStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)-(e.dw.val(t)>1?e.dw.val(t)-2:6)))},end:function(t){return t.wyEnd||(t.wyEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.dw.val(t)>1?8-e.dw.val(t):0)))},next:function(t,r){r=r>e.wy.extent(t)[1]?1:r;var n=e.dw.next(e.wy.start(t),5),s=e.date.nextRollover(n,r,e.wy,e.Y);1!==e.wy.val(s)&&(s=e.dw.next(s,2));var i=e.wy.extent(s)[1],o=e.wy.start(s);return r=r>i?1:r||i,e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(r-1))},prev:function(t,r){var n=e.dw.next(e.wy.start(t),5),s=e.date.prevRollover(n,r,e.wy,e.Y);1!==e.wy.val(s)&&(s=e.dw.next(s,2));var i=e.wy.extent(s)[1],o=e.wy.end(s);return r=r>i?i:r||i,e.wy.end(e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(r-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(t){return t.Y||(t.Y=e.date.getYear.call(t))},isValid:function(t,r){return e.Y.val(t)===r},extent:function(){return[1970,2099]},start:function(t){return t.YStart||(t.YStart=e.date.next(e.Y.val(t)))},end:function(t){return t.YEnd||(t.YEnd=e.date.prev(e.Y.val(t)))},next:function(t,r){return r>e.Y.val(t)&&r<=e.Y.extent()[1]?e.date.next(r):e.NEVER},prev:function(t,r){return r<e.Y.val(t)&&r>=e.Y.extent()[0]?e.date.prev(r):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(t,r){return e.fd.val(t)===r},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(t,r){return e.fd.val(t)<r?new Date(r):e.NEVER},prev:function(t,r){return e.fd.val(t)>r?new Date(r):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(e,t){var r=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-r)*e.range,val:e.val,isValid:function(e,t){return this.val(e)>=r},extent:e.extent,start:e.start,end:e.end,next:function(t,n){return n!=r&&(n=e.extent(t)[0]),e.next(t,n)},prev:function(t,n){return n=n===r?e.extent(t)[1]:r-1,e.prev(t,n)}}},e.modifier.before=e.modifier.b=function(e,t){var r=t[t.length-1];return{name:"before "+e.name,range:e.range*(r-1),val:e.val,isValid:function(e,t){return this.val(e)<r},extent:e.extent,start:e.start,end:e.end,next:function(t,n){return n=n===r?e.extent(t)[0]:r,e.next(t,n)},prev:function(t,n){return n=n===r?r-1:e.extent(t)[1],e.prev(t,n)}}},e.compile=function(t){var r,n=[],s=0;for(var i in t){var o=i.split("_"),a=o[0],l=o[1],c=t[i],d=l?e.modifier[l](e[a],c):e[a];n.push({constraint:d,vals:c}),s++}return n.sort((function(e,t){var r=e.constraint.range,n=t.constraint.range;return n<r?-1:n>r?1:0})),r=n[s-1].constraint,{start:function(t,i){for(var o,a=i,l=e.array[t],c=1e3;c--&&!o&&a;){o=!0;for(var d=0;d<s;d++){var u=n[d].constraint,h=u.val(a),g=u.extent(a),m=l(h,n[d].vals,g);if(!u.isValid(a,m)){a=u[t](a,m),o=!1;break}}}return a!==e.NEVER&&(a="next"===t?r.start(a):r.end(a)),a},end:function(t,r){for(var i,o=e.array[t+"Invalid"],a=function(e){return"next"===e?function(e,t){return e.getTime()>t.getTime()}:function(e,t){return t.getTime()>e.getTime()}}(t),l=s-1;l>=0;l--){var c,d=n[l].constraint,u=d.val(r),h=d.extent(r),g=o(u,n[l].vals,h);void 0!==g&&(!(c=d[t](r,g))||i&&!a(i,c)||(i=c))}return i},tick:function(t,n){return new Date("next"===t?r.end(n).getTime()+e.SEC:r.start(n).getTime()-e.SEC)},tickStart:function(e){return r.start(e)}}},e.schedule=function(t){if(!t)throw new Error("Missing schedule definition.");if(!t.schedules)throw new Error("Definition must include at least one schedule.");for(var r=[],n=t.schedules.length,s=[],i=t.exceptions?t.exceptions.length:0,o=0;o<n;o++)r.push(e.compile(t.schedules[o]));for(var a=0;a<i;a++)s.push(e.compile(t.exceptions[a]));function l(t,n,o,a,l){var b,C,w,S=v(t),D=n,E=1e3,x=[],T=[],R=[],M="next"===t,k=M?0:1,I=M?1:0;if(!(o=o?new Date(o):new Date)||!o.getTime())throw new Error("Invalid start date.");for(!function(e,t,r,n){for(var s=0,i=t.length;s<i;s++)r[s]=t[s].start(e,n)}(t,r,x,o),function(t,r,n,s){for(var i=0,o=r.length;i<o;i++){var a=r[i].start(t,s);n[i]=a?[a,r[i].end(t,a)]:e.NEVER}}(t,s,T,o);E--&&D&&(b=y(x,S))&&(!a||!S(b,a));)if(i&&(u(t,s,T,b),C=m(t,T,b)))d(t,r,x,C);else{if(l){var F=p(T,S);C=f(t,r,x,b,F);var A=M?[new Date(Math.max(o,b)),C?new Date(a?Math.min(C,a):C):void 0]:[C?new Date(a?Math.max(a,C.getTime()+e.SEC):C.getTime()+e.SEC):void 0,new Date(Math.min(o,b.getTime()+e.SEC))];if(w&&A[k].getTime()===w[I].getTime()?(w[I]=A[I],D++):(w=A,R.push(w)),!C)break;d(t,r,x,C)}else R.push(M?new Date(Math.max(o,b)):g(r,x,b,a)),h(t,r,x,b);D--}for(var P=0,L=R.length;P<L;P++){var O=R[P];R[P]="[object Array]"===Object.prototype.toString.call(O)?[c(O[0]),c(O[1])]:c(O)}return 0===R.length?e.NEVER:1===n?R[0]:R}function c(e){if(e instanceof Date&&!isNaN(e.valueOf()))return new Date(e)}function d(e,t,r,n){for(var s=v(e),i=0,o=t.length;i<o;i++)r[i]&&!s(r[i],n)&&(r[i]=t[i].start(e,n))}function u(t,r,n,s){for(var i=v(t),o=0,a=r.length;o<a;o++)if(n[o]&&!i(n[o][0],s)){var l=r[o].start(t,s);n[o]=l?[l,r[o].end(t,l)]:e.NEVER}}function h(e,t,r,n){for(var s=0,i=t.length;s<i;s++)r[s]&&r[s].getTime()===n.getTime()&&(r[s]=t[s].start(e,t[s].tick(e,n)))}function g(e,t,r,n){for(var s,i=0,o=t.length;i<o;i++)if(t[i]&&t[i].getTime()===r.getTime()){var a=e[i].tickStart(r);if(n&&a<n)return n;(!s||a>s)&&(s=a)}return s}function m(e,t,r){for(var n,s=v(e),i=0,o=t.length;i<o;i++){var a=t[i];!a||s(a[0],r)||a[1]&&!s(a[1],r)||n&&!s(a[1],n)||(n=a[1])}return n}function p(e,t){for(var r,n=0,s=e.length;n<s;n++)!e[n]||r&&!t(r,e[n][0])||(r=e[n][0]);return r}function f(e,t,r,n,s){for(var i,o=v(e),a=0,l=t.length;a<l;a++){var c=r[a];if(c&&c.getTime()===n.getTime()){var d=t[a].end(e,c);if(s&&(!d||o(d,s)))return s;i&&!o(d,i)||(i=d)}}return i}function v(e){return"next"===e?function(e,t){return!t||e.getTime()>t.getTime()}:function(e,t){return!e||t.getTime()>e.getTime()}}function y(e,t){for(var r=e[0],n=1,s=e.length;n<s;n++)e[n]&&t(r,e[n])&&(r=e[n]);return r}return{isValid:function(t){return l("next",1,t,t)!==e.NEVER},next:function(e,t,r){return l("next",e||1,t,r)},prev:function(e,t,r){return l("prev",e||1,t,r)},nextRange:function(e,t,r){return l("next",e||1,t,r,!0)},prevRange:function(e,t,r){return l("prev",e||1,t,r,!0)}}},e.setTimeout=function(t,r){var n,s=e.schedule(r);return t&&function e(){var r=Date.now(),i=s.next(2,r);if(!i[0])return void(n=void 0);var o=i[0].getTime()-r;o<1e3&&(o=i[1]?i[1].getTime()-r:1e3);n=o<2147483647?setTimeout(t,o):setTimeout(e,2147483647)}(),{isDone:function(){return!n},clear:function(){clearTimeout(n)}}},e.setInterval=function(t,r){if(t){var n=e.setTimeout((function i(){s||(t(),n=e.setTimeout(i,r))}),r),s=n.isDone();return{isDone:function(){return n.isDone()},clear:function(){s=!0,n.clear()}}}},e.date={},e.date.timezone=function(t){e.date.build=t?function(e,t,r,n,s,i){return new Date(e,t,r,n,s,i)}:function(e,t,r,n,s,i){return new Date(Date.UTC(e,t,r,n,s,i))};var r=t?"get":"getUTC",n=Date.prototype;e.date.getYear=n[r+"FullYear"],e.date.getMonth=n[r+"Month"],e.date.getDate=n[r+"Date"],e.date.getDay=n[r+"Day"],e.date.getHour=n[r+"Hours"],e.date.getMin=n[r+"Minutes"],e.date.getSec=n[r+"Seconds"],e.date.isUTC=!t},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=60*e.SEC,e.HOUR=60*e.MIN,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(t,r,n,s,i,o){return e.date.build(t,void 0!==r?r-1:0,void 0!==n?n:1,s||0,i||0,o||0)},e.date.nextRollover=function(t,r,n,s){var i=n.val(t),o=n.extent(t)[1];return(r||o)<=i||r>o?new Date(s.end(t).getTime()+e.SEC):s.start(t)},e.date.prev=function(t,r,n,s,i,o){var a=arguments.length;return r=a<2?11:r-1,n=a<3?e.D.extent(e.date.next(t,r+1))[1]:n,s=a<4?23:s,i=a<5?59:i,o=a<6?59:o,e.date.build(t,r,n,s,i,o)},e.date.prevRollover=function(e,t,r,n){return t>=r.val(e)||!t?n.start(n.prev(e,n.val(e)-1)):n.start(e)},e.parse={},e.parse.cron=function(e,t){var r={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},n={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},s={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function i(e,t,n){return isNaN(e)?r[e]||null:Math.min(+e+(t||0),n||9999)}function o(e,t,r,n,s){var i=r;for(e[t]||(e[t]=[]);i<=n;)e[t].indexOf(i)<0&&e[t].push(i),i+=s||1;e[t].sort((function(e,t){return e-t}))}function a(e,t,r,n){(t.d&&!t.dc||t.dc&&t.dc.indexOf(n)<0)&&(e.push(function(e){var t,r={};for(t in e)"dc"!==t&&"d"!==t&&(r[t]=e[t].slice(0));return r}(t)),t=e[e.length-1]),o(t,"d",r,r),o(t,"dc",n,n)}function l(e,t,n,s,l,c){var d,u,h=t.schedules,g=h[h.length-1];"L"===e&&(e=s-1),null!==(d=i(e,c,l))?o(g,n,d,d):null!==(d=i(e.replace("W",""),c,l))?function(e,t,n){var s={},i={};1===n?(o(t,"D",1,3),o(t,"d",r.MON,r.FRI),o(s,"D",2,2),o(s,"d",r.TUE,r.FRI),o(i,"D",3,3),o(i,"d",r.TUE,r.FRI)):(o(t,"D",n-1,n+1),o(t,"d",r.MON,r.FRI),o(s,"D",n-1,n-1),o(s,"d",r.MON,r.THU),o(i,"D",n+1,n+1),o(i,"d",r.TUE,r.FRI)),e.exceptions.push(s),e.exceptions.push(i)}(t,g,d):null!==(d=i(e.replace("L",""),c,l))?a(h,g,d,s-1):2===(u=e.split("#")).length?a(h,g,d=i(u[0],c,l),i(u[1])):function(e,t,r,n,s,a){var l=e.split("/"),c=+l[1],d=l[0];if("*"!==d&&"0"!==d){var u=d.split("-");n=i(u[0],a,s),s=i(u[1],a,s)||s}o(t,r,n,s,c)}(e,g,n,s,l,c)}function c(e){return e.indexOf("#")>-1||e.indexOf("L")>0}function d(e,t){return c(e)&&!c(t)?1:e-t}var u=function(e){var t=e.toUpperCase();return n[t]||t}(e);return function(e){var t,r,n,i,o={schedules:[{}],exceptions:[]},a=e.replace(/(\s)+/g," ").split(" ");for(t in s)if((n=a[(r=s[t])[0]])&&"*"!==n&&"?"!==n){var c,u=(i=n.split(",").sort(d)).length;for(c=0;c<u;c++)l(i[c],o,t,r[1],r[2],r[3])}return o}(t?u:"0 "+u)},e.parse.recur=function(){var t,r,n,s,i,o,a,l,c,d=[],u=[],h=d;function g(e,d,u){if(e=i?e+"_"+i:e,t||(h.push({}),t=h[0]),t[e]||(t[e]=[]),r=t[e],s){for(n=[],l=d;l<=u;l+=s)n.push(l);c={n:e,x:s,c:r.length,m:u}}var g=(n=o?[d]:a?[u]:n).length;for(l=0;l<g;l+=1){var m=n[l];r.indexOf(m)<0&&r.push(m)}n=s=i=o=a=0}return{schedules:d,exceptions:u,on:function(){return n=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return s=e||1,this},after:function(e){return i="a",n=[e],this},before:function(e){return i="b",n=[e],this},first:function(){return o=1,this},last:function(){return a=1,this},time:function(){for(var e=0,t=n.length;e<t;e++){var r=n[e].split(":");r.length<3&&r.push(0),n[e]=3600*+r[0]+60*+r[1]+ +r[2]}return g("t"),this},second:function(){return g("s",0,59),this},minute:function(){return g("m",0,59),this},hour:function(){return g("h",0,23),this},dayOfMonth:function(){return g("D",1,a?0:31),this},dayOfWeek:function(){return g("d",1,7),this},onWeekend:function(){return n=[1,7],this.dayOfWeek()},onWeekday:function(){return n=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return g("dc",1,a?0:5),this},dayOfYear:function(){return g("dy",1,a?0:366),this},weekOfMonth:function(){return g("wm",1,a?0:5),this},weekOfYear:function(){return g("wy",1,a?0:53),this},month:function(){return g("M",1,12),this},year:function(){return g("Y",1970,2450),this},fullDate:function(){for(var e=0,t=n.length;e<t;e++)n[e]=n[e].getTime();return g("fd"),this},customModifier:function(t,r){var s=e.modifier[t];if(!s)throw new Error("Custom modifier "+t+" not recognized!");return i=t,n=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(t){var r=e[t];if(!r)throw new Error("Custom time period "+t+" not recognized!");return g(t,r.extent(new Date)[0],r.extent(new Date)[1]),this},startingOn:function(e){return this.between(e,c.m)},between:function(e,r){return t[c.n]=t[c.n].splice(0,c.c),s=c.x,g(c.n,e,r),this},and:function(){return t=h[h.push({})-1],this},except:function(){return h=u,t=null,this}}},e.parse.text=function(t){var r,n=e.parse.recur,s=0,i="",o={eof:/^$/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},a={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(e,t,r,n){return{startPos:e,endPos:t,text:r,type:n}}function c(e){var t,r,n,o,a,c,d=e instanceof Array?e:[e],u=/\s+/;for(d.push(u),a=s;!t||t.type===u;){c=-1,r=i.substring(a),t=l(a,a,i.split(u)[0]);var h,g=d.length;for(h=0;h<g;h++)(n=(o=d[h]).exec(r))&&0===n.index&&n[0].length>c&&(t=l(a,a+(c=n[0].length),r.substring(0,c),o));t.type===u&&(a=t.endPos)}return t}function d(e){var t=c(e);return s=t.endPos,t}function u(e){for(var t=+y(e),r=f(o.through)?+y(e):t,n=[],s=t;s<=r;s++)n.push(s);return n}function h(e){for(var t=u(e);f(o.and);)t=t.concat(u(e));return t}function g(e){var t,r,n,s;f(o.weekend)?e.on(a.sun,a.sat).dayOfWeek():f(o.weekday)?e.on(a.mon,a.tue,a.wed,a.thu,a.fri).dayOfWeek():(t=y(o.rank),e.every(t),r=p(e),f(o.start)?(t=y(o.rank),e.startingOn(t),v(r.type)):f(o.between)&&(n=y(o.rank),f(o.and)&&(s=y(o.rank),e.between(n,s))))}function m(e){f(o.first)?e.first():f(o.last)?e.last():e.on(h(o.rank)),p(e)}function p(e){var t=v([o.second,o.minute,o.hour,o.dayOfYear,o.dayOfWeek,o.dayInstance,o.day,o.month,o.year,o.weekOfMonth,o.weekOfYear]);switch(t.type){case o.second:e.second();break;case o.minute:e.minute();break;case o.hour:e.hour();break;case o.dayOfYear:e.dayOfYear();break;case o.dayOfWeek:e.dayOfWeek();break;case o.dayInstance:e.dayOfWeekCount();break;case o.day:e.dayOfMonth();break;case o.weekOfMonth:e.weekOfMonth();break;case o.weekOfYear:e.weekOfYear();break;case o.month:e.month();break;case o.year:e.year();break;default:r=s}return t}function f(e){var t=c(e).type===e;return t&&d(e),t}function v(e){var t=d(e);return t.type?t.text=function(e,t){var r=e;switch(t){case o.time:var n=e.split(/(:|am|pm)/),s="pm"===n[3]&&n[0]<12?parseInt(n[0],10)+12:n[0],i=n[2].trim();r=(1===s.length?"0":"")+s+":"+i;break;case o.rank:r=parseInt(/^\d+/.exec(e)[0],10);break;case o.monthName:case o.dayName:r=a[e.substring(0,3)]}return r}(t.text,e):r=s,t}function y(e){return v(e).text}return function(e){s=0,i=e,r=-1;for(var t=n();s<i.length&&r<0;){switch(v([o.every,o.after,o.before,o.onthe,o.on,o.of,o.in,o.at,o.and,o.except,o.also]).type){case o.every:g(t);break;case o.after:void 0!==c(o.time).type?(t.after(y(o.time)),t.time()):(t.after(y(o.rank)),p(t));break;case o.before:void 0!==c(o.time).type?(t.before(y(o.time)),t.time()):(t.before(y(o.rank)),p(t));break;case o.onthe:m(t);break;case o.on:t.on(h(o.dayName)).dayOfWeek();break;case o.of:t.on(h(o.monthName)).month();break;case o.in:t.on(h(o.yearIndex)).year();break;case o.at:for(t.on(y(o.time)).time();f(o.and);)t.on(y(o.time)).time();break;case o.and:break;case o.also:t.and();break;case o.except:t.except();break;default:r=s}}return{schedules:t.schedules,exceptions:t.exceptions,error:r}}(t.toLowerCase())},e}();Nm.date.localTime();var Bm=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const zm=e=>{class t extends e{getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null}getPriorityField(){if(null!=this.priorityField)return this.priorityField;let e=1e4+100*this.getCalendar().getDepth(),t=this.priority;return null==t&&(t=this.isRecurrent()?20:30),this.priorityField=e+t}isRecurrent(){return Boolean(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return Boolean(this.startDate&&this.endDate)}parseDateSchedule(e){if(e&&e!==Object(e)&&((e=Nm.parse.text(e))!==Object(e)||e.error>0))try{e=JSON.parse(e)}catch(e){return null}return e}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const e=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=Nm.schedule(e)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;const e=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=Nm.schedule(e)}}return Bm([Im({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{converter:Pm})],t.prototype,"startDate",void 0),Bm([Im({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{converter:Pm})],t.prototype,"endDate",void 0),Bm([Im({type:"string"})],t.prototype,"recurrentStartDate",void 0),Bm([Im({type:"string"})],t.prototype,"recurrentEndDate",void 0),Bm([Im({type:"boolean",defaultValue:!1})],t.prototype,"isWorking",void 0),Bm([Im({type:"number"})],t.prototype,"priority",void 0),t},Vm=(e=Jn)=>zm(jm(Hm(Lm(lm(e)))));class Wm extends(Vm()){}class Gm extends(wg(Vm(Jn))){}Gm._$name="ProCalendarIntervalModel";const Um=new Date(-864e13),Ym=new Date(864e13),qm=e=>{if(!e)return!1;const t=e.getTime();return t!==Um.getTime()&&t!==Ym.getTime()};var Xm,Km;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(Xm||(Xm={})),function(e){e[e.FullRangeIterated=0]="FullRangeIterated",e[e.StoppedByIterator=1]="StoppedByIterator",e[e.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached"}(Km||(Km={}));class Zm{constructor(e){this.cacheFilledStartDate=Ym,this.cacheFilledEndDate=Um,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=$h.Day,this.maxCacheExtendCycles=1e3,e&&Object.assign(this,e)}includeWrappingRangeFrom(e,t,r){e.ensureCacheFilledForInterval(t,r),this.intervalCache.includeWrappingRange(e.intervalCache,t,r)}ensureCacheFilledForInterval(e,t){const r=this.cacheFilledStartDate.getTime(),n=this.cacheFilledEndDate.getTime();if(r!==Ym.getTime()){const s=e.getTime(),i=t.getTime();if(r<=s&&i<=n)return;if(i<=r)t=new Date(r-1);else if(s>=n)e=new Date(n+1);else if(r<=s&&s<=n)e=new Date(n+1);else{if(!(r<=i&&i<=n))return this.ensureCacheFilledForInterval(e,new Date(r-1)),void this.ensureCacheFilledForInterval(new Date(n+1),t);t=new Date(r-1)}}(r===Ym.getTime()||e.getTime()<n)&&(this.cacheFilledStartDate=e),(n===Um.getTime()||n<t.getTime())&&(this.cacheFilledEndDate=t),this.fillCache(e,t)}fillCache(e,t){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=Ym,this.cacheFilledEndDate=Um,this.intervalCache.clear()}forEachAvailabilityInterval(e,t,r){r=r||this;const n=e.startDate,s=e.endDate,i=n&&n.getTime(),o=s&&s.getTime(),a=!1!==e.isForward;if(a?!n:!s)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const l=this.intervalCache;let c=a?n:s,d=a?n:s;for(let e=1;e<this.maxCacheExtendCycles;e++){a?this.ensureCacheFilledForInterval(c,s||je.add(c,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(n||je.add(c,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),c);let e=l.getIntervalOf(d,a?Xm.Left:Xm.Right);for(;e;){const c=e.startDate,u=e.endDate;if(a&&o&&c.getTime()>=o||!a&&i&&u.getTime()<=i)return Km.FullRangeIterated;if(a&&c.getTime()>this.cacheFilledEndDate.getTime()||!a&&u.getTime()<this.cacheFilledStartDate.getTime())break;d=a?u:c;const h=i&&c.getTime()<i?n:c,g=o&&u.getTime()>o?s:u;if(!1===t.call(r,h,g,e.cacheInterval))return Km.StoppedByIterator;e=a?l.getNextInterval(e):l.getPrevInterval(e)}if(a&&d.getTime()===Ym.getTime()||!a&&d.getTime()===Um.getTime())return Km.FullRangeIterated;c=a?this.cacheFilledEndDate:this.cacheFilledStartDate}return Km.MaxCacheExtendCyclesReached}}const Jm=e=>{const t=new Map;return e.filter(e=>!t.has(e)&&(t.set(e,!0),!0))};class Qm{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(-1==this.intervals.indexOf(e)){const t=this.intervals.slice();return t.push(e),new Qm({intervals:t,calendar:this.calendar})}return this}combineWith(e){return new Qm({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(null!=this.isWorking)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const t=Jm(e);return t.sort((e,t)=>t.getPriorityField()-e.getPriorityField()),t}}const ep=(e,t,r=((e,t)=>e-t))=>{let n=0,s=t.length;for(;n<s;){const i=(n+s)/2|0,o=r(e,t[i]);if(0===o)return{found:!0,index:i};o<0?s=i:n=i+1}return{found:!1,index:s}};var tp,rp;!function(e){e[e.Exact=0]="Exact",e[e.Next=1]="Next"}(tp||(tp={}));class np{constructor(e){this.keys=[],this.values=[],this.comparator=e||((e,t)=>e-t)}set(e,t){const r=ep(e,this.keys,this.comparator);return r.found?this.values[r.index]=t:(this.keys.splice(r.index,0,e),this.values.splice(r.index,0,t)),r.index}insertAt(e,t,r){this.keys.splice(e,0,t),this.values.splice(e,0,r)}setValueAt(e,t){this.values[e]=t}get(e){const t=ep(e,this.keys,this.comparator);return t.found?this.values[t.index]:void 0}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:void 0}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const t=ep(e,this.keys,this.comparator);t.found&&this.deleteAt(t.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(e){const t=ep(e,this.keys,this.comparator);return{found:t.found?tp.Exact:tp.Next,index:t.index}}map(e){const t=this.keys,r=this.values,n=[];for(let s=0;s<t.length;s++)n.push(e(r[s],t[s],s));return n}getAllEntries(){return this.map((e,t)=>({value:e,key:t}))}clear(){this.keys.length=0,this.values.length=0}}!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(rp||(rp={}));class sp{constructor(e){if(this.points=new np((e,t)=>e.getTime()-t.getTime()),this.leftInfinityKey=Um,this.rightInfinityKey=Ym,Object.assign(this,e),void 0===this.emptyInterval||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(e,t=rp.Left){let r,{found:n,index:s}=this.indexOf(e);return r=t===rp.Left&&n===tp.Exact?s:s-1,this.getIntervalWithStartDateIndex(r)}getPrevInterval(e){return 0===e.startDateIndex?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(e,t,r){const n=this.points,{found:s,index:i}=n.indexOfKey(e);let o,a;if(s==tp.Exact){const e=r(a=n.getValueAt(i));n.setValueAt(i,e),o=i+1}else{const t=r(a=n.getValueAt(i-1));n.insertAt(i,e,t),o=i+1}for(;o<n.size();){if(n.getKeyAt(o).getTime()>=t.getTime())break;const e=r(a=n.getValueAt(o));n.setValueAt(o,e),o++}if(o===n.size())n.insertAt(n.size(),t,this.emptyInterval);else{n.getKeyAt(o).getTime()===t.getTime()||n.insertAt(o,t,a)}}includeWrappingRange(e,t,r){let n=e.getIntervalOf(t);for(;n&&(this.addInterval(n.startDate,n.endDate,e=>this.combineIntervalsFn(e,n.cacheInterval)),!(n.endDate.getTime()>r.getTime()));)n=e.getNextInterval(n)}getSummary(){return this.points.map((e,t)=>({label:e,date:t}))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}}class ip extends Zm{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new sp({emptyInterval:new Qm({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,t);const r=e.getTime(),n=t.getTime();if(r>n)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval(s=>{const i=s.getStartDateSchedule(),o=s.getEndDateSchedule();let a=i.prev(1,e),l=o.next(1,t);if(a!==Nm.NEVER&&a.getTime()===r){const t=i.prev(2,e);t!==Nm.NEVER&&2===t.length&&(a=t[1])}if(l!==Nm.NEVER&&l.getTime()===n){const e=o.next(2,t);e!==Nm.NEVER&&2===e.length&&(l=e[1])}const c=i.next(1/0,a!==Nm.NEVER?a:e,l!==Nm.NEVER?new Date(l.getTime()-1):t);if(c===Nm.NEVER)return;const d=o.next(1/0,new Date(c[0].getTime()+1),l!==Nm.NEVER?l:t);d.length>c.length?d.length=c.length:d.length<c.length&&(c.length=d.length),c.forEach((e,t)=>{const r=e,n=d[t];this.intervalCache.addInterval(r,n,e=>e.includeInterval(s))})})}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval(e=>{this.intervalCache.addInterval(e.startDate,e.endDate,t=>t.includeInterval(e))})}forEachStaticInterval(e){this.intervalStore.forEach(t=>{t.isStatic()&&e(t)})}forEachRecurrentInterval(e){this.intervalStore.forEach(t=>{t.isRecurrent()&&e(t)})}}class op extends(_m(Hm(Cs))){static get defaultConfig(){return{modelClass:Wm}}}var ap=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};class lp extends Wm{getCalendar(){return this.calendar}getPriorityField(){return null!=this.priorityField?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}ap([Im({type:"number",defaultValue:10})],lp.prototype,"priority",void 0);var cp=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const dp=Symbol("CalendarMixin"),up=e=>{class t extends e{constructor(){super(...arguments),this.version=1}[dp](){}*calculateSelf(){return yield this.$.version,this}afterConstruct(){super.afterConstruct();const e=this.hoursPerDay,t=this.daysPerWeek,r=this.daysPerMonth;this.unitsInMs={millisecond:1,second:1e3,minute:6e4,hour:36e5,day:60*e*60*1e3,week:t*e*60*60*1e3,month:r*e*60*60*1e3,quarter:3*r*e*60*60*1e3,year:12*r*e*60*60*1e3},this.intervalStore=new op({calendar:this,modelClass:this.constructor.defaultConfig.calendarIntervalModelClass||Wm}),this.intervals&&this.intervals.length&&this.addIntervals(this.intervals)}isDefault(){const e=this.getProject();return!!e&&this===e.defaultCalendar}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(e,t,r){return this.calendarCache.forEachAvailabilityInterval(e,t,r)}accumulateWorkingTime(e,t,r,n){if(0===t)return{finalDate:new Date(e),remainingDurationInMs:0};if(isNaN(t))throw new Error("Invalid duration");let s=this.convertDuration(t,r,$h.Millisecond),i=e;return this.forEachAvailabilityInterval(n?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},(e,t,r)=>{let o=!0;if(r.getIsWorking()){const r=e.getTimezoneOffset()-t.getTimezoneOffset(),a=t.getTime()-e.getTime()+60*r*1e3;s<=a?(i=n?new Date(e.getTime()+s):new Date(t.getTime()-s),s=0,o=!1):(i=n?t:e,s-=a)}return o}),{finalDate:new Date(i),remainingDurationInMs:s}}calculateDuration(e,t,r){let n=0;return this.forEachAvailabilityInterval({startDate:e,endDate:t},(e,t,r)=>{if(r.getIsWorking()){const r=e.getTimezoneOffset()-t.getTimezoneOffset();n+=t.getTime()-e.getTime()+60*r*1e3}}),this.convertDuration(n,$h.Millisecond,r)}calculateEndDate(e,t,r){const n=this.accumulateWorkingTime(e,t,r,!0);return 0===n.remainingDurationInMs?n.finalDate:null}calculateStartDate(e,t,r){const n=this.accumulateWorkingTime(e,t,r,!1);return 0===n.remainingDurationInMs?n.finalDate:null}skipNonWorkingTime(e,t=!0){let r;return this.forEachAvailabilityInterval(t?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},(e,n,s)=>{if(s.getIsWorking())return r=t?e:n,!1}),r?new Date(r):new Date(e)}convertDuration(e,t,r){let n=e;return t!==r&&(n=e*this.unitsInMs[t]/this.unitsInMs[r]),n}addInterval(e){return this.addIntervals([e])}addIntervals(e){return this.bumpVersion(),this.intervalStore.add(e)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(void 0!==this.$calendarCache)return this.$calendarCache;const e=new lp({isWorking:this.unspecifiedTimeIsWorking});return e.calendar=this,this.$calendarCache=new ip({calendar:this,unspecifiedTimeInterval:e,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse(e=>{e.intervalStore.forEach(e=>e.resetPriority())})}appendChild(e){let t=super.appendChild(e);return Array.isArray(t)||(t=[t]),t.forEach(e=>{e.bumpVersion(),e.resetPriorityOfAllIntervals()}),t}insertChild(e,t){let r=super.insertChild(e,t);return Array.isArray(r)||(r=[r]),r.forEach(e=>{e.bumpVersion(),e.resetPriorityOfAllIntervals()}),r}joinProject(){super.joinProject(),this.intervalStore.setProject(this.getProject())}leaveProject(){super.leaveProject(),this.intervalStore.setProject(null)}isDayHoliday(e){const t=je.clearTime(e),r=je.getNext(e,$h.Day);let n=!1;return this.forEachAvailabilityInterval({startDate:t,endDate:r,isForward:!0},(e,t,r)=>(n=r.getIsWorking(),!n)),!n}getDailyHolidaysRanges(e,t){let r=[];for(e=je.clearTime(e);e<t;)this.isDayHoliday(e)&&r.push({startDate:e,endDate:je.getStartOfNextDay(e,!0,!0)}),e=je.getNext(e,$h.Day);return r}}return cp([hm({persistent:!1})],t.prototype,"version",void 0),cp([Im({type:"string"})],t.prototype,"name",void 0),cp([Im({type:"number",defaultValue:24})],t.prototype,"hoursPerDay",void 0),cp([Im({type:"number",defaultValue:7})],t.prototype,"daysPerWeek",void 0),cp([Im({type:"number",defaultValue:30})],t.prototype,"daysPerMonth",void 0),cp([Im({type:"boolean",defaultValue:!0})],t.prototype,"unspecifiedTimeIsWorking",void 0),cp([Im()],t.prototype,"intervals",void 0),t},hp=(e=Jn)=>up(jm(Hm(lm(e))));class gp extends(hp()){}class mp extends(wg(hp(Jn))){static get fields(){return[]}static get defaultConfig(){return{calendarIntervalModelClass:Gm}}}mp._$name="ProCalendarModel";var pp=e=>class extends(td(fc(wc(e)))){construct(...e){const t=this;super.construct(...e),t.addPrioritizedStore(t.calendarManagerStore),t.addPrioritizedStore(t.assignmentStore),t.addPrioritizedStore(t.dependencyStore),t.addPrioritizedStore(t.resourceStore),t.addPrioritizedStore(t.eventStore),t.addPrioritizedStore(t.timeRangeStore)}async applyResponse(e,t,r){await super.applyResponse(e,t,r),t&&t.project&&Object.assign(this,t.project),await this.propagate(e=>{if(e instanceof Rg){const t=Array.from(new Set(e.cycle.map(e=>e.self.id))),r=new Error("Graph cycle: "+t);throw r.conflict=e,r}return bg.Resume}),this.clearCrudStoresChanges()}clearCrudStoresChanges(){this.crudStores.forEach(e=>{const t=e.store;t.remove(t.added.values,!0),t.modified.forEach(e=>e.clearChanges(!1)),t.added.clear(),t.modified.clear(),t.removed.clear()})}applyProjectResponse(e){this.loadProjectFields(e)}},fp=e=>class extends(e||B){async addEventToResource({event:e,resource:t,eventStore:r,assignmentStore:n}){const{assignment:s}=super.addEventToResource({event:e,resource:t,eventStore:r,assignmentStore:n});return{event:e,assignment:s,result:await this.propagate()}}addEventToResourceWithoutPropagation(e){return super.addEventToResource(e)}async removeEvents(e){e.forEach(e=>e.remove()),await this.project.propagate()}},vp=e=>class extends(e||B){isValidDependency({sourceEvent:e,targetEvent:t,type:r,dependencyStore:n}){return n.isValidDependency({fromEvent:e,toEvent:t,type:r})}async createDependency({sourceEvent:e,targetEvent:t,type:r,dependencyStore:n}){const s=n.add({fromEvent:e,toEvent:t,type:r})[0];return{result:await this.propagate(),dependency:s}}},yp=e=>class extends(e||B){},bp=e=>class extends(e||B){get project(){const e=this,t=e.host;return e._project||(e._project=t.getProjectForDataAPI&&t.getProjectForDataAPI(e)||t.getProject&&t.getProject(e)),e._project}propagate(){return this.project.propagate()}beginPropagationBatch(){this.project.suspendPropagate()}endPropagationBatch(e=!0){return this.project.resumePropagate(e)}},Cp=e=>{const t=[wd,yd,bd,Cd,yp,fp,vg,vp,bp],r=Qn(B).mixes(...t);return class extends(e||B){get dataApi(){return this._dataApi||(this._dataApi=new r({host:this.dataApiHost||this})),this._dataApi}}};class wp extends(Qn(uu).mixes(Cp)){static get featureClass(){return"b-dependencies"}static get defaultConfig(){return{terminalSides:["left","right"]}}getProjectForDataAPI(){return this.dependencyStore.getProject()}obtainResourceStore(e,t){return e.project.getResourceStore()}obtainDependencyStore(e,t){return e.project.getDependencyStore()}obtainAssignmentStore(e,t){return e.project.getAssignmentStore()}obtainEventStore(e,t){return e.project.getEventStore()}}wp._$name="ProDependencies",Va.registerFeature(wp,!0,"ProScheduler","Dependencies");var Sp=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const Dp=Symbol("hasMixin"),Ep=e=>{class t extends e{[Dp](){}*calculateSelf(){return yield this.$.lag,yield this.$.lagUnit,yield this.$.type,this}*calculateCalendar(){let e;switch(yield this.getProject().$.dependenciesCalendar){case Bh.Project:e=yield this.getProject().$.calendar;break;case Bh.FromEvent:const t=yield this.$.fromEvent;e=t&&!Bg(t)?yield t.$.calendar:null;break;case Bh.ToEvent:const r=yield this.$.toEvent;e=r&&!Bg(r)?yield r.$.calendar:null}return e||(e=yield this.getProject().$.calendar),yield e.$$,e}async setLag(e,t=this.lagUnit){return this.$.lag.put(e),this.$.lagUnit.put(t),this.propagate()}}return Sp([um({bucket:"outgoingDeps",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{persist:!0,serialize:e=>e.id}},xm)],t.prototype,"fromEvent",void 0),Sp([um({bucket:"incomingDeps",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{persist:!0,serialize:e=>e.id}},xm)],t.prototype,"toEvent",void 0),Sp([Im({type:"number",defaultValue:0})],t.prototype,"lag",void 0),Sp([Im({type:"string",defaultValue:$h.Day},{converter:je.normalizeUnit})],t.prototype,"lagUnit",void 0),Sp([Im({type:"string",defaultValue:Nh.EndToStart})],t.prototype,"type",void 0),Sp([hm()],t.prototype,"calendar",void 0),Sp([gm("calendar")],t.prototype,"calculateCalendar",null),t},xp=(e=Jn)=>Ep(jm(Hm(Lm(lm(e)))));class Tp extends(xp()){}const Rp=e=>Boolean(e&&e[Dp]),Mp=["SS","SF","FS","FF"];class kp extends(wg(xp(ae(od)))){static get fields(){return[{name:"from",persist:!1},{name:"to",persist:!1}]}constructor(...e){const[t]=e;t&&t.fromTask&&(t.fromEvent=t.fromTask),t&&t.toTask&&(t.toEvent=t.toTask),super(...e)}set sourceTask(e){this.fromEvent=e}get sourceTask(){return this.fromEvent}set sourceEvent(e){this.fromEvent=e}get sourceEvent(){return this.fromEvent}get from(){return this.fromEvent&&this.fromEvent.id}get fromTask(){return this.fromEvent}set fromTask(e){this.fromEvent=e}getFromTask(){return this.getFromEvent()}setFromTask(...e){return this.setFromEvent(...e)}set targetTask(e){this.toEvent=e}get to(){return this.toEvent&&this.toEvent.id}get targetTask(){return this.toEvent}set targetEvent(e){this.toEvent=e}get targetEvent(){return this.toEvent}get toTask(){return this.toEvent}set toTask(e){this.toEvent=e}getToTask(){return this.getToEvent()}setToTask(...e){return this.setToEvent(...e)}getTypeFromSides(e,t,r){const n=od.Type,s=r?"right":"left",i=r?"left":"right";return e===s?t===s?n.StartToStart:n.StartToEnd:t===i?n.EndToEnd:n.EndToStart}getConnectorString(e){const t=Mp[this.type];return e?t:this.type===od.Type.EndToStart?"":this.L(`L{SchedulerProCommon.${t}}`)}}kp._$name="ProDependencyModel";class Ip extends(Qn(Ed).mixes(Cp)){getProjectForDataAPI(){return this.eventStore.getProject()}updateRecordsMultipleAssignmentMode(e,t,r,n){const s=this,i=r.draggedRecords,o=i.map(e=>s.dataApi.getAssignmentEvent({assignment:e,eventStore:s.eventStore}).startDate);return this.dataApi.beginPropagationBatch(),super.updateRecordsMultipleAssignmentMode(e,t,r,n),r.valid=!0,this.dataApi.endPropagationBatch().then(e=>(i.forEach((e,t)=>{const r=s.dataApi.getAssignmentEvent({assignment:e,eventStore:s.eventStore}),n=o[t];if(n-r.startDate==0){const t=s.client.getElementFromAssignmentRecord(e);if(t){Et.setTranslateX(t.parentElement,s.client.getCoordinateFromDate(n));const r=s.client.features.dependencies;r&&r.updateDependenciesForTimeSpan(e,t)}}}),e))}}Ip._$name="ProEventDrag",Va.registerFeature(Ip,!0,"ProScheduler","EventDrag");class Fp extends(Qn(Td).mixes(vd,Cp)){static get featureClass(){return"b-eventdragcreate"}async finalizeDragCreate(e){const t=this,r=()=>{t.eventStore.modelClass.exposeProperties();const r=t.eventStore.modelClass.getFieldDefinition("durationUnit").defaultValue,{event:n,assignment:s}=t.dataApi.addEventToResourceWithoutPropagation({event:{startDate:e.startDate,duration:e.rowRecord.getCalendar().calculateDuration(e.startDate,e.endDate,r)},resource:e.rowRecord,eventStore:t.eventStore,assignmentStore:t.assignmentStore});return t.scheduler.trigger("dragCreateEnd",{newEventRecord:n,newAssignmentRecord:s,resourceRecord:e.rowRecord,event:e.event,proxyElement:t.proxy}),n};t.client.hasFeature("eventEdit")?t.client.features.eventEdit.editEvent(r,e.rowRecord):(r(),await t.dataApi.propagate())}getProjectForDataAPI(){return this.eventStore.getProject()}obtainResourceStore(e,t){return e.project.getResourceStore()}obtainDependencyStore(e,t){return e.project.getDependencyStore()}obtainAssignmentStore(e,t){return e.project.getAssignmentStore()}obtainEventStore(e,t){return e.project.getEventStore()}}Fp._$name="ProEventDragCreate",Va.registerFeature(Fp,!0,"ProScheduler","EventDragCreate");class Ap extends eu{static get defaultConfig(){return{showHeaderElements:!0,cls:"b-sch-nonworkingtime",calendar:null}}construct(e,t){super.construct(e,t),this.bindProject(e.project)}get calendar(){return this._calendar}set calendar(e){const t=this;e!==t._calendar&&(t._calendar=e,t.client.isPainted&&t.renderRanges())}doDestroy(){this.unbindProject(),super.doDestroy()}bindProject(e){const t=this;t.calendar=e.getCalendar(),e.on({name:"project",load:()=>{t.calendar=e.getCalendar()},thisObj:t}),e.eventStore.on({name:"project",change:({record:r,changes:n})=>{r===e&&n.calendar&&(t.calendar=e.getCalendar())},thisObj:t}),e.calendarManagerStore.on({name:"project",change:({record:e})=>{e===t.calendar&&t.client.isPainted&&t.renderRanges()},thisObj:t})}unbindProject(){this.detachListeners("project")}renderRanges(){const e=this,{store:t}=e,{timeAxis:r}=e.client;if(t&&!t.isDestroyed){const n=je.as(r.unit,1,"week")>=1;t.removeAll(!0),e.calendar&&n&&t.add(e.calendar.getDailyHolidaysRanges(r.startDate,r.endDate),!0)}super.renderRanges()}}Ap._$name="ProNonWorkingTime",Va.registerFeature(Ap,!0,["ProScheduler","Gantt"],"nonWorkingTime");var Pp=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const Lp=Symbol("HasCalendarMixin"),Op=e=>{class t extends e{constructor(){super(...arguments),this.calendarInherited=!0}[Lp](){}async setCalendar(e){return this.calendar=e,this.propagate()}getCalendar(){return this.calendar}*calculateCalendar(e){const t=this.getCalendarManagerStore();let r,n;if(null!=e?(Bg(e)&&(r=t.getById(e)||null,e=r),this.calendarInherited=!1,n=e):void 0===e&&this.$.calendar.hasConsistentValue()&&!this.calendarInherited&&(n=this.$.calendar.getConsistentValue()),null==n){const e=this.getProject();e!==this&&(n=yield e.$.calendar,this.calendarInherited=!0)}return!Bg(n)&&(yield n.$$),n}}return Pp([Im({serialize:e=>e&&e.id})],t.prototype,"calendar",void 0),Pp([gm("calendar")],t.prototype,"calculateCalendar",null),t};class _p extends Dg{}class $p extends Sg{initialize(...e){super.initialize(...e),this.startDate||(this.startDate=Um),this.endDate||(this.endDate=Ym)}startDateIsFinite(){return!this.isIntervalEmpty()&&this.startDate.getTime()!==Um.getTime()}endDateIsFinite(){return!this.isIntervalEmpty()&&this.endDate.getTime()!==Ym.getTime()}containsDate(e,t=Xm.Left){return t===Xm.Left&&e>=this.startDate&&e<this.endDate||t===Xm.Right&&e>this.startDate&&e<=this.endDate}isIntervalEmpty(){return this.startDate>this.endDate}intersect(e){const t=e.startDate,r=e.endDate,n=this.startDate,s=this.endDate;if(s<t||n>r)return jp;const i=new Date(Math.max(n.getTime(),t.getTime())),o=new Date(Math.min(s.getTime(),r.getTime()));return this.constructor.new({startDate:i,endDate:o})}}const jp=$p.new({startDate:Ym,endDate:Um}),Hp=e=>e.reduce((e,t)=>e.intersect(t),$p.new());var Np=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};class Bp extends $p{toString(){return`from ${this.startDate} till ${this.endDate}`}}const zp=function*(e,t,r,n){if(r.isIntervalEmpty())return jp;const s=r.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(r.startDate,!1,n):null,i=r.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(r.endDate,!1,n):null;return Hp([t,$p.new({startDate:s,endDate:i})])},Vp=function*(e,t,r,n){if(t.isIntervalEmpty())return jp;const s=t.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.startDate,!0,n):null,i=t.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.endDate,!0,n):null;return Hp([r,$p.new({startDate:s,endDate:i})])},Wp=e=>{class t extends e{async setManuallyScheduled(e){return this.$.manuallyScheduled.put(e),this.propagate()}*maybeSkipNonWorkingTime(e,t=!0){let r=yield*this.calculateEffectiveDuration();return e&&r>0?yield*this.skipNonWorkingTime(e,t):e}*calculateEffectiveConstraintInterval(e,t,r){const n=yield*this.calculateEffectiveDuration();if(null===n)return null;const s=e?zp:Vp;return yield*s(this,Hp(t),Hp(r),n)}*calculateStartDateConstraintIntervals(){return[]}*calculateEndDateConstraintIntervals(){return[]}*calculateEarlyStartDateConstraintIntervals(){return[]}*calculateEarlyEndDateConstraintIntervals(){return[]}*calculateEarlyStartDateRaw(){if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled))return yield this.$.startDate;const e=yield this.$.earlyStartDateConstraintIntervals,t=yield this.$.earlyEndDateConstraintIntervals,r=yield*this.calculateEffectiveConstraintInterval(!0,e.concat(yield this.$.startDateConstraintIntervals),t.concat(yield this.$.endDateConstraintIntervals));if(!r)return null;if(r.isIntervalEmpty()){if(void 0===this.$.startDate.value)return yield Eg.new({promise:Promise.resolve()}),null;yield _p.new()}return qm(r.startDate)?r.startDate:null}*calculateEarlyStartDate(){const e=yield this.$.earlyStartDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!0)}*calculateEarlyEndDateRaw(){if(!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled))return yield this.$.endDate;const e=yield this.$.earlyStartDateConstraintIntervals,t=yield this.$.earlyEndDateConstraintIntervals,r=yield*this.calculateEffectiveConstraintInterval(!1,e.concat(yield this.$.startDateConstraintIntervals),t.concat(yield this.$.endDateConstraintIntervals));if(!r)return null;if(r.isIntervalEmpty()){if(void 0===this.$.endDate.value)return yield Eg.new({promise:Promise.resolve()}),null;yield _p.new()}return qm(r.startDate)?r.startDate:null}*calculateEarlyEndDate(){const e=yield this.$.earlyEndDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!1)}*isConstrainedEarly(){const e=yield this.$.startDateConstraintIntervals,t=yield this.$.endDateConstraintIntervals,r=yield this.$.earlyStartDateConstraintIntervals,n=yield this.$.earlyEndDateConstraintIntervals;return Boolean(e.length||t.length||r.length||n.length)}*calculateStartDatePure(){return(yield this.$.direction)===Vh.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)?yield*super.calculateStartDatePure():(yield this.$.earlyStartDate)||(yield*super.calculateStartDatePure()):yield*super.calculateStartDatePure()}*calculateStartDateProposed(){switch(yield this.$.direction){case Vh.Forward:return!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)?yield*super.calculateStartDateProposed():(yield this.$.earlyStartDate)||(yield*super.calculateStartDateProposed());default:return yield*super.calculateStartDateProposed()}}*calculateEndDatePure(){return(yield this.$.direction)===Vh.Forward?!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)?yield*super.calculateEndDatePure():(yield this.$.earlyEndDate)||(yield*super.calculateEndDatePure()):yield*super.calculateEndDatePure()}*calculateEndDateProposed(){switch(yield this.$.direction){case Vh.Forward:return!(yield*this.isConstrainedEarly())||(yield this.$.manuallyScheduled)?yield*super.calculateEndDateProposed():(yield this.$.earlyEndDate)||(yield*super.calculateEndDateProposed());default:return yield*super.calculateEndDateProposed()}}}return Np([hm()],t.prototype,"earlyStartDateRaw",void 0),Np([Im({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ",persist:!1},{converter:Pm,persistent:!1})],t.prototype,"earlyStartDate",void 0),Np([hm()],t.prototype,"earlyEndDateRaw",void 0),Np([Im({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ",persist:!1},{converter:Pm,persistent:!1})],t.prototype,"earlyEndDate",void 0),Np([Im({type:"boolean",defaultValue:!1})],t.prototype,"manuallyScheduled",void 0),Np([hm()],t.prototype,"startDateConstraintIntervals",void 0),Np([hm()],t.prototype,"earlyStartDateConstraintIntervals",void 0),Np([hm()],t.prototype,"endDateConstraintIntervals",void 0),Np([hm()],t.prototype,"earlyEndDateConstraintIntervals",void 0),Np([gm("startDateConstraintIntervals")],t.prototype,"calculateStartDateConstraintIntervals",null),Np([gm("endDateConstraintIntervals")],t.prototype,"calculateEndDateConstraintIntervals",null),Np([gm("earlyStartDateConstraintIntervals")],t.prototype,"calculateEarlyStartDateConstraintIntervals",null),Np([gm("earlyEndDateConstraintIntervals")],t.prototype,"calculateEarlyEndDateConstraintIntervals",null),Np([gm("earlyStartDateRaw")],t.prototype,"calculateEarlyStartDateRaw",null),Np([gm("earlyStartDate")],t.prototype,"calculateEarlyStartDate",null),Np([gm("earlyEndDateRaw")],t.prototype,"calculateEarlyEndDateRaw",null),Np([gm("earlyEndDate")],t.prototype,"calculateEarlyEndDate",null),t},Gp=Symbol("RequiredProperties");function Up(e){const t=[],r=[];let n;return[function*(){for(n||(n=e[Symbol.iterator]());t.length&&(yield*t,t.length=0),n;){const{value:t,done:s}=n.next();if(s){n=null,e=null;break}r.push(t),yield t}}(),function*(){for(n||(n=e[Symbol.iterator]());r.length&&(yield*r,r.length=0),n;){const{value:r,done:s}=n.next();if(s){n=null,e=null;break}t.push(r),yield r}}()]}function*Yp(e,t){let r=0;for(const n of e)yield t(n,r++)}function*qp(e){const t=new Set;for(const r of e)t.has(r)||(t.add(r),yield r)}function*Xp(e){for(const t of e)yield*t}class Kp{constructor(e){if(this.iterable=void 0,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=void 0,new Kp(e)}copy(){const[e,t]=Up(this.iterable);return this.iterable=t,new Kp(e)}split(){const[e,t]=Up(this.iterable);return[new Kp(e),this.derive(t)]}inBatchesBySize(e){return this.derive(function*(e,t){if(t<0)throw new Error("Batch size needs to a natural number");t|=0;const r=[];for(const n of e)r.length===t&&(yield r,r.length=0),r.push(n);r.length>0&&(yield r)}(this.iterable,e))}filter(e){return this.derive(function*(e,t){let r=0;for(const n of e)t(n,r++)&&(yield n)}(this.iterable,e))}drop(e){return this.derive(function*(e,t){let r=0;for(const n of e)++r>t&&(yield n)}(this.iterable,e))}map(e){return this.derive(Yp(this.iterable,e))}reduce(e,t){return function(e,t,r){let n=0,s=r;for(const r of e)s=t(s,r,n++);return s}(this,e,t)}concat(){return this.derive(Xp(this.iterable))}uniqueOnly(){return this.derive(qp(this.iterable))}uniqueOnlyBy(e){return this.derive(function*(e,t){const r=new Set;for(const n of e){const e=t(n);r.has(e)||(r.add(e),yield n)}}(this.iterable,e))}every(e){return function(e,t){let r=0;for(const n of e)if(!t(n,r++))return!1;return!0}(this,e)}some(e){return function(e,t){let r=0;for(const n of e)if(t(n,r++))return!0;return!1}(this,e)}takeWhile(e){return this.derive(function*(e,t){let r=0;for(const n of e){if(!t(n,r++))return;yield n}}(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*e,e=void 0}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new Jp(this)}}const Zp=e=>new Kp(e);class Jp extends Kp{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new Kp(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let t=this.$iterator,r=e.length;for(r>0&&(yield*e);;){if(e.length>r){for(let t=r;t<e.length;t++)yield e[t];r=e.length}if(!t)break;const{value:n,done:s}=t.next();s?(t=this.$iterator=null,this.$iterable=null):(e.push(n),r++,yield n)}}else yield*e}}var Qp;!function(e){e.Cancel="Cancel",e.Resume="Resume"}(Qp||(Qp={}));const ef=Symbol("WalkSource");class tf extends Sg{constructor(){super(...arguments),this.visited=new Map,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e.map(e=>({node:e,from:ef,label:void 0}))),this.walkDepth()}onNode(e,t){}onTopologicalNode(e){}onCycle(e,t){return Qp.Cancel}forEachNext(e,t){throw new Error("Abstract method called")}collectNext(e,t,r){throw new Error("Abstract method called")}getVisitedInfo(e){return this.visited.get(e)}setVisitedInfo(e,t,r){return r?(r.visitedAt=t,r.visitEpoch=this.currentEpoch):(r={visitedAt:t,visitEpoch:this.currentEpoch},this.visited.set(e,r)),r}walkDepth(){this.visited;const e=this.toVisit;let t;for(;t=e.length;){const r=e[t-1].node,n=this.getVisitedInfo(r);if(n&&-2===n.visitedAt&&n.visitEpoch===this.currentEpoch)e.pop();else if(n&&n.visitEpoch===this.currentEpoch&&-1!==n.visitedAt){if(n.visitedAt<t){if(this.onCycle(r,e)!==Qp.Resume)break}else n.visitedAt=-2,this.onTopologicalNode(r);e.pop()}else{if(!1===this.onNode(r,e[t-1]))break;const s=this.setVisitedInfo(r,t,n),i=e.length;this.collectNext(r,e,s),e.length===i&&(s.visitedAt=-2,this.onTopologicalNode(r),e.pop())}}}}var rf=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};let nf=0;const sf=nf++;class of extends Sg{constructor(){super(...arguments),this.formulaId=nf++,this.inputs=new Set}}class af extends tf{collectNext(e,t){if(e instanceof of)t.push({node:e.output,from:e,label:void 0});else{const r=this.cache.formulasByInput.get(e);r&&r.forEach(r=>t.push({node:r,from:e,label:void 0}))}}}class lf extends Sg{constructor(){super(...arguments),this.variables=new Set,this.formulas=new Set,this.$formulasByInput=void 0,this.$formulasByOutput=void 0}get formulasByInput(){return void 0!==this.$formulasByInput||this.fillCache(),this.$formulasByInput}get formulasByOutput(){return void 0!==this.$formulasByOutput||this.fillCache(),this.$formulasByOutput}add(e){this.$formulasByInput=void 0,this.$formulasByOutput=void 0,this.formulas.add(e)}has(e){return this.formulas.has(e)}fillCache(){this.$formulasByInput=new Map,this.$formulasByOutput=new Map,this.formulas.forEach(e=>{let t=this.$formulasByOutput.get(e.output);t||(t=new Set,this.$formulasByOutput.set(e.output,t)),t.add(e),e.inputs.forEach(t=>{let r=this.$formulasByInput.get(t);r||(r=new Set,this.$formulasByInput.set(t,r)),r.add(e)})})}allInputVariables(){return qp(Xp(Yp(this.formulas,e=>e.inputs.values())))}isCyclic(){let e=!1;return af.new({cache:this,onCycle:()=>(e=!0,Qp.Cancel)}).startFrom(Array.from(this.allInputVariables())),e}}class cf extends lf{}class df extends Sg{constructor(){super(...arguments),this.description=void 0,this.defaultResolutionFormulas=new Set,this.resolutionsByInputHash=new Map}clear(){this.resolutionsByInputHash.clear()}resolve(e){const t=this.resolutionsByInputHash.get(e.hash);if(void 0!==t)return t;const r=this.buildResolution(e);return this.resolutionsByInputHash.set(e.hash,r),r}buildResolution(e){const t=gf.new({context:this,input:e}),r=Array.from(t.next()).map(e=>({resolution:e.asResolution(),nbrOfDefaultFormulas:Array.from(e.activatedFormulas.formulas).reduce((t,r)=>e.formulaIsDefault(r)?t+1:t,0),unCoveredInputWeight:e.unCoveredInputWeight()}));if(r.sort((e,t)=>e.unCoveredInputWeight<t.unCoveredInputWeight?-1:e.unCoveredInputWeight>t.unCoveredInputWeight?1:t.nbrOfDefaultFormulas-e.nbrOfDefaultFormulas),r.length>0)return r[0].resolution}}var uf;!function(e){e[e.NoInput=0]="NoInput",e[e.HasPreviousValue=1]="HasPreviousValue",e[e.HasProposedValue=2]="HasProposedValue",e[e.KeepIfPossible=4]="KeepIfPossible"}(uf||(uf={}));class hf extends Sg{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.$hash=""}get hash(){return""!==this.$hash?this.$hash:this.$hash=this.buildHash()}get description(){return this.context.description}get resolution(){return this.context.resolve(this)}initialize(...e){super.initialize(...e),(e=>{const t=e[Gp];if(t)for(let r=0;r<t.length;r++)if(void 0===e[t[r]])throw new Error(`Required attribute [${String(t[r])}] is not provided`)})(this),this.input=new Map(Zp(this.description.variables).map(e=>[e,uf.NoInput]))}buildHash(){return String.fromCharCode(...Zp(this.description.variables).inBatchesBySize(5).map(e=>this.batchToCharCode(e)))}batchToCharCode(e){return e.reduceRight((e,t,r)=>e|this.input.get(t)<<3*r,0)}addProposedValueFlag(e){const t=this.input.get(e);this.input.set(e,t|uf.HasProposedValue)}hasProposedValue(e){return Boolean(this.input.get(e)&uf.HasProposedValue)}hasProposedValueVars(){return Zp(this.description.variables).filter(e=>this.hasProposedValue(e))}addPreviousValueFlag(e){const t=this.input.get(e);this.input.set(e,t|uf.HasPreviousValue)}hasPreviousValue(e){return Boolean(this.input.get(e)&uf.HasPreviousValue)}hasPreviousValueVars(){return Zp(this.description.variables).filter(e=>this.hasPreviousValue(e))}addKeepIfPossibleFlag(e){const t=this.input.get(e);this.input.set(e,t|uf.KeepIfPossible)}keepIfPossible(e){return Boolean(this.input.get(e)&uf.KeepIfPossible)}keepIfPossibleVars(){return Zp(this.description.variables).filter(e=>this.keepIfPossible(e))}}rf([(e,t)=>{let r=e[Gp];r||(r=e[Gp]=[]),r.push(t)}],hf.prototype,"context",void 0);class gf extends Sg{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.previous=void 0,this.activatedFormula=void 0,this.$activatedFormulas=void 0}get activatedFormulas(){if(void 0!==this.$activatedFormulas)return this.$activatedFormulas;const e=lf.new({variables:this.description.variables,formulas:Zp(this.thisAndPreviousStates()).map(e=>e.activatedFormula).toSet()});return this.$activatedFormulas=e}get description(){return this.context.description}*thisAndPreviousStates(){let e=this;for(;e&&e.activatedFormula;)yield e,e=e.previous}formulaHasProposedValueInInput(e){return Array.from(e.inputs).some(e=>this.input.hasProposedValue(e))}unCoveredInputWeight(){const e=Yp(this.input.hasProposedValueVars(),e=>({variable:e,isProposed:!0})),t=Yp(this.input.keepIfPossibleVars(),e=>({variable:e,isProposed:!1}));return Zp([e,t]).concat().uniqueOnlyBy(e=>e.variable).reduce((e,{variable:t,isProposed:r})=>{let n=0;const s=this.activatedFormulas.formulasByOutput.get(t);if(s){const e=1===s.size?Array.from(s)[0]:null;e&&this.formulaIsDefault(e)&&this.formulaHasProposedValueInInput(e)?n+=r?1e6:1e4:n+=r?1e7:1e5}const i=this.activatedFormulas.formulasByInput.get(t);return i&&i.size>0||(n+=r?1e3:100),e+n},0)}preferFormula(e,t){const r=this.formulaAllInputsHasProposed(e),n=this.formulaAllInputsHasProposed(t);if(r&&!n)return-1;if(n&&!r)return 1;const s=this.formulaCountInputsWithProposedOrKeep(e),i=this.formulaCountInputsWithProposedOrKeep(t);return s>i?-1:s<i?1:this.formulaIsDefault(e)&&!this.formulaIsDefault(t)?-1:this.formulaIsDefault(t)&&!this.formulaIsDefault(e)?1:0}formulaIsDefault(e){return this.context.defaultResolutionFormulas.has(e)}formulaCountInputsWithProposedOrKeep(e){let t=0;return Array.from(e.inputs).forEach(e=>{(this.input.hasProposedValue(e)||this.input.keepIfPossible(e))&&t++}),t}formulaAllInputsHasProposedOrKeep(e){return Array.from(e.inputs).every(e=>this.input.hasProposedValue(e)||this.input.keepIfPossible(e))}formulaAllInputsHasProposed(e){return Array.from(e.inputs).every(e=>this.input.hasProposedValue(e))}formulaIsApplicable(e){const t=Array.from(e.inputs).every(e=>this.input.hasProposedValue(e)||this.input.hasPreviousValue(e)||this.activatedFormulas.formulasByOutput.has(e)),r=lf.new({formulas:new Set(this.activatedFormulas.formulas)});return r.add(e),t&&!r.isCyclic()}formulaIsInsignificant(e){const t=this.activatedFormulas.formulasByOutput.has(e.output),r=this.input.hasPreviousValue(e.output);return t||r&&Array.from(e.inputs).some(e=>!this.input.hasPreviousValue(e)&&!this.input.hasProposedValue(e))}unvisitedFormulas(){return Array.from(this.description.formulas).filter(e=>!this.activatedFormulas.has(e))}*next(){const e=this.unvisitedFormulas();e.sort(this.preferFormula.bind(this));let t=!0;for(const r of e){if(!this.formulaIsApplicable(r)||this.formulaIsInsignificant(r))continue;const e=gf.new({previous:this,context:this.context,input:this.input,activatedFormula:r});yield*e.next(),t=!1}t&&(yield this)}asResolution(){return new Map(Zp(this.description.variables).map(e=>{const t=this.activatedFormulas.formulasByOutput.get(e);if(t)for(const r of t)return[e,r.formulaId];return[e,sf]}))}}class mf extends hf{collectInfo(e,t){e.hasConsistentValue()&&this.addPreviousValueFlag(t),e.hasProposedValue()&&this.addProposedValueFlag(t)}}var pf;!function(e){e.KeepDuration="KeepDuration",e.KeepStartDate="KeepStartDate",e.KeepEndDate="KeepEndDate"}(pf||(pf={}));const ff=Symbol("StartDate"),vf=Symbol("EndDate"),yf=Symbol("Duration"),bf=of.new({output:ff,inputs:new Set([yf,vf])}),Cf=of.new({output:vf,inputs:new Set([yf,ff])}),wf=of.new({output:yf,inputs:new Set([ff,vf])}),Sf=cf.new({variables:new Set([ff,vf,yf]),formulas:new Set([bf,Cf,wf])}),Df=df.new({description:Sf,defaultResolutionFormulas:new Set([Cf])});df.new({description:Sf,defaultResolutionFormulas:new Set([bf])});class Ef extends mf{addInstruction(e){e===pf.KeepStartDate&&this.addKeepIfPossibleFlag(ff),e===pf.KeepEndDate&&this.addKeepIfPossibleFlag(vf),e===pf.KeepDuration&&this.addKeepIfPossibleFlag(yf)}}class xf extends em{equality(e,t){const r=e.resolution,n=t.resolution;return r.get(ff)===n.get(ff)&&r.get(vf)===n.get(vf)&&r.get(yf)===n.get(yf)}}var Tf=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const Rf=Symbol("EventMixin"),Mf=e=>{class t extends e{[Rf](){}*calculateDispatcher(){const e=yield*this.prepareDispatcher(),t=this.$.startDate.proposedArgs,r=t?t[1]?pf.KeepDuration:pf.KeepEndDate:void 0;r&&e.addInstruction(r);const n=this.$.endDate.proposedArgs,s=n?n[1]?pf.KeepDuration:pf.KeepStartDate:void 0;s&&e.addInstruction(s);const i=this.$.duration.proposedArgs;let o;if(i)switch(i[1]){case!0:o=pf.KeepStartDate;break;case!1:o=pf.KeepEndDate}return!o&&e.hasProposedValue(yf)&&(o=pf.KeepStartDate),o&&e.addInstruction(o),e}*prepareDispatcher(){const e=(yield*this.dispatcherClass()).new({context:yield*this.cycleResolutionContext()});return e.collectInfo(this.$.startDate,ff),e.collectInfo(this.$.endDate,vf),e.collectInfo(this.$.duration,yf),e}*cycleResolutionContext(){return Df}*dispatcherClass(){return Ef}buildProposedDispatcher(){}*skipNonWorkingTime(e,t=!0){if(!e)return null;return(yield this.$.calendar).skipNonWorkingTime(e,t)}convertDuration(e,t,r){return this.getProject().calendar.convertDuration(e,t,r)}*$convertDuration(e,t,r){const n=this.getProject();return(yield n.$.calendar).convertDuration(e,t,r)}*calculateStartDate(){const e=(yield this.$.dispatcher).resolution.get(ff);if(e===sf)return yield*this.calculateStartDateProposed();if(e===bf.formulaId)return yield*this.calculateStartDatePure();throw new Error("Unknown formula for `startDate`")}*calculateStartDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.endDate,!1,yield this.$.duration)}*calculateProjectedXDateWithDuration(e,t=!0,r){const n=yield this.$.durationUnit,s=yield this.$.calendar;this.getProject();if(!e||(i=r,Number(i)!==i))return null;var i;const o=yield*this.$convertDuration(r,n,$h.Millisecond);return t?s.calculateEndDate(e,o,$h.Millisecond):s.calculateStartDate(e,o,$h.Millisecond)}*calculateStartDateProposed(){const e=this.$.startDate.getProposedOrPreviousValue();return yield*this.skipNonWorkingTime(e,!0)}*calculateEndDate(){const e=(yield this.$.dispatcher).resolution.get(vf);if(e===sf)return yield*this.calculateEndDateProposed();if(e===Cf.formulaId)return yield*this.calculateEndDatePure();throw new Error("Unknown formula for `endDate`")}*calculateEndDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.startDate,!0,yield this.$.duration)}*calculateEndDateProposed(){const e=this.$.endDate.getProposedOrPreviousValue();return yield*this.skipNonWorkingTime(e,!1)}*calculateDuration(e){const t=(yield this.$.dispatcher).resolution.get(yf);if(t===sf)return yield*this.calculateDurationProposed();if(t===wf.formulaId)return yield*this.calculateDurationPure();throw new Error("Unknown formula for `duration`")}*calculateDurationPure(){const e=yield this.$.startDate,t=yield this.$.endDate;if(!e||!t)return null;if(e>t)throw new Error("debug");return yield*this.calculateProjectedDuration(e,t)}*calculateDurationProposed(){return this.$.duration.getProposedOrPreviousValue()}*calculateProjectedDuration(e,t,r){if(!e||!t)return null;r||(r=yield this.$.durationUnit);const n=yield this.$.calendar;this.getProject();return yield*this.$convertDuration(n.calculateDuration(e,t,$h.Millisecond),$h.Millisecond,r)}*calculateEffectiveDuration(){let e;const t=(yield this.$.dispatcher).resolution.get(yf);return t===sf?e=yield this.$.duration:t===wf.formulaId&&(e=yield*this.calculateProjectedDuration(this.$.startDate.getProposedOrPreviousValue(),this.$.endDate.getProposedOrPreviousValue())),e}getStartDate(){return this.startDate}putStartDate(e,t=!0){const r=void 0===this.$.startDate.getProposedOrPreviousValue();null==e&&r||(null!==e||r||(this.$.endDate.proposedValue=null,this.$.endDate.proposedArgs=[null],this.$.duration.proposedValue=null,this.$.duration.proposedArgs=[null]),this.$.startDate.put(e,t),this.getGraph()&&(this.markAsNeedRecalculation(this.$.dispatcher),this.markAsNeedRecalculation(this.$.endDate),this.markAsNeedRecalculation(this.$.duration)))}async setStartDate(e,t=!0){return this.putStartDate(e,t),this.propagate()}getEndDate(){return this.endDate}putEndDate(e,t=!1){const r=void 0===this.$.startDate.getProposedOrPreviousValue();if(null==e&&r)return;null!==e||r||(this.$.startDate.proposedValue=null,this.$.startDate.proposedArgs=[null],this.$.duration.proposedValue=null,this.$.duration.proposedArgs=[null]);const n=this.getStartDate();!t&&e&&e.getTime&&n&&e.getTime()<n.getTime()&&(e=n,this.putDuration(0)),this.$.endDate.put(e,t),this.getGraph()&&(this.markAsNeedRecalculation(this.$.dispatcher),this.markAsNeedRecalculation(this.$.startDate),this.markAsNeedRecalculation(this.$.duration))}async setEndDate(e,t=!1){return this.putEndDate(e,t),this.propagate()}getDuration(e){let t=this.duration;return e&&(t=this.convertDuration(t,this.durationUnit,e)),t}putDuration(e,t,r=!0){const n=void 0===this.$.duration.getProposedOrPreviousValue();null==e&&n||(null!==e||n||(this.$.startDate.proposedValue=null,this.$.startDate.proposedArgs=[null],this.$.endDate.proposedValue=null,this.$.endDate.proposedArgs=[null]),this.$.duration.put(e,r),this.getGraph()&&(this.markAsNeedRecalculation(this.$.dispatcher),this.markAsNeedRecalculation(this.$.startDate),this.markAsNeedRecalculation(this.$.endDate)),null!=t&&t!==this.durationUnit&&this.$.durationUnit.put(t))}async setDuration(e,t,r=!0){return this.putDuration(e,t,r),this.propagate()}getDurationUnit(){return this.durationUnit}setDurationUnit(e){throw new Error("Use `setDuration` instead")}toString(){return"Event "+this.id}}return Tf([Im({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{converter:Pm})],t.prototype,"startDate",void 0),Tf([Im({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{converter:Pm})],t.prototype,"endDate",void 0),Tf([Im({type:"number",allowNull:!0})],t.prototype,"duration",void 0),Tf([Im({type:"string",defaultValue:$h.Day},{converter:je.normalizeUnit})],t.prototype,"durationUnit",void 0),Tf([hm({atomCls:xf})],t.prototype,"dispatcher",void 0),Tf([Im({type:"string",defaultValue:Vh.Forward})],t.prototype,"direction",void 0),Tf([gm("dispatcher")],t.prototype,"calculateDispatcher",null),Tf([gm("startDate")],t.prototype,"calculateStartDate",null),Tf([gm("endDate")],t.prototype,"calculateEndDate",null),Tf([gm("duration")],t.prototype,"calculateDuration",null),t};class kf{constructor(e){this.intervalGroups=[],e&&Object.assign(this,e)}combineWith(e){const t=this.intervalGroups.slice();return t.push([e.calendar,e]),new kf({intervalGroups:t})}getIsWorkingForEvery(){if(null!=this.isWorkingForEvery)return this.isWorkingForEvery;for(let[e,t]of this.getGroups())if(!t[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(null!=this.isWorkingForSome)return this.isWorkingForSome;for(let[e,t]of this.getGroups())if(t[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(e){return this.getCalendarsWorkStatus().get(e)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const e=new Map;for(let[t,r]of this.getGroups())e.set(t,r[0].isWorking);return this.calendarsWorkStatus=e}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const e=[];for(let[t,r]of this.getGroups())r[0].isWorking&&e.push(t);return this.calendarsWorking=e}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const e=[];for(let[t,r]of this.getGroups())r[0].isWorking||e.push(t);return this.calendarsNonWorking=e}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const e=this.calendars=[],t=new Map;return this.intervalGroups.forEach(([r,n])=>{let s=t.get(r);s||(e.push(r),s=[],t.set(r,s)),s.push.apply(s,n.intervals)}),t.forEach((e,r)=>{const n=Jm(e);n.sort((e,t)=>t.getPriorityField()-e.getPriorityField()),t.set(r,n)}),this.intervalsByCalendar=t}}class If extends Zm{constructor(e){super(e),this.calendarCaches=Jm(this.calendarCaches),this.intervalCache=new sp({emptyInterval:new kf,combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){this.calendarCaches.forEach(r=>{r.fillCache(e,t),this.includeWrappingRangeFrom(r,e,t)})}}const Ff=new Map;var Af=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const Pf=Symbol("HasAssignments"),Lf=e=>{class t extends e{constructor(){super(...arguments),this.assignmentsByCalendar=new Map}[Pf](){}get assignments(){return[...this.assigned]}getAssignmentFor(e){let t;return this.assigned.forEach(r=>{r.resource===e&&(t=r)}),t}isAssignedTo(e){return Boolean(this.getAssignmentFor(e))}reassign(e,t){const r=this.getAssignmentFor(e);if(!r)throw new Error(`Can't unassign resource \`${e}\` from task \`${this}\` - resource is not assigned to the task!`);if(this.removeAssignment(r),this.getAssignmentFor(t))throw new Error("Resource can't be assigned twice to the same task");const n=this.getProject().assignmentStore.modelClass;return this.addAssignment(new n({event:this,resource:t})),this.propagate()}async assign(e,t=100){if(this.getAssignmentFor(e))throw new Error("Resource can't be assigned twice to the same task");const r=this.getProject().assignmentStore.modelClass;return this.addAssignment(new r({event:this,resource:e,units:t})),this.propagate()}async unassign(e){const t=this.getAssignmentFor(e);if(!t)throw new Error(`Can't unassign resource \`${e}\` from task \`${this}\` - resource is not assigned to the task!`);return this.removeAssignment(t),this.propagate()}addAssignment(e){return this.getProject().assignmentStore.add(e),e}removeAssignment(e){return this.getProject().assignmentStore.remove(e),e}leaveProject(){const e=this.getAssignmentStore();this.assigned.forEach(t=>e.remove(t)),super.leaveProject()}*forEachAvailabilityInterval(e,t){const r=yield this.$.calendar,n=yield this.$.assignmentsByCalendar;return(yield this.$.effectiveCalendarsCombination).forEachAvailabilityInterval(e,(s,i,o)=>{const a=o.getCalendarsWorkStatus(),l=o.getCalendarsWorking();if(a.get(r)&&(e.ignoreResourceCalendars||l.some(e=>n.has(e))))return t(s,i,o)})}*calculateEffectiveCalendarsCombination(){return(e=>{const t=Jm(e);if(0===t.length)throw new Error("No calendars to combine");t.sort((e,t)=>e.internalId<t.internalId?-1:1);const r=t.map(e=>e.internalId+"/").join(""),n=t.map(e=>e.version+"/").join("");let s,i=Ff.get(r);return i&&i.versionsHash===n?s=i.cache:(s=new If({calendarCaches:t.map(e=>e.calendarCache)}),Ff.set(r,{versionsHash:n,cache:s})),s})([...(yield this.$.assignmentsByCalendar).keys(),yield this.$.calendar])}*calculateAssignmentsByCalendar(){const e=yield this.$.assigned,t=new Map;for(const r of e){const e=yield r.$.resource;if(e){const n=yield e.$.calendar;let s=t.get(n);s||(s=[],t.set(n,s)),s.push(r)}}return t}*getBaseOptionsForDurationCalculations(){return{ignoreResourceCalendars:!1}}*skipNonWorkingTime(e,t=!0){if(!e)return null;if((yield this.$.assignmentsByCalendar).size>0){const r=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),t?{startDate:e,isForward:t}:{endDate:e,isForward:t});let n;return(yield*this.forEachAvailabilityInterval(r,(e,r,s)=>(n=t?e:r,!1)))===Km.FullRangeIterated&&(yield xg.new()),new Date(n)}return yield*super.skipNonWorkingTime(e,t)}*calculateProjectedDuration(e,t,r){if(!e||!t)return null;if((yield this.$.assignmentsByCalendar).size>0){const n=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),{startDate:e,endDate:t,isForward:!0});let s=0;return yield*this.forEachAvailabilityInterval(n,(e,t)=>{s+=t.getTime()-e.getTime()}),r||(r=yield this.$.durationUnit),yield*this.getProject().$convertDuration(s,$h.Millisecond,r)}return yield*super.calculateProjectedDuration(e,t,r)}*calculateProjectedXDateWithDuration(e,t=!0,r){if(null==e||null==r||isNaN(r))return null;if(0==r)return e;const n=yield this.$.durationUnit,s=yield*this.getProject().$convertDuration(r,n,$h.Millisecond);let i=e.getTime(),o=s;const a=yield this.$.calendar;if((yield this.$.assignmentsByCalendar).size>0){const r=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),t?{startDate:e,isForward:t}:{endDate:e,isForward:t});return yield*this.forEachAvailabilityInterval(r,(e,r,n)=>{const s=e.getTime(),a=r.getTime(),l=a-s;if(l>=o)return i=t?s+o:a-o,!1;{const t=e.getTimezoneOffset()-r.getTimezoneOffset();o-=l+60*t*1e3}}),new Date(i)}return a.accumulateWorkingTime(e,s,$h.Millisecond,t).finalDate}*hasProposedValueForUnits(){const e=yield this.$.assigned;for(const t of e){if((yield t.$.resource)&&t.$.units.hasProposedValue())return!0}return!1}hasAssignmentChanges(){return this.$.assigned.newRefs.size>0||this.$.assigned.oldRefs.size>0}}return Af([Im()],t.prototype,"dontRemoveMe",void 0),Af([um({},Tm)],t.prototype,"assigned",void 0),Af([hm()],t.prototype,"effectiveCalendarsCombination",void 0),Af([hm()],t.prototype,"assignmentsByCalendar",void 0),Af([gm("effectiveCalendarsCombination")],t.prototype,"calculateEffectiveCalendarsCombination",null),Af([gm("assignmentsByCalendar")],t.prototype,"calculateAssignmentsByCalendar",null),t};var Of=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const _f=e=>{class t extends e{*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}*calculateStartDatePure(){return(yield*this.hasSubEvents())?yield*this.calculateMinChildrenStartDate():yield*super.calculateStartDatePure()}*calculateEndDatePure(){return(yield*this.hasSubEvents())?yield*this.calculateMaxChildrenEndDate():yield*super.calculateEndDatePure()}*calculateStartDateProposed(){return(yield*this.hasSubEvents())?yield*this.calculateStartDatePure():yield*super.calculateStartDateProposed()}*calculateEndDateProposed(){return(yield*this.hasSubEvents())?yield*this.calculateEndDatePure():yield*super.calculateEndDateProposed()}*calculateDurationProposed(){return(yield*this.hasSubEvents())?yield*this.calculateDurationPure():yield*super.calculateDurationProposed()}*calculateMinChildrenStartDate(){const e=yield*this.subEventsIterable(),t=[];for(const r of e)t.push(yield r.$.startDate);let r=t.reduce((e,t)=>t?Math.min(e,t.getTime()):e,Ym.getTime());return r===Um.getTime()||r===Ym.getTime()?null:new Date(r)}*calculateMaxChildrenEndDate(){const e=yield*this.subEventsIterable(),t=[];for(const r of e)t.push(yield r.$.endDate);let r=t.reduce((e,t)=>t?Math.max(e,t.getTime()):e,Um.getTime());return r===Um.getTime()||r===Ym.getTime()?null:new Date(r)}get parent(){return this._parent}set parent(e){this._parent=e,this.$.parentEvent.put(e)}*maybeSkipNonWorkingTime(e,t=!0){return(yield this.$.childEvents).size>0?e:yield*super.maybeSkipNonWorkingTime(e,t)}*calculateStartDateConstraintIntervals(){const e=yield*super.calculateStartDateConstraintIntervals(),t=yield this.$.parentEvent;if(t){const r=yield t.$.startDateConstraintIntervals;e.push.apply(e,r)}return e}*calculateEndDateConstraintIntervals(){const e=yield*super.calculateEndDateConstraintIntervals(),t=yield this.$.parentEvent;if(t){const r=yield t.$.endDateConstraintIntervals;e.push.apply(e,r)}return e}*calculateEarlyStartDateConstraintIntervals(){const e=yield*super.calculateEarlyStartDateConstraintIntervals(),t=yield this.$.parentEvent;if(t){const r=yield t.$.earlyStartDateConstraintIntervals;e.push.apply(e,r)}return e}*calculateEarlyEndDateConstraintIntervals(){const e=yield*super.calculateEarlyEndDateConstraintIntervals(),t=yield this.$.parentEvent;if(t){const r=yield t.$.earlyEndDateConstraintIntervals;e.push.apply(e,r)}return e}*calculateEarlyStartDateRaw(){const e=yield this.$.childEvents;let t;if(e.size){t=Ym;for(let r of e){const e=yield r.$.earlyStartDateRaw;e&&e<t&&(t=e)}t=t.getTime()!==Ym.getTime()?t:null}else t=yield*super.calculateEarlyStartDateRaw();return t}*calculateEarlyEndDateRaw(){const e=yield this.$.childEvents;let t;if(e.size){t=Um;for(let r of e){const e=yield r.$.earlyEndDateRaw;e&&e>t&&(t=e)}t=t.getTime()!==Um.getTime()?t:null}else t=yield*super.calculateEarlyEndDateRaw();return t}}return Of([bm({bucket:"childEvents"})],t.prototype,"parentEvent",void 0),Of([ym()],t.prototype,"childEvents",void 0),Of([gm("startDateConstraintIntervals")],t.prototype,"calculateStartDateConstraintIntervals",null),Of([gm("endDateConstraintIntervals")],t.prototype,"calculateEndDateConstraintIntervals",null),Of([gm("earlyStartDateConstraintIntervals")],t.prototype,"calculateEarlyStartDateConstraintIntervals",null),Of([gm("earlyEndDateConstraintIntervals")],t.prototype,"calculateEarlyEndDateConstraintIntervals",null),Of([gm("earlyStartDateRaw")],t.prototype,"calculateEarlyStartDateRaw",null),Of([gm("earlyEndDateRaw")],t.prototype,"calculateEarlyEndDateRaw",null),t};var $f=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const jf=e=>{class t extends e{*calculateEarlyStartDateConstraintIntervals(){const e=yield*super.calculateEarlyStartDateConstraintIntervals();let t;for(t of yield this.$.incomingDeps){const r=yield t.$.fromEvent;if(null==r||Bg(r))continue;let n;switch(t.type){case Nh.EndToStart:const e=yield r.$.earlyEndDateRaw;if(e){const s=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;n=Bp.new({startDate:o.calculateEndDate(e,s,i),endDate:null,originDescription:'"end to start" dependency from task '+r,onRemoveAction:this.getOnRemoveAction(t)})}break;case Nh.StartToStart:const s=yield r.$.earlyStartDateRaw;if(s){const e=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;n=Bp.new({startDate:o.calculateEndDate(s,e,i),endDate:null,originDescription:'"start to start" dependency from task '+r,onRemoveAction:this.getOnRemoveAction(t)})}}n&&e.unshift(n)}return e}*calculateEarlyEndDateConstraintIntervals(){const e=yield*super.calculateEarlyEndDateConstraintIntervals();let t;for(t of yield this.$.incomingDeps){const r=yield t.$.fromEvent;if(null==r||Bg(r))continue;let n;switch(t.type){case Nh.EndToEnd:const e=yield r.$.earlyEndDateRaw;if(e){const s=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;n=Bp.new({startDate:o.calculateEndDate(e,s,i),endDate:null,originDescription:'"end to end" dependency from task '+r,onRemoveAction:this.getOnRemoveAction(t)})}break;case Nh.StartToEnd:const s=yield r.$.earlyStartDateRaw;if(s){const e=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;n=Bp.new({startDate:o.calculateEndDate(s,e,i),endDate:null,originDescription:'"start to end" dependency from task '+r,onRemoveAction:this.getOnRemoveAction(t)})}}n&&e.unshift(n)}return e}*calculateLateStartDateConstraintIntervals(){const e=yield*super.calculateLateStartDateConstraintIntervals();let t;for(t of yield this.$.outgoingDeps){const r=yield t.$.toEvent;if(null==r||Bg(r))continue;let n;switch(t.type){case Nh.StartToStart:const e=yield r.$.lateStartDateRaw;if(e){const s=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;n=Bp.new({startDate:null,endDate:o.calculateStartDate(e,s,i),originDescription:'"start to start" dependency to task '+r,onRemoveAction:this.getOnRemoveAction(t)})}break;case Nh.StartToEnd:const s=yield r.$.lateEndDateRaw;if(s){const e=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;n=Bp.new({startDate:null,endDate:o.calculateStartDate(s,e,i),originDescription:'"start to end" dependency to task '+r,onRemoveAction:this.getOnRemoveAction(t)})}}n&&e.unshift(n)}return e}*calculateLateEndDateConstraintIntervals(){const e=yield*super.calculateLateEndDateConstraintIntervals();let t;for(t of yield this.$.outgoingDeps){const r=yield t.$.toEvent;if(null==r||Bg(r))continue;let n;switch(t.type){case Nh.EndToEnd:const e=yield r.$.lateEndDateRaw;if(e){const s=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;n=Bp.new({startDate:null,endDate:o.calculateStartDate(e,s,i),originDescription:'"end to end" dependency to task '+r,onRemoveAction:this.getOnRemoveAction(t)})}break;case Nh.EndToStart:const s=yield r.$.lateStartDateRaw;if(s){const e=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;n=Bp.new({startDate:null,endDate:o.calculateStartDate(s,e,i),originDescription:'"end to start" dependency to task '+r,onRemoveAction:this.getOnRemoveAction(t)})}}n&&e.unshift(n)}return e}getOnRemoveAction(e){return()=>{this.getDependencyStore().remove(e)}}async setIncomingDeps(e){const t=this.getDependencyStore();return this.incomingDeps.forEach(e=>t.remove(e)),e.forEach(e=>{e.toEvent=this,t.add(e)}),this.propagate()}async setOutgoingDeps(e){const t=this.getDependencyStore();return this.outgoingDeps.forEach(e=>t.remove(e)),e.forEach(e=>{e.fromEvent=this,t.add(e)}),this.propagate()}leaveProject(){const e=this.getDependencyStore();this.incomingDeps.forEach(t=>e.remove(t)),this.outgoingDeps.forEach(t=>e.remove(t)),super.leaveProject()}}return $f([Im()],t.prototype,"dontRemoveMe",void 0),$f([um({},Tm)],t.prototype,"outgoingDeps",void 0),$f([um({},Tm)],t.prototype,"incomingDeps",void 0),$f([gm("earlyStartDateConstraintIntervals")],t.prototype,"calculateEarlyStartDateConstraintIntervals",null),$f([gm("earlyEndDateConstraintIntervals")],t.prototype,"calculateEarlyEndDateConstraintIntervals",null),$f([gm("lateStartDateConstraintIntervals")],t.prototype,"calculateLateStartDateConstraintIntervals",null),$f([gm("lateEndDateConstraintIntervals")],t.prototype,"calculateLateEndDateConstraintIntervals",null),t},Hf=(e=Jn)=>(e=>class extends e{})(Lf(_f(jf(Wp(Mf(Op(jm(Hm(Lm(lm(e)))))))))));Hf(Jn);class Nf extends(wg(Hf(jc))){static get fields(){return[{name:"note",type:"string"},{name:"percentDone",type:"number",defaultValue:0},{name:"parentId",serialize(e,t){const r=t.getEventStore(),n=t.getProject();return r&&r.getById(e)===n&&(e=null),e}},{name:"phantomId",type:"string"},{name:"phantomParentId",type:"string"},{name:"showInTimeline",type:"boolean"},{name:"index",type:"int",persist:!0},{name:"iconCls"},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0}]}get isTask(){return!0}get successors(){return Array.from(this.outgoingDeps)}set successors(e){this.setOutgoingDeps(e)}get predecessors(){return Array.from(this.incomingDeps)}set predecessors(e){this.setIncomingDeps(e)}get renderedPercentDone(){return this.percentDone<=99?Math.round(this.percentDone):Math.floor(this.percentDone)}get isDraggable(){return this.draggable}get isResizable(){return this.resizable&&!this.milestone&&!this.isParent}get isStarted(){return this.percentDone>0}get isCompleted(){return this.percentDone>=100}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:t}=this;if(e&&t)return t.getTime()===e.getTime()}return 0===this.duration}get isMilestone(){return this.milestone}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){const e=this;if(e.milestone)return e.setDuration(1,e.durationUnit,!1)}get allDependencies(){return[...this.predecessors||[],...this.successors||[]]}get predecessorTasks(){return this.predecessors.map(e=>e.fromEvent)}get successorTasks(){return this.successors.map(e=>e.toEvent)}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get sequenceNumber(){let e=0,t=this;for(;t.parent;)e+=t.previousSiblingsTotalCount+1,t=t.parent;return e}get isSubProject(){return!1}get subProject(){const e=this;let t=null;return e.isProject?t=e:e.bubbleWhile(e=>(e.isProject&&(t=e),!t)),t}get fullEffort(){return{unit:this.effortUnit,magnitude:this.effort}}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get fullDuration(){return{unit:this.durationUnit,magnitude:this.duration}}set fullDuration(e){this.setDuration(e.magnitude,e.unit)}normalize(){}inSetNormalize(e){}}Nf.convertEmptyParentToLeaf=!0,Nf._$name="ProTaskModel";var Bf=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const zf=e=>{class t extends e{*calculateLateStartDateConstraintIntervals(){const e=[],t=yield this.$.parentEvent;if(t){const r=yield t.$.lateStartDateConstraintIntervals;e.push.apply(e,r)}return e}*calculateLateEndDateConstraintIntervals(){const e=[],t=yield this.$.parentEvent;if(t){const r=yield t.$.lateEndDateConstraintIntervals;e.push.apply(e,r)}return e}*calculateLateStartDateRaw(){const e=yield this.$.childEvents;let t;if(e.size){t=Ym;for(let r of e){const e=yield r.$.lateStartDateRaw;e&&e<t&&(t=e)}t=t.getTime()-Ym.getTime()?t:null}else{if(!(yield*this.isConstrainedLate()))return yield this.$.startDate;const e=yield this.$.lateStartDateConstraintIntervals,r=yield this.$.lateEndDateConstraintIntervals,n=yield*this.calculateEffectiveConstraintInterval(!0,e.concat(yield this.$.startDateConstraintIntervals),r.concat(yield this.$.endDateConstraintIntervals));if(!n||!qm(n.endDate))return null;t=n.endDate}return t}*calculateLateStartDate(){const e=yield this.$.lateStartDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!0)}*calculateLateEndDateRaw(){const e=yield this.$.childEvents;let t;if(e.size){t=Um;for(let r of e){const e=yield r.$.lateEndDateRaw;e&&e>t&&(t=e)}t=t.getTime()-Um.getTime()?t:null}else{if(!(yield*this.isConstrainedLate()))return yield this.$.endDate;const e=yield this.$.lateStartDateConstraintIntervals,r=yield this.$.lateEndDateConstraintIntervals,n=yield*this.calculateEffectiveConstraintInterval(!1,e.concat(yield this.$.startDateConstraintIntervals),r.concat(yield this.$.endDateConstraintIntervals));if(!n||!qm(n.endDate))return null;t=n.endDate}return t}*calculateLateEndDate(){const e=yield this.$.lateEndDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!1)}*calculateTotalSlack(){const e=yield this.$.earlyStartDateRaw,t=yield this.$.lateStartDateRaw,r=yield this.$.earlyEndDateRaw,n=yield this.$.lateEndDateRaw,s=yield this.$.slackUnit;let i,o;const a=e&&t&&qm(e)&&qm(t),l=r&&n&&qm(r)&&qm(n);return(a||l)&&(a?(o=yield*this.calculateProjectedDuration(e,t,s),l&&(i=yield*this.calculateProjectedDuration(r,n,s),i<o&&(o=i))):l&&(o=yield*this.calculateProjectedDuration(r,n,s))),o}*calculateCritical(){return(yield this.$.totalSlack)<=0}*isConstrainedLate(){const e=yield this.$.startDateConstraintIntervals,t=yield this.$.endDateConstraintIntervals,r=yield this.$.lateStartDateConstraintIntervals,n=yield this.$.lateEndDateConstraintIntervals;return Boolean(e.length||t.length||r.length||n.length)}*calculateStartDatePure(){return(yield this.$.direction)===Vh.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)?yield*super.calculateStartDatePure():yield this.$.lateStartDate:yield*super.calculateStartDatePure()}*calculateStartDateProposed(){switch(yield this.$.direction){case Vh.Backward:return!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)?yield*super.calculateStartDateProposed():yield*this.calculateStartDatePure();default:return yield*super.calculateStartDateProposed()}}*calculateEndDatePure(){return(yield this.$.direction)===Vh.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)?yield*super.calculateEndDatePure():yield this.$.lateEndDate:yield*super.calculateEndDatePure()}*calculateEndDateProposed(){switch(yield this.$.direction){case Vh.Backward:return!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)?yield*super.calculateEndDateProposed():yield*this.calculateEndDatePure();default:return yield*super.calculateEndDateProposed()}}}return Bf([hm()],t.prototype,"lateStartDateRaw",void 0),Bf([Im({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ",persist:!1},{converter:Pm,persistent:!1})],t.prototype,"lateStartDate",void 0),Bf([hm()],t.prototype,"lateEndDateRaw",void 0),Bf([Im({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ",persist:!1},{converter:Pm,persistent:!1})],t.prototype,"lateEndDate",void 0),Bf([hm()],t.prototype,"lateStartDateConstraintIntervals",void 0),Bf([hm()],t.prototype,"lateEndDateConstraintIntervals",void 0),Bf([Im({type:"number",persist:!1},{persistent:!1})],t.prototype,"totalSlack",void 0),Bf([Im({type:"string",defaultValue:$h.Day,persist:!1},{converter:je.normalizeUnit,persistent:!1})],t.prototype,"slackUnit",void 0),Bf([Im({type:"boolean",defaultValue:!1,persist:!1},{persistent:!1})],t.prototype,"critical",void 0),Bf([gm("lateStartDateConstraintIntervals")],t.prototype,"calculateLateStartDateConstraintIntervals",null),Bf([gm("lateEndDateConstraintIntervals")],t.prototype,"calculateLateEndDateConstraintIntervals",null),Bf([gm("lateStartDateRaw")],t.prototype,"calculateLateStartDateRaw",null),Bf([gm("lateStartDate")],t.prototype,"calculateLateStartDate",null),Bf([gm("lateEndDateRaw")],t.prototype,"calculateLateEndDateRaw",null),Bf([gm("lateEndDate")],t.prototype,"calculateLateEndDate",null),Bf([gm("totalSlack")],t.prototype,"calculateTotalSlack",null),Bf([gm("critical")],t.prototype,"calculateCritical",null),t};var Vf=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const Wf=e=>{class t extends e{putStartDate(e,t=!0){const r=void 0===this.$.startDate.getProposedOrPreviousValue(),n=this.getProject();if(!(r||n&&n.getStm().isRestoring)){const t=this.getStartDatePinConstraintType();t&&(this.constraintType=t,this.constraintDate=e)}return super.putStartDate(e,t)}putEndDate(e,t=!1){const r=void 0===this.$.endDate.getProposedOrPreviousValue(),n=this.getProject();if(!r&&t&&(!n||!n.getStm().isRestoring)){const t=this.getEndDatePinConstraintType();t&&(this.constraintType=t,this.constraintDate=e)}return super.putEndDate(e,t)}*calculateConstraintType(){let e=this.$.constraintType.getProposedOrPreviousValue();return(yield*this.isConstraintTypeApplicable(e))||(e=null),e}*calculateConstraintDate(e){let t=this.$.constraintDate.getProposedOrPreviousValue();const r=yield this.$.constraintType;return r?t||(t=this.getConstraintTypeDefaultDate(e,r)):t=null,t}getStartDatePinConstraintType(){const{direction:e}=this;if(!this.isTaskPinnableWithConstraint())return null;switch(e){case Vh.Forward:return jh.StartNoEarlierThan;case Vh.Backward:return jh.FinishNoLaterThan}}getEndDatePinConstraintType(){const{direction:e}=this;if(!this.isTaskPinnableWithConstraint())return null;switch(e){case Vh.Forward:return jh.FinishNoEarlierThan;case Vh.Backward:return jh.FinishNoLaterThan}}isTaskPinnableWithConstraint(){const{manuallyScheduled:e,constraintType:t}=this;let r=!1;if(!e)if(t)switch(t){case jh.StartNoEarlierThan:case jh.FinishNoEarlierThan:r=!0}else r=!0;return r}getConstraintTypeDefaultDate(e,t){switch(t){case jh.StartNoEarlierThan:case jh.StartNoLaterThan:case jh.MustStartOn:return this.$.startDate.getProposedOrPreviousValue();case jh.FinishNoEarlierThan:case jh.FinishNoLaterThan:case jh.MustFinishOn:return this.$.endDate.getProposedOrPreviousValue()}return null}*isConstraintTypeApplicable(e){const t=(yield this.$.childEvents).size>0;switch(e){case jh.FinishNoEarlierThan:case jh.StartNoLaterThan:case jh.MustFinishOn:case jh.MustStartOn:return!t}return!0}async setConstraint(e,t){return this.constraintType=e,void 0!==t&&(this.constraintDate=t),this.propagate()}*calculateEndDateConstraintIntervals(){const e=yield*super.calculateEndDateConstraintIntervals(),t=yield this.$.constraintType,r=yield this.$.constraintDate;if(t&&r)switch(t){case jh.MustFinishOn:e.unshift($p.new({startDate:r,endDate:r}));break;case jh.FinishNoEarlierThan:e.unshift($p.new({startDate:r}));break;case jh.FinishNoLaterThan:e.unshift($p.new({endDate:r}))}return e}*calculateStartDateConstraintIntervals(){const e=yield*super.calculateStartDateConstraintIntervals(),t=yield this.$.constraintType,r=yield this.$.constraintDate;if(t&&r)switch(t){case jh.MustStartOn:e.unshift($p.new({startDate:r,endDate:r}));break;case jh.StartNoEarlierThan:e.unshift($p.new({startDate:r}));break;case jh.StartNoLaterThan:e.unshift($p.new({endDate:r}))}return e}}return Vf([Im({type:"string"})],t.prototype,"constraintType",void 0),Vf([Im({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{converter:Pm})],t.prototype,"constraintDate",void 0),Vf([gm("constraintType")],t.prototype,"calculateConstraintType",null),Vf([gm("constraintDate")],t.prototype,"calculateConstraintDate",null),t};var Gf=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const Uf=e=>{class t extends e{setEffort(e,t){return this.putEffort(e,t),this.propagate()}getEffort(e){const t=this.effort;return void 0!==e?this.getProject().convertDuration(t,this.effortUnit,e):t}putEffort(e,t){e<0&&(e=0);const r=void 0===this.$.effort.getProposedOrPreviousValue();null==e&&r||(null!=t&&t!==this.effortUnit&&(this.effortUnit=t),this.$.effort.put(e))}setEffortUnit(e){throw new Error("Use `setEffort` instead")}*calculateTotalChildrenEffort(){const e=yield this.$.childEvents,t=this.getProject();let r=0;for(const n of e){const e=yield n.$.effortUnit;r+=(yield*t.$convertDuration(yield n.$.effort,e,$h.Millisecond))}return yield*t.$convertDuration(r,$h.Millisecond,yield this.$.effortUnit)}*calculateEffort(){if((yield this.$.childEvents).size>0)return yield*this.calculateTotalChildrenEffort();{const e=this.$.effort.getProposedOrPreviousValue();return void 0!==e?e:yield*this.calculateEffortPure()}}*calculateEffortPure(){return(yield this.$.childEvents).size>0?yield*this.calculateTotalChildrenEffort():yield*this.calculateProjectedEffort(yield this.$.startDate,yield this.$.endDate)}*calculateEffortProposed(){return this.$.effort.getProposedOrPreviousValue()}*calculateAssignmentUnits(e){return yield*this.calculateAssignmentUnitsProposed(e)}*calculateAssignmentUnitsPure(e){return yield*this.calculateUnitsByStartEndAndEffort(e)}*calculateAssignmentUnitsProposed(e){return e.$.units.getProposedOrPreviousValue()}*getBaseOptionsForEffortCalculations(){return{ignoreResourceCalendars:!1}}*calculateProjectedEffort(e,t){if(null==e||null==t||e>t)return null;const r=yield this.$.assignmentsByCalendar,n=new Map;for(const[e,t]of r){let r=0;for(const e of t)r+=(yield e.$.units);n.set(e,r)}let s=0;const i=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:e,endDate:t});return 0===n.size&&(n.set(yield this.$.calendar,100),i.ignoreResourceCalendars=!0),yield*this.forEachAvailabilityInterval(i,(e,t,r)=>{const i=r.getCalendarsWorking(),o=e.getTime(),a=t.getTime()-o;let l=0;for(const e of i)l+=n.get(e)||0;s+=l*a*.01}),yield*this.getProject().$convertDuration(s,$h.Millisecond,yield this.$.effortUnit)}*calculateUnitsByStartEndAndEffort(e){const t=yield this.$.effort,r=yield this.$.effortUnit,n=yield*this.getProject().$convertDuration(t,r,$h.Millisecond);let s=0;const i=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:yield this.$.startDate,endDate:yield this.$.endDate}),o=yield this.$.assignmentsByCalendar;return yield*this.forEachAvailabilityInterval(i,(e,t,r)=>{const n=r.getCalendarsWorking(),i=e.getTime(),a=t.getTime()-i;for(const e of n)s+=(o.has(e)?o.get(e).length:0)*a}),s?100*n/s:100}*calculateProjectedXDateByEffort(e,t=!0){const r=yield this.$.effort,n=yield this.$.effortUnit,s=yield*this.getProject().$convertDuration(r,n,$h.Millisecond);if(null==e||null==r)return null;let i=e.getTime(),o=s;const a=yield this.$.calendar,l=yield this.$.assignmentsByCalendar,c=new Map;for(const[e,t]of l){let r=0;for(const e of t)r+=(yield e.$.units);c.set(e,r)}if(l.size>0){const r=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),t?{startDate:e,isForward:t}:{endDate:e,isForward:t});return yield*this.forEachAvailabilityInterval(r,(e,r,n)=>{const s=n.getCalendarsWorking(),a=e.getTime(),l=r.getTime(),d=l-a;let u=0;for(const e of s)u+=c.get(e)||0;const h=u*d*.01;if(h>=o)return i=t?a+o/(.01*u):l-o/(.01*u),!1;o-=h}),new Date(i)}return a.accumulateWorkingTime(e,s,$h.Millisecond,t).finalDate}}return Gf([Im({type:"number"})],t.prototype,"effort",void 0),Gf([Im({type:"string",defaultValue:$h.Hour},{converter:je.normalizeUnit})],t.prototype,"effortUnit",void 0),Gf([gm("effort")],t.prototype,"calculateEffort",null),t};var Yf=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const qf=e=>{class t extends e{*calculatePercentDone(e){const t=yield this.$.childEvents,r=this.getProject(),n=yield r.$.autoCalculatePercentDoneForParentTasks;if(t.size&&n){const e=yield this.$.percentDoneSummaryData;return e.totalDuration>0?e.completedDuration/e.totalDuration:e.milestonesNum>0?e.milestonesTotalPercentDone/e.milestonesNum:null}return void 0!==e?e:this.$.percentDone.value}*calculatePercentDoneSummaryData(){const e=yield this.$.childEvents;if(e.size){let t={totalDuration:0,completedDuration:0,milestonesNum:0,milestonesTotalPercentDone:0};for(const r of e){const e=yield r.$.percentDoneSummaryData;e&&(t.totalDuration+=e.totalDuration,t.completedDuration+=e.completedDuration,t.milestonesNum+=e.milestonesNum,t.milestonesTotalPercentDone+=e.milestonesTotalPercentDone)}return t}{const e=yield this.$.duration;if("number"==typeof e){const t=yield*this.$convertDuration(e,yield this.$.durationUnit,$h.Millisecond),r=yield this.$.percentDone;return{totalDuration:t,completedDuration:t*r,milestonesNum:0===t?1:0,milestonesTotalPercentDone:0===t?r:0}}return null}}}return Yf([Im({type:"number",defaultValue:0})],t.prototype,"percentDone",void 0),Yf([hm()],t.prototype,"percentDoneSummaryData",void 0),Yf([gm("percentDone")],t.prototype,"calculatePercentDone",null),Yf([gm("percentDoneSummaryData")],t.prototype,"calculatePercentDoneSummaryData",null),t},Xf=Symbol("EffortVar"),Kf=Symbol("UnitsVar"),Zf=of.new({output:Xf,inputs:new Set([ff,vf,Kf])}),Jf=of.new({output:Kf,inputs:new Set([ff,vf,Xf])}),Qf=of.new({output:vf,inputs:new Set([ff,Xf,Kf])}),ev=of.new({output:ff,inputs:new Set([vf,Xf,Kf])});class tv extends Ef{}class rv extends xf{equality(e,t){const r=e.resolution,n=t.resolution;return r.get(Xf)===n.get(Xf)&&r.get(Kf)===n.get(Kf)&&super.equality(e,t)}}var nv=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const sv=e=>{class t extends e{*prepareDispatcher(){if((yield this.$.schedulingMode)!==Hh.Normal){const e=yield*super.prepareDispatcher();return e.collectInfo(this.$.effort,Xf),(yield*this.hasProposedValueForUnits())&&e.addProposedValueFlag(Kf),e.addPreviousValueFlag(Kf),e}return yield*super.prepareDispatcher()}*dispatcherClass(){return(yield this.$.schedulingMode)!==Hh.Normal?tv:yield*super.dispatcherClass()}buildProposedDispatcher(){const e=super.buildProposedDispatcher();return e.addPreviousValueFlag(Xf),e.addPreviousValueFlag(Kf),e}*calculateAssignmentUnits(e){if((yield this.$.schedulingMode)!==Hh.Normal){const t=(yield this.$.dispatcher).resolution.get(Kf);if(t===sf)return yield*this.calculateAssignmentUnitsProposed(e);if(t===Jf.formulaId)return yield*this.calculateAssignmentUnitsPure(e);throw new Error("Unknown formula for `units`")}return yield*super.calculateAssignmentUnits(e)}putEffort(e,t){const r=void 0===this.$.effort.getProposedOrPreviousValue();if(null==e&&r)return super.putEffort(e,t);this.getGraph()&&(this.markAsNeedRecalculation(this.$.dispatcher),this.markAsNeedRecalculation(this.$.startDate),this.markAsNeedRecalculation(this.$.endDate),this.markAsNeedRecalculation(this.$.duration),this.assigned.forEach(e=>e.markAsNeedRecalculation(e.$.units))),super.putEffort(e,t)}putStartDate(e,t=!0){!(void 0===this.$.startDate.getProposedOrPreviousValue())&&this.getGraph()&&(this.markAsNeedRecalculation(this.$.dispatcher),this.markAsNeedRecalculation(this.$.startDate),this.markAsNeedRecalculation(this.$.endDate),this.markAsNeedRecalculation(this.$.duration),this.markAsNeedRecalculation(this.$.effort),this.assigned.forEach(e=>e.markAsNeedRecalculation(e.$.units))),super.putStartDate(e,t)}putEndDate(e,t=!1){!(void 0===this.$.endDate.getProposedOrPreviousValue())&&this.getGraph()&&(this.markAsNeedRecalculation(this.$.dispatcher),this.markAsNeedRecalculation(this.$.startDate),this.markAsNeedRecalculation(this.$.endDate),this.markAsNeedRecalculation(this.$.duration),this.markAsNeedRecalculation(this.$.effort),this.assigned.forEach(e=>e.markAsNeedRecalculation(e.$.units))),super.putEndDate(e,t)}putDuration(e,t,r=!0){!(void 0===this.$.duration.getProposedOrPreviousValue())&&this.getGraph()&&(this.markAsNeedRecalculation(this.$.dispatcher),this.markAsNeedRecalculation(this.$.startDate),this.markAsNeedRecalculation(this.$.endDate),this.markAsNeedRecalculation(this.$.duration),this.markAsNeedRecalculation(this.$.effort),this.assigned.forEach(e=>e.markAsNeedRecalculation(e.$.units))),super.putDuration(e,t,r)}*calculateEffort(){if((yield this.$.schedulingMode)!==Hh.Normal){const e=(yield this.$.dispatcher).resolution.get(Xf);if(e===sf)return yield*this.calculateEffortProposed();if(e===Zf.formulaId)return yield*this.calculateEffortPure();throw new Error("Unknown formula for `effort`")}return yield*super.calculateEffort()}*calculateStartDate(){if((yield this.$.schedulingMode)!==Hh.Normal){return(yield this.$.dispatcher).resolution.get(ff)===ev.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.endDate,!1):yield*super.calculateStartDate()}return yield*super.calculateStartDate()}*calculateEndDate(){if((yield this.$.schedulingMode)!==Hh.Normal){return(yield this.$.dispatcher).resolution.get(vf)===Qf.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.startDate,!0):yield*super.calculateEndDate()}return yield*super.calculateEndDate()}*calculateEffectiveDuration(){const e=yield this.$.dispatcher,t=yield this.$.schedulingMode,r=e.resolution.get(yf);e.resolution.get(Xf);let n;if(r===wf.formulaId&&t!=Hh.Normal){const r=this.$.startDate.getProposedOrPreviousValue(),s=this.$.endDate.getProposedOrPreviousValue(),i=e.resolution.get(ff),o=e.resolution.get(vf);(yield this.$.effortDriven)||t===Hh.FixedEffort?s&&i===ev.formulaId?n=yield*this.calculateProjectedDuration(yield*this.calculateProjectedXDateByEffort(s,!1),s):r&&o===Qf.formulaId&&(n=yield*this.calculateProjectedDuration(r,yield*this.calculateProjectedXDateByEffort(r,!0))):(r&&s||!r&&!s)&&(n=yield*super.calculateEffectiveDuration())}else n=yield*super.calculateEffectiveDuration();return n}*calculateSchedulingMode(){return this.$.schedulingMode.getProposedOrPreviousValue()||Hh.Normal}}return nv([Im({type:"boolean",defaultValue:!1})],t.prototype,"effortDriven",void 0),nv([Im({type:"string",defaultValue:Hh.Normal})],t.prototype,"schedulingMode",void 0),nv([hm({atomCls:rv})],t.prototype,"dispatcher",void 0),nv([gm("effort")],t.prototype,"calculateEffort",null),nv([gm("startDate")],t.prototype,"calculateStartDate",null),nv([gm("endDate")],t.prototype,"calculateEndDate",null),nv([gm("schedulingMode")],t.prototype,"calculateSchedulingMode",null),t},iv=cf.new({variables:new Set([ff,vf,yf,Xf,Kf]),formulas:new Set([bf,Cf,wf,Jf,Zf])}),ov=df.new({description:iv,defaultResolutionFormulas:new Set([Cf,Zf])}),av=df.new({description:iv,defaultResolutionFormulas:new Set([Cf,Jf])}),lv=df.new({description:iv,defaultResolutionFormulas:new Set([bf,Zf])}),cv=df.new({description:iv,defaultResolutionFormulas:new Set([bf,Jf])}),dv=e=>class extends e{*prepareDispatcher(){if((yield this.$.schedulingMode)===Hh.FixedDuration){const e=yield*super.prepareDispatcher();if((yield this.$.effortDriven)&&e.addKeepIfPossibleFlag(Xf),this.hasAssignmentChanges()){(yield this.$.effortDriven)?e.addProposedValueFlag(Xf):e.addProposedValueFlag(Kf)}return e}return yield*super.prepareDispatcher()}*cycleResolutionContext(){if((yield this.$.schedulingMode)===Hh.FixedDuration){const e=yield this.$.direction,t=yield this.$.effortDriven;return e===Vh.Forward||e===Vh.None?t?av:ov:t?cv:lv}return yield*super.cycleResolutionContext()}*getBaseOptionsForDurationCalculations(){return(yield this.$.schedulingMode)===Hh.FixedDuration?{ignoreResourceCalendars:!0}:yield*super.getBaseOptionsForDurationCalculations()}},uv=cf.new({variables:new Set([ff,vf,yf,Xf,Kf]),formulas:new Set([Qf,wf,Jf,Zf,ev,bf,Cf])}),hv=df.new({description:uv,defaultResolutionFormulas:new Set([Qf,wf])}),gv=df.new({description:uv,defaultResolutionFormulas:new Set([ev,wf])}),mv=e=>class extends e{*prepareDispatcher(){if((yield this.$.schedulingMode)===Hh.FixedEffort){const e=yield*super.prepareDispatcher();return this.hasAssignmentChanges()&&e.addProposedValueFlag(Kf),e.addKeepIfPossibleFlag(Xf),e}return yield*super.prepareDispatcher()}*cycleResolutionContext(){if((yield this.$.schedulingMode)===Hh.FixedEffort){const e=yield this.$.direction;return e===Vh.Forward||e===Vh.None?hv:gv}return yield*super.cycleResolutionContext()}},pv=cf.new({variables:new Set([ff,vf,yf,Xf,Kf]),formulas:new Set([Qf,wf,Zf,Jf,ev,bf,Cf])}),fv=df.new({description:pv,defaultResolutionFormulas:new Set([Qf,Cf,Zf])}),vv=df.new({description:pv,defaultResolutionFormulas:new Set([Qf,Cf,wf])}),yv=df.new({description:pv,defaultResolutionFormulas:new Set([ev,bf,Zf])}),bv=df.new({description:pv,defaultResolutionFormulas:new Set([ev,bf,wf])}),Cv=e=>class extends e{*prepareDispatcher(){if((yield this.$.schedulingMode)===Hh.FixedUnits){const e=yield*super.prepareDispatcher();return this.hasAssignmentChanges()&&e.addProposedValueFlag(Kf),(yield this.$.effortDriven)&&e.addKeepIfPossibleFlag(Xf),e.addKeepIfPossibleFlag(Kf),e}return yield*super.prepareDispatcher()}*cycleResolutionContext(){if((yield this.$.schedulingMode)===Hh.FixedUnits){const e=yield this.$.direction,t=yield this.$.effortDriven;return e===Vh.Forward||e===Vh.None?t?vv:fv:t?bv:yv}return yield*super.cycleResolutionContext()}},wv=(e=Jn)=>Wf(Cv(mv(dv(sv(Uf(Lf(qf(jf(zf(_f(Wp(Mf(Op(jm(Hm(Lm(lm(e))))))))))))))))));class Sv extends(wv(Jn)){}const Dv=e=>class extends e{},Ev=e=>class extends e{static get defaultConfig(){return{tree:!0,modelClass:Sv}}buildRootNode(){return this.getProject()||{}}},xv=(e=Cs)=>Ev(_m(Hm(Dv(e))));class Tv extends(xv()){}class Rv extends(wg(xv(Tc(Ds)))){static get defaultConfig(){return{tree:!0,modelClass:Nf,loadPriority:200,syncPriority:300,storeId:"tasks"}}updateIdMap(){super.updateIdMap()}getEvents(e){const t=this.getById(e);return t&&[t]}getEventsForResource(e){const t=this.resourceStore.getById(e);return[...t&&t.assignments.filter(e=>e.isPartOfStore(this.assignmentStore))||[]].map(e=>e.event)}getResourcesForEvent(e){return e.assignments.map(e=>e.resource)}}Rv._$name="TaskStore";const Mv=Symbol("DependencyValidationMixin"),kv=e=>{return class extends e{[Mv](){}async isValidDependency(e,t,r){const n=this,s=n.getProject();console.assert(!Rp(e)||e.getProject()!=s,"Can't validate dependency, the dependency given is already a part of this project, validation can be done only on depepdencies which are not joined yet!"),await s.waitForPropagateCompleted();if(!Rp(e)){const s=n.getEventStore(),i=n.getDependencyStore().modelClass;e=new i("object"==typeof e?e:{fromEvent:s.getById(e),toEvent:s.getById(t),type:r})}const i=e.getProject();e.setProject(s);let o=await s.tryPropagateWithEntities(async e=>{let t;return t=e instanceof Rg?bg.Cancel:bg.Resume,t},[e]);return e.setProject(i),o==Vg.Passed}}},Iv=(e=Cs)=>(e=>class extends e{})(kv((e=>class extends e{static get defaultConfig(){return{modelClass:Tp}}})(_m(Hm(Dv(e))))));class Fv extends(Iv()){}class Av extends(wg(Iv(ld))){static get defaultConfig(){return{modelClass:kp,loadPriority:300,syncPriority:500}}reduceTaskDependencies(e,t,r,n,s){return this.reduceEventDependencies(e,t,r,n,s)}reduceTaskPredecessors(e,t,r,n){return this.reduceEventPredecessors(e,t,r,n)}reduceTaskSuccessors(e,t,r,n){return this.reduceEventSuccessors(e,t,r,n)}mapTaskDependencies(e,t,r,n,s){return this.mapEventDependencies(e,t,r,n,s)}mapTaskPredecessors(e,t,r,n){return this.mapEventPredecessors(e,t,r,n)}mapTaskSuccessors(e,t,r,n){return this.mapEventSuccessors(e,t,r,n)}getTaskDependencies(e,t){return this.getEventDependencies(e,t)}getTaskPredecessors(e,t){return this.getEventPredecessors(e,t)}getTaskSuccessors(e,t){return this.getEventSuccessors(e,t)}removeTaskDependencies(e,t){this.removeEventDependencies(e,t)}removeTaskPredecessors(e,t){this.removeEventPredecessors(e,t)}removeTaskSuccessors(e,t){this.removeEventSuccessors(e,t)}getDependencyForSourceAndTargetTasks(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)}getTasksLinkingDependency(e,t){return this.getEventsLinkingDependency(e,t)}async isValidDependencyToCreate(e,t,r){const n=await this.isValidDependency(e,t,r),s=Boolean(this.getDependencyForSourceAndTargetEvents(e,t));return n&&!s}getTaskById(e){const t=this.taskStore;return t&&t.getById(e)||null}getSourceTask(e){const t=e instanceof kp?e.sourceId:e;return this.getTaskById(t)}getTargetTask(e){const t=e instanceof kp?e.targetId:e;return this.getTaskById(t)}}Av._$name="DependencyStore";var Pv=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const Lv=Symbol("ResourceMixin"),Ov=e=>{class t extends e{[Lv](){}get assignments(){return[...this.assigned]}leaveProject(){const e=this.getAssignmentStore();this.assigned.forEach(t=>e.remove(t)),super.leaveProject()}}return Pv([Im({type:"string"})],t.prototype,"name",void 0),Pv([um({},Tm)],t.prototype,"assigned",void 0),t},_v=(e=Jn)=>Ov(Op(jm(Hm(Lm(lm(e))))));class $v extends(_v()){}class jv extends(wg(_v(nd))){static get fields(){return[]}get tasks(){return this.events}}jv._$name="ResourceModel";const Hv=(e=Cs)=>(e=>class extends e{static get defaultConfig(){return{modelClass:$v}}})(_m(Hm(Dv(e))));class Nv extends(Hv()){}class Bv extends(wg(Hv(sd))){static get defaultConfig(){return{modelClass:jv,loadPriority:400,syncPriority:200,storeId:"resources"}}}Bv._$name="ResourceStore";var zv=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const Vv=Symbol("AssignmentMixin"),Wv=e=>{class t extends e{[Vv](){}getUnits(){return this.units}setUnits(e){return this.putUnits(e),this.propagate()}putUnits(e){this.$.units.put(e);const t=this.event;t&&this.getGraph()&&(t.markAsNeedRecalculation(t.$.dispatcher),t.markAsNeedRecalculation(t.$.startDate),t.markAsNeedRecalculation(t.$.endDate),t.markAsNeedRecalculation(t.$.duration),t.markAsNeedRecalculation(t.$.effort),t.assigned.forEach(e=>e.markAsNeedRecalculation(e.$.units)))}*calculateUnits(e){const t=yield this.$.event;return t&&t.calculateAssignmentUnits?yield*t.calculateAssignmentUnits(this,e):void 0!==e?e:this.$.units.getConsistentValue()}}return zv([Im({type:"number",defaultValue:100})],t.prototype,"units",void 0),zv([um({bucket:"assigned",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{serialize:e=>e.id}},xm)],t.prototype,"event",void 0),zv([um({bucket:"assigned",resolver:function(e){return this.getResourceById(e)},modelFieldConfig:{serialize:e=>e.id}},xm)],t.prototype,"resource",void 0),zv([gm("units")],t.prototype,"calculateUnits",null),t},Gv=(e=Jn)=>Wv(jm(Hm(Lm(lm(e)))));class Uv extends(Gv()){}class Yv extends(wg(Gv(xc))){static get fields(){return[{name:"eventId",persist:!1},{name:"resourceId",persist:!1}]}get units(){return Math.max(0,this.get("units"))}set units(e){if(e<0)throw new Error("`Units` value for an assignment can't be less than 0");this.set("units",e)}get task(){return this.event}set task(e){this.event=e}get taskName(){return this.task&&this.task.name||""}get eventId(){return this.event.id}get resourceId(){return this.resource.id}toString(){return this.resource.name+" "+this.units+"%"}}Yv._$name="AssignmentModel";const qv=(e=Cs)=>(e=>class extends e{static get defaultConfig(){return{modelClass:Uv}}})(_m(Hm(Dv(e))));class Xv extends(qv()){}class Kv extends(wg(qv(Jc))){static get defaultConfig(){return{modelClass:Yv,loadPriority:500,syncPriority:400,storeId:"assignments"}}mapAssignmentsForTask(e,t,r){return this.mapAssignmentsForEvent(e,t,r)}getAssignmentsForTask(e){return this.getAssignmentsForEvent(e)}removeAssignmentsForTask(e){return this.removeAssignmentsForEvent(e)}getResourcesForTask(e){return this.getResourcesForEvent(e)}getTasksForResource(e){return this.getEventsForResource(e)}assignTaskToResource(e,t,r){return this.assignEventToResource(e,t,e=>(e.units=r,e))}unassignTaskFromResource(e,t){return this.unassignEventFromResource(e,t)}isTaskAssignedToResource(e,t,r){return this.isEventAssignedToResource(e,t,r)}getAssignmentForTaskAndResource(e,t){return this.getAssignmentForEventAndResource(e,t)}}Kv._$name="AssignmentStore";const Zv=(e=Cs)=>(e=>class extends e{static get defaultConfig(){return{tree:!0,modelClass:gp}}})(_m(Hm(Dv(e))));class Jv extends(Zv()){}class Qv extends(wg(Zv(Ds))){static get defaultConfig(){return{tree:!0,modelClass:mp,loadPriority:100,syncPriority:100,storeId:"calendars"}}}Qv._$name="CalendarManagerStore";class ey extends Sg{constructor(){super(...arguments),this.entities=new Map}hasEntity(e){return this.entities.has(e)}getEntity(e){return this.entities.get(e)}addEntity(e){const t=e.name;if(!t)throw new Error("Entity must have a name");if(this.hasEntity(t))throw new Error(`Entity with name [${String(t)}] already exists`);return e.schema=this,this.entities.set(t,e),e}getEntityDecorator(){return e=>{const t=e.name;if(!t)throw new Error("Can't add entity - the target class has no name");let r=dm(e.prototype);if(r.name&&r.name!=t)throw new Error("Invalid state");return r.name=t,this.addEntity(r),e}}}const ty=e=>class extends e{constructor(){super(...arguments),this.projectRefreshThreshold=500}async propagate(e,t=!1){const r=this.project;let n;return this.isPropagating?n=await super.propagate(e,t):(r.trigger("propagationStart",{dryRun:!!t}),n=await super.propagate(e,t),r.trigger("propagationComplete",{dryRun:!!t,result:n})),n}commit(){const e=this.project,t=this.changedAtoms,r=new Set(t.map(e=>e.self));r.forEach(e=>e.beginBatch()),e.trigger("beforeCommit",{records:r,changedAtoms:t}),super.commit(),e.trigger("commit",{records:r,changedAtoms:t});const n=r.size>this.projectRefreshThreshold;r.forEach(e=>e.endBatch(n)),n&&e.trigger("refresh",{records:r})}async onEffect(e){const t=this.project;return e instanceof _p?t.hasListener("schedulingconflict")?new Promise((r,n)=>{t.trigger("schedulingconflict",{conflict:e,continueWithResolutionResult:r})}):Promise.resolve(bg.Cancel):super.onEffect(e)}};var ry=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const ny=e=>{class t extends e{construct(e={}){this.replica=ty(om).new({project:this,schema:ey.new()}),e.hasOwnProperty("expanded")||(e.expanded=!0);const t=Boolean(e.calendarManagerStore||e.eventStore||e.dependencyStore||e.resourceStore||e.assignmentStore);super.construct(e),this.eventModelClass||(this.eventModelClass=this.getDefaultEventModelClass()),this.eventStoreClass||(this.eventStoreClass=this.getDefaultEventStoreClass()),this.dependencyModelClass||(this.dependencyModelClass=this.getDefaultDependencyModelClass()),this.dependencyStoreClass||(this.dependencyStoreClass=this.getDefaultDependencyStoreClass()),this.resourceModelClass||(this.resourceModelClass=this.getDefaultResourceModelClass()),this.resourceStoreClass||(this.resourceStoreClass=this.getDefaultResourceStoreClass()),this.assignmentModelClass||(this.assignmentModelClass=this.getDefaultAssignmentModelClass()),this.assignmentStoreClass||(this.assignmentStoreClass=this.getDefaultAssignmentStoreClass()),this.calendarModelClass||(this.calendarModelClass=this.getDefaultCalendarModelClass()),this.calendarManagerStoreClass||(this.calendarManagerStoreClass=this.getDefaultCalendarManagerStoreClass()),this.replica.addEntity(this),this.stm=new ho({disabled:!0}),this.stm.on({restoringStop:async()=>{this.stm.disable(),await this.propagate(),this.stm.enable(),this.trigger("stateRestoringDone")}}),this.calendarManagerStore?this.setCalendarManagerStore(this.calendarManagerStore):this.calendarManagerStore=new this.calendarManagerStoreClass({modelClass:this.calendarModelClass,project:this,stm:this.stm}),this.defaultCalendar=new this.calendarManagerStore.modelClass({hoursPerDay:24,daysPerWeek:7,daysPerMonth:30,unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this,this.eventStore?this.setEventStore(this.eventStore):this.eventStore=new this.eventStoreClass({modelClass:this.eventModelClass,tree:!0,project:this,stm:this.stm}),this.dependencyStore?this.setDependencyStore(this.dependencyStore):this.dependencyStore=new this.dependencyStoreClass({modelClass:this.dependencyModelClass,project:this,stm:this.stm}),this.resourceStore?this.setResourceStore(this.resourceStore):this.resourceStore=new this.resourceStoreClass({modelClass:this.resourceModelClass,project:this,stm:this.stm}),this.assignmentStore?this.setAssignmentStore(this.assignmentStore):this.assignmentStore=new this.assignmentStoreClass({modelClass:this.assignmentModelClass,project:this,stm:this.stm});const r=Boolean(this.calendarsData||this.eventsData||this.dependenciesData||this.resourcesData||this.assignmentsData);r&&(this.loadInlineData({calendarsData:this.calendarsData,eventsData:this.eventsData,dependenciesData:this.dependenciesData,resourcesData:this.resourcesData,assignmentsData:this.assignmentsData}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData),t&&!r&&this.propagate()}getType(){return zh.Unknown}getDefaultEventModelClass(){return Sv}getDefaultEventStoreClass(){return Tv}getDefaultDependencyModelClass(){return Tp}getDefaultDependencyStoreClass(){return Fv}getDefaultResourceModelClass(){return $v}getDefaultResourceStoreClass(){return Nv}getDefaultAssignmentModelClass(){return Uv}getDefaultAssignmentStoreClass(){return Xv}getDefaultCalendarModelClass(){return gp}getDefaultCalendarManagerStoreClass(){return Jv}loadInlineData(e){return e.calendarsData&&(this.calendarManagerStore.data=e.calendarsData),e.eventsData&&(this.eventStore.data=e.eventsData),e.dependenciesData&&(this.dependencyStore.data=e.dependenciesData),e.resourcesData&&(this.resourceStore.data=e.resourcesData),e.assignmentsData&&(this.assignmentStore.data=e.assignmentsData),this.propagate()}getGraph(){return this.replica}getStm(){return this.stm}calculateProject(){return this}*calculateCalendar(e){let t=yield*super.calculateCalendar(e);return t||(t=this.defaultCalendar,yield t.$$),t}joinStoreRecords(e){const t=e=>{e.setProject(this),e.joinProject()};e.rootNode?e.rootNode.traverse(t):e.forEach(t)}setEventStore(e){this.eventStore&&this.stm.hasStore(this.eventStore)&&this.stm.removeStore(this.eventStore),this.eventStore=e,e&&(e.setProject(this),this.stm.addStore(e),e.rootNode!==this&&(this.appendChild(e.rootNode.children||[]),e.rootNode=this),this.joinStoreRecords(e))}setDependencyStore(e){this.dependencyStore&&this.stm.hasStore(this.dependencyStore)&&this.stm.removeStore(this.dependencyStore),this.dependencyStore=e,e&&(e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e))}setResourceStore(e){this.resourceStore&&this.stm.hasStore(this.resourceStore)&&this.stm.removeStore(this.resourceStore),this.resourceStore=e,e&&(e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e))}setAssignmentStore(e){this.assignmentStore&&this.stm.hasStore(this.assignmentStore)&&this.stm.removeStore(this.assignmentStore),this.assignmentStore=e,e&&(e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e))}setCalendarManagerStore(e){this.calendarManagerStore&&this.stm.hasStore(this.calendarManagerStore)&&this.stm.removeStore(this.calendarManagerStore),this.calendarManagerStore=e,e&&(e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e))}async tryPropagateWithChanges(e,t){const r=this.stm;let n,s;n=r.disabled,s=r.autoRecord,n?r.enable():(s&&(r.autoRecord=!1),r.isRecording&&r.stopTransaction()),r.startTransaction(),this.suspendPropagate(),e(),this.resumePropagate(!1);const i=await this.propagate(t||(e=>{let t;return e instanceof Rg&&(t=bg.Cancel),t}));return i===Vg.Canceled?r.transaction.length?(r.forEachStore(e=>e.beginBatch()),r.rejectTransaction(),r.forEachStore(e=>e.endBatch())):r.stopTransaction():(r.stopTransaction(),n&&r.resetQueue()),r.disabled=n,r.autoRecord=s,i}}return ry([Im({type:"boolean",defaultValue:!0})],t.prototype,"unspecifiedTimeIsWorking",void 0),ry([Im({type:"string",defaultValue:Bh.ToEvent})],t.prototype,"dependenciesCalendar",void 0),ry([Im({type:"boolean",defaultValue:!0})],t.prototype,"autoCalculatePercentDoneForParentTasks",void 0),t},sy=(e=Jn)=>ny(Uf(Lf(_f(Wp(Mf(Op(jm(Hm(Lm(lm(G(e)))))))))))),iy=(e=Jn)=>(e=>class extends e{})(sy(e));iy();class oy extends(pp(iy(Jn))){static get defaults(){return{expanded:!0}}static get defaultConfig(){return{eventModelClass:null,taskModelClass:Nf,dependencyModelClass:kp,resourceModelClass:jv,assignmentModelClass:Yv,calendarModelClass:mp,eventStoreClass:null,taskStoreClass:Rv,dependencyStoreClass:Av,resourceStoreClass:Bv,assignmentStoreClass:Kv,calendarManagerStoreClass:Qv,eventsData:null,tasksData:null,dependenciesData:null,resourcesData:null,assignmentsData:null,calendarsData:null,timeRangeStore:null,convertEmptyParentToLeaf:!1}}construct(...e){const t=e[0]||{};e[0]=t,"tasksData"in t&&(t.eventsData=t.tasksData,delete t.tasksData),"taskStore"in t&&(t.eventStore=t.taskStore,delete t.taskStore),t.eventModelClass=t.taskModelClass||t.eventModelClass||this.defaultEventModelClass,t.eventStoreClass=t.taskStoreClass||t.eventStoreClass||this.defaultEventStoreClass,t.timeRangeStore||(t.timeRangeStore={modelClass:jc,storeId:"timeRanges"}),super.construct(...e)}get defaultEventModelClass(){return Nf}get defaultEventStoreClass(){return Rv}get taskStore(){return this.getEventStore()}get timeRangeStore(){return this._timeRangeStore}set timeRangeStore(e){const t=this;t._timeRangeStore=e&&Cs.getStore(e,Cs),e&&!t._timeRangeStore.storeId&&(t._timeRangeStore.storeId="timeRanges")}}oy.applyConfigs=!0,oy._$name="ProProjectModel";var ay=e=>class extends(e||B){get project(){return this._project}set project(e){Object.assign(this,{_project:e,store:this.resourcesStore,resourceStore:e.getResourceStore(),eventStore:e.getEventStore(),assignmentStore:e.getAssignmentStore(),dependencyStore:e.getDependencyStore(),taskStore:e.getEventStore()})}onBeforeAssignmentRemove(e){e.doRemoveLastEvent=!1,super.onBeforeAssignmentRemove(e)}get widgetClass(){}},ly=e=>class extends(e||B){getProject(){let e;if(!super.getProject)throw new Error("Abstract method call!");return e=super.getProject(),e}captureStm(){const e=this,t=e.getProject().getStm();e.stmInitiallyDisabled=t.disabled,e.stmInitiallyAutoRecord=t.autoRecord,e.stmInitiallyDisabled?(t.enable(),t.autoRecord=!1):(e.stmInitiallyAutoRecord&&(t.autoRecord=!1),t.isRecording&&t.stopTransaction())}startStmTransaction(){this.getProject().getStm().startTransaction()}commitStmTransaction(){const e=this.getProject().getStm();e.stopTransaction(),this.stmInitiallyDisabled&&e.resetQueue()}rejectStmTransaction(){const e=this.getProject().getStm(),{client:t}=this;e.transaction.length?(t.suspendRefresh(),e.forEachStore(e=>e.beginBatch()),e.rejectTransaction(),e.forEachStore(e=>e.endBatch()),t.resumeRefresh(!0)):e.stopTransaction()}enableStm(){this.getProject().getStm().enable()}disableStm(){this.getProject().getStm().disable()}freeStm(){const e=this.getProject().getStm();e.disabled=this.stmInitiallyDisabled,e.autoRecord=this.stmInitiallyAutoRecord}};class cy extends pg{static get $name(){return"SchedulerTaskEditor"}static get defaultConfig(){return{items:[{type:"tabpanel",ref:"tabs",flex:"1 0 100%",layoutConfig:{alignItems:"stretch",alignContent:"stretch"}}],defaultTabs:[{type:"schedulergeneraltab"},{type:"successorstab"},{type:"predecessorstab"},{type:"resourcestab"},{type:"notestab"}]}}}cy._$name="SchedulerTaskEditor";class dy extends(Qn(Nn).mixes(br,ly)){static get pluginConfig(){return{chain:["getEventMenuItems","onEnterKey"],assign:["editEvent"]}}static get defaultConfig(){return{triggerEvent:"eventdblclick",editorClassMap:{[zh.Unknown]:cy,[zh.Gantt]:fg,[zh.Scheduler]:cy},editorClass:null,editorConfig:null,showDeleteButton:!0,saveAndCloseOnEnter:!0,tabsConfig:null,weekStartDay:null}}construct(e,t){const r=this;e.taskEdit=r,super.construct(e,ze.assign({weekStartDay:e.weekStartDay},t)),r._clientListenersDetacher=e.on({[r.triggerEvent]:r.onActivateEditor,thisObj:r})}get scheduler(){return this.client}getProject(){return this.scheduler.project}doDestroy(){this._clientListenersDetacher(),this.detachFromProject(),this.editor&&this.editor.destroy(),super.doDestroy()}get isEditing(){return!!this._editing}onActivateEditor({eventRecord:e,resourceRecord:t}){this.editEvent(e,t)}getElementFromTaskRecord(e,t){return this.client.getElementFromEventRecord(e,t)}async editEvent(e,t=null,r=null){const n=this,s=n.scheduler;if(!s.readOnly&&!n.disabled){const i=n.client.partner;if(i&&(i.editEvent||i.editTask))(i.editEvent||i.editTask)(e,t,r);else{const i=!r;n._editing=!0,n.captureStm(),n.startStmTransaction(),n.schedulerAutoCommit=s.taskStore.autoCommit,s.taskStore.autoCommit=!1,n.schedulerAutoSync=s.project.autoSync,s.project.autoSync=!1,"function"==typeof e&&(e=e()),i&&s.taskStore.includes(e)&&await n.scrollEventIntoView(e,t);const o=r||Et.down(n.getElementFromTaskRecord(e,t),s.eventInnerSelector),a=n.getEditor(e);!1!==s.trigger("beforeTaskEdit",{taskEdit:n,taskRecord:e,taskElement:o})?(s.element.classList.add("b-taskeditor-editing"),s.trigger("beforeTaskEditShow",{taskEdit:n,taskRecord:e,taskElement:o,editor:a}),n.load(e),n.attachToProject(),o?await a.showBy({target:o,anchor:!0,offset:-5}):await a.showBy({target:s.element,anchor:!1,align:"c-c"})):(n.rejectStmTransaction(),n.disableStm(),n.freeStm(),n._editing=!1)}}}getEditor(e=this.record){const t=this,r=(e&&e.getProject()||this.getProject()).getType(),n=t.editorClass||t.editorClassMap[r]||t.editorClassMap[zh.Unknown]||cy;return t.editor&&t.editor.constructor===n||(t.editor&&t.editor.destroy(),t.editor=new n(ze.merge({eventEditFeature:t,weekStartDay:t.weekStartDay,saveAndCloseOnEnter:t.saveAndCloseOnEnter,showDeleteButton:t.showDeleteButton,project:t.getProject(),durationDisplayPrecision:t.client.durationDisplayPrecision,tabsConfig:t.tabsConfig,listeners:{cancel:t.onCancel,delete:t.onDelete,save:t.onSave,requestPropagation:t.onRequestPropagation,thisObj:t}},t.editorConfig))),t.editor}load(e){const t=this.getEditor(e);this._loading=!0,this.record=e,t.loadEvent(e),this._loading=!1}async save(){const e=this,{scheduler:t}=e;if(e._editing){const r=e.getEditor();if(!e.isValid||!1===t.trigger("beforeTaskSave",{taskRecord:e.record,editor:r}))return;e.detachFromProject();const n=e.getProject();n.isPropagating()&&await n.waitForPropagateCompleted(),r.beforeSave(),e.commitStmTransaction(),e.freeStm(),r.hide().then(()=>r.afterSave()),e.resumeAutoSync(!0),t.element.classList.remove("b-taskeditor-editing"),e._editing=!1}}async cancel(){const e=this,{scheduler:t}=e;if(e._editing){e._canceling=!0,e.detachFromProject();const r=e.record,n=e.getProject();n.isPropagating()&&await n.waitForPropagateCompleted();const s=e.getEditor();s.beforeCancel(),await s.hide(),e.rejectStmTransaction(),e.disableStm(),await n.propagate(),e.freeStm(),s.afterCancel(),e.resumeAutoSync(!1),e.scheduler.element.classList.remove("b-taskeditor-editing"),e._canceling=!1,e._editing=!1,t.trigger("taskEditCanceled",{taskRecord:r,editor:s})}}async delete(){const e=this,t=e.getEditor();if(!1===e.scheduler.trigger("beforeTaskDelete",{taskRecord:e.record,editor:t}))return;const r=e.getProject();r.isPropagating()&&await r.waitForPropagateCompleted(),e.detachFromProject(),t.beforeDelete(),e.record.remove(),e.freeStm(),await r.propagate(),e.resumeAutoSync(!0),t.hide(),t.afterDelete(),e.scheduler.element.classList.remove("b-taskeditor-editing"),e._editing=!1}resumeAutoSync(e){const{scheduler:t}=this;t.taskStore.autoCommit=this.schedulerAutoCommit,t.taskStore.autoCommit&&e&&t.taskStore.doAutoCommit(),t.project.autoSync=this.schedulerAutoSync,t.project.autoSync&&e&&t.project.sync()}onSave(){this.requestAnimationFrame(()=>this.save())}onCancel(){this.requestAnimationFrame(()=>this.cancel())}onDelete(){this.requestAnimationFrame(()=>this.delete())}onRequestPropagation(){const e=this.getProject();this.requestAnimationFrame(()=>{e.isPropagating()||e.propagate()})}attachToProject(){const e=this,t=e.getProject();e.detachFromProject(),e._projectEventDetacher=t.on({loadstart:()=>e.save(),propagationStart:e.onPropagationStart,propagationComplete:e.onPropagationComplete,thisObj:e,detachable:!0})}detachFromProject(){this._projectEventDetacher&&(this._projectEventDetacher(),this._projectEventDetacher=null)}onPropagationStart(){this.getEditor().mask("Calculatingâ€¦")}onPropagationComplete({dryRun:e}){const t=this;t.getEditor().unmask(),t.isEditing&&!t.getProject().taskStore.includes(t.record)?t.save():e||t._canceling||t.load(t.record)}getEventMenuItems({eventRecord:e,resourceRecord:t,items:r}){this.scheduler.readOnly||(r.editEvent={text:this.L("L{Edit event}"),icon:"b-icon b-icon-edit",weight:-200,disabled:this.disabled,onItem:()=>this.editEvent(e,t)})}onEnterKey({assignmentRecord:e,eventRecord:t}){e?this.editEvent(t,e.resource):t&&this.editEvent(t,t.resource)}scrollEventIntoView(e,t){this.client.scrollResourceEventIntoView(t,e)}get isValid(){return this.editor.eachWidget(e=>!!(!0===e.isValid||e.hidden||e.disabled||e instanceof jn&&!e.name)||!1!==e.isValid,!0)}}dy._$name="ProTaskEdit",Va.registerFeature(dy,!0,"ProScheduler","EventEdit");const uy=te.mergeLocales(Ru,{SchedulerProCommon:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",dependencyTypesLong:["Start-to-Start","Start-to-End","End-to-Start","End-to-End"]},ConstraintTypePicker:{none:"None",muststarton:"Must start on",mustfinishon:"Must finish on",startnoearlierthan:"Start no earlier than",startnolaterthan:"Start no later than",finishnoearlierthan:"Finish no earlier than",finishnolaterthan:"Finish no later than"},CalendarField:{"Default calendar":"Default calendar"},ProTaskEdit:{"Edit event":"Edit event"},TaskEditorBase:{editorWidth:"45em",Information:"Information",Save:"Save",Cancel:"Cancel",Delete:"Delete",saveError:"Can't save, please correct errors first"},SchedulerGeneralTab:{labelWidth:"11.5em",General:"General",Name:"Name","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Dates:"Dates","Manually scheduled":"Manually scheduled",Calendar:"Calendar"},GeneralTab:{labelWidth:"6.5em",General:"General",Name:"Name","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Dates:"Dates"},AdvancedTab:{labelWidth:"11.5em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Constraint:"Constraint",Rollup:"Rollup"},DependencyTab:{Predecessors:"Predecessors",Successors:"Successors",ID:"ID",Name:"Name",Type:"Type",Lag:"Lag","Cyclic dependency has been detected":"Cyclic dependency has been detected","Invalid dependency":"Invalid dependency"},ResourcesTab:{unitsTpl:({value:e})=>e+"%",Resources:"Resources",Resource:"Resource",Units:"Units"},NotesTab:{Notes:"Notes"},SchedulingModePicker:{Normal:"Normal","Fixed Duration":"Fixed Duration","Fixed Units":"Fixed Units","Fixed Effort":"Fixed Effort"},DurationColumn:{Duration:"Duration"}});ne.registerLocale("En",{desc:"English",locale:uy});class hy extends(Cp(ay(Dc(Ch)))){static get $name(){return"ProScheduler"}static get type(){return"schedulerpro"}static get defaultConfig(){return{project:null,durationDisplayPrecision:1,calendars:null,resources:null,tasks:null,dependencies:null,assignments:null,features:{dependencies:!0,eventEdit:!0}}}construct(e){const t=Boolean(e.calendars||e.taskStore||e.dependencyStore||e.resourceStore||e.assignmentStore),r=Boolean(e.calendars||e.tasks||e.dependencies||e.resources||e.assignments);let n=e.project;if(n&&(t||r))throw new Error("Providing both project and inline data is not supported");n||(n=e.project=new oy({calendarsData:e.calendars,eventsData:e.tasks,dependenciesData:e.dependencies,resourcesData:e.resources,assignmentsData:e.assignments,resourceStore:e.resourceStore,eventStore:e.taskStore,assignmentStore:e.assignmentStore,dependencyStore:e.dependencyStore,timeRangeStore:e.timeRangeStore}),delete e.resourceStore,delete e.taskStore,delete e.assignmentStore,delete e.dependencyStore,delete e.timeRangeStore,delete e.calendars,delete e.resources,delete e.tasks,delete e.assignments,delete e.dependencies),e.crudManager=n,n.on({refresh:this.onProjectRefresh,load:this.onProjectLoad,thisObj:this}),super.construct(e)}onProjectRefresh(){this.refreshRows();const e=this.features.dependencies;e&&this.dependencies.forEach(t=>e.addToGridCache(t))}onProjectLoad(){const e=this;!("startDate"in e.initialConfig)&&e.project.startDate&&(e.startDate=e.project.startDate)}getProjectForDataAPI(){return this.project}async removeRecords(e){const t=this;if(!t.readOnly&&e.length)if(e[0]instanceof Nf)await t.dataApi.removeEvents(e);else{const r=e.map(e=>e.resource);await t.dataApi.removeAssignments(e,t.removeUnassignedEvent),r.forEach(e=>t.repaintEventsForResource(e))}}toggleEmptyText(){this.bodyContainer&&Et.toggleClasses(this.bodyContainer,"b-grid-empty",!(this.rowManager.rowCount||this.project.isCrudManagerLoading))}}hy._$name="ProScheduler",U.register(hy.type,hy),A.setVersion(hy.type,A.getVersion("scheduler"));class gy extends Nf{static get defaultConfig(){return{recognizedSchedulingModes:["Normal"],convertEmptyParentToLeaf:!1}}static get fields(){return[{name:"description",dataSource:"note",type:"string"},{name:"allowDependencies",type:"boolean",defaultValue:!1,persist:!1}]}get isSubProject(){return!0}isEditable(e){switch(e){case"name":case"startDate":case"readOnly":case"duration":case"durationUnit":case"description":case"allowDependencies":return super.isEditable(e);case"endDate":return this.isManuallyScheduled&&super.isEditable(e);default:return!1}}indent(){}outdent(){}}gy._$name="ProSubProjectModel";class my extends Nf{}my._$name="ProTaskSegmentModel";class py extends Da{static get type(){return"addnew"}static get defaults(){return{text:"L{New Column}",cls:"b-new-column-column",draggable:!1,sortable:!1,exportable:!1,field:null,editor:null}}get columnCombo(){const e=this,t=e.grid.columns;return e._columnCombo||(e._columnCombo=new As({owner:e.grid,cls:"b-new-column-combo",placeholder:e.L("L{New Column}"),triggers:!1,autoExpand:!0,store:e.ganttColumnStore,displayField:"text",monitorResize:!1,picker:{align:"t0-b0",minWidth:200,onItem({record:r}){const n=new r.value({region:e.region},t);t.insert(t.indexOf(e),n),n.element.focus()}},syncInputFieldValue(){this.input.value=""},listeners:{keydown({event:e}){e.stopImmediatePropagation()}}}))}get ganttColumnStore(){return new Cs({data:Object.values(Ea.columnTypes).reduce((e,t)=>(t.propertiesExposedForData||t.exposeProperties({}),t.isGanttColumn&&t.text&&e.push({id:t.type,text:t.L(t.text),value:t}),e),[]),filters:[e=>!this.grid.columns.some(t=>t.constructor===e.value)],sorters:[{field:"text"}]})}headerRenderer({column:e,headerElement:t,isExport:r}){if(!r){const{columnCombo:r}=e;r.render(t),r.picker.forElement=t}}onKeyDown(e){"Enter"===e.key&&this.columnCombo.focus()}updateLocalization(){this._columnCombo&&(this._columnCombo.destroy(),this._columnCombo=null),super.updateLocalization()}}Ea.registerColumnType(py),py._$name="AddNewColumn";class fy extends As{static get $name(){return"CalendarPicker"}static get type(){return"calendarpicker"}refreshCalendars(e){this.store.data=e.map(e=>({id:e.id,text:e.name}))}get store(){return this._store||(this.store=new Cs),this._store}set store(e){super.store=e}get value(){return super.value}set value(e){e&&(e.isDefault&&e.isDefault()?e=null:e.id&&(e=e.id)),super.value=e}}fy._$name="CalendarPicker",U.register(fy.type,fy);class vy extends Da{static get type(){return"calendar"}static get isGanttColumn(){return!0}static get defaults(){return{field:"calendar",text:"L{Calendar}",editor:{type:fy.type,clearable:!0,allowInvalid:!1}}}afterConstruct(){const e=this;super.afterConstruct();const t=e.grid.project;e.defaultCalendar=t.defaultCalendar,e.refreshCalendars(),t.calendarManagerStore.on({change:e.refreshCalendars,refresh:e.refreshCalendars,thisObj:e})}refreshCalendars(){const e=this.grid.project;this.editor.refreshCalendars(e.calendarManagerStore.getRange())}renderer({value:e}){const t=this;if(e===t.defaultCalendar)return"";if(e&&e.id){const r=t.editor.store.getById(e.id);return r&&r[t.editor.displayField]||""}return""}}Ea.registerColumnType(vy),vy._$name="CalendarColumn";class yy extends ka{static get isGanttColumn(){return!0}static get defaults(){return{instantUpdate:!0,width:130,step:null,format:"ll"}}construct(e,t){const r=this;r.gantt=t.grid,super.construct(e,t),r.format?r.explicitFormat=!0:r.gantt.on({displayDateFormatChange({format:e}){r.explicitFormat||r.set("format",e)}})}set format(e){this.explicitFormat=!0,this.set("format",e)}get format(){return this.explicitFormat&&this.data.format||this.gantt.displayDateFormat}}yy._$name="GanttDateColumn";class by extends yy{static get type(){return"constraintdate"}static get defaults(){return{field:"constraintDate",text:"L{Constraint Date}",width:146}}}Ea.registerColumnType(by),by._$name="ConstraintDateColumn";class Cy extends Da{static get type(){return"constrainttype"}static get isGanttColumn(){return!0}static get defaults(){return{field:"constraintType",text:"L{Constraint Type}",width:146,editor:{type:ug.type,clearable:!0,allowInvalid:!1}}}afterConstruct(){const e=this;super.afterConstruct(),e.grid.on({startCellEdit:e.onStartCellEdit,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),Zt.createSequence(e.editor.updateLocalization,e.onEditorLocaleChange,e)}onStartCellEdit({editorContext:{editor:e,record:t}}){e.inputField instanceof ug&&(e.inputField.store.filter(e=>t.run("isConstraintTypeApplicable",e.id)),this._filterDetacher=()=>e.inputField.store.clearFilters())}onDoneCellEdit(){this._filterDetacher&&this._filterDetacher()}renderer({value:e}){const t=null!=e&&"none"!==e&&this.editor.store.getById(e);return t&&t.text||""}onEditorLocaleChange(){this.grid.refreshColumn(this)}}Ea.registerColumnType(Cy),Cy._$name="ConstraintTypeColumn";class wy extends yy{static get type(){return"deadlinedate"}static get defaults(){return{field:"deadlineDate",text:"L{Deadline}",width:146}}}Ea.registerColumnType(wy),wy._$name="DeadlineDateColumn";class Sy extends ng{}Sy._$name="DurationColumn";class Dy extends yy{static get type(){return"earlyenddate"}static get defaults(){return{field:"earlyEndDate",text:"L{Early End}"}}canEdit(e){return!1}}Ea.registerColumnType(Dy),Dy._$name="EarlyEndDateColumn";class Ey extends yy{static get type(){return"earlystartdate"}static get defaults(){return{field:"earlyStartDate",text:"L{Early Start}"}}canEdit(e){return!1}}Ea.registerColumnType(Ey),Ey._$name="EarlyStartDateColumn";class xy extends Sy{static get type(){return"effort"}static get defaults(){return{field:"fullEffort",text:"L{Effort}"}}get defaultEditor(){return{type:Kh.type,name:this.field}}canEdit(e){return e.isLeaf}}Ea.registerColumnType(xy),xy._$name="EffortColumn";class Ty extends Ma{static get type(){return"rollup"}static get isGanttColumn(){return!0}static get defaults(){return{field:"rollup",text:"L{Rollup}"}}}Ea.registerColumnType(Ty),Ty._$name="RollupColumn";class Ry extends Ma{static get type(){return"showintimeline"}static get isGanttColumn(){return!0}static get defaults(){return{field:"showInTimeline",text:"L{Show in timeline}"}}}Ea.registerColumnType(Ry),Ry._$name="ShowInTimelineColumn";class My extends yy{static get type(){return"enddate"}static get defaults(){return{field:"endDate",text:"L{Finish}"}}get defaultEditor(){const e=super.defaultEditor;return e.type="enddate",e}get editor(){let e=this.data.editor;const t=e&&!(e instanceof Vr);return e=super.editor,e&&t&&(e.project=this.gantt.project),e}canEdit(e){return e.isLeaf}}Ea.registerColumnType(My),My._$name="EndDateColumn";class ky extends yy{static get type(){return"lateenddate"}static get defaults(){return{field:"lateEndDate",text:"L{Late End}"}}canEdit(e){return!1}}Ea.registerColumnType(ky),ky._$name="LateEndDateColumn";class Iy extends yy{static get type(){return"latestartdate"}static get defaults(){return{field:"lateStartDate",text:"L{Late Start}"}}canEdit(e){return!1}}Ea.registerColumnType(Iy),Iy._$name="LateStartDateColumn";class Fy extends Ma{static get type(){return"manuallyscheduled"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",text:"L{Manually scheduled}"}}}Ea.registerColumnType(Fy),Fy._$name="ManuallyScheduledColumn";class Ay extends Ma{static get type(){return"milestone"}static get isGanttColumn(){return!0}static get defaults(){return{field:"milestone",text:"L{Milestone}"}}}Ea.registerColumnType(Ay),Ay._$name="MilestoneColumn";class Py extends $a{static get type(){return"name"}static get isGanttColumn(){return!0}static get defaults(){return{htmlEncode:!1,width:200,field:"name",text:"L{Name}"}}}Ea.registerColumnType(Py),Py._$name="NameColumn";class Ly extends Da{static get type(){return"note"}static get isGanttColumn(){return!0}static get defaults(){return{field:"note",text:"L{Note}",width:150,editor:{type:"textareafield",inline:!1}}}renderer({value:e}){return(e||"").trim()}get disableHtmlEncode(){return!0}}Ea.registerColumnType(Ly),Ly._$name="NoteColumn";class Oy extends Fa{static get type(){return"percentdone"}static get isGanttColumn(){return!0}static get fields(){return["showCircle"]}static get defaults(){return{field:"percentDone",text:"L{% Done}",unit:"%",step:1,min:0,max:100,width:90}}construct(e){super.construct(...arguments),this.showCircle&&(this.htmlEncode=!1)}defaultRenderer({record:e}){const t=e.renderedPercentDone;if(this.showCircle){const e=.8*this.grid.rowHeight;return{className:"b-percentdone-circle",style:{animationDelay:`-${t-.1}s`,width:e,height:e},dataset:{value:t}}}return t+this.unit}canEdit(e){return e.isLeaf}}Ea.registerColumnType(Oy),Oy._$name="PercentDoneColumn";const _y={from:[2,3,0,1],to:[1,0,3,2]},$y=()=>new RegExp(`(${jy.join("|")})?((?:[+-])\\d+[a-z]*)?`,"i");let jy=["SS","SF","FS","FF"],Hy=$y();class Ny extends As{static get $name(){return"DependencyField"}static get defaultConfig(){return{listCls:"b-predecessor-list",valueField:"name",displayField:"name",delimiter:";",otherSide:null,ourSide:null}}construct(e){const t=this,{ourSide:r,otherSide:n}=e;t.dependencies=new Fr({extraKeys:n}),t.startCollection=new Fr({extraKeys:n}),super.construct(e),t.delimiterRegEx=new RegExp(`\\s*${t.delimiter}\\s*`),ne.on({locale(){jy=ae().L("L{GanttCommon.dependencyTypes}"),Hy=$y(),t.syncInputFieldValue()},thisObj:t})}internalOnInput(){this.isValid?(this.clearError(),Es.prototype.internalOnInput.call(this)):this.setError("Invalid dependency format")}onInternalKeyDown(e){const{key:t}=e;"Enter"!==t&&super.onInternalKeyDown&&super.onInternalKeyDown(e),this.pickerVisible&&"ArrowDown"===t&&this.filterField.focus()}onTriggerClick(){this.pickerVisible?super.onTriggerClick():this.doFilter(this.filterInput?this.filterInput.value:null)}set store(e){const t=this;(e=e.makeChained(e=>!t.owner||!t.owner.record||e.id!==t.owner.record.id)).tree=!1,super.store=e}get store(){return super.store}createPicker(){const e=this,t=e.input,r=e.filterField=new Es({cls:"b-dependency-list-filter",owner:e,clearable:!0,placeholder:"Filter",triggers:{filter:{cls:"b-icon b-icon-filter",align:"start"}},listeners:{input({value:r}){e.input=n,e.filterList(r),e.input=t},clear(){e.input=n,e.filterList(),e.input=t}}}),n=e.filterInput=r.input,s=new Ms({owner:e,floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,store:e.store,cls:e.listCls,itemTpl:e.listItemTpl,forElement:e[e.pickerAlignElement],align:{align:"t0-b0",axisLock:!0,anchor:e.overlayAnchor,target:e[e.pickerAlignElement]},navigator:{keyEventTarget:n,processEvent:t=>{if("Escape"!==t.key)return t;e.hidePicker()}},onItem:e.onPredecesssorClick,maxHeight:324,minHeight:161,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1,getItemClasses:function(t){const r=Ms.prototype.getItemClasses.call(this,t),n=e.dependencies.getBy(e.otherSide+"Event",t);return r+(n?" b-selected b-"+n.getConnectorString(1).toLowerCase():"")}});return r.render(s.contentElement),s}showPicker(e){this.store.fillFromMaster(),super.showPicker(e)}onPickerShow({source:e}){const t=this,r=t.filterField,n=t.input;e.minWidth=t[t.pickerAlignElement].offsetWidth,e.contentElement.insertBefore(r.element,e.contentElement.firstChild),t.input=t.filterInput,super.onPickerShow(),t.input=n}listItemTpl(e){return`<div class="b-predecessor-item-text">${e.name}</div>\n            <div class="b-sch-box b-from" data-side="from"></div>\n            <div class="b-sch-box b-to" data-side="to"></div>`}get isValid(){return Boolean(!this.owner||this.parseDependencies(this.input.value))}set value(e){const t=this,r=t.dependencies,n=t.startCollection;if("string"==typeof e){if(t.input.value=e,!(e=t.parseDependencies(e)))return void t.updateInvalid();for(let r=0;r<e.length;r++){const s=new t.dependencyStore.modelClass(e[r]);let i=n.getBy(t.otherSide,s.fromEvent);i&&(i=i.copy(i.id),i.type=s.type,i.fullLag=s.fullLag),e[r]=i||s}}else t.startCollection.clear(),t.startCollection.values=e;r.clear(),r.values=e,t.inputting||t.syncInputFieldValue()}get value(){return this.dependencies.values}onPredecesssorClick({source:e,item:t,record:r,index:n,event:s}){const i=this.owner,o=i.dependencies,a=s.target.closest(".b-sch-box"),l=a&&a.dataset.side;let c=o.getBy(i.otherSide+"Event",r);t.dataset.noselect=!0,c&&!a?o.remove(c):c?(c=c.copy(c.id),c.type=_y[l][c.type],o.add(c)):o.add(i.dependencyStore.createRecord({[i.otherSide+"Event"]:r,[i.ourSide+"Event"]:i.owner.record},!0)),i.syncInputFieldValue(),e.refresh()}syncInputFieldValue(){this.input.value=this.constructor.predecessorsToString(this.dependencies.values,this.otherSide,this.delimiter)}static predecessorsToString(e,t,r=";"){const n=[];if(e&&e.length)for(const r of e){const e=r[t+"Event"],s=e?e.id:e||"";n.push(`${s}${r.getConnectorString()}${r.getLag()}`)}return n.join(r)}parseDependencies(e){const t=this,r=t.grid,n=t.owner.record,s=t.store,i=t.dependencyStore,o=e.split(t.delimiterRegEx),a=i.modelClass,l=[];for(let e=0;e<o.length;e++){const i=o[e];if(i){let e,o=i.length+1,c=null;for(;o&&!c;o--)e=i.substr(0,o),c=s.getById(e);if(!c)return null;const d=i.substr(o+1),u={[t.otherSide+"Event"]:c,[t.ourSide+"Event"]:n,type:a.Type.EndToStart};if(d.length){const e=Hy.exec(d);if(!e||!e[1]&&!e[2])return null;if(e[1]&&(u.type=jy.indexOf(e[1].toUpperCase())),e[2]){const t=je.parseDuration(e[2],!0,r.timeAxis.unit);u.lag=t.magnitude,u.lagUnit=t.unit}}l.push(u)}}return l}}Ny._$name="DependencyField",U.register("dependencyfield",Ny);const By=e=>!e.project,zy=e=>e,Vy=async(e,t,r)=>{const n=e.shift();n&&(r.push(await t.isValidDependency({fromEvent:n.fromEvent,toEvent:n.toEvent,lag:n.lag,lagUnit:n.lagUnit,type:n.type})),await Vy(e,t,r))};class Wy extends(br(Da)){static get type(){return"dependency"}static get fields(){return[{name:"delimiter",defaultValue:";"}]}static get defaults(){return{htmlEncode:!1,width:120,renderer({record:e}){return Ny.predecessorsToString(e[this.field],"predecessors"===this.field?"from":"to",this.delimiter)}}}afterConstruct(){super.afterConstruct()}async finalizeCellEdit({grid:e,record:t,inputField:r,value:n,oldValue:s,editorContext:i}){if(t&&n){n=n.slice();const{dataField:o}=i.editor,a=n.filter(By),l=[];await Vy(a,e.dependencyStore,l);const c=l.every(zy);if(c){const e="set"+I.capitalizeFirstLetter(o);t[e]?t[e](n):t[o]=n}else r.value=s,J.toast(i.column.L("L{Invalid dependency found, change is reverted}"));return c}}get defaultEditor(){const e=this,t="predecessors"===e.field;return{type:"dependencyfield",grid:e.grid,name:e.field,delimiter:e.delimiter,ourSide:t?"to":"from",otherSide:t?"from":"to",store:e.grid.eventStore||e.grid.taskStore,dependencyStore:e.grid.features.dependencies.store}}}Ea.registerColumnType(Wy),Wy._$name="DependencyColumn";class Gy extends Wy{static get type(){return"predecessor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"L{Predecessors}",field:"predecessors"}}}Ea.registerColumnType(Gy),Gy._$name="PredecessorColumn";class Uy extends Jn{static get fields(){return[{name:"assignment",type:"object"},{name:"resource",type:"object"},{name:"event",type:"object"},{name:"units",type:"number",defaultValue:0}]}get name(){return this.resource?this.resource.name:""}get assigned(){return this.event&&this.firstStore.projectEvent===this.event}set assigned(e){const t=this;e?t.assigned||t.set({event:t.firstStore.projectEvent,units:t.units||100}):t.set({event:null,units:0})}}Uy._$name="AssignmentsManipulationModel";const{defineParser:Yy,alt:qy,seq:Xy,string:Ky,regexp:Zy,succeed:Jy,red:Qy,isSuccess:eb}=ha,tb=Yy(Qy(Zy("[^\\[\\,]+"),e=>({name:e.trim(),units:100,match:e}))),rb=Yy(Qy(Zy("[0-9\\s]+"),e=>({value:e.split(/\s*/).join(""),match:e}))),nb=Yy(Qy(qy(Ky("."),Ky(",")),e=>({value:e,match:e}))),sb=Yy(qy(Qy(Xy(()=>rb,()=>nb,()=>rb),(e,t,r)=>({value:Number(`${e.value}.${r.value}`),match:[e.match,t.match,r.match].join("")})),Qy(Xy(()=>nb,()=>rb),(e,t)=>({value:Number("0."+t.value),match:[e.match,t.match].join("")})),Qy(()=>rb,e=>({value:Number(""+e.value),match:e.match})))),ib=Yy(qy(Qy(Xy(()=>sb,Zy("\\s*\\%")),(e,t)=>({value:e.value,match:[e.match,t].join("")})),Qy(()=>sb,e=>({value:e.value,match:e.match})))),ob=Yy(Qy(Xy(Zy("\\s*\\[\\s*"),()=>ib,Zy("\\s*\\]")),(e,t,r)=>({units:t.value,match:[e,t.match,r].join("")}))),ab=Yy(Qy(Zy("\\s*,\\s*"),e=>({value:e,match:e}))),lb=Yy(qy(Xy(()=>tb,()=>ob,qy(Xy(()=>ab,()=>lb),Jy(""))),Xy(()=>tb,qy(Xy(()=>ab,()=>lb),Jy(""))))),cb=e=>{let t=!1,r=[],n="";lb(e,e=>{if(eb(e)){const[,s,i]=e;s.length>r.length&&(r=s,n=i,t=!0)}});let s=0;return!!t&&{rest:n,assignments:r.reduce((e,t)=>{let r;return"object"==typeof t&&(t.hasOwnProperty("name")?(r=Object.assign({position:s},t),e.push(r)):(r=e[e.length-1],t.hasOwnProperty("units")&&(r.units=t.units),r.match+=t.match),s+=t.match.length),e},[])}},db=(e,t=!1)=>{let r="";return e.assignments&&(r+=e.assignments.reduce((e,{name:r,units:n,match:s})=>e+=s&&t?s:(e.length?", ":"")+`${r} [${n}%]`,r)),e.rest&&(r+=e.rest),t||(r=r.trim()),r};var ub={parse:cb,compose:db,normalize:e=>db(cb(e))};const{compose:hb}=ub;class gb extends Cs{static get defaultConfig(){return{modelClass:Uy,storeId:"assignmentsmanipulation",storage:{extraKeys:["resource"]},callOnFunctions:!0,projectEvent:null,floatAssignedResources:!0,liveFloatAssignedResources:!1}}afterConfigure(){super.afterConfigure(),this.addSorter({fn:this.defaultSort.bind(this)})}get projectEvent(){return this._projectEvent}set projectEvent(e){const t=this;if(e!=t._projectEvent||e&&e.generation!==t._projectEventGeneration)if(t._projectEvent=e,t._projectEventGeneration=e.generation,e){t.fillFromMaster();const{assignments:r}=e,n=[];r.forEach(r=>{const s=t.find(e=>e.resource===r.resource);s&&(s.set({assignment:r,event:e,units:r.units||0}),n.push(s))}),t.originalAssignmentManipulationRecords=n,t.acceptChanges(),t.sort()}else t.removeAll()}get floatAssignedResources(){return this._floatAssignedResources}set floatAssignedResources(e){const t=this;e!==t.floatAssignedResources&&(t._floatAssignedResources=e,t.sort())}get assignmentStore(){return this.projectEvent&&this.projectEvent.getAssignmentStore()||null}get resourceStore(){return this.projectEvent&&this.projectEvent.getResourceStore()||null}fillFromMaster(){const e=this;e.projectEvent&&(e.data=e.resourceStore.map(e=>({resource:e})))}async applyChanges(){const e=this,{projectEvent:t,assignmentStore:r}=e,n=[],s=e.query(e=>e.event&&e.units,!0),i=e.originalAssignmentManipulationRecords.filter(e=>!s.includes(e));let o;if(s.length||i.length){const a=t.project.replica,l=a.projectRefreshThreshold;s.forEach(e=>{const t=e.assignment;t?t.$.units.put(e.units):n.push({resource:e.resource,event:e.event,units:e.units})}),e.commit(),r.remove(i.map(e=>e.assignment)),r.add(n),a.projectRefreshThreshold=0,o=await t.propagate(),a.projectRefreshThreshold=l,r.trigger("refresh",{action:"dataset"}),o===Vg.Completed&&(e.floatAssignedResources&&e.sort(),e.trigger("changesApplied"))}else o=Vg.Complete;return o}getResourceAssignment(e){return this.storage.getBy("resource",e)}get activeAssignments(){const e=this.projectEvent;return this.query(t=>t.event===e)}toValueString(){const{activeAssignments:e}=this;return hb({rest:"",assignments:e})}defaultSort(e,t){let r=0;return r=this.floatAssignedResources?!t.event&&e.event?-1:!e.event&&t.event?1:e.name.localeCompare(t.name):e.name.localeCompare(t.name),r}onUpdate({changes:e}){const t=this;t.isConfiguring||Object.hasOwnProperty.call(e,"event")&&t.floatAssignedResources&&t.liveFloatAssignedResources&&t.sort()}}gb._$name="AssignmentsManipulationStore";class mb extends mc{static get $name(){return"AssignmentGrid"}static get type(){return"assignmentgrid"}static get defaultConfig(){return{selectionMode:{rowCheckboxSelection:!0,multiSelect:!0,showCheckAll:!0},columns:[{cls:"b-assignmentgrid-resource-column",field:"resourceId",flex:1,editor:null,renderer:e=>e.record.name,filterable:{filterField:{placeholder:this.L("L{Name}"),triggers:{filter:{align:"start",cls:"b-icon b-icon-filter"}}},filterFn:({value:e,record:t})=>-1!==t.name.toLowerCase().indexOf(e.toLowerCase())},sortable:(e,t)=>e.name<t.name?-1:e.name>t.name?1:0},{field:"units",type:Fa.type,text:this.L("L{Units}"),width:70,min:0,max:100,step:10,unit:"%",renderer:({value:e})=>this.L("L{unitsTpl}",{value:e}),filterable:!1}],features:{group:!1,filterBar:!0,contextMenu:!1},disableGridRowModelWarning:!0,projectEvent:null}}construct(){super.construct(...arguments),this.on("selectionchange",({selected:e,deselected:t})=>{e.forEach(e=>e.assigned=!0),t.forEach(e=>e.assigned=!1)})}get projectEvent(){const e=this,t=e.store;let r=e._projectEvent;return t&&r!==t.projectEvent&&(r=e._projectEvent=t.projectEvent),r}set projectEvent(e){this._projectEvent=e,this.store.projectEvent=e,this.selectedRecords=this.store.originalAssignmentManipulationRecords}get store(){return super.store}set store(e){const t=this;t.store!==e&&(e instanceof gb||(e=new gb(Object.assign({projectEvent:t._projectEvent},e))),super.store=e)}}mb._$name="AssignmentGrid",U.register(mb.type,mb);class pb extends fn{static get $name(){return"AssignmentPicker"}static get type(){return"assignmentpicker"}static get defaultConfig(){return{grid:null,focusable:!0,trapFocus:!0,height:"20em",minWidth:"25em",items:[{ref:"grid",type:mb.type}],bbar:[{type:"button",text:this.L("L{Object.Save}"),localeClass:this,ref:"saveBtn",color:"b-green"},{type:"button",text:this.L("L{Object.Cancel}"),localeClass:this,ref:"cancelBtn",color:"b-gray"}],projectEvent:null,store:null}}afterConfigure(){const e=this;super.afterConfigure(),e.bbar.widgetMap.saveBtn.on("click",e.onSaveClick,e),e.bbar.widgetMap.cancelBtn.on("click",e.onCancelClick,e)}get focusElement(){return this.element.querySelector("input[type=text]")}get grid(){return this.isConfiguring?this._grid:this.widgetMap.grid}set grid(e){this._grid=e}get projectEvent(){return this._projectEvent}set projectEvent(e){this._projectEvent=e,this.grid&&(this.grid.projectEvent=e)}createWidget(e){if(e&&"grid"===e.ref){const t=this,r=U.getClass(e.type).defaultConfig;let n=t.grid;n&&(n.columns&&(e.columns=[...r.columns,...n.columns],n=Object.assign({},n),delete n.columns),ze.merge(e,n)),e.projectEvent=t.projectEvent,e.store=t.store,e.selectedRecordCollection=t.assignments}return super.createWidget(e)}onSaveClick(){this.store.applyChanges(),this.hide()}onCancelClick(){this.hide()}}pb._$name="AssignmentPicker",U.register(pb.type,pb);class fb extends As{static get $name(){return"AssignmentField"}static get type(){return"assignmentfield"}static get defaultConfig(){return{chipView:{cls:"b-assignment-chipview",itemTpl:(e,t)=>`${e.name} ${e.units}%`,scrollable:{overflowX:"hidden-scroll"}},triggers:{expand:{cls:"b-icon-down",handler:"onTriggerClick"}},multiSelect:!0,clearable:!1,editable:!1,value:null,pickerWidth:null,projectEvent:null,store:null}}onChipClose(e){this.showPicker(),e.forEach(e=>this.picker.grid.deselectRow(e))}syncInputFieldValue(){super.syncInputFieldValue(),this.store&&(this.tooltip=this.store.toValueString())}onTriggerClick(e){this.pickerVisible?this.hidePicker():xs.prototype.showPicker.call(this,e&&"key"in e)}focusPicker(){this.picker.focus()}createPicker(e){const t=this;return J.createWidget(Object.assign({type:pb.type,projectEvent:t.projectEvent,store:t.store,readOnly:t.readOnly,owner:t,forElement:t[t.pickerAlignElement],floating:!0,scrollAction:"realign",assignments:t.valueCollection,align:{align:"t0-b0",axisLock:!0,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]}},e))}get projectEvent(){return this._projectEvent}set projectEvent(e){this._projectEvent=e,this._projectEventGeneration=e.generation,this.store.projectEvent=this.picker.projectEvent=e}get store(){return this._store||(this.store={}),this._store}set store(e){const t=this;e!==t._store&&(e instanceof gb?(t._store=e,t.projectEvent=e.projectEvent):e&&(t._store=new gb(e),t._store.projectEvent=t.projectEvent))}get value(){}set value(e){}onPickerKeyDown(e){const t=this.picker.grid;"ArrowDown"===e.key&&e.target.compareDocumentPosition(t.bodyContainer)===document.DOCUMENT_POSITION_FOLLOWING&&t.element.focus()}}fb._$name="AssignmentField",U.register(fb.type,fb);const vb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA3CAYAAABQOymxAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAABCJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIgogICAgICAgICAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyI+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjU8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOlhSZXNvbHV0aW9uPjcyPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjYwPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT4xPC9leGlmOkNvbG9yU3BhY2U+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj41NTwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgICAgIDxkYzpzdWJqZWN0PgogICAgICAgICAgICA8cmRmOkJhZy8+CiAgICAgICAgIDwvZGM6c3ViamVjdD4KICAgICAgICAgPHhtcDpNb2RpZnlEYXRlPjIwMTgtMDMtMTBUMTE6MDM6NTc8L3htcDpNb2RpZnlEYXRlPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPlBpeGVsbWF0b3IgMy43PC94bXA6Q3JlYXRvclRvb2w+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpEgCIGAAADbUlEQVRoBe2aW08TQRTH/yVchVCg3Kyl1EAEg6VBjdpoor74ZUz8Nn4UIyHGy4NGLtEHoiLhBQpUkWAIt8itnkMt3SVud2b3DL0xSdPZnTNzzm8uZ87ubCCTyTwD8JR+1+hXyWme4J4HCPg7ZSodNjeQ8wycyV1Vw39NNUBaGWutF6bzh6Rg5XdeC8+t+nog3JK/ZzpnHDi9A0xNAUdH7ijt7cDjW+5yfiSMruHxD8Durr550Shw25AbNQL8hxhfvNIHtdZooWn+5J71jkzeiNMaf+PfuO1tYJo3TOEkDvx1WW29qnCkUsCBiqCGjDjw3JyGdgXRt5MKQhoiosA/PDgoN1u3ttwk9MpFgWdm9JSrSv/cU5V0lxMF3t93V+hFYpn8glQSBZYy6mw7ktF+WQCf7QA/1xfAfnovEPBT27lurWDEXxYjHAo5d4ZuSVkAR4K6WM7yZQHsbL5+yQWwfp/la5hyWpIv3URHOCi41vLdCEgaKdkWhoetZpZmXhT4crM8ZEODbJuiwGxaT4+sgfG4bHviwPcFDawh66JtJQ7M5tXVyRg5OCjTjrUV8RHmxmMxqwrv+Rv0ulY6GQGO92dPFPwY293tp7ZzXSPArK6vz1mpWwkHMA9G3aS8lRsDTlwFvD7W9fZ6g1GpZQyYlScSKibYZbiTkiP2e5JXRoH76XAsEtEzN5nUk9eVNgrMxjRrRl9twpHV2Q4xcpjGSn7RidrSErC+DuzQkalq6uwE+CGEt7YgOS/pJArMZ8Hz9OkIH4TxO2o/r1c5yuI4urUVGKPo7ZIQuW/ghTUgnc6OpB9ANx7uAN6bh4aAkI9IzjNwahNYXATWCPg8E3tx3rYGBryBawMz6MICsEn/x8fniWrXxeC81u+OAY32ooJXysB8MPh5Njt1Vb7XKKhVsJDXeVcXcEfx5YMrMB/cfSFHxOv0QPp0WhC8kYaZ9/zRWOFGCwJ/oqm7upr1uIWbKZ3SpiZ6hqanrBGHWP6/wLPkjHhEeXsp18TrOxwGrl+xE9iAD6ns3XTWIdnFyveKj2kekmPLJRvwy/fAnuBpe05Jsf87OoBHN7NWnMbSEx8rE5YxNzaA1/8+xzgZ4clv9A3kSrHHwbx+js9PRrgaYLk7OTI8ndLm+7f4GjjWrypg7vIL4OJPPLMWVN0I/wWcn9aXj4AzhgAAAABJRU5ErkJggg==";class yb extends Da{static get type(){return"resourceassignment"}static get isGanttColumn(){return!0}static get fields(){return["showAvatars","sideMargin","imageSize"]}static get defaults(){return{field:"assignments",instantUpdate:!1,text:"L{Assigned Resources}",width:250,cellCls:"b-resourceassignment-cell",showAvatars:!1,imageSize:30,sideMargin:20}}construct(){const e=this;if(super.construct(...arguments),e.showAvatars){if(gr.on({element:e.grid.element,error:e.onError,thisObj:e,capture:!0}),Object.assign(e,{repaintOnResize:!0,htmlEncode:!1,autoSyncHtml:!0}),!e.grid.resourceImageFolderPath)throw new Error("Must provide a resourceImageFolderPath where resource images are located");e.renderer=e.rendererWithAvatars}e.grid.on({startCellEdit:e.onStartCellEdit,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),e.grid.resourceStore.on({name:"resourceStore",update:e.onResourceUpdate,thisObj:e})}get defaultEditor(){return{type:fb.type}}onStartCellEdit({editorContext:{record:e,column:t}}){const r=this;t===r&&(r.editor.projectEvent=e,this.detachListeners("editorStore"),r.editor.store.on({name:"editorStore",changesApplied:r.onEditorChangesApplied,thisObj:r}))}onDoneCellEdit(){this.detachListeners("editorStore")}onEditorChangesApplied(){const e=this,t=e.grid.getCell({id:e.editor.projectEvent.id,columnId:e.id});t&&e.renderer({value:e.editor.projectEvent.assignments,cellElement:t})}onResourceUpdate(){this.grid.refreshColumn(this)}get chipView(){return this._chipView||(this._chipView=new ks({cls:"b-assignment-chipview",itemsFocusable:!1,closable:!1,itemTpl:this.itemTpl,store:{},scrollable:{overflowX:"hidden-scroll"}}),Object.defineProperty(this.chipView,"isVisible",{get:()=>!0})),this._chipView}itemTpl(e,t){return`${e.resourceName} ${e.units}%`}renderer({cellElement:e,value:t,isExport:r}){if(r)return t;{const{chipView:r}=this;r.store.storage.replaceValues({values:t.filter(e=>e.resource).sort((e,t)=>e.resourceName.localeCompare(t.resourceName)),silent:!0}),r.refresh();const n=r.element.cloneNode(!0);n.removeAttribute("id"),e.innerHTML='<div class="b-assignment-chipview-wrap"></div>',e.firstElementChild.appendChild(n)}}rendererWithAvatars({value:e,isExport:t}){if(t)return e;const r=this,n=Math.floor((r.width-r.sideMargin)/(r.imageSize+2)),s=e.length>n?e.length-n:0;return'<div class="b-resource-avatar-container">'+Array.from(e).map((e,t)=>{const{resource:i}=e;if(i&&t<n){const o=s>0&&t===n-1,a=r.renderImage({resource:i,assignment:e,overflowCount:o?s:0});return o?`<div class="b-overflow-img">${a}<span class="b-overflow-count">+${s}</span></div>`:a}}).join("")+"</div>"}renderImage({resource:e,assignment:t,overflowCount:r}){return`<img data-btip-scroll-action="realign" data-btip="${`${e.name} ${t.units}%${r?` (+${r} ${this.L("L{more resources}")})`:""}`}" class="b-resource-avatar" src="${e.image?this.grid.resourceImageFolderPath+e.image:this.defaultAvatar}">`}onError(e){const t=e.target;t.classList.contains("b-resource-avatar")&&(t.getAttribute("src").endsWith(this.defaultAvatar)?t.src=vb:t.src=this.defaultAvatar)}get defaultAvatar(){return this.grid.defaultResourceImageName?this.grid.resourceImageFolderPath+this.grid.defaultResourceImageName:vb}}Ea.registerColumnType(yb),yb._$name="ResourceAssignmentColumn";class bb extends Da{static get type(){return"schedulingmodecolumn"}static get isGanttColumn(){return!0}static get defaults(){return{field:"schedulingMode",text:"L{Scheduling Mode}",editor:{type:hg.type,allowInvalid:!1,picker:{minWidth:"8.5em"}}}}afterConstruct(){super.afterConstruct(),Zt.createSequence(this.editor.updateLocalization,this.onEditorLocaleChange,this)}renderer({value:e}){const t=this.editor.store.getById(e);return t&&t.text||""}onEditorLocaleChange(){this.grid.refreshColumn(this)}}Ea.registerColumnType(bb),bb._$name="SchedulingModeColumn";class Cb extends Da{static get type(){return"sequence"}static get isGanttColumn(){return!0}static get defaults(){return{field:"sequenceNumber",text:"L{Sequence}",sortable:!1,groupable:!1,filterable:!1,width:70,editor:null}}}Ea.registerColumnType(Cb),Cb._$name="SequenceColumn";class wb extends yy{static get type(){return"startdate"}static get defaults(){return{field:"startDate",text:"L{Start}"}}get defaultEditor(){const e=super.defaultEditor;return e.type="startdate",e}get editor(){let e=this.data.editor;const t=e&&!(e instanceof Vr);return e=super.editor,e&&t&&(e.project=this.gantt.project),e}}Ea.registerColumnType(wb),wb._$name="StartDateColumn";class Sb extends Wy{static get type(){return"successor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"L{Successors}",field:"successors"}}}Ea.registerColumnType(Sb),Sb._$name="SuccessorColumn";class Db extends Sy{static get type(){return"totalslack"}static get isGanttColumn(){return!0}get durationUnitField(){return"slackUnit"}static get defaults(){return{field:"totalSlack",text:"L{Total Slack}"}}canEdit(e){return!1}}Ea.registerColumnType(Db),Db._$name="TotalSlackColumn";class Eb extends Da{static get type(){return"wbs"}static get isGanttColumn(){return!0}static get defaults(){return{field:"wbsCode",text:"L{WBS}",width:70,editor:null}}}Ea.registerColumnType(Eb),Eb._$name="WBSColumn";var xb={AddNewColumn:py,CalendarColumn:vy,ConstraintDateColumn:by,ConstraintTypeColumn:Cy,DeadlineDateColumn:wy,DurationColumn:Sy,EarlyEndDateColumn:Dy,EarlyStartDateColumn:Ey,EffortColumn:xy,EndDateColumn:My,LateEndDateColumn:ky,LateStartDateColumn:Iy,ManuallyScheduledColumn:Fy,MilestoneColumn:Ay,NameColumn:Py,NoteColumn:Ly,PercentDoneColumn:Oy,PredecessorColumn:Gy,ResourceAssignmentColumn:yb,RollupColumn:Ty,SchedulingModeColumn:bb,SequenceColumn:Cb,ShowInTimelineColumn:Ry,StartDateColumn:wb,SuccessorColumn:Sb,TotalSlackColumn:Db,WBSColumn:Eb};class Tb extends Ma{static get type(){return"eventmode"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",align:"left",text:"L{Event mode}"}}constructor(e,t){super(...arguments),this.internalCellCls="b-eventmode-cell"}renderer({value:e,cellElement:t,column:r,isExport:n}){if(super.renderer(...arguments),n)return this.renderText(e);t.widget&&(t.widget.text=this.renderText(e))}onCheckboxChange({source:e,checked:t}){super.onCheckboxChange(...arguments),e.text=this.renderText(t)}renderText(e){return e?this.L("L{Manual}"):this.L("L{Auto}")}}Ea.registerColumnType(Tb),Tb._$name="EventModeColumn";class Rb extends Yv{}Rb._$name="AssignmentModel";class Mb extends Kv{static get defaultConfig(){return{modelClass:Rb}}}Mb._$name="AssignmentStore";class kb extends kp{}kb._$name="DependencyModel";class Ib extends Av{static get defaultConfig(){return{modelClass:kb}}}Ib._$name="DependencyStore";class Fb extends jv{}Fb._$name="ResourceModel";class Ab extends Bv{static get defaultConfig(){return{modelClass:Fb}}}Ab._$name="ResourceStore";class Pb extends jc{static get fields(){return[{name:"task",persist:!1}]}get isBaseline(){return!0}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:t}=this;if(e&&t)return t.getTime()===e.getTime()}return 0===this.duration}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}}Pb._$name="Baseline";const Lb=(e,t)=>{const{startDate:r,durationUnit:n,endDate:s}=e;return t?t.map(t=>Object.assign({task:e,startDate:r,durationUnit:n,endDate:s},t)):[]};class Ob extends(wg(wv(jc))){static get fields(){return[{name:"cls",serialize:e=>e.isDomClassList?e.toString():e,persist:!0},{name:"fullEffort",persist:!1},{name:"baselines"},{name:"note",type:"string"},{name:"percentDone",type:"number",defaultValue:0},{name:"parentId",serialize:(e,t)=>{const r=t.getEventStore(),n=t.getProject();return r&&r.getById(e)===n&&(e=null),e}},{name:"children",persist:!1},{name:"showInTimeline",type:"boolean"},{name:"rollup",type:"boolean"},{name:"deadlineDate",type:"date"},{name:"parentIndex",type:"int",persist:!0},"iconCls","taskIconCls",{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0}]}static get defaultConfig(){return{baselineModelClass:Pb}}get isTask(){return!0}get hasBaselines(){return this.baselinesStore&&this.baselinesStore.count||Boolean(this.originalData.baselines)}setBaseline(e){if(e>this.baselines.count+1)throw new Error(`Attempt to set baseline ${e} when there are only ${this.baselines.count} baselines`);if(e===this.baselines.count+1)return this.baselines.add(Lb(this,[{}]));this.baselines.getAt(e-1).set(Lb(this,[{}])[0])}get baselines(){return this.baselinesStore||(this.baselinesStore=new Cs({modelClass:this.constructor.getDefaultConfiguration().baselineModelClass,data:Lb(this,this.originalData.baselines)})),this.baselinesStore}get successors(){return Array.from(this.outgoingDeps)}set successors(e){this.setOutgoingDeps(e)}get predecessors(){return Array.from(this.incomingDeps)}set predecessors(e){this.setIncomingDeps(e)}get renderedPercentDone(){const e="number"!=typeof this.percentDone||isNaN(this.percentDone)?0:this.percentDone;return e<=99?Math.round(e):Math.floor(e)}set renderedPercentDone(e){this.percentDone=e}get isDraggable(){return this.draggable}get isResizable(){return this.resizable&&!this.milestone&&!this.isParent}get isStarted(){return this.percentDone>0}get isCompleted(){return this.percentDone>=100}get isInProgress(){return this.isStarted&&!this.isCompleted}get milestone(){if(!this.isLeaf){const e=this.startDate,t=this.endDate;if(e&&t)return t.getTime()===e.getTime()}return 0===this.duration}get isMilestone(){return this.milestone}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){const e=this;if(e.milestone)return e.setDuration(1,e.durationUnit,!1)}get allDependencies(){return[...this.predecessors||[],...this.successors||[]]}get predecessorTasks(){return this.predecessors.map(e=>e.fromEvent)}get successorTasks(){return this.successors.map(e=>e.toEvent)}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get sequenceNumber(){let e=0,t=this;for(;t.parent;)e+=t.previousSiblingsTotalCount+1,t=t.parent;return e}get isSubProject(){return!1}get subProject(){const e=this;let t=null;return e.isProject?t=e:e.bubbleWhile(e=>(e.isProject&&(t=e),!t)),t}get fullEffort(){return new ti({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}normalize(){}inSetNormalize(e){}setStartEndDate(){throw new Error("Not supported")}async tryInsertChild(){return await this.getProject().tryPropagateWithChanges(()=>{this.insertChild(...arguments)})!==Vg.Canceled}copy(){const e=super.copy(...arguments);return e.percentDone=0,e}}Ob.convertEmptyParentToLeaf=!0,Ob._$name="TaskModel";class _b extends Gm{}_b._$name="CalendarIntervalModel";class $b extends mp{static get defaultConfig(){return{calendarIntervalModelClass:_b}}}$b._$name="CalendarModel";class jb extends Qv{static get defaultConfig(){return{modelClass:$b}}}jb._$name="CalendarManagerStore";var Hb=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};const Nb=e=>{class t extends e{*calculateCriticalPaths(){const e=[],t=[],r=[...yield this.$.childEvents],n=yield this.$.endDate;let s,i;for(;s=r.shift();){const e=yield s.$.childEvents,i=yield s.$.critical;s.endDate-n==0&&i&&t.push([{event:s}]),r.push(...e)}for(;i=t.shift();){let r,n=i.length-1;for(;r=i[n];){const e=[];for(const t of yield r.event.$.incomingDeps){const r=yield t.$.fromEvent;r&&(yield r.$.critical)&&e.push({event:r,dependency:t})}if(e.length){const r=i.slice();i.push(e[0]);for(let n=1;n<e.length;n++)t.push(r.concat(e[n]));n++}else n=-1}e.push(i.reverse())}return e}}return Hb([hm()],t.prototype,"criticalPaths",void 0),Hb([gm("criticalPaths")],t.prototype,"calculateCriticalPaths",null),t},Bb=e=>class extends e{getType(){return zh.Gantt}getDefaultEventModelClass(){return Sv}*calculateStartDate(){const e=yield this.$.direction;if(e===Vh.Forward){return this.$.startDate.proposedValue||this.$.startDate.getConsistentValue()||(yield*this.unsafeCalculateInitialMinChildrenStartDateDeep())}if(e===Vh.Backward)return yield*this.calculateMinChildrenStartDate()}*calculateEndDate(){const e=yield this.$.direction;if(e===Vh.Forward)return yield*this.calculateMaxChildrenEndDate();if(e===Vh.Backward){return this.$.endDate.proposedValue||this.$.endDate.getConsistentValue()||(yield*this.unsafeCalculateInitialMaxChildrenEndDateDeep())}}*calculateEarlyStartDateConstraintIntervals(){const e=yield*super.calculateEarlyStartDateConstraintIntervals(),t=yield this.$.direction;if(t===Vh.Forward){const t=yield this.$.startDate;t&&e.push($p.new({startDate:t}))}else if(t===Vh.Backward){const t=yield this.$.lateStartDate;t&&e.push($p.new({startDate:t}))}return e}*calculateLateEndDateConstraintIntervals(){const e=yield*super.calculateLateEndDateConstraintIntervals(),t=yield this.$.direction;if(t===Vh.Forward){const t=yield this.$.earlyEndDate;t&&e.push($p.new({endDate:t}))}else if(t===Vh.Backward){const t=yield this.$.endDate;t&&e.push($p.new({endDate:t}))}return e}*unsafeCalculateInitialMinChildrenStartDateDeep(){const e=yield this.$.childEvents;if(!e.size)return this.startDate;let t,r=Ym;const n=[...e];for(;t=n.shift();){const e=t.startDate;e&&e<r&&(r=e),n.push(...yield t.$.childEvents)}return r.getTime()!==Um.getTime()&&r.getTime()!==Ym.getTime()?r:null}*unsafeCalculateInitialMaxChildrenEndDateDeep(){const e=yield this.$.childEvents;if(!e.size)return this.endDate;let t,r=Um;const n=[...e];for(;t=n.shift();){const e=t.endDate;e&&e>r&&(r=e),n.push(...yield t.$.childEvents)}return r.getTime()!==Um.getTime()&&r.getTime()!==Ym.getTime()?r:null}},zb=(e=Jn)=>Bb(Nb(zf(sy(e))));class Vb extends(zb()){static get defaultConfig(){return{assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}}Vb.applyConfigs=!0;class Wb extends(pp(zb(Jn))){static get defaults(){return{expanded:!0}}static get defaultConfig(){return{eventModelClass:Ob,taskModelClass:Ob,dependencyModelClass:kb,resourceModelClass:Fb,assignmentModelClass:Rb,calendarModelClass:$b,eventStoreClass:Ub,taskStoreClass:Ub,dependencyStoreClass:Ib,resourceStoreClass:Ab,assignmentStoreClass:Mb,calendarManagerStoreClass:jb,tasksData:null,eventsData:null,dependenciesData:null,resourcesData:null,assignmentsData:null,calendarsData:null,timeRangeStore:null,convertEmptyParentToLeaf:!1}}construct(...e){const t=e[0]||{};e[0]=t,"tasksData"in t&&(t.eventsData=t.tasksData,delete t.tasksData),"taskStore"in t&&(t.eventStore=t.taskStore,delete t.taskStore),t.eventModelClass=t.taskModelClass||t.eventModelClass||this.defaultEventModelClass,t.eventStoreClass=t.taskStoreClass||t.eventStoreClass||this.defaultEventStoreClass,t.timeRangeStore||(t.timeRangeStore={modelClass:jc,storeId:"timeRanges"}),super.construct(...e)}get defaultEventModelClass(){return Ob}get defaultEventStoreClass(){return Ub}get taskStore(){return this.getEventStore()}get timeRangeStore(){return this._timeRangeStore}set timeRangeStore(e){const t=this;t._timeRangeStore=Cs.getStore(e,Cs),t._timeRangeStore.storeId||(t._timeRangeStore.storeId="timeRanges")}async tryInsertChild(){return await this.tryPropagateWithChanges(()=>{this.insertChild(...arguments)})!==Vg.Canceled}}Wb.applyConfigs=!0,Wb._$name="ProjectModel";const Gb=e=>e.replace(/(\d+)/g,e=>+e+1e5);class Ub extends Rv{static get defaultConfig(){return{modelClass:Ob}}setBaseline(e){const t=this.storage.values;this.forEach(t=>t.setBaseline(e)),this.trigger("refresh",{action:"batch",records:t,data:t})}async indent(e){const t=this,{taskStore:r,project:n}=t;let s=!1;return(e=(e=(e=Array.isArray(e)?e.slice():[e]).filter(e=>!(e instanceof Wb)&&!1!==n.trigger("beforeIndent",{task:e}))).filter(t=>{let r;for(r=Boolean(t.previousSibling);r&&!t.isRoot;)r=!e.includes(t.parent),t=t.parent;return r})).length&&(e.sort((e,t)=>{const r=Gb(e.wbsCode),n=Gb(t.wbsCode);return r<n?-1:r>n?1:0}),r.beginBatch(),s=await n.tryPropagateWithChanges(()=>{for(const r of e){const e=r.previousSibling;e.appendChild(r),t.toggleCollapse(e,!1)}}),r.endBatch(),s&&(t.trigger("indent",{records:e}),t.trigger("change",{action:"indent",records:e}))),s}async outdent(e){const t=this,{taskStore:r,project:n}=t;let s=!1;return(e=(e=(e=Array.isArray(e)?e.slice():[e]).filter(e=>!(e instanceof Wb)&&!1!==n.trigger("beforeOutdent",{task:e}))).filter(t=>{let r;for(r=t.parent&&!t.parent.isRoot;r&&!t.isRoot;)r=!e.includes(t.parent),t=t.parent;return r})).length&&(e.sort((e,t)=>{const r=Gb(e.wbsCode),n=Gb(t.wbsCode);return r<n?1:r>n?-1:0}),r.beginBatch(),s=await n.tryPropagateWithChanges(()=>{for(const r of e){const e=r.parent.children.slice(r.parent.children.indexOf(r)+1);r.parent.parent.insertChild(r,r.parent.nextSibling),r.appendChild(e),t.toggleCollapse(r,!1)}}),r.endBatch(),s&&(t.trigger("outdent",{records:e}),t.trigger("change",{action:"outdent",records:e}))),s}}Ub._$name="TaskStore";class Yb extends Kd{static get $name(){return"Baselines"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:".b-task-baseline",recordType:"baseline"}}static get pluginConfig(){return{chain:["onTaskDataGenerated","render"]}}construct(e,t){const r=this;r.tipId=e.id+"-baselines-tip",r.gantt=e,super.construct(e,t),r.ganttDetatcher=e.on({taskDrag:"onTaskDrag",afterTaskDrop:"onAfterTaskDrop",thisObj:r}),r.storeDetacher=e.taskStore.on({update:{fn:"onStoreUpdateRecord",thisObj:r,prio:1e3}})}doDestroy(){this.ganttDetatcher&&this.ganttDetatcher(),this.storeDetacher&&this.storeDetacher(),super.doDestroy()}doDisable(e){const t=this,{dependencies:r}=t.client.features;t.client.refresh(),r&&t.client.setTimeout(()=>r.scheduleDraw(!0),300),super.doDisable(e)}onAfterTaskDrop({valid:e}){e||this.disabled||this.monitorBaselineSync(300)}onStoreUpdateRecord({record:e,changes:t}){!this.disabled&&(t.startDate||t.endDate)&&this.gantt.getElementFromTaskRecord(e)&&this.monitorBaselineSync(300)}onTaskDrag({taskRecords:e,dragData:t}){!this.disabled&&this.updateTaskBaselines(e[0],t.context.newX)}updateTaskBaselines(e,t){const{gantt:r}=this;if(e.baselines.count){const n=r.getElementFromTaskRecord(e,!1);n&&(null==t&&(t=Et.getOffsetX(n,r.timeAxisSubGridElement)+r.scrollLeft),bo.sync({domConfig:this.getTaskDOMConfig(e,t),targetElement:n.syncIdMap.baselines}))}}monitorBaselineSync(e){this.baselineMonitor&&this.baselineMonitor.cancel(),this.baselineMonitor=Zt.animate(e,this.syncAllBaselines,this)}syncAllBaselines(){!this.isDestroyed&&this.gantt.taskStore.forEach(e=>this.updateTaskBaselines(e))}resolveTimeSpanRecord(e){const t=this.client.resolveTimeSpanRecord(e),r=e.closest(".b-task-baseline");if(t&&r)return t.baselines.getAt(parseInt(r.dataset.index))}template(e){const t=this,{baseline:r}=e,{task:n}=r;let{decimalPrecision:s}=t;null==s&&(s=t.client.durationDisplayPrecision);const i=Math.pow(10,s),o=Math.round(r.duration*i)/i;return`\n            <div class="b-gantt-task-title">${n.name} (baseline ${r.parentIndex+1})</div>\n            <table>\n            <tr><td>${t.L("L{TaskTooltip.Start}")}:</td><td>${e.startClockHtml}</td></tr>\n            ${r.milestone?"":`\n                <tr><td>${t.L("L{TaskTooltip.End}")}:</td><td>${e.endClockHtml}</td></tr>\n                <tr><td>${t.L("L{TaskTooltip.Duration}")}:</td><td class="b-right">${o+" "+je.getLocalizedNameOfUnit(r.durationUnit,1!==r.duration)}</td></tr>\n            `}\n            </table>\n            `}getTaskDOMConfig(e,t){const r=e.baselines.allRecords;return{className:"b-baseline-wrap",style:{flex:.5*r.length},dataset:{taskFeature:"baselines"},children:r.map((e,r)=>{const n=this.gantt.taskRendering.getTaskBox(e);return n?{className:e.cls+"b-task-baseline",style:{width:n.width,left:n.left-t+1},dataset:{index:r}}:null}),syncOptions:{syncIdField:"index"}}}onTaskDataGenerated({taskRecord:e,left:t,wrapperChildren:r}){!this.disabled&&e.hasBaselines&&r.push(this.getTaskDOMConfig(e,t))}}Yb._$name="Baselines",Va.registerFeature(Yb,!1,"Gantt");class qb extends gc{static get $name(){return"CellEdit"}async doAddNewAtEnd(){const e=this.grid,t=this.addNewAtEnd,r=e.taskStore,n=r.rootNode.appendChild(Object.assign({name:"New task",startDate:r.getProject().startDate},t));return await r.getProject().propagate(),e.rowManager.getRowFor(n)||e.rowManager.displayRecordAtBottom(),n}}qb._$name="CellEdit",Va.registerFeature(qb,!0,"Gantt");class Xb extends(br(Nn)){static get $name(){return"CriticalPaths"}static get defaultConfig(){return{cls:"b-gantt-critical-paths",criticalDependencyCls:"b-critical",disabled:!0}}static get pluginConfig(){return{chain:["onPaint"]}}doDisable(e){e?this.unhighlightCriticalPaths():this.highlightCriticalPaths(),super.doDisable(e)}onPaint(){this.client.project.on({commit:this.onProjectCommit,thisObj:this})}getDependenciesFeature(){return this.client.foregroundCanvas&&this.client.features.dependencies}highlightCriticalPaths(){const e=this,t=e.client,r=t.project,n=e.getDependenciesFeature();t.element.classList.contains(e.cls)&&e.unhighlightCriticalPaths(),n&&r.criticalPaths&&r.criticalPaths.forEach(t=>{t.forEach(t=>{t.dependency&&n.highlight(t.dependency,e.criticalDependencyCls)})}),t.element.classList.add(e.cls),t.trigger("criticalPathsHighlighted")}unhighlightCriticalPaths(){const e=this,t=e.client,r=t.project,n=e.getDependenciesFeature();n&&r.dependencyStore.forEach(t=>n.unhighlight(t,e.criticalDependencyCls)),t.element.classList.remove(e.cls),t.trigger("criticalPathsUnhighlighted")}onProjectCommit({records:e,changedAtoms:t}){const{project:r}=this.client;!this.disabled&&e.has(r)&&t.includes(r.$.criticalPaths)&&this.highlightCriticalPaths()}}Xb._$name="CriticalPaths",Va.registerFeature(Xb,!0,"Gantt");const Kb=["left","left","right","right"],Zb=["left","right","left","right"];class Jb extends uu{static get $name(){return"Dependencies"}static get defaultConfig(){return{terminalSides:["left","right"],storeClass:Ib,highlightDependenciesOnEventHover:!0}}construct(e,t={}){const r=this;e.isGantt&&(r.gantt=e),Object.prototype.hasOwnProperty.call(t,"pathFinderConfig")?(Object.prototype.hasOwnProperty.call(t.pathFinderConfig,"otherHorizontalMargin")||(t.pathFinderConfig.otherHorizontalMargin=0),Object.prototype.hasOwnProperty.call(t.pathFinderConfig,"otherVerticalMargin")||(t.pathFinderConfig.otherVerticalMargin=0)):t.pathFinderConfig={otherHorizontalMargin:0,otherVerticalMargin:0},super.construct(e,t)}getIteratableDependencyAssignments(e){return[null]}isDependencyVisible(e,t=null){const{client:r}=this,n=e.sourceTask,s=e.targetTask;if(n&&s&&Object(n)===n&&Object(s)===s)return n instanceof Ob&&!t?!n.placeHolder&&r.store.isAvailable(n)&&!s.placeHolder&&r.store.isAvailable(s):super.isDependencyVisible(e,t)}getBox(e,t,r=null){const n=this.getTimeSpanRecordFromDependency(e,t);return this.gantt?this.gantt.getTaskBox(n,!0,!0):n.isEvent||r?super.getBox(e,t,r):n.assignments.length?this.client.getResourceEventBox(n,n.assignments[0].resource,!0):null}getRowRecordFromDependency(e,t){if(!this.gantt){const r=this.getTimeSpanRecordFromDependency(e,t);return r.isEvent?super.getRowRecordFromDependency(e,t):r.assignments.length?r.assignments[0].resource:null}return this.getTimeSpanRecordFromDependency(e,t)}drawLine(e,t,r,n=null,s=!0){const i=super.drawLine(e,t,r,n,s),{client:o}=this,a=t.toEvent;(!a.milestone&&(a.endDate<=o.startDate||o.endDate<=a.startDate)||a.milestone&&(a.endDate<o.startDate||o.endDate<a.startDate))&&i.classList.add("b-sch-dependency-ends-outside")}prepareLineDef(e,t,r=null){const n=this,s=n.getTimeSpanRecordFromDependency(e,!0),i=n.getTimeSpanRecordFromDependency(e,!1),o=e.type,a=this.pathFinder.startArrowMargin;let l=e.fromSide,c=e.toSide;if(!l)switch(!0){case o===Nh.StartToEnd:case o===Nh.StartToStart:l=n.getConnectorStartSide(s);break;case o===Nh.EndToStart:case o===Nh.EndToEnd:l=n.getConnectorEndSide(s);break;default:throw new Error("Invalid dependency type: "+o)}if(!c)switch(!0){case o===Nh.StartToEnd:c=n.getConnectorEndSide(i);break;case o===Nh.StartToStart:case o===Nh.EndToStart:c=n.getConnectorStartSide(i);break;case o===Nh.EndToEnd:c=n.getConnectorEndSide(i);break;default:throw new Error("Invalid dependency type: "+o)}const{startRectangle:d,endRectangle:u}=t;o===Nh.EndToStart&&d.bottom<u.y&&Math.round(d.right)-Math.round(u.x)<=0&&(c="top",e.targetTask.milestone||(u.right=u.x+2*a));const h=n.client.getRecordCoords(s,!0),g=n.client.getRecordCoords(i,!0),m=[{start:d.x,end:d.right,top:h.y,bottom:h.y+h.height},{start:u.x,end:u.right,top:g.y,bottom:g.y+g.height}];return{endBox:{start:d.x,end:d.right,top:d.y,bottom:d.bottom},startBox:{start:u.x,end:u.right,top:u.y,bottom:u.bottom},endSide:l,startSide:c,boxesReversed:!0,otherBoxes:m}}drawForTask(e){this.drawForTimeSpan(e)}getHoverTipHtml({activeTarget:e}){const t=this.getDependencyForElement(e);if(!t)return null;const r=t.sourceTask,n=t.targetTask;return Cn.tpl`
             <table class="b-sch-dependency-tooltip">
                <tr>
                    <td>${this.L("L{Dependencies.from}")}: </td>
                    <td>${r.name} ${r.id}</td>
                    <td><div class="b-sch-box b-${Kb[t.type]}"></div></td>
                </tr>
                <tr>
                    <td>${this.L("L{Dependencies.to}")}: </td>
                    <td>${n.name} ${n.id}</td>
                    <td><div class="b-sch-box b-${Zb[t.type]}"></div></td>
                </tr>
            </table>
        `}createDependency(e){const t=this,r=e.source,n=e.target,s=e.sourceTerminal.dataset.side,i=e.targetTerminal.dataset.side,o=("left"===s?0:2)+("right"===i?1:0);t.store.add({fromEvent:r,toEvent:n,type:o,fromSide:s,toSide:i})&&t.store.getProject().propagate()}createMarkers(){super.createMarkers();const e=(this.startMarker||this.endMarker).cloneNode(!0);e.setAttribute("id","arrowEndCritical"),this.client.svgCanvas.appendChild(e)}}Jb._$name="Dependencies",Va.registerFeature(Jb,!0,"Gantt");class Qb extends gu{static get $name(){return"DependencyEdit"}static get defaultConfig(){return{showLagField:!0}}}Qb._$name="DependencyEdit",Va.registerFeature(Qb,!1);const eC=["top","left","right","bottom"],tC={top:"b-b",right:"l-l",bottom:"t-t",left:"r-r"},rC={top:1,bottom:1};class nC extends Nn{static get $name(){return"Labels"}static get defaultConfig(){return{labelCls:"b-sch-label",top:null,right:null,bottom:null,left:null,thisObj:null,blurAction:"cancel"}}static get pluginConfig(){return{}}construct(e,t){const r=this;if(e.isVertical)throw new Error("Labels feature is not supported in vertical mode");r.scheduler=e,r.labelElements={},super.construct(e,t);const{top:n,bottom:s,left:i,right:o}=r;(n||s||i||o)&&(r.schedulerDetatcher=e.on({eventpaint:"onEventPaint",eventrepaint:"onEventPaint",thisObj:r}),r.updateHostClasslist())}updateHostClasslist(){const{top:e,bottom:t}=this,{classList:r}=this.scheduler.element;r.remove("b-labels-topbottom"),r.remove("b-labels-top"),r.remove("b-labels-bottom"),(e||t)&&(r.add("b-labels-topbottom"),e&&r.add("b-labels-top"),t&&r.add("b-labels-bottom"))}onLabelDblClick(e){const t=this,r=e.target;if(r&&!t.scheduler.readOnly){const{side:n}=r.dataset,s=t[n],{editor:i,field:o,recordType:a}=s;if(i){const a=this.scheduler.resolveEventRecord(e.target);return i instanceof Bs||(s.editor=new Bs({appendTo:t.scheduler.element,blurAction:t.blurAction,inputField:i,scrollAction:"realign"})),s.editor.startEdit({target:r,align:tC[n],matchSize:!1,record:a,field:o}),e.stopImmediatePropagation(),!1}}}set top(e){this._top=this.processLabelSpec(e,"top"),this.updateHostClasslist()}get top(){return this._top}set right(e){this._right=this.processLabelSpec(e,"right"),this.updateHostClasslist()}get right(){return this._right}set bottom(e){this._bottom=this.processLabelSpec(e,"bottom"),this.updateHostClasslist()}get bottom(){return this._bottom}set left(e){this._left=this.processLabelSpec(e,"left"),this.updateHostClasslist()}get left(){return this._left}processLabelSpec(e,t){if("function"==typeof e)e={renderer:e};else if("string"==typeof e)e={field:e};else{if(!e)return;e=Object.setPrototypeOf({},e)}const{scheduler:r}=this,{eventStore:n,resourceStore:s,taskStore:i,id:o}=r,{field:a,editor:l}=e;if(rC[t]&&(r.milestoneWidth=null),a){let t;n&&!i&&(t=n.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="event"):Reflect.has(n.modelClass.prototype,a)&&(e.recordType="event")),!t&&i&&(t=i.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="task"):Reflect.has(s.modelClass.prototype,a)&&(e.recordType="task")),!t&&s&&(t=s.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="resource"):Reflect.has(s.modelClass.prototype,a)&&(e.recordType="resource")),l&&("boolean"==typeof l?r.editor={type:"textfield"}:"string"==typeof l&&(r.editor={type:l}),gr.on({element:r.timeAxisSubGrid.element,delegate:".b-sch-label",dblclick:"onLabelDblClick",thisObj:this}))}return e}doDestroy(){this.schedulerDetatcher&&this.schedulerDetatcher(),super.doDestroy()}doDisable(e){super.doDisable(e),this.client.isPainted&&this.client.refresh()}onEventPaint(e){if(Et.removeEachSelector(e.element,".b-sch-label"),!this.disabled)for(const t of eC)this[t]&&this.appendLabel(t,e.element,e)}appendLabel(e,t,r){this.labelElements[e]=Et.createElement({tag:"label",dataset:{side:e},parent:t}),this.updateLabel(e,r)}updateLabel(e,t){const r=this,{field:n,fieldDef:s,recordType:i,renderer:o,thisObj:a}=r[e],l=r.labelElements[e];let c;l.className=`${r.labelCls} ${r.labelCls}-${e}`,o?c=o.call(a||r.thisObj||r,Object.assign({labelElement:l},t)):(c=t[i+"Record"][n],s&&"date"===s.type&&!o&&(c=je.format(c,r.scheduler.displayDateFormat))),l.innerHTML=c||"Â "}}nC.featureClass="b-sch-labels",nC._$name="Labels",Va.registerFeature(nC,!1,"Scheduler");const sC=["top","left","right","bottom"];class iC extends nC{static get $name(){return"Labels"}construct(e,t){super.construct(e,t)}static get pluginConfig(){return{chain:["onTaskDataGenerated"]}}onTaskDataGenerated(e){const t=this;if(!t.disabled)for(const r of sC)if(t[r]){const{field:n,fieldDef:s,recordType:i,renderer:o,thisObj:a}=t[r];let l;o?l=o.call(a||t.thisObj||t,e):(l=e[i+"Record"][n],s&&"date"===s.type&&!o&&(l=je.format(l,t.client.displayDateFormat))),e.wrapperChildren.push({tag:"label",className:`${t.labelCls} ${t.labelCls}-${r}`,dataset:{side:r,taskFeature:"label-"+r},html:l||"Â "})}}}iC._$name="Labels",Va.registerFeature(iC,!1,"Gantt");class oC extends Kd{static get $name(){return"Indicators"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",forSelector:".b-indicator",recordType:"indicator",hoverDelay:500,defaultIndicators:{earlyDates:e=>e.earlyStartDate&&!e.isMilestone?{startDate:e.earlyStartDate,endDate:e.earlyEndDate,cls:"b-bottom b-early-dates",name:this.L("L{earlyDates}")}:null,lateDates:e=>e.lateStartDate&&!e.isMilestone?{startDate:e.lateStartDate,endDate:e.lateEndDate,cls:"b-bottom b-late-dates",name:this.L("L{lateDates}")}:null,constraintDate:e=>e.constraintDate?{startDate:e.constraintDate,cls:"b-bottom b-constraint-date b-constraint-type-"+e.constraintType,name:this.L(`L{ConstraintTypePicker.${e.constraintType}}`)}:null,deadlineDate:e=>e.deadlineDate?{startDate:e.deadlineDate,cls:"b-bottom b-deadline-date",name:this.L("L{deadlineDate}")}:null},items:{}}}static get pluginConfig(){return{chain:["onTaskDataGenerated","render"]}}construct(e,t={}){this.tipId=e.id+"-indicators-tip",this.gantt=e;const{items:r}=t;delete t.items,super.construct(e,t),this.items=r}set items(e){const t=this;t._indicators=ze.assign({},t.defaultIndicators,e),t._indicatorAccessors={},t._indicatorStatus={};for(const e in t._indicators)t._indicatorStatus[e]=Boolean(t._indicators[e]),"function"!=typeof t._indicators[e]&&(t._indicators[e]=t.defaultIndicators[e]),Object.defineProperty(t._indicatorAccessors,e,{enumerable:!0,get:()=>!!t._indicatorStatus[e]&&t._indicators[e],set(r){t._indicatorStatus[e]=r,t.gantt.refresh()}})}get items(){return this._indicatorAccessors}createIndicatorDOMConfig(e,t){const{gantt:r,renderData:n}=this,{cls:s,iconCls:i}=e,o=r.getCoordinateFromDate(e.startDate),a=e.endDate?r.getCoordinateFromDate(e.endDate)-o:null,l=s&&s.isDomClassList?s:new Ve(s);return{className:Object.assign(l,{"b-indicator":1,"b-has-icon":e.iconCls}),style:{transform:`translate(${o}px, ${n.top}px)`,height:n.height,width:a,style:e.style},dataset:{taskId:`${n.taskId}-indicator-${t}`,title:e.name},children:[i?{tag:"i",className:i}:null],elementData:e}}onTaskDataGenerated(e){const{items:t}=this,r=[];for(const n in t){const s=t[n];if(this._indicatorStatus[n]&&"function"==typeof s){const t=s(e.taskRecord);t&&this.gantt.timeAxis.timeSpanInAxis(t.startDate,t.endDate)&&r.push(t)}}e.extraConfigs.push(...r.map(this.createIndicatorDOMConfig,{gantt:this.gantt,renderData:e}))}resolveTimeSpanRecord(e){return e.lastDomConfig.elementData}template(e){const{indicator:t}=e;return e.endDate?`\n                ${t.name?`<div class="b-gantt-task-title">${t.name}</div>`:""}\n                <table border="0" cellspacing="0" cellpadding="0">\n                    <tr><td>${this.L("L{Start}")}:</td><td>${e.startClockHtml}</td></tr>\n                    <tr><td>${this.L("L{End}")}:</td><td>${e.endClockHtml}</td></tr>\n                </table>\n            `:`\n            ${t.name?`<div class="b-gantt-task-title">${t.name}</div>`:""}\n            ${e.startText}\n        `}}oC._$name="Indicators",Va.registerFeature(oC,!1);class aC extends Nn{static get $name(){return"PercentBar"}static get defaultConfig(){return{allowResize:!0}}static get pluginConfig(){return{chain:["onPaint","onTaskDataGenerated"]}}onPaint(){const e=this,t=e.client;e.resize&&e.resize.destroy(),e.resize=new No({name:"percentBarResize",outerElement:t.timeAxisSubGridElement,targetSelector:".b-gantt-task-percent",handleSelector:".b-gantt-task-percent-handle",allowResize:e.isResizable.bind(e),dragThreshold:0,listeners:{resizeStart:e.onResizeStart,resizing:e.onResizing,resize:e.onFinishResize,cancel:e.onCancelResize,thisObj:e}})}get allowResize(){return this._allowResize}set allowResize(e){this._allowResize=e,this.client.element.classList[e?"remove":"add"]("b-percentbar-drag-disabled")}doDestroy(){this.resize&&this.resize.destroy(),super.doDestroy()}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}isResizable(e){return this.allowResize&&!e.closest(".b-gantt-task-parent")}cleanup(e){const t=this.client;e.element.closest(t.eventSelector).classList.remove("b-gantt-task-percent-resizing"),t.element.classList.remove("b-gantt-resizing-task-percent")}onTaskDataGenerated(e){const{task:t,children:r}=e;t.milestone||this.disabled||r.unshift({className:"b-gantt-task-percent",dataset:{percent:Math.round(t.percentDone),taskBarFeature:"percentBar"},style:{width:t.percentDone+"%"},children:[{className:"b-gantt-task-percent-handle"}]})}onResizeStart({context:e}){e.element.closest(this.client.eventSelector).classList.add("b-gantt-task-percent-resizing"),this.client.element.classList.add("b-gantt-resizing-task-percent")}onResizing({context:e}){const t=e.element,r=t.closest(this.client.eventSelector),n=1===t.offsetWidth?0:t.offsetWidth;t.dataset.percent=Math.min(100,Math.round(100*n/r.offsetWidth))}onFinishResize({context:e}){const t=this.client,r=e.element,n=t.resolveTaskRecord(r);this.cleanup(e),n.setPercentDone(parseInt(r.dataset.percent))}onCancelResize({context:e}){this.cleanup(e)}}aC._$name="PercentBar",Va.registerFeature(aC,!0,"Gantt");class lC extends(br(Nn)){static get $name(){return"ProgressLine"}static get defaultConfig(){return{statusDate:new Date,drawLineOnlyWhenStatusDateVisible:!1,lineCls:"b-gantt-progress-line",containerCls:"b-progress-line-canvas"}}static get pluginConfig(){return{chain:["onPaint"]}}construct(e,t={}){const r=this;r.scheduleDraw=r.createOnFrame("draw",[],r,!0),super.construct(e,t),this.lineSegments=[],e.store.on({refresh:r.onRowStoreRefresh,thisObj:r}),e.rowManager.on({translaterow:r.onTranslateRow,refresh:r.scheduleDraw,rerender:r.scheduleDraw,changetotalheight:r.scheduleDraw,thisObj:r}),e.on({horizontalscroll:r.scheduleDraw,togglenode:r.scheduleDraw,taskdrag:r.onTaskDrag,taskdragabort:r.scheduleDraw,aftertaskdrop:r.scheduleDraw,timelineviewportresize:r.scheduleDraw,thisObj:r})}doDisable(e){this.client.rendered&&this.draw(),super.doDisable(e)}get statusDate(){return this._statusDate}set statusDate(e){e instanceof Date&&(this._statusDate=e,this.scheduleDraw())}getSVGCanvas(){const e=this,{client:t}=e;if(!e._svgCanvas){const r=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");r.retainElement=!0,r.classList.add(e.containerCls),t.foregroundCanvas.appendChild(r)}return e._svgCanvas}onPaint(){this.client.taskStore.on({change:this.scheduleDraw,thisObj:this})}onRowStoreRefresh({action:e}){switch(e){case"sort":case"filter":this.scheduleDraw()}}onTranslateRow({row:e}){e.lastTop>=0&&e.top!==e.lastTop&&this.scheduleDraw()}onTaskDrag({taskRecords:e,dragData:t}){e.forEach(e=>{this.updateLineForTask(e,{[e.id]:je.add(e.startDate,t.timeDiff)})})}shouldDrawProgressLine(){return!this.client.timeAxisSubGrid.collapsed&&!this.disabled&&(!this.drawLineOnlyWhenStatusDateVisible||this.client.timeAxis.dateInAxis(this.statusDate))}getStatusDateX(){let{client:e}=this,t=this.statusDate;return e.timeAxis.dateInAxis(t)||(t=t<e.timeAxis.startDate?e.timeAxis.startDate:e.timeAxis.endDate),e.getCoordinateFromDate(t)}getRenderData(){const e=this.getStatusDateX(),t=this.client.timeAxisSubGridElement.getBoundingClientRect();return{statusDateX:e,viewXY:[this.client.scrollLeft-t.left,-t.top]}}draw(){const e=this,{client:t}=e;if(e.lineSegments.forEach(e=>e.remove()),e.lineSegments=[],!e.shouldDrawProgressLine())return;if(t.isAnimating)return void t.on({transitionend(){e.scheduleDraw()},once:!0});const r=e.getRenderData(),n=[];t.rowManager.forEach(t=>{n.push(...e.getLineSegmentRenderData(t,r))}),n.forEach(t=>e.drawLineSegment(t)),t.trigger("progressLineDrawn")}updateLineForTask(e,t){const r=this;if(r.disabled)return;const n=r.client.getRowFor(e);if(n){const s=[];r.lineSegments.forEach(t=>{t.dataset.taskId==e.id&&(s.push(t),t.remove())}),z.remove(r.lineSegments,...s),r.getLineSegmentRenderData(n,r.getRenderData(),t).forEach(e=>r.drawLineSegment(e))}}getLineSegmentRenderData(e,t,r={}){const n=this,{statusDateX:s,viewXY:i}=t,o=n.client.getRecordFromElement(e.elements.normal),a=o.id;let l,c=[];return n.isStatusLineTask(o,r[o.id])&&(l=n.calculateCoordinateForTask(o,i),l&&c.push({dataset:{taskId:a},x1:s,y1:e.top,x2:l.x,y2:l.y},{dataset:{taskId:a},x1:l.x,y1:l.y,x2:s,y2:e.bottom})),l||c.push({dataset:{taskId:a},x1:s,y1:e.top,x2:s,y2:e.bottom}),c}drawLineSegment(e){this.lineSegments.push(Et.createElement(Object.assign({tag:"line",ns:"http://www.w3.org/2000/svg",class:this.lineCls,parent:this.getSVGCanvas()},e)))}isStatusLineTask(e,t){const r=this.statusDate;return t=t||e.startDate,e&&this.client.timeAxis.isTimeSpanInAxis(e)&&!e.milestone&&(e.isInProgress||!e.isStarted&&t<r||e.isCompleted&&t>r)}calculateCoordinateForTask(e,t){const{client:r}=this,n=r.getElementFromTaskRecord(e),s=null==n?void 0:n.querySelector(".b-gantt-task-percent");if(s){const e=s.getBoundingClientRect(),n=r.timeAxisViewModel.totalSize;return{x:Math.min(e.right+t[0],n),y:e.top+e.height/2+t[1]}}}}lC._$name="ProgressLine",Va.registerFeature(lC);class cC extends eu{static get $name(){return"ProjectLines"}static get defaultConfig(){return{showHeaderElements:!0,cls:"b-gantt-project-line"}}startConfigure(){}onPaint(){const e=this;[e.startDateLine,e.endDateLine]=e.store.add([{name:e.L("L{Project Start}")},{name:e.L("L{Project End}")}]),e.updateDateFromProject(),e.client.project.taskStore.on({update:e.onProjectTaskStoreRecordUpdate,refresh:e.onProjectTaskStoreRefresh,thisObj:e}),super.onPaint()}updateLocalization(){const e=this;e.client.rendered&&(e.startDateLine.name=e.L("L{Project Start}"),e.endDateLine.name=e.L("L{Project End}"))}updateDateFromProject(){const e=this.client.project;this.startDateLine.startDate=e.startDate,this.endDateLine.startDate=e.endDate}onProjectTaskStoreRecordUpdate({record:e}){e===this.client.project&&this.updateDateFromProject()}onProjectTaskStoreRefresh(e){this.updateDateFromProject()}}cC._$name="ProjectLines",Va.registerFeature(cC,!0,"Gantt");class dC extends Kd{static get $name(){return"Rollups"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:".b-task-rollup"}}static get pluginConfig(){return{chain:["onTaskDataGenerated","render"]}}construct(e,t){this.tipId=e.id+"-rollups-tip",super.construct(e,t),this.storeDetacher=e.taskStore.on({update:"onStoreUpdateRecord",thisObj:this})}doDestroy(){this.storeDetacher&&this.storeDetacher(),super.doDestroy()}doDisable(e){const t=this,{dependencies:r}=t.client.features;t.tooltip&&(t.tooltip.disabled=e),t.client.refresh(),r&&t.client.setTimeout(()=>r.scheduleDraw(!0),300),super.doDisable(e)}getTipHtml({activeTarget:e,event:t}){const{client:r}=this,n=r.resolveTaskRecord(e),s=P.isEdge||P.isIE11,i=document[s?"msElementsFromPoint":"elementsFromPoint"](t.pageX+window.pageXOffset,t.pageY+window.pageYOffset),o=Array.from(i).filter(e=>e.classList.contains("b-task-rollup")).sort((e,t)=>parseInt(e.dataset.index,10)-parseInt(t.dataset.index,10)),a=[];for(const e of o)a.push(n.children[parseInt(e.dataset.index,10)]);return this.template({task:n,children:a})}template({children:e}){const t=this,{client:r}=t,n=[];return e.map((e,s)=>{const{startDate:i,endDate:o}=e,a=r.getFormattedDate(i),l=r.getDisplayEndDate(o,i),c=r.getFormattedDate(l);n.push(`<div class="b-gantt-task-title ${s?"b-follow-on":""}">${e.name}</div><table>`,`<tr><td>${t.L("L{TaskTooltip.Start}")}:</td><td>${t.clockTemplate.template({date:i,text:a,cls:"b-sch-tooltip-startdate"})}</td></tr>`,`<tr><td>${t.L("L{TaskTooltip.End}")}:</td><td>${e.isMilestone?"":t.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})}</td></tr></table>`)}),n.join("")}onStoreUpdateRecord({record:e,changes:t}){e.parent&&(t.rollup||t.startDate||t.endDate)&&this.client.taskRendering.redraw(e.parent)}onTaskDataGenerated({taskRecord:e,left:t,wrapperChildren:r}){if(!this.disabled&&e.isParent){const n=e.children.slice().sort((e,t)=>t.durationMS-e.durationMS);r.push({className:"b-task-rollup-wrap",dataset:{taskFeature:"rollups"},children:n.map(e=>{if(e.rollup){const r=this.client.getSizeAndPosition(e);if(!r)return null;const{position:n,width:s}=r;return{dataset:{index:e.parentIndex,rollupTaskId:e.id},className:`b-task-rollup ${e.isMilestone?"b-milestone":""} ${e.cls}`,style:{width:e.isMilestone?null:s,left:n-t}}}return null}),syncOptions:{syncIdField:"rollupTaskId"}})}}}dC._$name="Rollups",Va.registerFeature(dC,!1,"Gantt");class uC extends md{static get $name(){return"TaskContextMenu"}static get defaultConfig(){return{defaultItems:{add:!0,indent:!0,outdent:!0,deleteTask:!0}}}construct(e,t){e.showRemoveRowInContextMenu=!1,e.features.contextMenu&&(e.features.contextMenu.disableCellContextMenu=!0),super.construct(e,t)}resolveRecord(e){return this.client.resolveTaskRecord(e)||this.client.getRecordFromElement(e)}showContextMenuFor(e,{targetElement:t,eventElement:r,event:n}={}){const{client:s}=this;if(e&&(t||(t=s.getElementFromTaskRecord(e)))){if(n){const e=s.getEventData(n);if(!e)return;const t=s.columns.getById(e.columnId);if(!r&&t&&!t.enableCellContextMenu)return}this.showContextMenu({menuType:"task",taskElement:t,targetElement:t,taskRecord:e,event:n})}}beforeContextMenuShow(e){const{taskRecord:t,items:r,namedItems:n,selection:s}=e,i=(e.selectionIncludesContextTask=s.includes(t))&&s.length>1;r.editTask&&(r.editTask.hidden=i),n.add.hidden=i,n.addTaskAbove.hidden=i,n.addTaskBelow.hidden=i,n.milestone.hidden=i,n.subtask.hidden=i,n.successor.hidden=i,n.predecessor.hidden=i,n.convertToMilestone.hidden=i,n.predecessor.disabled=!t.previousSibling,n.outdent.disabled=t.parent===this.client.taskStore.rootNode}get namedItems(){const e=this,{client:t}=e;if(!e._namedItems){(e._namedItems={addTaskAbove:{text:t.L("L{Gantt.Task above}"),icon:"b-icon-up",onItem:({taskRecord:e})=>{t.addTaskAbove(e)}},addTaskBelow:{text:t.L("L{Gantt.Task below}"),icon:"b-icon-down",onItem:({taskRecord:e})=>{t.addTaskBelow(e)}},milestone:{text:t.L("L{Gantt.Milestone}"),icon:"b-fa-flag",name:"milestone",onItem:({taskRecord:e})=>{t.addMilestonBelow(e)}},subtask:{text:t.L("L{Gantt.Sub-task}"),name:"subtask",onItem:({taskRecord:e})=>{t.addSubtask(e)}},successor:{text:t.L("L{Gantt.Successor}"),onItem:({taskRecord:e})=>{t.addSuccessor(e)}},predecessor:{text:t.L("L{Gantt.Predecessor}"),name:"predecessor",onItem:({taskRecord:e})=>{t.addPredecessor(e)}},deleteTask:{text:t.L("L{Gantt.Delete task}"),icon:"b-icon-trash",name:"deleteTask",onItem:({selectionIncludesContextTask:e,selection:r,taskRecord:n})=>{t.taskStore.remove(e?r:n)}},convertToMilestone:{text:t.L("L{Gantt.Convert to milestone}"),onItem:({taskRecord:e})=>{e.convertToMilestone()}},indent:{text:t.L("L{Gantt.Indent}"),icon:"b-fa-indent",onItem:({selectionIncludesContextTask:e,selection:r,taskRecord:n})=>{t.indent(e?r:n)}},outdent:{text:t.L("L{Gantt.Outdent}"),icon:"b-fa-outdent",onItem:({selectionIncludesContextTask:e,selection:r,taskRecord:n})=>{t.outdent(e?r:n)}}}).add={text:t.L("L{Gantt.Add}"),icon:"b-icon-add",menu:{items:{addTaskAbove:!0,addTaskBelow:!0,milestone:!0,subtask:!0,successor:!0,predecessor:!0}}}}return e._namedItems}}uC.featureClass="",uC._$name="TaskContextMenu",Va.registerFeature(uC,!0,"Gantt");class hC extends fg{static get $name(){return"TaskEditor"}static get defaultConfig(){return{cls:"b-gantt-taskeditor b-schedulerpro-taskeditor"}}}hC._$name="TaskEditor";class gC extends dy{static get $name(){return"TaskEdit"}static get defaultConfig(){return{triggerEvent:"taskdblclick",saveAndCloseOnEnter:!0,tabsConfig:null,editorClass:hC}}static get pluginConfig(){return{chain:["getTaskMenuItems","onTaskEnterKey"],assign:["editTask"]}}editTask(e,t){return this.editEvent(e,null,t)}onActivateEditor({taskRecord:e,taskElement:t}){this.editTask(e,t)}getElementFromTaskRecord(e){return this.client.getElementFromTaskRecord(e)}onTaskEnterKey({taskRecord:e}){this.editTask(e)}getTaskMenuItems({taskRecord:e,items:t}){this.client.readOnly||(t.editTask={text:this.client.L("L{Gantt.Edit}"),icon:"b-icon b-icon-edit",weight:-200,disabled:this.disabled,onItem:()=>this.editTask(e)})}onEventEnterKey({taskRecord:e,target:t}){this.editTask(e)}scrollTaskIntoView(e){this.scrollEventIntoView(e)}scrollEventIntoView(e){this.client.scrollTaskIntoView(e)}}gC._$name="TaskEdit",Va.registerFeature(gC,!0,"Gantt");class mC extends Kd{static get $name(){return"TaskTooltip"}static get defaultConfig(){return{template(e){const t=this,{taskRecord:r}=e;let{decimalPrecision:n}=t;null==n&&(n=t.client.durationDisplayPrecision);const s=Math.pow(10,n),i=Math.round(r.duration*s)/s;return`\n                    ${r.name?`<div class="b-gantt-task-title">${r.name}</div>`:""}\n                    <table border="0" cellspacing="0" cellpadding="0">\n                    <tr><td>${t.L("L{Start}")}:</td><td>${e.startClockHtml}</td></tr>\n                    ${r.milestone?"":`\n                        <tr><td>${t.L("L{End}")}:</td><td>${e.endClockHtml}</td></tr>\n                        <tr><td>${t.L("L{Duration}")}:</td><td class="b-right">${i+" "+je.getLocalizedNameOfUnit(r.durationUnit,1!==r.duration)}</td></tr>\n                        <tr><td>${t.L("L{Complete}")}:</td><td class="b-right">${r.renderedPercentDone}%</td></tr>\n                    `}\n                    </table>\n                `},decimalPrecision:null,cls:"b-gantt-task-tooltip"}}}mC._$name="TaskTooltip",Va.registerFeature(mC,!0,"Gantt");var pC=e=>class extends e{async prepareComponent(e){await super.prepareComponent(e);const t=this.element.querySelector(".b-sch-foreground-canvas");Et.removeEachSelector(t,".b-gantt-task-wrap"),Et.removeEachSelector(t,".b-released")}collectEvents(e,t){const r=e.length,{client:n}=t,s=this.exportMeta.subGrids.normal.rows;e.forEach((e,t)=>{const i=s[s.length-r+t],o=n.store.getAt(e.dataIndex),a=i[3];if(o.isScheduled){const e=n.getElementFromTaskRecord(o,!1);e&&!a.has(o.id)&&a.set(o.id,[e.outerHTML,Xt.from(e,e.offsetParent)])}})}};class fC extends(pC(kh)){}fC._$name="MultiPageExporter";class vC extends(pC(Ih)){}vC._$name="MultiPageVerticalExporter";class yC extends(pC(Fh)){}yC._$name="SinglePageExporter";class bC extends Ah{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[yC,fC,vC]}}}bC._$name="PdfExport",Va.registerFeature(bC,!1,"Gantt");class CC extends gy{}CC._$name="SubProjectModel";class wC extends my{}wC._$name="TaskSegmentModel";const SC=new Date,DC=new Date(SC.getFullYear(),0,1),EC=new Bo;function xC(e,t){return parseInt(""+e+t)}class TC{static generateAsync(e,t,r=null,n=DC){const s={startDate:n,tasksData:[],dependenciesData:[]},i=Math.ceil(e/10),o=Math.ceil(t/10),a=this.generateBlocks(i,o,s.startDate);let l=0,c=0,d=0;return new Promise(e=>{!function t(){for(let t=0;t<100;t++){const t=a.next();if(t.done)return r&&r(c,d,!0),s.endDate=je.add(s.startDate,Math.max(l,30),"days"),e(s);{const e=t.value;s.tasksData.push(...e.tasksData),s.dependenciesData.push(...e.dependenciesData),e.projectDuration&&(l=Math.max(e.projectDuration,l)),c+=e.taskCount,d+=e.dependencyCount}}r&&r(c,d,!1),setTimeout(t,0)}()})}static*generateBlocks(e,t,r){let n=1,s=1,i=0,o=0;function a(e=!0){const t=EC.nextRandom(5)+2;return e&&(o+=t),t}for(let l=0;l<e;l++){const e=n,c={tasksData:[{id:n++,name:"Parent "+e,startDate:r,expanded:!0,children:[{id:n++,name:"Sub-parent "+xC(e,1),startDate:r,expanded:!0,children:[{id:n++,name:"Task "+xC(e,11),startDate:r,duration:a(),percentDone:EC.nextRandom(100)},{id:n++,name:"Task "+xC(e,12),startDate:r,duration:a(),percentDone:EC.nextRandom(100)},{id:n++,name:"Task "+xC(e,13),startDate:r,duration:a(),percentDone:EC.nextRandom(100)},{id:n++,name:"Task "+xC(e,14),startDate:r,duration:a(),percentDone:EC.nextRandom(100)}]},{id:n++,name:"Sub-parent "+xC(e,2),startDate:r,expanded:!0,children:[{id:n++,name:"Task "+xC(e,21),startDate:r,duration:a(),percentDone:EC.nextRandom(100)},{id:n++,name:"Task "+xC(e,22),startDate:r,duration:a(),percentDone:EC.nextRandom(100)},{id:n++,name:"Task "+xC(e,23),startDate:r,duration:a(),percentDone:EC.nextRandom(100)}]}]}],dependenciesData:[{id:s++,fromEvent:e+2,toEvent:e+3},{id:s++,fromEvent:e+3,toEvent:e+4},{id:s++,fromEvent:e+4,toEvent:e+5},{id:s++,fromEvent:e+5,toEvent:e+7},{id:s++,fromEvent:e+7,toEvent:e+8},{id:s++,fromEvent:e+8,toEvent:e+9}],taskCount:10,dependencyCount:5};i+=o,o=0,c.projectDuration=i,l%t!=0?(c.dependenciesData.push({id:s++,fromEvent:e-2,toEvent:e+2}),c.dependencyCount++):i=0,n++,yield c}}}TC._$name="ProjectGenerator";const RC={releaseElement:1,reuseElement:1},MC={newElement:1,reuseOwnElement:1,reuseElement:1};class kC extends B{static get properties(){return{rowMap:new Map}}construct(e){this.gantt=e,e.rowManager.on({renderDone:"onRenderDone",removeRows:"onRemoveRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:this}),super.construct({})}init(){}bindTaskStore(){}refreshRows(){}onTimeAxisViewModelUpdate(){this.updateFromHorizontalScroll(this.gantt.timeAxisSubGrid.scrollable.x)}onViewportResize(){}onDragAbort(){}onBeforeRowHeightChange(e){const{gantt:t}=this;t.foregroundCanvas&&(t.foregroundCanvas.style.fontSize=(e&&e.height||t.rowHeight)-2*t.resourceMargin+"px")}get visibleDateRange(){return this._visibleDateRange}getVisibleDateRange(){return this.visibleDateRange}getTaskBox(e,t=!1,r=!1){const{gantt:n}=this;if(r){const t=this.getElementFromTaskRecord(e);if(t)return Xt.from(t,n.timeAxisSubGridElement)}if(!e.startDate||e.isTask&&!n.taskStore.isAvailable(e))return null;const s=this.getSizeAndPosition(e,t);if(!s)return null;const{position:i,width:o}=s,a=n.taskStore.indexOf(e)*n.rowManager.rowOffsetHeight+n.resourceMargin,l=n.rowHeight-2*n.resourceMargin;return new Xt(i,a,o,l)}getSizeAndPosition(e,t){const{gantt:r}=this,{timeAxis:n}=r,s=n.startDate,i=n.endDate,o=e.startDate,a=e.endDate||(null!=e.duration?je.add(o,e.duration,e.durationUnit):null),l=e.milestone,c=l?r.features.dependencies.pathFinder.startArrowMargin:0;let d,u;if(!t&&(a<s||o>i))return null;if(t&&o<s)d=r.getCoordinateFromDate(s)-c;else if(t&&o>i)d=r.getCoordinateFromDate(i)+c;else if(o<s){const t=r.timeAxisViewModel.getSingleUnitInPixels("second"),i=(n.startMS-e.startDateMS)/1e3*t;d=r.getCoordinateFromDate(s)-i}else d=r.getCoordinateFromDate(o);if(!l)if(t&&a<s)u=r.getCoordinateFromDate(s)-c;else if(t&&a>i)u=r.getCoordinateFromDate(i)+c;else if(a>i){const t=r.timeAxisViewModel.getSingleUnitInPixels("second"),s=(e.endDateMS-n.endMS)/1e3*t;u=r.getCoordinateFromDate(i)+s}else u=r.getCoordinateFromDate(a);const h=l?0:u-d;return!t&&d+h<0?null:{position:d,width:h}}getRowRegion(e,t,r){const{gantt:n}=this,s=n.getRowFor(e);if(!s)return null;const i=s.getElement(n.timeAxisSubGrid.region),o=n.timeAxis.startDate,a=n.timeAxis.endDate,l=t?je.max(o,t):o,c=r?je.min(a,r):a,d=n.getCoordinateFromDate(l),u=n.getCoordinateFromDate(c,!0,!0),h=s.top+n.scrollTop,g=Math.min(d,u),m=h+i.offsetHeight;return new Xt(g,h,Math.max(d,u)-g,m-h)}getDateFromXY(e,t,r){let n=e[0];return r||(n=this.translateToScheduleCoordinate(n)),this.gantt.timeAxisViewModel.getDateFromPosition(n,t)}translateToScheduleCoordinate(e){return e-this.gantt.timeAxisSubGridElement.getBoundingClientRect().left+this.gantt.scrollLeft}translateToPageCoordinate(e){const t=this.gantt.timeAxisSubGridElement;return e+t.getBoundingClientRect().left-t.scrollLeft}getElementFromTaskRecord(e,t=!0){const r=this.gantt.rowManager.getRowFor(e);if(r&&this.rowMap.has(r)){const e=this.rowMap.get(r)[0]._element;if(e)return t?e.syncIdMap.task:e}return null}getConnectorStartSide(e){return"left"}getConnectorEndSide(e){return"right"}onRemoveRows({rows:e}){e.forEach(e=>this.rowMap.delete(e)),this.onRenderDone()}updateFromHorizontalScroll(e){const{gantt:t}=this,r=t.timeAxisSubGrid.width,n=t.getDateFromX(Math.max(0,e-100)),s=t.getDateFromX(e+r+100)||t.endDate,i=t.getDateFromX(e),o=t.getDateFromX(e+r)||t.endDate;this._visibleDateRange={startDate:i,endDate:o},this.gantt.timeView.range={startDate:n,endDate:s}}populateTaskRenderData(e,t){const{gantt:r}=this,n=!(!r.features.baselines||!r.features.baselines.disabled),s={className:"b-gantt-task-content",dataset:{taskBarFeature:"content"},children:[]};if(e){let i=void 0===t.isResizable||t.isResizable;e.startsOutsideView&&(!0===i?i="end":"start"===i&&(i=!1)),e.endsOutsideView&&(!0===i?i="start":"end"===i&&(i=!1)),Object.assign(e,{iconCls:new Ve(t.taskIconCls),id:r.getEventRenderId(t),style:t.style||"",taskId:t.id,wrapperCls:new Ve({[r.eventCls+"-wrap"]:1,[r.eventCls+"-parent"]:t.isParent,"b-milestone-wrap":t.milestone,"b-has-baselines":t.hasBaselines&&!n}),cls:t.isResourceTimeRange?new Ve:t.cls.clone(),extraConfigs:[]}),Object.assign(e.cls,{[r.eventCls]:1,[r.generatedIdCls]:t.hasGeneratedId,[r.dirtyCls]:t.modifications,[r.committingCls]:t.isCommitting,[r.endsOutsideViewCls]:e.endsOutsideView,[r.startsOutsideViewCls]:e.startsOutsideView,[r.fixedEventCls]:!1===t.isDraggable,["b-sch-event-resizable-"+i]:1,"b-milestone":t.milestone,"b-critical":t.critical,"b-task-started":t.percentDone>0,"b-task-finished":t.isCompleted,"b-task-selected":r.selectedRecords.includes(t)});const o=t.eventStyle||r.eventStyle,a=t.eventColor||r.eventColor;if(e.eventColor=a,e.eventStyle=o,r.taskRenderer){const n=r.taskRenderer.call(r.taskRendererThisObj||r,{taskRecord:t,tplData:e,renderData:e});"string"==typeof e.cls&&(e.cls=new Ve(e.cls)),"string"==typeof e.iconCls&&(e.iconCls=new Ve(e.iconCls)),"string"==typeof e.wrapperCls&&(e.wrapperCls=new Ve(e.wrapperCls));let i=null;"string"==typeof n&&n.includes("<")?i={html:n}:"string"==typeof n||"object"==typeof n?i=n:null!=n&&(i=String(n)),i&&(s.children.push(i),e.cls.add("b-has-content"))}e.cls["b-sch-event-withicon"]=e.iconCls.length,e.wrapperCls["b-sch-style-"+e.eventStyle]=e.eventStyle,e.eventColor&&e.eventColor.startsWith("#")?e.style=`background-color:${e.eventColor};`+e.style:e.wrapperCls["b-sch-color-"+e.eventColor]=e.eventColor,e.iconCls&&e.iconCls.length&&s.children.unshift({tag:"i",className:e.iconCls}),s.children.length&&e.children.push(s)}e.taskContent=s,e.wrapperChildren=[],r.onTaskDataGenerated(e)}renderer({row:e,record:t}){const r=this,n=r.getTaskBox(t);if(!n)return void r.rowMap.delete(e);const s={top:n.top,left:n.left,width:n.width,height:n.height,taskRecord:t,task:t,row:e,children:[]};r.populateTaskRenderData(s,t);const i={className:s.wrapperCls,tabIndex:"0",children:[{className:s.cls,style:(s.internalStyle||"")+(s.style||""),children:s.children,dataset:{taskFeature:"task"},syncOptions:{syncIdField:"taskBarFeature"}},...s.wrapperChildren],style:{transform:`translate(${s.left}px, ${s.top}px)`,height:s.height,width:s.width,zIndex:s.zIndex},dataset:{taskId:s.taskId},elementData:s,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};r.gantt.trigger("beforeRenderTask",{renderData:s,domConfig:i}),r.rowMap.set(e,[i,...s.extraConfigs])}onRenderDone(){const{gantt:e}=this,t=Array.from(this.rowMap.values()).flat();bo.sync({domConfig:{onlyChildren:!0,children:t},targetElement:e.foregroundCanvas,syncIdField:"taskId",callback({action:t,domConfig:r,lastDomConfig:n,element:s}){if("none"!==t&&r&&r.className&&r.className[e.eventCls+"-wrap"]){const i=MC[t];if(RC[t]&&n){const t={renderData:n.elementData,taskRecord:n.elementData.taskRecord,element:s};e.trigger("releaseTask",t)}if(i){const n={renderData:r.elementData,taskRecord:r.elementData.taskRecord,element:s};n.reusingElement="reuseElement"===t,e.trigger("renderTask",n)}}}})}redraw(e){const t=this.gantt.rowManager.getRowFor(e);if(t){const e=t.getCell(this.gantt.timeAxisColumn.id);e&&(t.renderCell(e),this.onRenderDone())}}}kC._$name="NewTaskRendering";const IC=/-/g;var FC=e=>class extends(e||B){resolveEventRecord(e){return this.resolveTaskRecord(e)}resolveTaskRecord(e){return(e=Et.up(e,this.eventSelector))?this.taskStore.getById(e.dataset.taskId):null}getElementFromTaskRecord(e,t=!0){return this.taskRendering.getElementFromTaskRecord(e,t)}getElementFromEventRecord(e){return this.getElementFromTaskRecord(e)}getEventRenderId(e){return`${this.id.toString().replace(IC,"_")}-${e.id}`}getEventData(e){const t=this,r=t.resolveTimeSpanRecord(e.target);if(r){const e=t.getCell({record:r,column:t.timeAxisColumn}),n=ei.get(e),s=n.id,i=n.columnId;return{cellElement:e,cellData:n,columnId:i,id:s,record:r,cellSelector:{id:s,columnId:i}}}return super.getEventData(e)}get widgetClass(){}},AC=e=>class extends(e||B){getScheduleRegion(e,t){const r=this,n=r.timeAxisSubGridElement;let s;if(e){const t=r.getElementFromTaskRecord(e);if(s=Xt.from(r.getRowById(e.id).getElement("locked")),t){const e=Xt.from(t,n);s.y=e.y,s.bottom=e.bottom}else s.y=s.y+r.barMargin,s.bottom=s.bottom-r.barMargin}else s=Xt.from(n).moveTo(null,0),s.width=n.scrollWidth,s.y=s.y+r.barMargin,s.bottom=s.bottom-r.barMargin;const i=r.timeAxis.startDate,o=r.timeAxis.endDate,a=r.getDateConstraints(e)||{start:i,end:o},l=s.y,c=s.bottom;let d=r.getCoordinateFromDate(je.max(i,a.start)),u=r.getCoordinateFromDate(je.min(o,a.end));return t||(d=r.translateToPageCoordinate(d),u=r.translateToPageCoordinate(u)),{top:l,right:Math.max(d,u),bottom:c,left:Math.min(d,u)}}translateToPageCoordinate(e){const t=this.timeAxisSubGridElement;return e+t.getBoundingClientRect().left-t.scrollLeft}isRowVisible(e){return this.store.indexOf(e)>=0}getTaskBox(e,t=!1,r=!1){return this.taskRendering.getTaskBox(...arguments)}getSizeAndPosition(){return this.taskRendering.getSizeAndPosition(...arguments)}get widgetClass(){}};const PC={block:"nearest",edgeOffset:20};var LC=e=>class extends(e||B){scrollTaskIntoView(e,t=PC){let r,n=e.startDate,s=e.endDate;const i=this;if(null==t.edgeOffset&&(t.edgeOffset=20),!e.isScheduled)return this.scrollRowIntoView(e,t);n=n||s,s=s||n;const o=n<i.timeAxis.startDate|(s>i.timeAxis.endDate)<<1;if(o&&!1!==t.extendTimeAxis){const e=i.timeAxis.endDate-i.timeAxis.startDate;let t,r;3===o?i.timeAxis.setTimeSpan(new Date(n.valueOf()-e/2),new Date(s.getTime()+e/2)):(t=i.getCoordinateFromDate(1&o?s:n),1&o?i.timeAxis.setTimeSpan(new Date(n),new Date(n.valueOf()+e)):i.timeAxis.setTimeSpan(new Date(s.valueOf()-e),new Date(s)),r=1&o?i.getCoordinateFromDate(s):i.getCoordinateFromDate(n),i.timeAxisSubGrid.scrollable.scrollBy(r-t))}if(r=i.getElementFromTaskRecord(e),r){return i.timeAxisSubGrid.scrollable.scrollIntoView(r,ze.assign({silent:!0},t))}return i.scrollUnrenderedTaskIntoView(e,t)}scrollUnrenderedTaskIntoView(e,t=PC){null==t.edgeOffset&&(t.edgeOffset=20);const r=this,n=r.timeAxisSubGrid.scrollable,s=r.getTaskBox(e),i=n.viewport,o=s.translate(i.x-n.x,i.y-n.y);let a=n.scrollIntoView(o,Object.assign({},t,{highlight:!1}));if(t.highlight||t.focus){const n=r.on({renderTask({taskRecord:r,element:s}){r===e&&(n(),a=a.then(()=>{t.highlight&&Et.highlight(s),t.focus&&s.focus()}))}})}else a=Promise.all([a,new Promise(t=>{const n=r.on({renderTask({taskRecord:r}){r===e&&(n(),t())}})})]);return a}get widgetClass(){}};const OC=["barMargin"];var _C=e=>class extends(e||B){getState(){const e=ze.copyProperties(super.getState(),this,OC);return e.zoomLevel=this.zoomLevel,e.zoomLevelOptions={startDate:this.startDate,endDate:this.endDate,centerDate:this.viewportCenterDate,width:this.tickSize},e}applyState(e){e.zoomLevel&&this.zoomToLevel(e.zoomLevel,e.zoomLevelOptions),ze.copyProperties(this,e,OC),super.applyState(e)}get widgetClass(){}},$C=e=>class extends(e||B){get project(){return this._project}set project(e){this._project=e,this.onTaskStoreChange(e.eventStore)}set tasks(e){this.taskStore.data=e}get eventStore(){return this.project.eventStore}get taskStore(){return this.eventStore}onTaskStoreChange(e){const t=this;e.metaMapId=t.id,t.store=t.timeAxisViewModel.store=e,t.dependencyStore=this.project.dependencyStore,t.features.dependencies&&(t.features.dependencies.store=t.dependencyStore),t.currentOrientation.bindTaskStore(e)}get assignmentStore(){return this.project.assignmentStore}bindAssignmentStore(e,t){}get resourceStore(){return this.project.resourceStore}bindResourceStore(e,t){}get widgetClass(){}},jC=e=>class extends(e||B){getDisplayEndDate(e,t){return e}get widgetClass(){}},HC=e=>class extends(e||B){static get defaultConfig(){return{navigator:{inlineFlow:!1,prevKey:"ArrowUp",nextKey:"ArrowDown",keys:{ArrowLeft:()=>{},ArrowRight:()=>{},Enter:"onTaskEnterKey"}}}}processEvent(e){const t=this,r=Et.up(e.target,t.eventSelector);return!t.navigator.disabled&&r&&(e.taskRecord=e.eventRecord=t.resolveTaskRecord(r),"click"===e.type&&t.selectEvent(e.taskRecord,e.ctrlKey||e.metaKey)),e}selectEvent(e,t=!1){this.selectRow({record:e.id,column:!1,addToSelection:t})}deselectEvent(e){this.deselectRow(e.id)}getNext(e){const t=this,{taskStore:r}=t;for(let n=r.indexOf(e)+1;n<r.count;n++){const e=r.getAt(n);if(t.isInTimeAxis(e))return e}}getPrevious(e){const t=this,{taskStore:r}=t;for(let n=r.indexOf(e)-1;n>=0;n--){const e=r.getAt(n);if(t.isInTimeAxis(e))return e}}navigateTo(e,t={}){const r=this;e&&(r.navigator.disabled=!0,r.scrollTaskIntoView(e,{animate:100}).then(()=>{r.navigator.disabled=!1,r.activeEvent=e,r.navigator.trigger("navigate",{event:t,item:r.getElementFromTaskRecord(e).parentNode})}))}clearEventSelection(){this.deselectAll()}onTaskEnterKey(){}get widgetClass(){}};const NC=te.mergeLocales(uy,{Object:{Save:"Save"},AddNewColumn:{"New Column":"New Column"},CalendarColumn:{Calendar:"Calendar"},EarlyStartDateColumn:{"Early Start":"Early Start"},EarlyEndDateColumn:{"Early End":"Early End"},LateStartDateColumn:{"Late Start":"Late Start"},LateEndDateColumn:{"Late End":"Late End"},TotalSlackColumn:{"Total Slack":"Total Slack"},ConstraintDateColumn:{"Constraint Date":"Constraint Date"},ConstraintTypeColumn:{"Constraint Type":"Constraint Type"},DeadlineDateColumn:{Deadline:"Deadline"},DependencyColumn:{"Invalid dependency found, change is reverted":"Invalid dependency found, change is reverted"},DurationColumn:{Duration:"Duration"},EffortColumn:{Effort:"Effort"},EndDateColumn:{Finish:"Finish"},EventModeColumn:{"Event mode":"Event mode",Manual:"Manual",Auto:"Auto"},ManuallyScheduledColumn:{"Manually scheduled":"Manually scheduled"},MilestoneColumn:{Milestone:"Milestone"},NameColumn:{Name:"Name"},NoteColumn:{Note:"Note"},PercentDoneColumn:{"% Done":"% Done"},PredecessorColumn:{Predecessors:"Predecessors"},ResourceAssignmentColumn:{"Assigned Resources":"Assigned Resources","more resources":"more resources"},RollupColumn:{Rollup:"Rollup"},SchedulingModeColumn:{"Scheduling Mode":"Scheduling Mode"},SequenceColumn:{Sequence:"Sequence"},ShowInTimelineColumn:{"Show in timeline":"Show in timeline"},StartDateColumn:{Start:"Start"},SuccessorColumn:{Successors:"Successors"},WBSColumn:{WBS:"WBS"},ProjectLines:{"Project Start":"Project start","Project End":"Project end"},TaskTooltip:{Start:"Start",End:"End",Duration:"Duration",Complete:"Complete"},AssignmentGrid:{Name:"Resource name",Units:"Units",unitsTpl:({value:e})=>e?e+"%":""},AssignmentEditGrid:{Name:"Resource name",Units:"Units"},Gantt:{Edit:"Edit task",Indent:"Indent",Outdent:"Outdent","Convert to milestone":"Convert to milestone",Add:"Add...","New task":"New task","New milestone":"New milestone","Task above":"Task above","Task below":"Task below","Delete task":"Delete task",Milestone:"Milestone","Sub-task":"Subtask",Successor:"Successor",Predecessor:"Predecessor",changeRejected:"Scheduling engine rejected the changes"},GanttCommon:{dependencyTypes:["SS","SF","FS","FF"]},Indicators:{earlyDates:"Early start/end",lateDates:"Late start/end",Start:"Start",End:"End",deadlineDate:"Deadline"}});te.trimLocale(NC,{EventEdit:["Repeat"],RecurrenceCombo:{},RecurrenceConfirmationPopup:{},RecurrenceDaysCombo:{},RecurrenceEditor:{},RecurrenceFrequencyCombo:{},RecurrenceLegend:{},RecurrencePositionsCombo:{},RecurrenceStopConditionCombo:{}}),ne.registerLocale("En",{desc:"English",locale:NC});const BC=Object.freeze({});let zC=0;class VC extends(Qn(Tu).mixes(Dc,FC,AC,LC,_C,$C,jC,Zu,HC)){static get $name(){return"GanttBase"}static get defaultConfig(){return{project:null,resourceImageFolderPath:null,defaultResourceImageName:null,calendars:null,resources:null,tasks:null,dependencies:null,assignments:null,eventCls:"b-gantt-task",eventBarTextField:null,eventLayout:"none",eventSelectionDisable:!0,eventColor:null,eventStyle:null,rowHeight:45,scheduledEventName:"task",eventScrollMode:"move",overScheduledEventClass:"b-gantt-task-hover",mode:"horizontal",timeCellCls:"b-sch-timeaxis-cell",timeCellSelector:".b-sch-timeaxis-cell",focusCls:"b-active",durationDisplayPrecision:1,taskRenderer:null}}get isGantt(){return!0}construct(e){const t=this,r=Boolean(e.calendars||e.taskStore||e.dependencyStore||e.resourceStore||e.assignmentStore),n=Boolean(e.calendars||e.tasks||e.dependencies||e.resources||e.assignments);e.features||(e.features={}),"tree"in e.features||(e.features.tree=!0);let s=e.project;if(s&&(r||n))throw new Error("Providing both project and inline data is not supported");s instanceof Wb||(s=e.project=new Wb(ze.assign({calendarsData:e.calendars,eventsData:e.tasks,dependenciesData:e.dependencies,resourcesData:e.resources,assignmentsData:e.assignments,resourceStore:e.resourceStore,eventStore:e.taskStore,assignmentStore:e.assignmentStore,dependencyStore:e.dependencyStore,timeRangeStore:e.timeRangeStore},s)),delete e.resourceStore,delete e.taskStore,delete e.assignmentStore,delete e.dependencyStore,delete e.timeRangeStore,delete e.calendars,delete e.resources,delete e.tasks,delete e.assignments,delete e.dependencies),s.getEventStore().on({add:t.onTaskStoreAddOrRemove,remove:t.onTaskStoreAddOrRemove,prio:-1,thisObj:t}),s.on({eventstorechanged:t.onTaskStoreChange,refresh:t.onProjectRefresh,load:t.onProjectLoad,commit:t.onProjectCommit,prio:1e3,thisObj:t}),e.crudManager=s,super.construct(e),t.features.cellEdit&&(t.features.cellEdit.addNewAtEnd={name:t.L("L{Gantt.New task}"),startDate:s.startDate,duration:1,durationUnit:t.timeAxis.unit}),t.on("taskclick",t.onTaskBarClick,t)}get columns(){return super.columns}set columns(e){if(e){let t=e;Array.isArray(e)||(t=e.data,this._thisIsAUsedExpression(this.taskStore)),t.some(e=>{const t=e instanceof Da?e.constructor:Ea.getColumnClass(e.type)||Da;return t===Py||t.prototype instanceof Py})||t.unshift({type:"name"})}super.columns=e}set timeAxisViewModel(e){super.timeAxisViewModel=e,this.taskStore&&(this.timeAxisViewModel.store=this.taskStore)}get timeAxisViewModel(){return super.timeAxisViewModel}onStoreUpdateRecord(e){if(!this.project.isPropagating()){let t;return this.runWithTransition(()=>{t=super.onStoreUpdateRecord(e)}),t}}onProjectCommit({records:e}){if(this.isPainted){const{rowManager:t}=this,r=[];for(const n of e)if(n.isTask&&this.taskStore.isAvailable(n)){const e=t.getRowFor(n);e&&r.push(e)}r.sort((e,t)=>e.index-t.index),this.runWithTransition(()=>{t.renderRows(r)})}}onTaskStoreAddOrRemove({isExpand:e,isCollapse:t}){e||t||this.project.stm.isRestoring||this.project.isPropagating()||this.project.propagate()}onProjectRefresh(){this.refreshRows();const e=this.features.dependencies;this.dependencies.forEach(t=>e.addToGridCache(t))}onProjectLoad(){const e=this;!("startDate"in e.initialConfig)&&e.project.startDate&&(e.startDate=e.project.startDate)}onTaskDataGenerated(){}onTaskBarClick({taskRecord:e}){e.isLeaf||this.toggleCollapse(e)}triggerChangeEvent(e,t){super.triggerChangeEvent(e,t);const r=this;function n(e,t){const n=r.getElementFromTaskRecord(e);n&&n.classList[t?"add":"remove"]("b-task-selected")}"row"===e.mode&&(e.selected.map(e=>n(e,!0)),e.deselected.map(e=>n(e,!1)))}toggleEmptyText(){this.bodyContainer&&Et.toggleClasses(this.bodyContainer,"b-grid-empty",!(this.rowManager.rowCount||this.project.isLoadingOrSyncing))}get currentOrientation(){const e=this;return e._currentOrientation||(e.taskRendering=e._currentOrientation=new kC(e)),e._currentOrientation}getTimeSpanMouseEventParams(e,t){const r=this.resolveTaskRecord(e);return r?{taskRecord:r,taskElement:e,event:t}:null}getScheduleMouseEventParams(e){return{taskRecord:this.store.getById(e.id)}}resolveTimeSpanRecord(e){return this.resolveTaskRecord(e)}repaintEventsForResource(e){this.taskRendering.redraw(e)}async addTask(e,t=BC){const r=this,{milestone:n,above:s,asChild:i,asPredecessor:o,asSuccessor:a}=t,l=r.store.getProject(),c=e.parent,d=e.copy();return d.name=n?`${r.L("L{Gantt.New milestone}")} ${++zC}`:`${r.L("L{Gantt.New task}")} ${++zC}`,i?e.insertChild(d,e.firstChild):s?e.parent.insertChild(d,e):c.insertChild(d,e.nextSibling),n?(await l.waitForPropagateCompleted(),await d.convertToMilestone()):l.isPropagating()||await l.propagate(),a?r.dependencyStore.add({fromEvent:e,toEvent:d,type:Nh.EndToStart,fromSide:"right",toSide:"left"}):o&&r.dependencyStore.add({fromEvent:d,toEvent:e,type:Nh.EndToStart,fromSide:"right",toSide:"left"}),(a||o)&&await l.propagate(),d}addTaskAbove(e){return this.addTask(e,{above:!0})}addTaskBelow(e){return this.addTask(e)}addMilestonBelow(e){return this.addTask(e,{milestone:!0})}addSubtask(e){const t=this.addTask(e,{asChild:!0});return this.toggleCollapse(e,!1),t}addSuccessor(e){return this.addTask(e,{asSuccessor:!0})}addPredecessor(e){return this.addTask(e,{above:!0,asPredecessor:!0})}async indent(e){const t=this,r=await t.taskStore.indent(e);return r===Vg.Canceled&&Tn.show(t.L("L{Gantt.changeRejected}")),r}async outdent(e){const t=this,r=await t.taskStore.outdent(e);return r===Vg.Canceled&&Tn.show(t.L("L{Gantt.changeRejected}")),r}}VC._$name="GanttBase",U.register("ganttbase",VC),A.setVersion("gantt","2.1.9");class WC extends hd{static get $name(){return"TaskDrag"}static get defaultConfig(){return{validatorFn:(e,t,r,n)=>!0,validatorFnThisObj:null,tooltipCls:"b-gantt-taskdrag-tooltip"}}construct(e,t){this.gantt=e,this.store=e.taskStore,super.construct(e,t)}isElementDraggable(e,t){const{gantt:r}=this,n=Et.up(e,r.eventSelector),{taskResize:s}=r.features;if(!n)return!1;if(e.matches('[class$="-handle"]'))return!1;const i=r.resolveTaskRecord(n);return!(!i||!i.isDraggable)&&(!(s&&!i.isMilestone&&s.resize.overAnyHandle(t,n))&&!1!==r.trigger("beforeTaskDrag",{taskRecord:i}))}triggerEventDrag(e,t){this.gantt.trigger("taskDrag",{taskRecords:e.draggedRecords,startDate:e.startDate,endDate:e.endDate,dragData:e,changed:e.startDate-t!=0})}getProductDragContext(e){return{valid:!0}}setupProductDragData(e){const t=this.gantt,r=e.element,n=t.resolveTaskRecord(r),s=Xt.from(r),i=this.getRelatedRecords(n)||[],o=t.getDateConstraints(n);let a=[r];this.setupConstraints(t.getScheduleRegion(n),s,t.timeAxisViewModel.snapPixelAmount,Boolean(o)),i.forEach(e=>{z.include(a,t.getElementFromTaskRecord(e,!1))});const l=[n,...i];return{record:n,dateConstraints:o,eventBarEls:a,draggedRecords:l}}getCoordinate(e,t,r){return r[0]}checkDragValidity(e,t){return this.validatorFn.call(this.validatorFnThisObj||this,e.draggedRecords,e.startDate,e.duration,t)}isValidDrop(e){return!0}async updateRecords(e){const t=e.draggedRecords[0],r=t.startDate,n=e.startDate,s=t.setStartDate(n,!0);return await s,t.startDate-r?this.gantt.trigger("taskDrop",{taskRecords:e.draggedRecords}):this.dragData.valid=!1,s}}WC._$name="TaskDrag",Va.registerFeature(WC,!0,"Gantt");class GC extends xd{static get $name(){return"TaskDragCreate"}static get defaultConfig(){return{preventMultiple:!0,validatorFn:()=>{}}}construct(e,t){this.gantt=e,this.store=e.taskStore,super.construct(e,t)}async finalizeDragCreate(e){const{taskRecord:t}=e;t.beginBatch(),t.setStartDate(e.startDate),t.setEndDate(e.endDate),t.endBatch(),await this.gantt.project.propagate(),this.gantt.trigger("dragCreateEnd",{taskRecord:t,event:e.event,proxyElement:this.proxy})}handleBeforeDragCreate(e,t){const r=this,n=r.gantt.trigger("beforeDragCreate",{taskRecord:r.createContext.taskRecord,date:e,event:t});if(n){const e=r.gantt.features.scheduleTooltip;e&&e.hoverTip&&e.hoverTip.hide()}return r.dateConstraints=r.gantt.getDateConstraints(r.createContext.rowRecord,e),n}checkValidity(e,t){return e.taskRecord=e.rowRecord,this.validatorFn.call(this.validatorFnThisObj||this,e,t)}isRowEmpty(e){return!e.startDate||!e.endDate}}GC._$name="TaskDragCreate",Va.registerFeature(GC,!0,"Gantt");class UC extends qd{static get $name(){return"TaskResize"}getTimespanRecord(e){return e.taskRecord}getRowRecord(e){return e.taskRecord}setupProductResizeContext(e,t){const r=this.client,n=r.resolveTaskRecord(e.element);Object.assign(e,{taskRecord:n,dateConstraints:r.getDateConstraints(n)})}get store(){return this.client.taskStore}internalUpdateRecord(e,t){const r=t.run("calculateProjectedDuration",e.startDate,e.endDate);return r===t.duration?(e.element.lastDomConfig.style.width=null,!1):(t.setDuration(r),!0)}createResizeHelper(){const e=this,t=e.client;return new No({name:e.constructor.name,isElementResizable:(t,r)=>e.isElementResizable(t,r),targetSelector:t.eventSelector,resizingCls:"b-sch-event-resizing",allowResize:e.isElementResizable.bind(e),outerElement:t.timeAxisSubGridElement,scrollManager:t.scrollManager,leftHandle:!1,dragThreshold:0,dynamicHandleSize:!0,reservedSpace:5,listeners:{beforeresizestart:e.onBeforeResizeStart,resizestart:e.onResizeStart,resizing:e.onResizing,resize:e.onFinishResize,cancel:e.onCancelResize,thisObj:e},highlightHandle(){const e=Et.up(this.currentElement,this.targetSelector),r=Et.up(this.currentElement,t.eventInnerSelector);r&&(r.classList.add("b-resize-handle"),e.classList.add("b-over-resize-handle"))},unHighlightHandle(){const e=Et.up(this.currentElement,this.targetSelector);e&&e.classList.remove("b-over-resize-handle");const r=Et.up(this.currentElement,t.eventInnerSelector);r&&r.classList.remove("b-resize-handle"),this.currentElement=null}})}}UC._$name="TaskResize",Va.registerFeature(UC,!0,"Gantt");class YC extends VC{static get $name(){return"Gantt"}}YC._$name="Gantt",U.register("gantt",YC);class qC extends un{static get $name(){return"AssignmentEditGrid"}static get defaultConfig(){return{id:"assignmenteditgrid",cls:"b-assignmenteditgrid",items:[{type:"button",cls:"b-add-button green",icon:"plus",id:"assignmenteditgrid-add"},{type:"button",cls:"b-remove-button red",icon:"trash",disabled:!0,id:"assignmenteditgrid-remove"},{type:"grid",id:"assignmenteditgrid-grid",storeConfig:{modelClass:Fb},columns:[{field:"name",text:"L{Name}",flex:1,editor:{type:"combo",textField:"name",valueField:"id"}},{field:"units",text:"L{Units}",width:80}]}]}}afterConfigure(){super.afterConfigure();const e=this,t=e.addButton=J.getById("assignmenteditgrid-add"),r=e.removeButton=J.getById("assignmenteditgrid-remove"),n=e.grid=J.getById("assignmenteditgrid-grid").grid;t&&t.on("click",e.onAddClick,e),r&&r.on("click",e.onRemoveClick,e),n.on({rowselect:()=>r.enable()})}}qC._$name="AssignmentEditGrid";class XC extends Ch{static get $name(){return"Timeline"}static get type(){return"timeline"}construct(e){const t=this;if(t.startDateLabel=document.createElement("label"),t.startDateLabel.className="b-timeline-startdate",t.endDateLabel=document.createElement("label"),t.endDateLabel.className="b-timeline-enddate",super.construct(e),!t.project)throw new Error("You need to configure the Timeline with a Project");t.project instanceof Wb||(t.project=new Wb(t.project)),t.taskStore=t.project.taskStore,t.features.timeRanges.store=new Cs,t.fillFromTaskStore(),t.fillFromTaskStore=t.buffer(t.fillFromTaskStore,100),t.taskStore.on({refresh:t.fillFromTaskStore,change:t.onTaskStoreChange,thisObj:t}),t.on({resize:t.onSizeChanged,thisObj:t}),t.bodyContainer.appendChild(t.startDateLabel),t.bodyContainer.appendChild(t.endDateLabel),ne.on({locale:"onLocaleChange",thisObj:t})}static get defaultConfig(){return{height:"13em",eventLayout:"pack",barMargin:1,readOnly:!0,forceFit:!0,zoomOnMouseWheel:!1,zoomOnTimeAxisDoubleClick:!1,eventColor:null,eventStyle:null,rowHeight:48,displayDateFormat:"L",features:{columnLines:!1,eventContextMenu:!1,contextMenu:!1,scheduleContextMenu:!1,timeRanges:{showCurrentTimeLine:!0}},resources:[{id:1}],columns:[]}}onSizeChanged({width:e,oldWidth:t}){this.suspendRefresh(),this.updateRowHeight(),this.resumeRefresh(),e!==t&&this.fitTimeline()}updateRowHeight(){this.rowHeight=this.bodyContainer.offsetHeight}fitTimeline(){this.eventStore.count>0&&this.zoomToFit({leftMargin:50,rightMargin:50}),this.updateStartEndLabels()}updateStartEndLabels(){const e=this;e.startDateLabel.innerHTML=e.getFormattedDate(e.startDate),e.endDateLabel.innerHTML=e.getFormattedDate(e.endDate)}async onTaskStoreChange(e){const t=this,r=t.eventStore;let n;switch(e.action){case"add":e.records.forEach(e=>{e.showInTimeline&&(r.add(t.cloneTask(e)),n=!0)});break;case"remove":e.isCollapse||e.records.forEach(e=>{e.showInTimeline&&(r.remove(e.id),n=!0)});break;case"removeall":t.fillFromTaskStore();break;case"update":const s=e.record;if(e.changes.showInTimeline)s.showInTimeline?r.add(t.cloneTask(s)):r.remove(r.getById(s.id)),n=!0;else if(s.showInTimeline){const e=r.getById(s.id);if(e){const t=Object.assign({},s.data);delete t.expanded,e.set(t),n=!0}}}n&&t.fitTimeline()}cloneTask(e){return{id:e.id,resourceId:1,startDate:e.startDate,endDate:e.endDate,duration:e.duration,durationUnit:e.durationUnit,name:e.name}}render(){super.render(),this.updateRowHeight()}fillFromTaskStore(){const e=this,t=[];e.taskStore.traverse(r=>{r.showInTimeline&&r.isScheduled&&t.push(e.cloneTask(r))}),e.suspendRefresh(),e.events=t,e.resumeRefresh(),e.fitTimeline()}onLocaleChange(){this.updateStartEndLabels()}}XC._$name="Timeline",U.register(XC.type,XC);class KC extends(window.customElements?HTMLElement:Object){constructor(){super();const e=this,t=[],r={};let n;for(let s of e.children)if("COLUMN"===s.tagName){const e=parseInt(s.dataset.width),r=parseInt(s.dataset.flex),n={field:s.dataset.field,text:s.innerHTML,type:s.dataset.type};e?n.width=e:n.flex=r||1,t.push(n)}else if("PROJECT"===s.tagName)n=new Wb({transport:{load:{url:s.dataset.loadUrl}}});else if("FEATURE"===s.tagName){const e=s.dataset.name,t=Object.assign({},s.dataset);delete t.name,Object.keys(t).length?r[e]=t:r[e]="false"!==s.textContent}const s=Object.assign({},e.dataset),i=s.theme||"stockholm",o=this.attachShadow({mode:"open"}),a=document.createElement("link");delete s.theme,a.rel="stylesheet",a.href=`../../build/gantt.${i}.css`,a.onload=()=>{const e=document.createElement("div");e.id="container",e.style.width="100%",e.style.height="100%",o.appendChild(e),Jr(o),Object.assign(s,{appendTo:e,columns:t,features:r,project:n});const i=new YC(s);n instanceof Wb&&n.load(),window.gantt||(window.gantt=i)},o.appendChild(a)}}try{window.customElements&&window.customElements.define("bryntum-gantt",KC)}catch(e){}KC._$name="GanttTag",window.bryntum||(window.bryntum={});export{Sc as AbstractCrudManager,xa as ActionColumn,py as AddNewColumn,gg as AdvancedTab,Ta as AggregateColumn,ee as AjaxHelper,Ds as AjaxStore,fc as AjaxTransport,xb as AllColumns,z as ArrayHelper,qC as AssignmentEditGrid,fb as AssignmentField,mb as AssignmentGrid,Rb as AssignmentModel,pb as AssignmentPicker,Mb as AssignmentStore,Uy as AssignmentsManipulationModel,gb as AssignmentsManipulationStore,kn as Badge,an as Bag,al as Bar,B as Base,Pb as Baseline,Yb as Baselines,ga as BooleanCombo,P as BrowserHelper,Qs as BryntumWidgetAdapter,U as BryntumWidgetAdapterRegister,An as Button,Pn as ButtonGroup,go as CSSHelper,vy as CalendarColumn,_b as CalendarIntervalModel,$b as CalendarModel,_s as CalendarPanel,qb as CellEdit,Wa as CellTooltip,Ma as CheckColumn,Hn as Checkbox,ks as ChipView,Ln as ClickRepeater,Fr as Collection,Cr as CollectionFilter,wr as CollectionSorter,Da as Column,Ga as ColumnDragToolbar,dd as ColumnLines,Ua as ColumnPicker,Ya as ColumnReorder,qa as ColumnResize,Ea as ColumnStore,As as Combo,by as ConstraintDateColumn,jh as ConstraintType,Cy as ConstraintTypeColumn,ug as ConstraintTypePicker,un as Container,Xa as ContextMenu,Xb as CriticalPaths,pp as CrudManager,Dc as CrudManagerView,zo as DataGenerator,ka as DateColumn,Vs as DateField,je as DateHelper,zs as DatePicker,wy as DeadlineDateColumn,br as Delayable,Wo as DemoBot,Jb as Dependencies,od as DependencyBaseModel,Wy as DependencyColumn,au as DependencyCreation,Qb as DependencyEdit,Ny as DependencyField,kb as DependencyModel,Ib as DependencyStore,ag as DependencyTab,rg as DependencyTypePicker,ma as DisplayField,Ve as DomClassList,ei as DomDataStore,Et as DomHelper,bo as DomSync,hd as DragBase,Fo as DragHelper,ti as Duration,Sy as DurationColumn,pa as DurationField,Dy as EarlyEndDateColumn,Ey as EarlyStartDateColumn,Bs as Editor,bg as EffectResolutionResult,xy as EffortColumn,Kh as EffortField,My as EndDateColumn,_h as EndDateField,Uh as EventChangePropagator,pd as EventContextMenu,Ed as EventDrag,Td as EventDragCreate,Gd as EventEdit,Ud as EventFilter,gr as EventHelper,Gh as EventLoader,Tb as EventModeColumn,Uc as EventModel,Xd as EventResize,Yc as EventStore,Zd as EventTooltip,G as Events,Lh as ExcelExporter,bl as ExportOrientationCombo,yl as ExportRowsCombo,jn as Field,fa as FileField,pl as FileFormat,va as FilePicker,Ka as Filter,Za as FilterBar,ya as FlagField,qh as FormTab,Go as Fullscreen,Zt as FunctionHelper,YC as Gantt,VC as GanttBase,yy as GanttDateColumn,KC as GanttTag,fg as GanttTaskEditor,Zh as GeneralTab,Yr as GlobalEvents,mc as Grid,dc as GridBase,Al as GridExcelExporter,Cl as GridExportDialog,Va as GridFeatureManager,Tl as GridMultiPageExporter,Rl as GridMultiPageVerticalExporter,kl as GridPdfExport,ja as GridRowModel,Ml as GridSinglePageExporter,Ja as Group,el as GroupSummary,jl as Header,Jd as HeaderContextMenu,Qd as HeaderZoom,gh as HorizontalTimeAxis,K as IdHelper,oC as Indicators,Nn as InstancePlugin,iC as Labels,ky as LateEndDateColumn,Iy as LateStartDateColumn,Ms as List,te as LocaleHelper,ne as LocaleManager,ae as Localizable,Fy as ManuallyScheduledColumn,Qr as Mask,xn as Menu,Dn as MenuItem,ba as MessageDialog,Ay as MilestoneColumn,Vb as MinimalGanttProject,Jn as Model,Os as Month,fC as MultiPageExporter,vC as MultiPageVerticalExporter,Py as NameColumn,tu as NonWorkingTime,Ly as NoteColumn,mg as NotesTab,Gs as NumberField,ze as ObjectHelper,ml as Orientation,Yo as Override,Ca as PagingToolbar,ru as Pan,fn as Panel,gl as PaperFormat,ha as Parser,bC as PdfExport,aC as PercentBar,Ia as PercentColumn,Oy as PercentDoneColumn,Bn as Pluggable,Kt as Point,vn as Popup,Gy as PredecessorColumn,cg as PredecessorsTab,Kc as PresetManager,Xc as PresetStore,vg as ProAssignmentAPI,Yv as ProAssignmentModel,Kv as ProAssignmentStore,Gm as ProCalendarIntervalModel,Qv as ProCalendarManagerStore,mp as ProCalendarModel,pp as ProCrudManager,Cp as ProDataAPI,wp as ProDependencies,vp as ProDependencyAPI,kp as ProDependencyModel,Av as ProDependencyStore,fp as ProEventAPI,Ip as ProEventDrag,Fp as ProEventDragCreate,Ap as ProNonWorkingTime,bp as ProProjectAPI,oy as ProProjectModel,yp as ProResourceAPI,jv as ProResourceModel,Bv as ProResourceStore,hy as ProScheduler,ay as ProSchedulerStores,gy as ProSubProjectModel,dy as ProTaskEdit,ly as ProTaskEditStm,Nf as ProTaskModel,my as ProTaskSegmentModel,Rv as ProTaskStore,lC as ProgressLine,TC as ProjectGenerator,cC as ProjectLines,Wb as ProjectModel,zh as ProjectType,tl as QuickFind,Bo as RandomGenerator,Aa as RatingColumn,Xt as Rectangle,lu as RectangularPathFinder,rl as RegionResize,No as ResizeHelper,vr as ResizeMonitor,yb as ResourceAssignmentColumn,ub as ResourceAssignmentParser,Oh as ResourceInfoColumn,Fb as ResourceModel,Ab as ResourceStore,iu as ResourceTimeRanges,dg as ResourcesTab,on as Ripple,Ty as RollupColumn,dC as Rollups,Ol as RowManager,Pa as RowNumberColumn,nl as RowReorder,hl as RowsRange,ou as ScheduleContextMenu,Eh as ScheduleRange,xh as ScheduleRangeCombo,Ch as Scheduler,xc as SchedulerAssignmentModel,Jc as SchedulerAssignmentStore,ed as SchedulerCalendar,Qc as SchedulerCalendarDayModel,cd as SchedulerCrudManager,uu as SchedulerDependencies,gu as SchedulerDependencyEdit,ad as SchedulerDependencyModel,ld as SchedulerDependencyStore,Th as SchedulerExportDialog,eg as SchedulerGeneralTab,kh as SchedulerMultiPageExporter,Ih as SchedulerMultiPageVerticalExporter,Ah as SchedulerPdfExport,gg as SchedulerProAdvancedTab,Qh as SchedulerProCalendarField,ug as SchedulerProConstraintTypePicker,ag as SchedulerProDependencyTab,rg as SchedulerProDependencyTypePicker,ng as SchedulerProDurationColumn,Kh as SchedulerProEffortField,Uh as SchedulerProEventChangePropagator,Gh as SchedulerProEventLoader,qh as SchedulerProFormTab,Zh as SchedulerProGeneralTab,Jh as SchedulerProModelCombo,mg as SchedulerProNotesTab,wg as SchedulerProPartOfProject,cg as SchedulerProPredecessorsTab,Wh as SchedulerProReadyStatePropagator,dg as SchedulerProResourcesTab,hg as SchedulerProSchedulingModePicker,lg as SchedulerProSuccessorsTab,pg as SchedulerProTaskEditorBase,Yh as SchedulerProTaskEditorTab,nd as SchedulerResourceModel,sd as SchedulerResourceStore,Fh as SchedulerSinglePageExporter,wh as SchedulerSummary,cy as SchedulerTaskEditor,Hh as SchedulingMode,bb as SchedulingModeColumn,hg as SchedulingModePicker,Pl as ScrollManager,_r as Scroller,sl as Search,Cb as SequenceColumn,Ry as ShowInTimelineColumn,Sh as SimpleEventEdit,yC as SinglePageExporter,Us as Slider,il as Sort,Sa as Splitter,wb as StartDateColumn,Xh as StartDateField,zn as State,ho as StateTrackingManager,Cs as Store,I as StringHelper,ol as Stripe,sc as SubGrid,CC as SubProjectModel,Sb as SuccessorColumn,lg as SuccessorsTab,cl as Summary,Xs as TabPanel,Ph as TableExporter,uC as TaskContextMenu,gC as TaskEdit,ly as TaskEditStm,hC as TaskEditor,Ob as TaskModel,wC as TaskSegmentModel,Ub as TaskStore,mC as TaskTooltip,La as TemplateColumn,Cn as TemplateHelper,Ks as TextAreaField,Es as TextField,Zc as TimeAxis,ph as TimeAxisColumn,pu as TimeAxisViewModel,Oa as TimeColumn,Js as TimeField,Zs as TimePicker,Dh as TimeRanges,jc as TimeSpan,$h as TimeUnit,XC as Timeline,Tn as Toast,en as Tool,hn as Toolbar,Mn as Tooltip,Db as TotalSlackColumn,yi as Transaction,ul as Tree,$a as TreeColumn,pc as TreeGrid,A as VersionHelper,qc as ViewPreset,Eb as WBSColumn,Vr as Widget,Ra as WidgetColumn,J as WidgetHelper};
//# sourceMappingURL=gantt.module.min.js.map
